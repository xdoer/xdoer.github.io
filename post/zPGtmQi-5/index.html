<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>TS 的一些高级类型写法 |
    文享日志</title>
<meta name="description" content="">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://aiyou.life/favicon.ico?v=1639240595674">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://aiyou.life/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  

<!-- <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script> -->

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


  </head>
  <body>
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://aiyou.life">文享日志</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                首页
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>TS 的一些高级类型写法</h1>
            <p class="article-meta">
              2021-09-03 
              <a
                href="https://aiyou.life/tag/df67loo-n/"
                class="badge success"
              >
                笔记
              </a>
              
              <a
                href="https://aiyou.life/tag/K1r5vpFd_/"
                class="badge "
              >
                前端
              </a>
              
              <a
                href="https://aiyou.life/tag/E75leUW9b/"
                class="badge secondary"
              >
                typescript
              </a>
              
            </p>
            
            <div class="post-content"><p>记录自己想到的和遇到的收集一些高级 TS 类型的代码</p>
<!-- more -->
<h2 id="数组不为空">数组不为空</h2>
<p>一道面试题，如何定义一个不是空数组的数组？</p>
<pre><code class="language-ts">// 怎么定义类型，约束数组中值至少有一项
const a: number[] = []
</code></pre>
<details>
<summary>点击查看答案</summary>
<pre><code class="language-ts">// 解法一
type NotAmptyArray&lt;T&gt; = [T, ...T[]]

// 解法二
type NotAmptyArray&lt;T&gt; = T[] &amp; { 0: T }
</code></pre>
</details>
<h2 id="全部可选的参数对象至少包含一个-key">全部可选的参数对象至少包含一个 key</h2>
<p>自己想出来的一个问题，语言不好描述，看下面代码</p>
<pre><code class="language-ts">interface A {
    a?: number
    b?: boolean
}

declare function main(opt: A): void

// 怎么定义一个类型，使得参数对象中至少包含一个 key？
main({})
</code></pre>
<details>
<summary>点击查看答案</summary>
<pre><code class="language-ts">interface A {
    a: number
    b: boolean
}

type AtLeastOne&lt;T&gt; = {
    [K in keyof T]: Pick&lt;T, K&gt; &amp; Partial&lt;Omit&lt;T, P&gt;&gt;
}[keyof T]

declare function main(opt: AtLeastOne&lt;A&gt;): void

main({ a: 1 })
</code></pre>
</details>
<h2 id="给定的类型可选">给定的类型可选</h2>
<p>在下面的实例中，实现 SetOptional，可使得给定的 key 为可选</p>
<pre><code class="language-ts">type Foo = {
  a: number;
  b?: string;
  c: boolean;
}

// 实现 SetOptional
type SomeOptional = SetOptional&lt;Foo, 'a' | 'b'&gt;;

// type SomeOptional = {
//  a?: number; // 该属性已变成可选的
//  b?: string; // 保持不变
//  c: boolean; 
// }
</code></pre>
<details>
<summary>点击查看答案</summary>
<pre><code class="language-ts">// 解法一
type SetOptional&lt;T, N extends keyof T&gt; = {
  [P in keyof T]: Partial&lt;Pick&lt;T, N&gt;&gt; &amp; Pick&lt;T, Exclude&lt;keyof T, N&gt;&gt;
}[keyof T]

// 解法二
type Simplify&lt;T&gt; = {
  [P in keyof T]: T[P]
}
type SetOptional&lt;T, K extends keyof T&gt; =
 Simplify&lt;Partial&lt;Pick&lt;T, K&gt;&gt; &amp; Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;&gt;
</code></pre>
</details>
<h2 id="条件-pick">条件 Pick</h2>
<p>根据值类型进行筛选</p>
<pre><code class="language-ts">interface Example {
 a: string;
 b: string | number;
 c: () =&gt; void;
 d: {};
}

// 测试用例：
type StringKeysOnly = ConditionalPick&lt;Example, string&gt;;
//=&gt; {a: string}
</code></pre>
<details>
<summary>点击查看答案</summary>
<pre><code class="language-ts">// 首先将类型对应的 key 找出来，然后再进行 Pick
type ConditionalKeys&lt;T, Condition&gt; = {
  [P in keyof T]: T[P] extends Condition ? P : never
}[keyof T]

type ConditionalPick&lt;T, Condition&gt; = Pick&lt;T, ConditionalKeys&lt;T, Condition&gt;&gt;
</code></pre>
</details>
<h2 id="函数插入参数">函数插入参数</h2>
<p>为已有的函数类型增加指定类型的参数，新增的参数名是 x，将作为新函数类型的第一个参数</p>
<pre><code class="language-ts">type Fn = (a: number, b: string) =&gt; number
type AppendArgument&lt;F, A&gt; = // 你的实现代码

type FinalFn = AppendArgument&lt;Fn, boolean&gt; 
// (x: boolean, a: number, b: string) =&gt; number
</code></pre>
<details>
<summary>点击查看答案</summary>
<pre><code class="language-ts">type Fn = (a: number, b: string) =&gt; number

// TS 中内置了 Parameters， 和 ReturnType 可以便捷的获取函数的参数和响应类型
type AppendArgument&lt;F extends ((...args: any) =&gt; any), A&gt; = (x: A, ...args: Parameters&lt;F&gt;) =&gt; ReturnType&lt;F&gt;

type FinalFn = AppendArgument&lt;Fn, boolean&gt;

</code></pre>
</details>
<h2 id="扁平数组">扁平数组</h2>
<pre><code class="language-ts">type NaiveFlat&lt;T extends any[]&gt; = // 你的实现代码

// 测试用例：
type NaiveResult = NaiveFlat&lt;[['a'], ['b', 'c'], ['d']]&gt;
// NaiveResult的结果： &quot;a&quot; | &quot;b&quot; | &quot;c&quot; | &quot;d&quot;
</code></pre>
<details>
<summary>点击查看答案</summary>
<pre><code class="language-ts">type NaiveFlat&lt;T extends any[]&gt; = {
  [P in keyof T]: T[P] extends any[] ? NaiveFlat&lt;T[P]&gt;: T[P]
}[number]
</code></pre>
</details>
<h2 id="强制对象范围">强制对象范围</h2>
<pre><code class="language-ts">type SomeType =  {
  prop: string
}

// 更改以下函数的类型定义，让它的参数只允许严格SomeType类型的值
function takeSomeTypeOnly(x: SomeType) { return x }

// 测试用例：
const x = { prop: 'a' };
takeSomeTypeOnly(x) // 可以正常调用

const y = { prop: 'a', addditionalProp: 'x' };
takeSomeTypeOnly(y) // 将出现编译错误
</code></pre>
<details>
<summary>点击查看答案</summary>
<pre><code class="language-ts">type Exclusive&lt;T1, T2 extends T1&gt; = {
  [P in keyof T2]: P extends keyof T1 ? T2[P] : never
}

function takeSomeTypeOnly&lt;T extends SomeType&gt;(x: Exclusive&lt;SomeType, T&gt;) { return x }
</code></pre>
</details></div>
          </article>
          <div class="simple-share">
            <a class="share-item" href="javascript:share.qzone()">QQ空间</a>
            <a class="share-item" href="javascript:share.weibo()">微博</a>
            <a class="share-item" href="javascript:share.facebook()"
              >Facebook</a
            >
            <a class="share-item" href="javascript:share.twitter()">Twitter</a>
          </div>
        </div>
        <div class="paper" data-aos="fade-in">
          
          <div class="next-post">
            <div class="next">
              下一篇
            </div>
            <a href="https://aiyou.life/post/QqaRhC3Gf/">
              <h3 class="post-title">Restful-API 的一种动态生成数据类型的方法</h3>
            </a>
          </div>
          
        </div>
         
        <div class="paper" data-aos="fade-in">
          <div id="gitalk-container"></div>
        </div>
          
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img
      src="https://aiyou.life/images/avatar.png?v=1639240595674"
      class="no-responsive avatar"
    />
    <div class="text-muted"></div>
    <div class="social-container">
       
      <a href="https://github.com/xdoer" target="_blank">
        <i class="fab fa-github"></i>
      </a>
        
      <a href="https://twitter.com/xxdoer1" target="_blank">
        <i class="fab fa-twitter"></i>
      </a>
        
      <a href="https://weibo.com/u/7407806835" target="_blank">
        <i class="fab fa-weibo"></i>
      </a>
          
      <a href="https://www.facebook.com/xxdoer" target="_blank">
        <i class="fab fa-facebook"></i>
      </a>
       
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      最新文章
    </div>
    <div class="row">
      <ul>
         
        <li>
          <a href="https://aiyou.life/post/WTBK_yMNR/">账本开发小记</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/7Ta0APQTd/">让生活井井有条</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/Fjnj0JDZ5/">富文本编辑器转为受控组件的一种思路</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/zPGtmQi-5/">TS 的一些高级类型写法</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/QqaRhC3Gf/">Restful-API 的一种动态生成数据类型的方法</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/SV2erlm_4/">几个Demo 看懂 ESM 与 CommonJS 差异</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/UNWTwtWxa/">Taro 自定义 showModal</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/iWhkaOqqO/">写一个倒计时😢？</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/4XYWTWTx/">想到的一些很好的面试题</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/M4RcI3wfU/">由封装一个请求库所想到的</a>
        </li>
                                   
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      标签列表
    </div>
    <div class="row">
      
      <a
        href="https://aiyou.life/tag/df67loo-n/"
        class="badge "
      >
        笔记
      </a>
      
      <a
        href="https://aiyou.life/tag/K1r5vpFd_/"
        class="badge "
      >
        前端
      </a>
      
      <a
        href="https://aiyou.life/tag/E75leUW9b/"
        class="badge warning"
      >
        typescript
      </a>
      
      <a
        href="https://aiyou.life/tag/rSf0tu2pz/"
        class="badge "
      >
        React
      </a>
      
      <a
        href="https://aiyou.life/tag/TfrzxMzWY/"
        class="badge "
      >
        小程序
      </a>
      
      <a
        href="https://aiyou.life/tag/TDgBvCzI8/"
        class="badge success"
      >
        javascript
      </a>
      
      <a
        href="https://aiyou.life/tag/g_6wyy_ol/"
        class="badge success"
      >
        网络
      </a>
      
      <a
        href="https://aiyou.life/tag/jp41-NU1u/"
        class="badge secondary"
      >
        ReactNative
      </a>
      
      <a
        href="https://aiyou.life/tag/X7Cdzy-Hu/"
        class="badge success"
      >
        博客
      </a>
      
    </div>
  </div>
  <div class="paper">
    Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> |
    <a class="rss" href="https://aiyou.life/atom.xml" target="_blank"
      >RSS</a
    >
  </div>
</div>

    </div>

    
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
<!-- <script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-bash.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-typescript.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-jsx.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-tsx.min.js"></script> -->
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">
  AOS.init()

  // hljs.initHighlightingOnLoad()

</script>

<script type="application/javascript">
  // 一言
  function oneWord(element) {
    if (!element) return
    const xhr = new XMLHttpRequest()
    xhr.open('get', 'https://v1.hitokoto.cn/')
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
        element.innerText = JSON.parse(xhr.responseText).hitokoto
      }
    }
    xhr.send()
  }
  oneWord(document.querySelector('.text-muted'))
</script>

<script type="application/javascript">
  // 分享
  var SimpleShare = function (options) {
    // get share content
    options = options || {}
    var url = options.url || window.location.href
    var title = options.title || document.title
    var content = options.content || ''
    var pic = options.pic || ''

    // fix content format
    url = encodeURIComponent(url)
    title = encodeURIComponent(title)
    content = encodeURIComponent(content)
    pic = encodeURIComponent(pic)

    // share target url
    var qzone =
      'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={url}&title={title}&pics={pic}&summary={content}'
    var weibo =
      'http://service.weibo.com/share/share.php?url={url}&title={title}&pic={pic}&searchPic=false'
    var tqq =
      'http://share.v.t.qq.com/index.php?c=share&a=index&url={url}&title={title}&appkey=801cf76d3cfc44ada52ec13114e84a96'
    var renren =
      'http://widget.renren.com/dialog/share?resourceUrl={url}&srcUrl={url}&title={title}&description={content}'
    var douban =
      'http://www.douban.com/share/service?href={url}&name={title}&text={content}&image={pic}'
    var facebook =
      'https://www.facebook.com/sharer/sharer.php?u={url}&t={title}&pic={pic}'
    var twitter = 'https://twitter.com/intent/tweet?text={title}&url={url}'
    var linkedin =
      'https://www.linkedin.com/shareArticle?title={title}&summary={content}&mini=true&url={url}&ro=true'
    var weixin = 'http://qr.topscan.com/api.php?text={url}'
    var qq =
      'http://connect.qq.com/widget/shareqq/index.html?url={url}&desc={title}&pics={pic}'

    // replace content functions
    function replaceAPI(api) {
      api = api.replace('{url}', url)
      api = api.replace('{title}', title)
      api = api.replace('{content}', content)
      api = api.replace('{pic}', pic)

      return api
    }

    // share target
    this.qzone = function () {
      window.open(replaceAPI(qzone))
    }
    this.weibo = function () {
      window.open(replaceAPI(weibo))
    }
    this.tqq = function () {
      window.open(replaceAPI(tqq))
    }
    this.renren = function () {
      window.open(replaceAPI(renren))
    }
    this.douban = function () {
      window.open(replaceAPI(douban))
    }
    this.facebook = function () {
      window.open(replaceAPI(facebook))
    }
    this.twitter = function () {
      window.open(replaceAPI(twitter))
    }
    this.linkedin = function () {
      window.open(replaceAPI(linkedin))
    }
    this.qq = function () {
      window.open(replaceAPI(qq))
    }
    this.weixin = function (callback) {
      if (!callback) {
        window.open(replaceAPI(weixin))
      } else {
        callback(replaceAPI(weixin))
      }
    }
  }
  var share = new SimpleShare()
</script>



<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  var gitalk = new Gitalk({
    clientID: 'f9e29934c5621e13bb13',
    clientSecret: '6ca4b35e60834188ea98ca3be6fba3c21b5ad34a',
    repo: 'xdoer.github.io',
    owner: 'xdoer',
    admin: ['xdoer'],
    id: location.pathname.substring(0, 49), // Ensure uniqueness and length less than 50
    distractionFreeMode: false, // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')
</script>
  
<script>
  // 点击文章内部图片查看大图
  const contentImagesEles = [...document.querySelectorAll('.post-content img')]
  const maskEle = document.querySelector('prev-mask')
  const containerEle = document.querySelector('image-container')
  const imgCloseEle = document.querySelector('img-close')
  const imgBigEle = document.querySelector('img-big')

  contentImagesEles.forEach((ele) => {
    ele.addEventListener('click', () => {
      const { currentSrc } = ele
      imgBigEle.attributes.currentSrc = currentSrc
      mask.style.display = 'block'
    })
  })

  imgCloseEle.addEventListener('click', () => {
    mask.style.display = 'none'
  })
</script>

  </body>
</html>
