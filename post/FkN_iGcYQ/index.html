<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Taroå°ç¨‹åºå¼€å‘æå‡æ•ˆç‡çš„å‡ ç‚¹åˆ†äº«-è·¯ç”±ç¯‡ |
    æ–‡äº«æ—¥å¿—</title>
<meta name="description" content="">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://aiyou.life/favicon.ico?v=1642938807452">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://aiyou.life/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  

<!-- <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script> -->

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


  </head>
  <body>
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://aiyou.life">æ–‡äº«æ—¥å¿—</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                é¦–é¡µ
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                å½’æ¡£
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                æ ‡ç­¾
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                å…³äº
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>Taroå°ç¨‹åºå¼€å‘æå‡æ•ˆç‡çš„å‡ ç‚¹åˆ†äº«-è·¯ç”±ç¯‡</h1>
            <p class="article-meta">
              2020-09-22 
              <a
                href="https://aiyou.life/tag/rSf0tu2pz/"
                class="badge "
              >
                React
              </a>
              
              <a
                href="https://aiyou.life/tag/TfrzxMzWY/"
                class="badge secondary"
              >
                å°ç¨‹åº
              </a>
              
              <a
                href="https://aiyou.life/tag/E75leUW9b/"
                class="badge secondary"
              >
                typescript
              </a>
              
            </p>
            
            <img src="https://aiyou.life/post-images/FkN_iGcYQ.png" alt="Taroå°ç¨‹åºå¼€å‘æå‡æ•ˆç‡çš„å‡ ç‚¹åˆ†äº«-è·¯ç”±ç¯‡" />
            
            <div class="post-content"><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå°ç¨‹åºå¼€å‘ä¸€ä¸ªé¡µé¢ï¼Œé¦–å…ˆè¦åœ¨ pages æ–‡ä»¶å¤¹åœ¨æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ appConfig ä¸­é…ç½®é¡µé¢å®Œæ•´çš„è·¯å¾„åœ°å€ï¼Œåœ¨è¿›è¡Œè·¯ç”±è·³è½¬æ—¶ï¼Œè¿˜éœ€è¦åœ¨ navigateTo ä¸­å†™ä¸‹å®Œæ•´çš„é¡µé¢è·¯å¾„ã€‚å½“é¡µé¢æ•°é‡å°‘ï¼Œä»£ç é‡å°æ—¶ï¼Œä¼¼ä¹å¯ä»¥æ¥å—ï¼Œä½†å½“ä»£ç é‡å¤§ï¼Œé¡¹ç›®å­˜åœ¨å¥½å‡ ä¸ªåˆ†åŒ…æ—¶ï¼Œé¡µé¢è·³è½¬è·¯å¾„ä¼šå˜å¾—éå¸¸é•¿ï¼Œä¹¦å†™é¡µé¢è·¯å¾„ä¼šå˜å¾—è¶Šæ¥è¶Šå›°éš¾ï¼Œä»£ç ä¹Ÿä¸å¤Ÿç¾è§‚å’Œç›´è§‚ã€‚è§£æè·¯ç”±å‚æ•°æ—¶ï¼Œè¿˜éœ€è¦ç»è¿‡å‡ æ­¥è½¬æ¢æ‰èƒ½å¾—åˆ°ã€‚ã€‚</p>
<!-- more -->
<h2 id="ç¯å¢ƒ">ç¯å¢ƒ</h2>
<p>åŸºç¡€ç¯å¢ƒ: taro 3.0.5 / react 16.10.0 / typescript 4.1.0</p>
<p>æŠ€æœ¯æ ˆ: React Hooks</p>
<h2 id="è·¯ç”±éƒ¨åˆ†">è·¯ç”±éƒ¨åˆ†</h2>
<p>Taro å°ç¨‹åºè·¯ç”±æ–¹æ³•è°ƒç”¨ç¤ºä¾‹</p>
<p>è·¯ç”±è·³è½¬</p>
<pre><code class="language-typescript">navigateTo({
  url: `/package-appointment/pages/manage-appointments/index?roomId=${roomId}&amp;appointmentId=${appointmentId}&amp;scriptId=${scriptId}`
})
</code></pre>
<p>å‚æ•°è§£æ</p>
<pre><code class="language-typescript">const { params } = useRouter()
const { roomId, appointmentId, scriptId } = params
const oRoomId = Number.parseInt(roomId)
const oAppointmentId = Number.parseInt(appointmentId)
const oScriptId = Number.parseInt(scriptId)
</code></pre>
<h2 id="ä¼˜åŒ–æ–¹æ¡ˆ">ä¼˜åŒ–æ–¹æ¡ˆ</h2>
<h3 id="part-1-è·¯ç”±è¡¨æ–‡ä»¶">PART 1 è·¯ç”±è¡¨æ–‡ä»¶</h3>
<p>æ–°å»ºä¸€ä¸ªè·¯ç”±è¡¨æ–‡ä»¶ routeTable.tsï¼Œä¸ºè·¯å¾„å‘½åã€‚</p>
<pre><code class="language-typescript">export enum URLs {
  INDEX = '/pages/index/index',
  MANAGE_APPOINTMENTS = '/package-appointment/pages/manage-appointments/index',
  INTENT_DETAIL = '/package-intent/pages/intent-detail/index'
}
</code></pre>
<p>è°ƒç”¨æ—¶ï¼Œåªéœ€è¦å¼•å…¥è·¯ç”±è¡¨æ–‡ä»¶</p>
<pre><code class="language-typescript">import { URLs } from '@/common/routeTable'
...
navigateTo({
  url: `${URLs.MANAGE_APPOINTMENTS}?roomId=${roomId}&amp;appointmentId=${appointmentId}&amp;scriptId=${scriptId}`
})
...
</code></pre>
<p>å¼•å…¥äº†è·¯ç”±è¡¨æ–‡ä»¶çš„åŒæ—¶ï¼Œå¼•å…¥äº†æ–°çš„é—®é¢˜ï¼Œæ–°å»ºä¸€ä¸ªé¡µé¢è¦ç»´æŠ¤ä¸¤ä¸ªè·¯ç”±åœ°å€æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ app.config ï¼Œå¦ä¸€ä¸ªå°±æ˜¯è·¯ç”±è¡¨æ–‡ä»¶ routeTableã€‚å¢åŠ äº†ç»´æŠ¤æˆæœ¬ï¼ŒåŒæ—¶ä¸¤ä¸ªæ–‡ä»¶ï¼Œåªè¦æœ‰ä¸€ç‚¹é”™è¯¯ï¼Œé¡µé¢å°±ä¸èƒ½æ­£ç¡®çš„è¢«è®¿é—®ã€‚æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<h3 id="part-2-è„šæœ¬æ›´æ–°è·¯ç”±è¡¨ä¸ç›¸å…³é…ç½®">PART 2 è„šæœ¬æ›´æ–°è·¯ç”±è¡¨ä¸ç›¸å…³é…ç½®</h3>
<p>æ— è®º app.config è·¯å¾„é…ç½®è¿˜æ˜¯è·¯ç”±è¡¨é…ç½®ï¼Œé¡µé¢ä¸è·¯å¾„æ˜¯å¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬å»å¤„ç†é—®é¢˜ã€‚é¦–å…ˆæ‰«ææºç æ–‡ä»¶å¤¹ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ‰¾åˆ° pages å’Œ package- ä¸‹çš„æ‰€æœ‰é¡µé¢ã€‚æ‰¾åˆ°æ–‡ä»¶åï¼Œè·å–æ–‡ä»¶å¤¹åç§°ä½œä¸ºè·¯ç”±è¡¨çš„ shortName, æ„é€ æ•°æ®åå³å¯æ›¿æ¢å’Œæ–°å»ºåˆ° app.config å’Œ routeTable ä¸­ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é¡ºå¸¦æŠŠ project.config.json ä¸­ miniprogram å­—æ®µæ›´æ–°ï¼Œç”¨äºå¼€å‘é¡µé¢è¿›è¡Œå¿«æ·è°ƒè¯•ã€‚</p>
<p>è„šæœ¬å®Œæˆä¹‹åï¼Œæ¯æ¬¡å¼€å‘é¡µé¢æ—¶ï¼Œåªéœ€è¦åœ¨ pages ç›®å½•ä¸‹æˆ–è€…åˆ†åŒ… pages ç›®å½•ä¸‹æ–°å»ºç›®å½•ï¼Œè¿è¡Œè„šæœ¬å‘½ä»¤å³å¯è‡ªåŠ¨æ›´æ–° app.config ã€ project.config å’Œ routeTableã€‚</p>
<p>æ³¨æ„:</p>
<blockquote>
<ul>
<li>æŸ¥æ‰¾é¡µé¢æ–‡ä»¶ï¼Œé»˜è®¤ pages ä¸‹çš„ä¸€çº§ç›®å½•ä¸ºæ‰€æœ‰é¡µé¢æ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦å¼€å‘è€…æ‹¥æœ‰è‰¯å¥½çš„å¼€å‘ä¹ æƒ¯ï¼Œå†™çš„é¡µé¢æ²¡æœ‰è¿›è¡ŒåµŒå¥—ã€‚</li>
<li>è„šæœ¬ä»£ç å¾ˆç®€å•ï¼Œå°±ä¸æ–°å»ºä»“åº“äº†ï¼Œå®Œæ•´ä»£ç å·²ç»è´´åˆ°äº†æœ€ä¸‹é¢</li>
</ul>
</blockquote>
<h3 id="part-3-åœ°å€å‚æ•°æ”¹é€ ">PART 3 åœ°å€å‚æ•°æ”¹é€ </h3>
<p>è§‚å¯Ÿ PART 1 éƒ¨åˆ†çš„ä»£ç ï¼Œå…¶å®å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶é€šè¿‡è·¯ç”±è¡¨å½¢å¼ç¼©çŸ­äº†ä¸€éƒ¨åˆ†åœ°å€çš„é•¿åº¦ï¼Œä½†æ˜¯å‚æ•°éƒ¨åˆ†è¿˜å¯ä»¥åšäº›æ–‡ç« ã€‚</p>
<pre><code class="language-typescript">// queryParams å°è£…
const covertObjToSearchParams = (searchObj: commonObjectProps = {}) =&gt; {
  let searchParams = ''
  for (let i in searchObj) {
    searchParams = searchParams + `${i}=${searchObj[i]}&amp;`
  }
  return searchParams.slice(0, -1)
}

const queryParams = covertObjToSearchParams({ roomId, appointmentId, scriptId })

navigateTo({
  url: `${URLs.MANAGE_APPOINTMENTS}?${queryParams}`
})

</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ä¼ é€’å‚æ•°ï¼Œç®€æ´ç›´è§‚ï¼Œæ–¹ä¾¿ä¸å°‘ã€‚</p>
<h3 id="part-4-è·¯ç”±è·³è½¬æ–¹æ³•æ”¹é€ ">PART 4 è·¯ç”±è·³è½¬æ–¹æ³•æ”¹é€ </h3>
<p>å°ç¨‹åºä¸­çš„æ–¹æ³•å¤§éƒ½éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå¯¹è±¡ä¼ é€’çš„å‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºå¤§å¤šæ•°æ–¹æ³•éƒ½æœ‰å¾ˆå¤šå‚æ•°ï¼Œé€šè¿‡å¯¹è±¡ä¼ å‚åˆ™æ˜¾å¾—ä»£ç æ•´æ´å‹å¥½ã€‚è§‚å¯Ÿæˆ‘ä»¬çš„ä»£ç ï¼Œç”¨åˆ°çš„æœ€å¤šçš„å°±æ˜¯ä¸€ä¸ª url å‚æ•°, é‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥å°†åœ°å€æ”¾åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä½ä¸Šã€‚</p>
<p>navigateTo æ–¹æ³•æ”¹é€ </p>
<pre><code class="language-typescript">import { navigateTo as originNavigateTo } from '@tarojs/taro'

export function navigateTo(url: string, params?: commonObjectProps, opt?: commonObjectProps) {
  if (!params) return originNavigateTo({ url, ...opt })

  const _url = `${url}?${covertObjToSearchParams(params)}`
  originNavigateTo({ url: _url, ...opt })
}
</code></pre>
<p>navigateTo è°ƒç”¨</p>
<pre><code class="language-typescript">navigateTo(URLs.MANAGE_APPOINTMENTS, { roomId, appointmentId, scriptId })`
</code></pre>
<p>ç›¸æ¯”å‰æ–‡ä¸­çš„æœ€å¼€å§‹æ—¶çš„è·¯ç”±è°ƒç”¨ï¼Œè¿™é‡Œæ›´åŠ ç®€æ´æ˜äº†</p>
<h3 id="part-5-è·¯ç”±å‚æ•°è§£ææ–¹æ³•æ”¹é€ ">PART 5 è·¯ç”±å‚æ•°è§£ææ–¹æ³•æ”¹é€ </h3>
<p>Taro ä¸­æä¾›äº† <strong>useRouter</strong> hookså»è§£æè·¯ç”±å‚æ•°ï¼Œä½†è¯¥ Hooks è§£æå‡ºçš„å‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚</p>
<p>å½“ä½¿ç”¨å‚æ•°æ—¶ï¼Œéœ€è¦å…ˆå¯¼å‡º <strong>params</strong> å¯¹è±¡ï¼Œç„¶åå†æ‹¿åˆ°å‚æ•°å€¼ï¼Œå¯¹äºä¸€äº›æ•°å­—ã€å¸ƒå°”ç±»å‹å€¼è¿˜åªèƒ½å†é€šè¿‡è½¬æ¢è·å¾—åŸå§‹å€¼ã€‚æµç¨‹ç¹çä¸”å¤æ‚ã€‚æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜?</p>
<p>é¦–å…ˆå¯¹ useRouter è¿›è¡Œåˆæ­¥å°è£…</p>
<pre><code class="language-typescript">import { useRouter as useOriginRouter } from '@tarojs/taro'

export function useRouter&lt;T&gt;(): T {
  const { params } = useOriginRouter()
  return params
}
</code></pre>
<p>å°è£…å®Œçš„ useRouter åªç®€åŒ–äº†å¯¼å‡º params çš„è¿‡ç¨‹ï¼Œè€Œå‚æ•°ç±»å‹è½¬æ¢è¿˜æ˜¯åªèƒ½æ ¹æ®å…·ä½“çš„å‚æ•°è¿›è¡Œå…·ä½“è½¬æ¢ã€‚é‚£è¿™æ ·çš„å°è£…å…¶å®è¿˜æ˜¯æœ‰ç‚¹é¸¡è‚‹ã€‚</p>
<p>é€šè¿‡ queryParams ä¼ é€’çš„å‚æ•°åªèƒ½æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„ï¼Œæ‰€ä»¥è§£æå‚æ•°ä¹Ÿåªèƒ½è§£æå‡ºå­—ç¬¦ä¸²ã€‚å› è€Œå¯ä»¥é€šè¿‡ <strong>JSON.stringify</strong> å°†å‚æ•°å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè§£ææ—¶å†åˆ©ç”¨ <strong>JSON.parse</strong> è§£æå‡ºä¿æœ‰åŸå§‹æ•°æ®ç±»å‹çš„å‚æ•°ã€‚</p>
<pre><code class="language-typescript">import { useRouter as useOriginRouter, navigateTo as originNavigateTo } from '@tarojs/taro'

// è·¯ç”±è·³è½¬
export function navigateTo(url: string, params?: object) {
  if (!params) return originNavigateTo({ url })

  const _url = `${url}?navParams=${JSON.stringify(params)}`
  originNavigateTo({ url: _url })
}

// è·¯ç”±è§£æ
export function useRouter&lt;T&gt;(): T {
  const { params } = useOriginRouter()

  try {
    const targetParams = params['navParams']
    if (targetParams) return JSON.parse(targetParams)
  } catch (e) {
    console.warn('å‚æ•°è§£æå¤±è´¥', e)
  }

  return {} as T
}
</code></pre>
<p>ä½¿ç”¨è¿™ç§å°è£…æ–¹å¼ï¼Œè™½ç„¶ URL ä¸ç›´è§‚ä¸”ä¸åˆ©äº SEOï¼Œä½†åœ¨å°ç¨‹åºç¯å¢ƒä¸­ï¼Œç”¨æˆ·æ ¹æœ¬ä¸ä¼šçœ‹åˆ° URLï¼Œä¸”åœ¨å½“å‰å°ç¨‹åºç¯å¢ƒä¸­ï¼ŒSEOä¼¼ä¹æ ¹æœ¬æ²¡ä»€ä¹ˆç”¨ã€‚</p>
<p>ä½¿ç”¨æˆ‘ä»¬å°è£…å¥½çš„ä»£ç ï¼Œæ–‡ç« å¼€å¤´ç»™å‡ºçš„ç¤ºä¾‹å¯ç®€åŒ–ä¸ºå¦‚ä¸‹ä»£ç :</p>
<pre><code class="language-typescript">import { navigateTo, useRouter } from '@/app'

navigateTo(URLs.MANAGE_APPOINTMENTS, { roomId, appointmentId, scriptId })
...

const { roomId, appointmentId, scriptId } = useRouter()
...

</code></pre>
<h2 id="å®Œæ•´è·¯ç”±è„šæœ¬ç”Ÿæˆå’Œä»£ç ">å®Œæ•´è·¯ç”±è„šæœ¬ç”Ÿæˆå’Œä»£ç </h2>
<p>è„šæœ¬ä»£ç å¾ˆç®€å•ï¼Œå°±ä¸æ–°å»ºä»“åº“å­˜äº†ã€‚</p>
<h3 id="ä¸»è„šæœ¬æ–‡ä»¶">ä¸»è„šæœ¬æ–‡ä»¶</h3>
<pre><code class="language-javascript">const path = require('path')
const fs = require('fs')
const { isDir, readDir, readFile, writeFile } = require('./util')
const PROJECT_CONFIG = require('../project.config.json')

const BASE_PATH = path.resolve(__dirname, '..')
const APP_CONFIG_PATH = path.resolve(BASE_PATH, 'src/app.config.ts')
const URL_TABLE_PATH = path.resolve(BASE_PATH, 'src/common/url.constant.ts')
const PACKAGE_CONFIG_PATH = path.resolve(BASE_PATH, 'project.config.json')

function handleMainPageConfig(dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'pages/${dir}/index'\n`)
  fileStr = fileStr.replace(/pages[\S\s]*subPackages/, `pages: [${paths}], subPackages`)
  return fileStr
}

function handleSubPageConfig(rootPath, dirsName, subPackage) {
  const [, name] = rootPath.split('-')
  subPackage.push({
    root: rootPath,
    name,
    pages: dirsName.map((name) =&gt; `pages/${name}/index`),
  })
  return subPackage
}

function handleMainRouteTable(dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'/pages/${dir}/index'\n`)
  for (let i = 0; i &lt; dirsName.length; i++) {
    const current = dirsName[i]
    const name = current
      .split('-')
      .map((v) =&gt; v.toUpperCase())
      .join('_')
    fileStr = fileStr + `${name}=${paths[i]},`
  }
  return fileStr
}

function handleSubRouteTable(rootPath, dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'/${rootPath}/pages/${dir}/index'\n`)
  for (let i = 0; i &lt; dirsName.length; i++) {
    const current = dirsName[i]
    const name = current
      .split('-')
      .map((v) =&gt; v.toUpperCase())
      .join('_')
    fileStr = fileStr + `${name}=${paths[i]},`
  }
  return fileStr
}

function handleMainProjectConfig(dirsName, routes) {
  const paths = dirsName.map((dir) =&gt; `pages/${dir}/index`)
  return routes.concat(paths.map((_path, idx) =&gt; {
    return {
      id: idx + 1,
      name: dirsName[idx],
      pathName: _path,
      query: '',
    }
  }))
}

function handleSubProjectConfig(rootPath, dirsName, routes) {
  const paths = dirsName.map((dir) =&gt; `${rootPath}/pages/${dir}/index`)
  return routes.concat(
    paths.map((_path, idx) =&gt; {
      return {
        id: idx + 1,
        name: dirsName[idx],
        pathName: _path,
        query: '',
      }
    }),
  )
}

async function updateAppConfig(fileStr, subPackage) {
  fileStr = fileStr.replace(/(subPackages[\S\s]*)window/g, `subPackages: ${JSON.stringify(subPackage)}, window`)
  await writeFile(APP_CONFIG_PATH, fileStr)
}

async function updateRouteTable(fileStr) {
  let routeTable = `
    // è‡ªåŠ¨ç”Ÿæˆ, pages æ–‡ä»¶å¤¹æ–°å»ºç›®å½•ï¼Œè¿è¡Œ npm run g
    export enum URLs {
      ${fileStr}
    }
  `
  await writeFile(URL_TABLE_PATH, routeTable)
}

async function updateProjectConfig(entrance) {
  PROJECT_CONFIG.condition.miniprogram.list = entrance
  await writeFile(PACKAGE_CONFIG_PATH, JSON.stringify(PROJECT_CONFIG, null, 2))
}

function sortDirs(dirsName) {
  const indexIdx = dirsName.findIndex((dirname) =&gt; dirname === 'index')
  if (indexIdx === -1) return dirsName.sort((a, b) =&gt; a.localeCompare(b))
  dirsName.splice(indexIdx, 1)
  dirsName = dirsName.sort((a, b) =&gt; a.localeCompare(b))
  dirsName.unshift('index')
  return dirsName
}

async function main(dirPath) {
  const baseDirsName = await readDir(dirPath)
  const target = baseDirsName.filter((dirName) =&gt; /^pages$|^package-\w+$/.test(dirName))

  // è¯»å–APPé…ç½®æ–‡ä»¶
  let appConfigFileStr = await readFile(APP_CONFIG_PATH)
  // app.config åˆ†åŒ…é…ç½®
  let subPackage = []

  // ç”Ÿæˆè·¯ç”±è¡¨æ–‡ä»¶
  let routeTableFileStr = ''
  
  // project.config é¡¹ç›®å¿«æ·å…¥å£é…ç½®
  let entrance = []
  let mainEntrance = []

  for await (let i of target) {
    if (i === 'pages') {
      const dirsName = sortDirs(await readDir(path.resolve(dirPath, i)))
      appConfigFileStr = handleMainPageConfig(dirsName, appConfigFileStr)
      routeTableFileStr = handleMainRouteTable(dirsName, routeTableFileStr)
      mainEntrance = handleMainProjectConfig(dirsName, [])
    } else {
      const dirsName = sortDirs(await readDir(path.resolve(dirPath, i, 'pages')))
      subPackage = handleSubPageConfig(i, dirsName, subPackage)
      routeTableFileStr = handleSubRouteTable(i, dirsName, routeTableFileStr)
      entrance = handleSubProjectConfig(i, dirsName, entrance)
    }
  }
  updateAppConfig(appConfigFileStr, subPackage)
  updateRouteTable(routeTableFileStr)
  updateProjectConfig(mainEntrance.concat(entrance))
}

// ä¸»å‡½æ•°
main(path.resolve(BASE_PATH, 'src'))

</code></pre>
<h3 id="å·¥å…·è„šæœ¬æ–‡ä»¶">å·¥å…·è„šæœ¬æ–‡ä»¶</h3>
<pre><code class="language-javascript">const path = require('path')
const fs = require('fs')

// å½“å‰è·¯å¾„æ˜¯æ–‡ä»¶å¤¹
function isDir(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.stat(filePath, (err, stats) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(stats.isDirectory())
      }
    })
  })
}

// è¯»å–å½“å‰æ–‡ä»¶å¤¹ç›®å½•
function readDir(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.readdir(filePath, 'utf8', (err, dir) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(dir)
      }
    })
  })
}

// è¯»å–æ–‡ä»¶
function readFile(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.readFile(filePath, (err, dir) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(dir.toString())
      }
    })
  })
}

// å†™æ–‡ä»¶
async function writeFile(filePath, fileStr) {
  return new Promise((resolve, reject) =&gt; {
    fs.writeFile(filePath, fileStr, (err, res) =&gt; {
      if (err) return reject(err)
      resolve(res)
    })
  })
}

// æ–‡ä»¶å¤¹æ‰«æ
async function fileScanner(filePath, fn) {
  const dir = await isDir(filePath)
  if (dir) {
    const dirs = await readDir(filePath)
    for await (const name of dirs) {
      fileScanner(path.resolve(filePath, name), fn)
    }
  } else {
    await fn(filePath)
  }
}

module.exports = {
  isDir,
  readDir,
  readFile,
  writeFile,
  fileScanner,
}
</code></pre>
</div>
          </article>
          <div class="simple-share">
            <a class="share-item" href="javascript:share.qzone()">QQç©ºé—´</a>
            <a class="share-item" href="javascript:share.weibo()">å¾®åš</a>
            <a class="share-item" href="javascript:share.facebook()"
              >Facebook</a
            >
            <a class="share-item" href="javascript:share.twitter()">Twitter</a>
          </div>
        </div>
        <div class="paper" data-aos="fade-in">
          
          <div class="next-post">
            <div class="next">
              ä¸‹ä¸€ç¯‡
            </div>
            <a href="https://aiyou.life/post/FEu-GtOkz/">
              <h3 class="post-title">ReactNativeæ¸è¿›å¼å›¾ç‰‡åŠ è½½</h3>
            </a>
          </div>
          
        </div>
         
        <div class="paper" data-aos="fade-in">
          <div id="gitalk-container"></div>
        </div>
          
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img
      src="https://aiyou.life/images/avatar.png?v=1642938807452"
      class="no-responsive avatar"
    />
    <div class="text-muted"></div>
    <div class="social-container">
       
      <a href="https://github.com/xdoer" target="_blank">
        <i class="fab fa-github"></i>
      </a>
        
      <a href="https://twitter.com/xxdoer1" target="_blank">
        <i class="fab fa-twitter"></i>
      </a>
        
      <a href="https://weibo.com/u/7407806835" target="_blank">
        <i class="fab fa-weibo"></i>
      </a>
          
      <a href="https://www.facebook.com/xxdoer" target="_blank">
        <i class="fab fa-facebook"></i>
      </a>
       
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      æœ€æ–°æ–‡ç« 
    </div>
    <div class="row">
      <ul>
         
        <li>
          <a href="https://aiyou.life/post/WTBK_yMNR/">è´¦æœ¬å¼€å‘å°è®°</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/7Ta0APQTd/">è®©ç”Ÿæ´»äº•äº•æœ‰æ¡</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/Fjnj0JDZ5/">å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è½¬ä¸ºå—æ§ç»„ä»¶çš„ä¸€ç§æ€è·¯</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/zPGtmQi-5/">TS çš„ä¸€äº›é«˜çº§ç±»å‹å†™æ³•</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/QqaRhC3Gf/">Restful-API çš„ä¸€ç§åŠ¨æ€ç”Ÿæˆæ•°æ®ç±»å‹çš„æ–¹æ³•</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/SV2erlm_4/">å‡ ä¸ªDemo çœ‹æ‡‚ ESM ä¸ CommonJS å·®å¼‚</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/UNWTwtWxa/">Taro è‡ªå®šä¹‰ showModal</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/iWhkaOqqO/">å†™ä¸€ä¸ªå€’è®¡æ—¶ğŸ˜¢ï¼Ÿ</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/4XYWTWTx/">æƒ³åˆ°çš„ä¸€äº›å¾ˆå¥½çš„é¢è¯•é¢˜</a>
        </li>
          
        <li>
          <a href="https://aiyou.life/post/M4RcI3wfU/">ç”±å°è£…ä¸€ä¸ªè¯·æ±‚åº“æ‰€æƒ³åˆ°çš„</a>
        </li>
                                   
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      æ ‡ç­¾åˆ—è¡¨
    </div>
    <div class="row">
      
      <a
        href="https://aiyou.life/tag/df67loo-n/"
        class="badge secondary"
      >
        ç¬”è®°
      </a>
      
      <a
        href="https://aiyou.life/tag/K1r5vpFd_/"
        class="badge success"
      >
        å‰ç«¯
      </a>
      
      <a
        href="https://aiyou.life/tag/E75leUW9b/"
        class="badge warning"
      >
        typescript
      </a>
      
      <a
        href="https://aiyou.life/tag/rSf0tu2pz/"
        class="badge secondary"
      >
        React
      </a>
      
      <a
        href="https://aiyou.life/tag/TfrzxMzWY/"
        class="badge secondary"
      >
        å°ç¨‹åº
      </a>
      
      <a
        href="https://aiyou.life/tag/TDgBvCzI8/"
        class="badge success"
      >
        javascript
      </a>
      
      <a
        href="https://aiyou.life/tag/g_6wyy_ol/"
        class="badge success"
      >
        ç½‘ç»œ
      </a>
      
      <a
        href="https://aiyou.life/tag/jp41-NU1u/"
        class="badge warning"
      >
        ReactNative
      </a>
      
      <a
        href="https://aiyou.life/tag/X7Cdzy-Hu/"
        class="badge secondary"
      >
        åšå®¢
      </a>
      
    </div>
  </div>
  <div class="paper">
    Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> |
    <a class="rss" href="https://aiyou.life/atom.xml" target="_blank"
      >RSS</a
    >
  </div>
</div>

    </div>

    
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
<!-- <script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-bash.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-typescript.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-jsx.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-tsx.min.js"></script> -->
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">
  AOS.init()

  // hljs.initHighlightingOnLoad()

</script>

<script type="application/javascript">
  // ä¸€è¨€
  function oneWord(element) {
    if (!element) return
    const xhr = new XMLHttpRequest()
    xhr.open('get', 'https://v1.hitokoto.cn/')
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
        element.innerText = JSON.parse(xhr.responseText).hitokoto
      }
    }
    xhr.send()
  }
  oneWord(document.querySelector('.text-muted'))
</script>

<script type="application/javascript">
  // åˆ†äº«
  var SimpleShare = function (options) {
    // get share content
    options = options || {}
    var url = options.url || window.location.href
    var title = options.title || document.title
    var content = options.content || ''
    var pic = options.pic || ''

    // fix content format
    url = encodeURIComponent(url)
    title = encodeURIComponent(title)
    content = encodeURIComponent(content)
    pic = encodeURIComponent(pic)

    // share target url
    var qzone =
      'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={url}&title={title}&pics={pic}&summary={content}'
    var weibo =
      'http://service.weibo.com/share/share.php?url={url}&title={title}&pic={pic}&searchPic=false'
    var tqq =
      'http://share.v.t.qq.com/index.php?c=share&a=index&url={url}&title={title}&appkey=801cf76d3cfc44ada52ec13114e84a96'
    var renren =
      'http://widget.renren.com/dialog/share?resourceUrl={url}&srcUrl={url}&title={title}&description={content}'
    var douban =
      'http://www.douban.com/share/service?href={url}&name={title}&text={content}&image={pic}'
    var facebook =
      'https://www.facebook.com/sharer/sharer.php?u={url}&t={title}&pic={pic}'
    var twitter = 'https://twitter.com/intent/tweet?text={title}&url={url}'
    var linkedin =
      'https://www.linkedin.com/shareArticle?title={title}&summary={content}&mini=true&url={url}&ro=true'
    var weixin = 'http://qr.topscan.com/api.php?text={url}'
    var qq =
      'http://connect.qq.com/widget/shareqq/index.html?url={url}&desc={title}&pics={pic}'

    // replace content functions
    function replaceAPI(api) {
      api = api.replace('{url}', url)
      api = api.replace('{title}', title)
      api = api.replace('{content}', content)
      api = api.replace('{pic}', pic)

      return api
    }

    // share target
    this.qzone = function () {
      window.open(replaceAPI(qzone))
    }
    this.weibo = function () {
      window.open(replaceAPI(weibo))
    }
    this.tqq = function () {
      window.open(replaceAPI(tqq))
    }
    this.renren = function () {
      window.open(replaceAPI(renren))
    }
    this.douban = function () {
      window.open(replaceAPI(douban))
    }
    this.facebook = function () {
      window.open(replaceAPI(facebook))
    }
    this.twitter = function () {
      window.open(replaceAPI(twitter))
    }
    this.linkedin = function () {
      window.open(replaceAPI(linkedin))
    }
    this.qq = function () {
      window.open(replaceAPI(qq))
    }
    this.weixin = function (callback) {
      if (!callback) {
        window.open(replaceAPI(weixin))
      } else {
        callback(replaceAPI(weixin))
      }
    }
  }
  var share = new SimpleShare()
</script>



<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  var gitalk = new Gitalk({
    clientID: 'f9e29934c5621e13bb13',
    clientSecret: '6ca4b35e60834188ea98ca3be6fba3c21b5ad34a',
    repo: 'xdoer.github.io',
    owner: 'xdoer',
    admin: ['xdoer'],
    id: location.pathname.substring(0, 49), // Ensure uniqueness and length less than 50
    distractionFreeMode: false, // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')
</script>
  
<script>
  // ç‚¹å‡»æ–‡ç« å†…éƒ¨å›¾ç‰‡æŸ¥çœ‹å¤§å›¾
  const contentImagesEles = [...document.querySelectorAll('.post-content img')]
  const maskEle = document.querySelector('prev-mask')
  const containerEle = document.querySelector('image-container')
  const imgCloseEle = document.querySelector('img-close')
  const imgBigEle = document.querySelector('img-big')

  contentImagesEles.forEach((ele) => {
    ele.addEventListener('click', () => {
      const { currentSrc } = ele
      imgBigEle.attributes.currentSrc = currentSrc
      mask.style.display = 'block'
    })
  })

  imgCloseEle.addEventListener('click', () => {
    mask.style.display = 'none'
  })
</script>

  </body>
</html>
