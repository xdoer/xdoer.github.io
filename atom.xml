<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://aiyou.life</id>
    <title>æ–‡äº«æ—¥å¿—</title>
    <updated>2021-06-02T06:15:56.911Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://aiyou.life"/>
    <link rel="self" href="https://aiyou.life/atom.xml"/>
    <logo>https://aiyou.life/images/avatar.png</logo>
    <icon>https://aiyou.life/favicon.ico</icon>
    <rights>All rights reserved 2021, æ–‡äº«æ—¥å¿—</rights>
    <entry>
        <title type="html"><![CDATA[å†™ä¸€ä¸ªå€’è®¡æ—¶ğŸ˜¢ï¼Ÿ]]></title>
        <id>https://aiyou.life/post/iWhkaOqqO/</id>
        <link href="https://aiyou.life/post/iWhkaOqqO/">
        </link>
        <updated>2021-06-01T08:20:34.000Z</updated>
        <summary type="html"><![CDATA[<p>å¦‚ä½•å†™ä¸€ä¸ªé«˜æ€§èƒ½ã€æ˜“æ‰©å±•ã€æ˜“ç”¨çš„è®¡æ—¶å™¨ï¼Ÿ</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¦‚ä½•å†™ä¸€ä¸ªé«˜æ€§èƒ½ã€æ˜“æ‰©å±•ã€æ˜“ç”¨çš„è®¡æ—¶å™¨ï¼Ÿ</p>
<!-- more -->
<p>æŸæ—¥ï¼Œæ¥åˆ°äº†äº§å“éœ€æ±‚ï¼Œè¯´è¦åŠ ä¸€ä¸ªæŠ¢è´­åˆ—è¡¨é¡µé¢ï¼Œåˆ—è¡¨ä¸­æ¯ä¸€é¡¹è¦åŠ ä¸€ä¸ªæŠ¢è´­å€’è®¡æ—¶ï¼Œæ²¡å¤šæƒ³ï¼Œä½¿ç”¨ <code>setInterval</code> å¿«é€Ÿå®ç°äº†ã€‚</p>
<p>éšç€åˆ—è¡¨ä¸­é¡¹ç›®è¶Šæ¥è¶Šå¤šï¼Œå„ä¸ªé¡¹ç›®çš„å€’è®¡æ—¶è¶Šæ¥è¶Šä¸å‡†ï¼Œä¸”é¡µé¢å˜çš„è¶Šæ¥è¶Šå¡ã€‚</p>
<p>å…¶å®å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œn å¤šä¸ª <code>setInterval</code> å®ä¾‹åŒæ—¶è¿è¡Œï¼Œé˜»å¡äº† JS çº¿ç¨‹ï¼Œå¯¼è‡´é¡µé¢è¶Šæ¥è¶Šå¡ï¼Œè®¡æ—¶å™¨è®¡æ—¶å‡ºç°äº†åå·®ã€‚æœ‰æ²¡æœ‰åŠæ³•ç”¨ä¸€ä¸ª <code>setInterval</code> å®ä¾‹ï¼Œè¿›è¡Œå¤šä¸ªå€’è®¡æ—¶å‘¢?</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹ <code>setInterval</code> ç”¨æ³•:</p>
<pre><code class="language-js">setInterval(() =&gt; {
    // callback
}, 1000)
</code></pre>
<p>å¦‚æœåœ¨ <code>setInterval</code> ä¸­æ‰§è¡Œå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>ç®€å•å®ç°ä¸€ä¸‹:</p>
<pre><code class="language-js">class Timer {
    private timerId
    private cbs = []
    private cbId = 0

    constructor(delay) {
        this.delay = delay
    }

    private start() {
        this.timerId = setInterval(() =&gt; {
            this.cbs.forEach(item =&gt; {
                item.cb()
            })
        }, this.delay)
    }

    private stop() {
        clearInterval(this.timerId)
    }

    add(cb) {
        const id = this.cbId++
        this.cbs.push({ cb, id })
        if(!this.timerId) this.start()
        return id
    }

    remove(cbId) {
        const cbIdx = this.cbs.findIndex(({ id }) =&gt; id === cbId)
        this.cbs.splice(cbIdx, 1)
        if(!this.cbs.length) this.stop()
    }
}
</code></pre>
<p>é—®é¢˜åˆæ¥äº†ï¼Œä¸åŒçš„å›è°ƒå‡½æ•°ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„è®¡æ—¶é—´éš”ï¼Œè¿™æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<p>å¯ä»¥é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè®¡ç®— <code>setInterval</code> çš„æ‰§è¡Œæ¬¡æ•°ï¼Œæ‰§è¡Œæ¬¡æ•° * é—´éš”æ—¶é—´å°±æ˜¯æ‰§è¡Œæ€»æ—¶é—´ï¼Œæœ‰äº†æ‰§è¡Œæ€»æ—¶é—´å°±å¥½åŠäº†ï¼Œåªéœ€è¦è¿›è¡Œä½™è¿ç®—å³å¯ã€‚</p>
<p>demoå¦‚ä¸‹:</p>
<pre><code class="language-ts">// some code
let count = 0
let delay = 1000
 setInterval(() =&gt; {
    this.cbs.forEach(({ cb, interval }) =&gt; {
        if(!(count * delay % interval)) {
            cb()
        }
    })
}, delay)
// some code
</code></pre>
<p>ä¸Šé¢ demo ä¸­å†™æ­»äº†æ‰§è¡Œé—´éš”ä¸º 1000msï¼Œé‚£å¯¹äºæ³¨å†Œäº† 500ms æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ¥è®²ï¼Œä¼šå»¶è¿Ÿ 500ms åæ‰æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥éå†æ‰€æœ‰ cbsï¼Œä»ä¸­è·å–æœ€å°çš„ interval å½“åš delay å³å¯ã€‚</p>
<pre><code class="language-ts">// some code
let min = this.cbs[0].interval
let delay = this.cbs.reduce((min, cur) =&gt;  cur.interval &lt; min ? cur.interval : min,min)
// some code
</code></pre>
<p>ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦ new ä¸€ä¸ª Timer å®ä¾‹ï¼Œåœ¨éœ€è¦å€’è®¡æ—¶çš„åœ°æ–¹ï¼Œé€šè¿‡ add æ·»åŠ å›è°ƒå‡½æ•°å³å¯è‡ªåŠ¨å¯åŠ¨è®¡æ—¶å™¨ï¼Œåˆ é™¤æ—¶ï¼Œè°ƒç”¨ remove æ–¹æ³•ï¼Œåˆ é™¤å®Œæ‰€æœ‰æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼Œè®¡æ—¶å™¨è‡ªåŠ¨åœæ­¢ã€‚</p>
<pre><code class="language-js">const timer = new Timer()

const timerId = timer.add(() =&gt; {}, 1000)
timer.remove(timerId)
</code></pre>
<p>æˆ–è€…å†æ”¹é€ ä¸€ä¸‹ï¼Œå®ç°ç±»ä¼¼ <code>setTimeout</code> å’Œ <code>setInterval</code> çš„è°ƒç”¨æ–¹å¼</p>
<pre><code class="language-ts">const setTimeoutInterval = timer.add.bind(timer)
const clearTimeoutInterval = timer.remove.bind(timer)
</code></pre>
<p>æ”¹é€ åçš„å€’è®¡æ—¶æ€§èƒ½æ— ç–‘å¥½äº†è®¸å¤šï¼Œé¡µé¢ä¸å†å¡é¡¿ã€‚ä¸”æ— è®ºæ·»åŠ å¤šå°‘ä¸ªè®¡æ—¶å›è°ƒï¼Œå®ƒè¿è¡Œçš„éƒ½æ˜¯åŒä¸€ä¸ªè®¡æ—¶å®ä¾‹ã€‚</p>
<p>ä½¿ç”¨ <code>setInterval</code> çš„è®¡æ—¶è¿˜æ˜¯è¶Šæ¥è¶Šä¸å‡†ï¼Œ<code>setInterval</code> ä¼šå°†å›è°ƒå‡½æ•°é—´éš”æ’å…¥ JS çº¿ç¨‹ä¸­ï¼Œä½†çº¿ç¨‹å¦‚æœæ­£åœ¨æ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼Œæ’å…¥çš„å›è°ƒå‡½æ•°å°†åç§»å…¶åº”å½“åœ¨çš„ä½ç½®ï¼Œæ»åæ‰§è¡Œï¼Œä¸‹ä¸€æ¬¡æ’å…¥çš„ä½ç½®ï¼Œå‚ç…§äº†æ»åæ’å…¥çš„ä½ç½®ï¼Œæ‰€ä»¥å¯¼è‡´è¿è¡Œæ—¶é—´è¶Šé•¿ï¼Œåå·®è¶Šå¤§ã€‚</p>
<p>ä½¿ç”¨é€’å½’ <code>setTimeout</code> ï¼Œä¸æ–­ä¿®æ­£å°†å›è°ƒå‡½æ•°æ’å…¥çº¿ç¨‹çš„æ—¶é—´ï¼Œå³å¯è·å¾—ç›¸å¯¹å‡†ç¡®çš„å€’è®¡æ—¶ã€‚</p>
<p>ç®€å•å®ç°ä¸€ä¸‹:</p>
<pre><code class="language-js">let count = 0 // é€’å½’æ¬¡æ•°
let now = Date.now() // åˆå§‹æ‰§è¡Œæ—¶é—´

function countdown() {
    const offset = Date.now() - (now + count * 1000)
    const nextTime = 1000 - offset
    count++

    setTimeout(() =&gt; {
        countdown()
    }, nextTime)
}
countdown()
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬è®°å½•äº†åˆå§‹æ‰§è¡Œæ—¶é—´ï¼Œå’Œ countdown é€’å½’æ‰§è¡Œçš„æ¬¡æ•°ï¼Œæ ¹æ®è¿™ä¸¤è€…ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºåç§»æ—¶é—´å’Œä¸‹æ¬¡ <code>setTimeout</code> çš„æ—¶é—´ã€‚</p>
<p>æ”¹é€ åï¼Œè™½ç„¶å€’è®¡æ—¶å‡†ç¡®äº†è®¸å¤šã€‚ä½†ï¼Œåˆå›åˆ°äº†ä¸Šé¢çš„é—®é¢˜ï¼Œåˆ—è¡¨é¡¹è¶Šå¤šï¼Œ <code>setTimeout</code> å®ä¾‹è¶Šå¤šï¼Œé¡µé¢ä¹Ÿä¼šè¶Šæ¥è¶Šå¡ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>setTimeout</code> æ¨¡æ‹Ÿ <code>setinterval</code>ï¼Œå¹¶å°†å…¶æ›¿æ¢åˆ°ä¸Šé¢æˆ‘ä»¬çš„ <code>Timer</code> ç±»ä¸­ã€‚å³å¯è§£å†³é—®é¢˜ã€‚</p>
<pre><code class="language-js">function timeoutInterval(cb, interval = 1000) {
  let count = 0
  let now = Date.now()
  let timerId = null

  function countdown() {
    const offset = Date.now() - (now + count * interval)
    const nextTime = interval - offset
    count++

    cb(timerId)

    timerId = setTimeout(() =&gt; {
      countdown()
    }, nextTime)
  }

  countdown()
}
</code></pre>
<p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨é€’å½’ <code>setTimeout</code>, æ‰€ä»¥æ¯æ¬¡ç”Ÿæˆçš„ <code>timeId</code> éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è®¾è®¡å°†å…¶é€šè¿‡ <code>cb</code> å›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å‡ºã€‚</p>
<p>ç”¨æ³•å¦‚ä¸‹:</p>
<pre><code class="language-js">let i = 0
timeoutInterval((timerId) =&gt; {
    if(i++ &lt; 10) {
        console.log(i)
    } else {
        clearTimeout(timerId)
    }
}, 1000)
</code></pre>
<p>å°†å…¶æ›¿æ¢åˆ° <code>Timer</code> ç±»ä¸­</p>
<pre><code class="language-js">class Timer {
    // some code
    private start() {
        timeoutInterval((timerId) =&gt; {
            this.timerId = timerId
            this.cbs.forEach(item =&gt; {
                item.cb()
            })
        }, 1000)
    }
    // some code
}
</code></pre>
<p>æ”¹é€ åçš„å€’è®¡æ—¶æ€§èƒ½è‰¯å¥½ï¼Œä¸”å› ä¸ºåªæœ‰ä¸€ä¸ªè®¡æ—¶å®ä¾‹ï¼Œé¡µé¢ä¹Ÿä¸ä¼šå¡é¡¿ã€‚</p>
<p>å…·ä½“å®ç°è¯·æŸ¥é˜…ä»£ç : <a href="https://github.com/xdoer/TimeoutInterval">TimeoutInterval</a></p>
<p>å¯¹äºä¸€äº›ç§’æ€æŠ¢è´­åœºæ™¯ï¼Œè¿™ç§å€’è®¡æ—¶æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºæœ¬åœ°æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´æœ‰åå·®ï¼Œå¦‚æœæŠ¢è´­å•çº¯ç”±å‰ç«¯å€’è®¡æ—¶æ¥æ§åˆ¶ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å‡ºç°ç”¨æˆ·ä¿®æ”¹æœ¬æœºæ—¶é—´ï¼Œé¡µé¢å°±å‡ºç°äº†è´­ä¹°æŒ‰é’®å¯ä»¥ç›´æ¥è´­ä¹°çš„ bugã€‚ç”±æœ¬åœ°è®¡æ—¶å¼•èµ·çš„ bugï¼Œåœ¨ç›®å‰å¸‚é¢ä¸Šçš„ APP ä¸Šå¾ˆå¸¸è§ï¼Œé™¤äº†æŠ¢è´­åœºæ™¯å¤–ï¼Œæ¥å£é˜²é‡æ”¾æœºåˆ¶ä¸­ä¼šæ ¡éªŒå®¢æˆ·ç«¯è¯·æ±‚æºå¸¦çš„æ—¶é—´æˆ³ï¼Œé€šå¸¸çº¦å®šï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶é—´æˆ³ä¸æœåŠ¡ç«¯æ—¶é—´åå·®åœ¨ 60s ä¹‹å¤–ï¼Œåˆ™è¯¥è¯·æ±‚æ— æ•ˆï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹æœ¬æœºæ—¶é—´åï¼Œæ‰“å¼€æŸäº› APPï¼Œä¼šçœ‹åˆ°ç©ºç™½é¡µé¢ã€‚</p>
<p>è§£å†³åŠæ³•å¾ˆç®€å•ã€‚</p>
<p>æ‰“å¼€åº”ç”¨åï¼Œé¦–å…ˆå°†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„åç§»æ—¶é—´å­˜åˆ°æœ¬åœ°ï¼Œç§’æ€å€’è®¡æ—¶çš„æ—¶å€™ï¼Œå°†åç§»æ—¶é—´åŠ ä¸Šå³å¯ã€‚è¿™æ ·çš„è¯ï¼Œæ— è®ºå®¢æˆ·ç«¯æ—¶é—´æ˜¯æå‰è¿˜æ˜¯ä¹‹åï¼Œéƒ½å¯¹åº”ç”¨æ²¡æœ‰å½±å“ã€‚</p>
<p>ç®€å•å†™ä¸ª demo:</p>
<pre><code class="language-js">// é¦–å…ˆè·å–åç§»æ—¶é—´
prequest('/api').then(res =&gt; {
    // nginx æœåŠ¡å™¨ï¼Œå¯ä»¥ä»å“åº”å¤´æ‹¿åˆ°æ—¶é—´
    const date = res.headers.Date
    const offsetTime = Date.now() - new Date(date).getTime()
    localStorage.setItem('offsetTime', offsetTime)
})

// å°è£…è·å–æ—¶é—´æ–¹æ³•
function getNow() {
    const offset = localStorage.getItem('offsetTime')
    return Date.now() + Number.parseInt(offset)
}
</code></pre>
<p>å›åˆ°æˆ‘ä»¬çš„è®¡æ—¶å™¨ä»£ç ï¼Œåªéœ€è¦å°†å…¶ä¸­çš„ <code>Date.now()</code> æ–¹æ³•æ›¿æ¢æˆ è¿™é‡Œçš„ <code>getNow()</code> å³å¯ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸Šé¢çš„ä»£ç å·²ç»å¯ä»¥åº”å¯¹å¤§éƒ¨åˆ†è®¡æ—¶åœºæ™¯ï¼Œä½†å¯¹äºç§’æ€åœºæ™¯æ¥è¯´ï¼Œæœ¬åœ°è¿è¡Œçš„å€’è®¡æ—¶å¯èƒ½è¿˜æ˜¯ä¸å¤Ÿå¯é ï¼Œå¯ä»¥è®¾è®¡é—´æ­‡æ€§è¯·æ±‚æ¥å£è·å–æœåŠ¡ç«¯æ—¶é—´ï¼Œæ›´æ–°å€’è®¡æ—¶ï¼Œæ¥è·å¾—æ›´é«˜è®¡æ—¶ç²¾ç¡®åº¦ã€‚</p>
<p>é¦–å…ˆå¤§è‡´è®¾è®¡è·å–æœåŠ¡ç«¯æ—¶é—´æ–¹æ³•</p>
<pre><code class="language-js">async function getServerTime() {
    const start = Date.now()    // å¼€å¯è¯·æ±‚æ—¶é—´
    const serverTime = await prequest('/api').then(res =&gt; ...)
    const endTime = Date.now()
    return serverTime + (endTime - startTime) / 2
}
</code></pre>
<p>è¿™é‡Œè€ƒè™‘äº†è¯·æ±‚ç½‘ç»œæ¶ˆè€—çš„æ—¶é—´ã€‚</p>
<p>å…¶æ¬¡è€ƒè™‘æˆ‘ä»¬å€’è®¡æ—¶ï¼Œå½“æ¯æ¬¡æ‹¿åˆ°æœåŠ¡ç«¯æ—¶é—´åï¼ŒåŠ ä¸Š <code>interval</code> æ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦å’Œç›®æ ‡æ—¶é—´ç›¸ç­‰å³å¯ã€‚</p>
<p>demoå¦‚ä¸‹</p>
<pre><code class="language-js">let now = Date.now()
let interval = 1000
setInterval(() =&gt; {
    if (now + interval &gt;=  endTime) {
        // some code
    }
}, interval)

setInterval(() =&gt; {
    getServerTime(res).then(res =&gt; now = res)
}, 5000)
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ç»´æŠ¤äº†ä¸¤ä¸ªè®¡æ—¶å™¨ï¼Œä¸€ä¸ªè´Ÿè´£è¯·æ±‚æ¥å£æ›´æ–° <code>now</code> æ•°æ®ï¼Œä¸€ä¸ªè¿›è¡Œæ­£å¸¸å€’è®¡æ—¶ï¼Œå†™æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>å½“æœ‰ n å¤šä¸ªè¿™æ ·çš„å€’è®¡æ—¶å®ä¾‹ï¼Œä»£ç å°†ä¸å¯ç»´æŠ¤ã€‚å¯ä»¥æ”¹é€ ä¸€ä¸‹ä»£ç ï¼Œä½¿ç”¨ç±»ä¼¼äº‹ä»¶å‘å¸ƒè®¢é˜…çš„æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>é¦–å…ˆå®ç°ä¸€ä¸ª <code>manager</code> æ¥å®ç°äº‹ä»¶å‘å¸ƒè®¢é˜…çš„é€»è¾‘</p>
<pre><code class="language-js">class CountDowmManager {
    queue = []
    tiemrId = null

    constructor({ getRemoteDate, interval }) {
        this.getRemoteDate = getRemoteDate
        this.interval = interval
    }

    private start() {
        this.timerId = timer.add(() =&gt; {
            this.getNow()
        }, this.interval)
    }

    private stop() {
        timer.remove(this.timerId)
    }

    on (countdown) {
        this.queue.push(countdown)
        if(!this.timerId) this.start()
    }

    off(countdown) {
        this.queue.splice(this.queue.findIndex(i =&gt; i === countdown), 1)
        if(!this.queue.length) this.stop()
    }

    private async getNow() {
        try {
            const start = Date.now()
            const nowStr = await this.opt.getRemoteDate()
            const end = Date.now()
            this.queue.forEach((instance) =&gt; (instance.now = new Date(nowStr).getTime() + (end - start) / 2)
        } catch (e) {
            console.log('fix time fail', e)
        }
    }
}
</code></pre>
<p>åœ¨ <code>CountDownManager</code> ç±»ä¸­ï¼Œç»´æŠ¤äº†ä¸€ä¸ª <code>countdown</code> å®ä¾‹çš„é˜Ÿåˆ—ï¼Œæ¯éš” <code>interval</code> ä¸ªæ—¶é—´ï¼Œä¼šè¯·æ±‚æ¥å£ï¼Œæ›´æ–°æ‰€æœ‰å®ä¾‹çš„ <code>now</code> å€¼ã€‚åŒæ—¶è®¾è®¡å°†è·å–æœåŠ¡å™¨æ—¶é—´çš„å‡½æ•°ç”±å‚æ•°ä¼ å…¥ï¼Œå·²æ»¡è¶³ä¸åŒåœºæ™¯çš„ä¸åŒéœ€æ±‚ã€‚</p>
<p>æ¥ç€ï¼Œè®¾è®¡å€’è®¡æ—¶</p>
<pre><code class="language-js">class CountDown {
    now = Date.now()
    timerId = null

   // ... some code
    start() {
        this.timerId = timer.add(() =&gt; {
            this.now += interval

            if (this.now &gt;= endTime) {
                // some code
                return
            }
        })
    }

    // some code
}
</code></pre>
<p>ç”¨æ³•å¦‚ä¸‹:</p>
<pre><code class="language-js">const manager = new CountDownManager()

const instance1 = new CountDown()
const instance2 = new CountDown()

manager.on(instance1) 
manager.on(instance2)
</code></pre>
<p>ä¸Šé¢çš„ <code>CounDown</code>  ä»£ç ä¸­ï¼Œåªè€ƒè™‘äº†ä½¿ç”¨ <code>server</code> æ›´æ–°æ—¶é—´çš„åœºæ™¯ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸Šé¢ä½¿ç”¨æœ¬åœ°æ—¶é—´è¿›è¡Œçš„å€’è®¡æ—¶ï¼Œæ•´åˆåˆ° <code>countDown</code> ç±»ä¸­ã€‚å…¶æ¬¡ï¼Œå¯ä»¥è®¾è®¡å°† <code>manager</code> ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥åˆ° <code>countdown</code> å®ä¾‹ï¼Œè¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨çš„æ³¨å†Œå’Œç§»é™¤ <code>countdown</code> å®ä¾‹ï¼Œå°† <code>managr</code> å½“å‚æ•°ä¼ å…¥ï¼Œåœ¨åˆå§‹åŒ–å®ä¾‹æ—¶ï¼Œå°±å¯ä»¥è‡ªåŠ¨å°†å½“å‰å®ä¾‹æ³¨å†Œï¼›å½“å€’è®¡æ—¶ç»“æŸï¼Œè‡ªåŠ¨å°†å½“å‰å®ä¾‹ç§»é™¤ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®æ˜¯å¦ä¼ å…¥ <code>manager</code> æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨æœåŠ¡ç«¯æ¥æ›´æ–°æ—¶é—´ã€‚</p>
<p>æ”¹é€ ä¸€ä¸‹ä»£ç </p>
<pre><code class="language-js">class CountDown() {

    constructor({ manager, ...opt }) {
        this.manager = manager
        manager ? this.useServerToCountDown(...opt) : this.useLocalToCountDown(...opt)
    }

    useServerToCountDown() {
        // ...some code
        this.manager.on(this)
    }

    // ...some code

    clear() {
        timer.clear(this.timer)
        if(this.manager) {
            this.manager.off(this)
        }
    }
}
</code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œå¥½æ‰©å±•ï¼Œæ˜“ç”¨çš„è®¡æ—¶å™¨äº†ã€‚</p>
<p>å®Œæ•´ä»£ç è¯·æŸ¥é˜… <a href="https://github.com/xdoer/CountDown">CountDown</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æƒ³åˆ°çš„ä¸€äº›å¾ˆå¥½çš„é¢è¯•é¢˜]]></title>
        <id>https://aiyou.life/post/4XYWTWTx/</id>
        <link href="https://aiyou.life/post/4XYWTWTx/">
        </link>
        <updated>2021-05-30T07:32:50.000Z</updated>
        <summary type="html"><![CDATA[<p>å†™ä»£ç çš„æ—¶å€™ï¼Œæƒ³åˆ°çš„å’Œé‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚æƒ³æ¥å¯ä»¥åšé¢è¯•é¢˜ã€‚ç‰¹è®°å½•äºæ­¤ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å†™ä»£ç çš„æ—¶å€™ï¼Œæƒ³åˆ°çš„å’Œé‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚æƒ³æ¥å¯ä»¥åšé¢è¯•é¢˜ã€‚ç‰¹è®°å½•äºæ­¤ã€‚</p>
<!-- more -->
<h2 id="å¯¹è±¡">å¯¹è±¡</h2>
<p>1ã€<code>{} === {}</code> æ˜¯å¦ç›¸ç­‰ï¼Ÿ<br>
2ã€<code>obj.a === obj.a</code> æ˜¯å¦ç›¸ç­‰?</p>
<pre><code class="language-ts">const obj = {
    a: {}
}
</code></pre>
<p>3ã€æ€æ ·ä½¿ <code>obj.a !== obj.a</code></p>
<pre><code class="language-ts">const obj = {
    get a() {
        return {}
    }
}
</code></pre>
<p>4ã€<code>obj.a === obj.a</code> æ˜¯å¦ç›¸ç­‰? <code>obj.a</code> è®¿é—®åˆ°çš„æ˜¯å“ªä¸€ä¸ªï¼Ÿ</p>
<pre><code class="language-ts">const obj = {
    a: {}
    get a() {
        return {}
    }
}
</code></pre>
<p>5ã€<code>getter</code> è®¿é—®ä¸è®¿é—®å™¨è®¿é—®æœ‰ä½•åŒºåˆ«ï¼Ÿ<br>
getter å¯å®šä¹‰åœ¨å®ä¾‹å’Œç±»ä¸Šï¼Œå€¼ä¸ºä¸€ä¸ªæ— å‚æ•°çš„å‡½æ•°ï¼Œå¯ä»¥æƒ°æ€§èµ‹å€¼ã€‚</p>
<p>6ã€<code>getter</code> è®¿é—®ä¸è®¿é—®å™¨å­˜åœ¨ç›¸åŒå±æ€§çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•é€šè¿‡<code>getter</code>è®¿é—®</p>
<pre><code class="language-ts">const obj = {
    a: {}
    get a() {
        return {}
    }
}
</code></pre>
<p>å½“åœ¨å®ä¾‹ä¸Šå®šä¹‰ <code>getter</code> è®¿é—®ï¼Œåˆ™ <code>getter</code> å­˜åœ¨äºå®ä¾‹ä¸Šã€‚è™½ç„¶å¯ä»¥å®šä¹‰åŒåå±æ€§ï¼Œä½†å´è®¿é—®ä¸åˆ° ã€‚</p>
<p>ä½¿ç”¨ <code>delete obj.a</code> å°†ä¼šéƒ½åˆ æ‰ã€‚</p>
<p>å¯ä»¥è€ƒè™‘å°†å…¶å®šä¹‰åˆ°åŸå‹ä¸Šã€‚</p>
<pre><code class="language-ts">class A {
    a = 1
    get a() {
        return 2
    }
}
const obj = new A()

obj.a === 1 // true
obj.__proto__a === 2 // true

delete obj.a

obj.a === 2 // true
</code></pre>
<p>7ã€<code>arr[0] === null</code> æ˜¯å¦ç›¸ç­‰ï¼Ÿä¸ºä»€ä¹ˆ?</p>
<pre><code class="language-ts">const obj = { a: 1 }
const arr = [obj]
obj = null
</code></pre>
<p>8ã€<code>arr.get(obj) === null</code> æ˜¯å¦ç›¸ç­‰ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<pre><code class="language-ts">let obj = { a: 1 }
const map = new WeakMap()
map.set(obj, { a: 1 })
obj = null
</code></pre>
<p>9ã€a, b, c çš„åŒºåˆ«ï¼Ÿå¦‚ä½•åœ¨ class å†™æ³•ä¸Šçš„åŸå‹ä¸Šå®šä¹‰å€¼ï¼Ÿ</p>
<pre><code class="language-ts">class A {
    a = 1

    constructor() {
        this.b = 2
    }

    c() {
        return 3
    }
}
</code></pre>
<p>a, b, c çš„åŒºåˆ«ï¼Ÿå¦‚ä½•åœ¨åŸå‹ä¸Šå®šä¹‰å€¼ï¼Ÿ</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç”±å°è£…ä¸€ä¸ªè¯·æ±‚åº“æ‰€æƒ³åˆ°çš„]]></title>
        <id>https://aiyou.life/post/M4RcI3wfU/</id>
        <link href="https://aiyou.life/post/M4RcI3wfU/">
        </link>
        <updated>2021-05-06T07:32:44.000Z</updated>
        <summary type="html"><![CDATA[<p>æ˜¯å¦æœ‰ä¸€ç§æ–¹å¼ï¼Œä»åº•å‘ä¸Šçš„ï¼Œé’ˆå¯¹ä¸åŒçš„è¯·æ±‚å†…æ ¸å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºå…¶èµ‹äºˆè¯·æ±‚åº“æ‹¦æˆªå™¨ã€ä¸­é—´ä»¶ã€å¿«æ·è¯·æ±‚ç­‰å‡ ä¸ªé€šç”¨åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿ç•™ä¸åŒè¯·æ±‚å†…æ ¸çš„å·®å¼‚åŒ–ï¼Ÿ</p>
]]></summary>
        <content type="html"><![CDATA[<p>æ˜¯å¦æœ‰ä¸€ç§æ–¹å¼ï¼Œä»åº•å‘ä¸Šçš„ï¼Œé’ˆå¯¹ä¸åŒçš„è¯·æ±‚å†…æ ¸å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºå…¶èµ‹äºˆè¯·æ±‚åº“æ‹¦æˆªå™¨ã€ä¸­é—´ä»¶ã€å¿«æ·è¯·æ±‚ç­‰å‡ ä¸ªé€šç”¨åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿ç•™ä¸åŒè¯·æ±‚å†…æ ¸çš„å·®å¼‚åŒ–ï¼Ÿ</p>
<!-- more -->
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ€è¿‘æƒ³å†™ä¸€ä¸ªå¯ä»¥é€‚é…å¤šå¹³å°çš„è¯·æ±‚åº“ï¼Œåœ¨ç ”ç©¶ xhr å’Œ fetch å‘ç°äºŒè€…çš„å‚æ•°ã€å“åº”ã€å›è°ƒå‡½æ•°ç­‰å·®åˆ«å¾ˆå¤§ã€‚æƒ³åˆ°å¦‚æœè¯·æ±‚åº“æƒ³è¦é€‚é…å¤šå¹³å°ï¼Œéœ€è¦ç»Ÿä¸€çš„ä¼ å‚å’Œå“åº”æ ¼å¼ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šåœ¨è¯·æ±‚åº“å†…éƒ¨åšå¤§é‡çš„åˆ¤æ–­ï¼Œè¿™æ ·ä¸ä½†è´¹æ—¶è´¹åŠ›ï¼Œè¿˜ä¼šå±è”½æ‰åº•å±‚è¯·æ±‚å†…æ ¸å·®å¼‚ã€‚</p>
<p>é˜…è¯» axios å’Œ umi-request æºç æ—¶æƒ³åˆ°ï¼Œè¯·æ±‚åº“å…¶å®åŸºæœ¬éƒ½åŒ…å«äº†æ‹¦æˆªå™¨ã€ä¸­é—´ä»¶å’Œå¿«æ·è¯·æ±‚ç­‰å‡ ä¸ªé€šç”¨çš„ï¼Œä¸å…·ä½“è¯·æ±‚è¿‡ç¨‹æ— å…³çš„åŠŸèƒ½ã€‚ç„¶åé€šè¿‡ä¼ å‚ï¼Œè®©ç”¨æˆ·æ¥è§¦åº•å±‚è¯·æ±‚å†…æ ¸ã€‚é—®é¢˜åœ¨äºï¼Œè¯·æ±‚åº“å†…ç½®å¤šä¸ªåº•å±‚è¯·æ±‚å†…æ ¸ï¼Œå†…æ ¸æ”¯æŒçš„å‚æ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸Šå±‚åº“å¯èƒ½åšä¸€äº›å¤„ç†ï¼ŒæŠ¹å¹³ä¸€äº›å‚æ•°çš„å·®å¼‚åŒ–ï¼Œä½†å¯¹äºåº•å±‚å†…æ ¸çš„ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œè¦ä¹ˆæ”¾å¼ƒï¼Œè¦ä¹ˆåªèƒ½åœ¨å‚æ•°åˆ—è¡¨ä¸­åŠ å…¥ä¸€äº›å…·ä½“å†…æ ¸çš„ç‰¹æœ‰çš„å‚æ•°ã€‚æ¯”å¦‚åœ¨ axios ä¸­ï¼Œå®ƒçš„è¯·æ±‚é…ç½®å‚æ•°åˆ—è¡¨ä¸­ï¼Œç½—åˆ—äº†ä¸€äº› <a href="https://axios-http.com/docs/req_config">browser only</a>çš„å‚æ•°ï¼Œé‚£å¯¹äºåªéœ€è¦åœ¨ node ç¯å¢ƒä¸­è¿è¡Œçš„ axios æ¥è¯´ï¼Œå‚æ•°å¤šå°‘æœ‰äº›å†—ä½™ï¼Œå¹¶ä¸”å¦‚æœ axios è¦æ”¯æŒå…¶ä»–è¯·æ±‚å†…æ ¸(æ¯”å¦‚å°ç¨‹åºã€å¿«åº”ç”¨ã€åä¸ºé¸¿è’™ç­‰)ï¼Œé‚£ä¹ˆå‚æ•°å†—ä½™ä¹Ÿå°†è¶Šæ¥è¶Šå¤§ï¼Œæ‰©å±•æ€§ä¹Ÿå·®ã€‚</p>
<p>æ¢ä¸ªæ€è·¯æ¥æƒ³ï¼Œæ—¢ç„¶å®ç°ä¸€ä¸ªé€‚é…å¤šå¹³å°çš„ç»Ÿä¸€çš„è¯·æ±‚åº“æœ‰è¿™äº›é—®é¢˜ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥ä»åº•å‘ä¸Šçš„ï¼Œé’ˆå¯¹ä¸åŒçš„è¯·æ±‚å†…æ ¸ï¼Œæä¾›ä¸€ç§æ–¹å¼å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºå…¶èµ‹äºˆæ‹¦æˆªå™¨ã€ä¸­é—´ä»¶ã€å¿«æ·è¯·æ±‚ç­‰å‡ ä¸ªé€šç”¨åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿ç•™ä¸åŒè¯·æ±‚å†…æ ¸çš„å·®å¼‚åŒ–ï¼Ÿ</p>
<h2 id="è®¾è®¡å®ç°">è®¾è®¡å®ç°</h2>
<p>æˆ‘ä»¬çš„è¯·æ±‚åº“è¦æƒ³ä¸è¯·æ±‚å†…æ ¸æ— å…³ï¼Œé‚£ä¹ˆåªèƒ½é‡‡ç”¨å†…æ ¸ä¸è¯·æ±‚åº“ç›¸åˆ†ç¦»çš„æ¨¡å¼ã€‚ä½¿ç”¨æ—¶ï¼Œéœ€è¦å°†è¯·æ±‚å†…æ ¸ä¼ å…¥ï¼Œåˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹ï¼Œå†è¿›è¡Œä½¿ç”¨ã€‚æˆ–è€…åŸºäºè¯·æ±‚åº“ï¼Œä¼ å…¥å†…æ ¸ï¼Œé¢„ç½®è¯·æ±‚å‚æ•°æ¥è¿›è¡ŒäºŒæ¬¡å°è£…ã€‚</p>
<h3 id="åŸºæœ¬æ¶æ„">åŸºæœ¬æ¶æ„</h3>
<p>é¦–å…ˆå®ç°ä¸€ä¸ªåŸºæœ¬çš„æ¶æ„</p>
<pre><code class="language-ts">class PreQuest {
    constructor(private adapter)
    
    request(opt) {
        return this.adapter(opt)
    }
}

const adapter = (opt) =&gt; nativeRequestApi(opt)
// eg: const adapter = (opt) =&gt; fetch(opt).then(res =&gt; res.json())

// åˆ›å»ºå®ä¾‹
const prequest = new PreQuest(adapter)

// è¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯ adapter å‡½æ•°
prequest.request({ url: 'http://localhost:3000/api' })
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¥¶äº†ä¸ªå¼¯ï¼Œé€šè¿‡å®ä¾‹æ–¹æ³•è°ƒç”¨äº† adapter å‡½æ•°ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼Œä¸ºä¿®æ”¹è¯·æ±‚å’Œå“åº”æä¾›äº†æƒ³è±¡ç©ºé—´ã€‚</p>
<pre><code class="language-ts">class PreQuest {
    // ...some code
    
    async request(opt){
        const options = modifyReqOpt(opt)
        const res = await this.adapter(options)
        return modifyRes(res)
    }

    // ...some code
}
</code></pre>
<h3 id="ä¸­é—´ä»¶">ä¸­é—´ä»¶</h3>
<p>å¯ä»¥é‡‡ç”¨ koa çš„æ´‹è‘±æ¨¡å‹ï¼Œå¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªå’Œä¿®æ”¹ã€‚</p>
<p>ä¸­é—´ä»¶è°ƒç”¨ç¤ºä¾‹:</p>
<pre><code class="language-ts">const prequest = new PreQuest(adapter)

prequest.use(async (ctx, next) =&gt; {
    ctx.request.path = '/perfix' + ctx.request.path
    await next()
    ctx.response.body = JSON.parse(ctx.response.body)
})
</code></pre>
<p>å®ç°ä¸­é—´ä»¶åŸºæœ¬æ¨¡å‹ï¼Ÿ</p>
<pre><code class="language-ts">class Middleware {
    // ä¸­é—´ä»¶åˆ—è¡¨
    cbs = []
    
    // æ³¨å†Œä¸­é—´ä»¶
    use(cb) {
       this.cbs.push(cb)
       return this
    }
    
    // æ‰§è¡Œä¸­é—´ä»¶
    exec(ctx, next){

        let times = -1
    
        const dispatch = (pointer = 0): Promise&lt;any&gt; =&gt; {
            if (cbs.length &lt; pointer) return Promise.resolve()

            const fn = this.cbs[pointer] || next

            if (pointer &lt;= times) throw new Error('next function only can be called once')
             // ç¡®ä¿æ¯ä¸ªä¸­é—´ä»·ä¸­ next æ–¹æ³•åªè°ƒç”¨ä¸€æ¬¡
             times = pointer

            // æ´‹è‘±æ¨¡å‹
             return fn(ctx, () =&gt; dispatch(++pointer))
        }

        return dispatch()
    }
}
</code></pre>
<p>å…¨å±€ä¸­é—´ä»¶ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ª use å’Œ exec çš„é™æ€æ–¹æ³•å³å¯ã€‚</p>
<p>PreQuest ç»§æ‰¿è‡ª Middleware ç±»ï¼Œå³å¯åœ¨å®ä¾‹ä¸Šæ³¨å†Œä¸­é—´ä»¶ã€‚</p>
<p>é‚£ä¹ˆæ€ä¹ˆåœ¨è¯·æ±‚å‰è°ƒç”¨ä¸­é—´ä»¶?</p>
<pre><code class="language-ts">class PreQuest extends Middleware {
    // ...some code
     
    async request(opt) {
    
        const ctx = {
            request: opt,
            response: {}
        }
        
        // æ‰§è¡Œä¸­é—´ä»¶
        async this.exec(ctx, async (ctx) =&gt; {
            ctx.response = await this.adapter(ctx.request)
        })
        
        return ctx.response
    }
        
    // ...some code
}

</code></pre>
<p>ä¸­é—´ä»¶æ¨¡å‹ä¸­ï¼Œå‰ä¸€ä¸ªä¸­é—´ä»¶çš„è¿”å›å€¼æ˜¯ä¼ ä¸åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ä¸­ï¼Œæ‰€ä»¥æ˜¯é€šè¿‡ä¸€ä¸ªå¯¹è±¡åœ¨ä¸­é—´ä»¶ä¸­ä¼ é€’å’Œèµ‹å€¼ã€‚</p>
<h3 id="æ‹¦æˆªå™¨">æ‹¦æˆªå™¨</h3>
<p>æ‹¦æˆªå™¨æ˜¯ä¿®æ”¹å‚æ•°å’Œå“åº”çš„å¦ä¸€ç§æ–¹å¼ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹ axios ä¸­æ‹¦æˆªå™¨æ˜¯æ€ä¹ˆç”¨çš„ã€‚</p>
<pre><code class="language-ts">import axios from 'axios'

const instance = axios.create()

instance.interceptor.request.use(
    (opt) =&gt; modifyOpt(opt),
    (e) =&gt; handleError(e)
)
</code></pre>
<p>æ ¹æ®ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªåŸºæœ¬ç»“æ„</p>
<pre><code class="language-ts">class Interceptor {
    cbs = []
    
    // æ³¨å†Œæ‹¦æˆªå™¨
    use(successHandler, errorHandler) {
        this.cbs.push({ successHandler, errorHandler })
    }
    
    exec(opt) {
      return this.cbs.reduce(
        (t, c, idx) =&gt; t.then(c.successHandler, this.handles[idx - 1]?.errorHandler),
        Promise.resolve(opt)
      )
      .catch(this.handles[this.handles.length - 1].errorHandler)
    }
}
</code></pre>
<p>ä»£ç å¾ˆç®€å•ï¼Œæœ‰ç‚¹éš¾åº¦çš„å°±æ˜¯æ‹¦æˆªå™¨çš„æ‰§è¡Œäº†ã€‚è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªçŸ¥è¯†ç‚¹: Array.reduce å’Œ Promise.then ç¬¬äºŒä¸ªå‚æ•°çš„ä½¿ç”¨ã€‚</p>
<p>æ³¨å†Œæ‹¦æˆªå™¨æ—¶ï¼Œ<code>successHandler</code> ä¸ <code>errorHandler</code> æ˜¯æˆå¯¹çš„ï¼Œ successHandler ä¸­æŠ›å‡ºçš„é”™è¯¯ï¼Œè¦åœ¨å¯¹åº”çš„ errorHandler ä¸­å¤„ç†ï¼Œæ‰€ä»¥ errorHandler æ¥æ”¶åˆ°çš„é”™è¯¯ï¼Œæ˜¯ä¸Šä¸€ä¸ªæ‹¦æˆªå™¨ä¸­æŠ›å‡ºçš„ã€‚</p>
<p>æ‹¦æˆªå™¨æ€ä¹ˆä½¿ç”¨å‘¢?</p>
<pre><code class="language-ts">class PreQuest {
    // ... some code
    interceptor = {
        request: new Interceptor()
        response: new Interceptor()
    }
    
    // ...some code
    
    async request(opt){
        
        // æ‰§è¡Œæ‹¦æˆªå™¨ï¼Œä¿®æ”¹è¯·æ±‚å‚æ•°
        const options = await this.interceptor.request.exec(opt)
        
        const res = await this.adapter(options)
        
        // æ‰§è¡Œæ‹¦æˆªå™¨ï¼Œä¿®æ”¹å“åº”æ•°æ®
        const response = await this.interceptor.response.exec(res)
        
        return response
    }
    
}
</code></pre>
<h3 id="æ‹¦æˆªå™¨ä¸­é—´ä»¶">æ‹¦æˆªå™¨ä¸­é—´ä»¶</h3>
<p>æ‹¦æˆªå™¨ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œä¸­é—´ä»¶æ¥å®ç°ã€‚è¯·æ±‚æ‹¦æˆªå™¨åœ¨ <code>await next()</code> å‰æ‰§è¡Œï¼Œå“åº”æ‹¦æˆªå™¨åœ¨å…¶åã€‚</p>
<pre><code class="language-ts">const instance = new Middleware()

instance.use(async (ctx, next) =&gt; {
    // Promise é“¾å¼è°ƒç”¨ï¼Œæ›´æ”¹è¯·æ±‚å‚æ•°
    await Promise.resolve().then(reqInterceptor1).then(reqInterceptor2)...
    // æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€æˆ–æ‰§è¡Œåˆ° this.adapter å‡½æ•°
    await next()
    // Promise é“¾å¼è°ƒç”¨ï¼Œæ›´æ”¹å“åº”æ•°æ®
    await Promise.resolve().then(resInterceptor1).then(resInterceptor2)...
})
</code></pre>
<p>æ‹¦æˆªå™¨æœ‰è¯·æ±‚æ‹¦æˆªå™¨å’Œå“åº”æ‹¦æˆªå™¨ä¸¤ç±»ã€‚</p>
<pre><code class="language-ts">class InterceptorMiddleware {
    request = new Interceptor()
    response = new Interceptor()
    
    // æ³¨å†Œä¸­é—´ä»¶
    register: async (ctx, next) {
        ctx.request = await this.request.exec(ctx.request)
        await next()
        ctx.response = await thie.response.exec(ctx.response)
    }
}
</code></pre>
<p>ä½¿ç”¨</p>
<pre><code class="language-ts">const instance = new Middleware()
const interceptor = new InterceptorMiddleware()

// æ³¨å†Œæ‹¦æˆªå™¨
interceptor.request.use(
    (opt) =&gt; modifyOpt(opt),
    (e) =&gt; handleError(e)
)

// æ³¨å†Œåˆ°ä¸­é—´ä¸­
instance.use(interceptor.register)
</code></pre>
<h3 id="ç±»å‹è¯·æ±‚">ç±»å‹è¯·æ±‚</h3>
<p>è¿™é‡Œæˆ‘æŠŠç±»ä¼¼ <code>instance.get('/api')</code> è¿™æ ·çš„è¯·æ±‚å«åšç±»å‹è¯·æ±‚ã€‚åº“ä¸­é›†æˆç±»å‹è¯·æ±‚çš„è¯ï¼Œéš¾å…ä¼šå¯¹å¤–éƒ¨ä¼ å…¥çš„adapter å‡½æ•°çš„å‚æ•°è¿›è¡Œæ±¡æŸ“ã€‚å› ä¸ºéœ€è¦ä¸ºè¯·æ±‚æ–¹å¼ <code>get</code> å’Œè·¯å¾„ <code>/api</code> åˆ†é…é”®åï¼Œå¹¶ä¸”å°†å…¶æ··å…¥åˆ°å‚æ•°ä¸­ï¼Œé€šå¸¸åœ¨ä¸­é—´ä»¶ä¸­ä¼šæœ‰ä¿®æ”¹è·¯å¾„çš„éœ€æ±‚ã€‚</p>
<p>å®ç°å¾ˆç®€å•ï¼Œåªéœ€è¦éå† HTTP è¯·æ±‚ç±»å‹ï¼Œå¹¶å°†å…¶æŒ‚åœ¨ this ä¸‹å³å¯</p>
<pre><code class="language-ts">class PreQuest {
    constructor(private adapter) {
        this.mount()
    }
    
    // æŒ‚è½½æ‰€æœ‰ç±»å‹çš„åˆ«åè¯·æ±‚
    mount() {
       methods.forEach(method =&gt; {
           this[method] = (path, opt) =&gt; {
             // æ··å…¥ path å’Œ method å‚æ•°
             return this.request({ path, method, ...opt })
           }
       })
    }
    
    // ...some code

    request(opt) {
        // ...some code
    }
}

</code></pre>
<h3 id="ç®€å•è¯·æ±‚">ç®€å•è¯·æ±‚</h3>
<p>axios ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢è¿™ç§å½¢å¼è¿›è¡Œè°ƒç”¨</p>
<pre><code class="language-ts">axios('http://localhost:3000/api').then(res =&gt; console.log(res))
</code></pre>
<p>æˆ‘å°†è¿™ç§è¯·æ±‚æ–¹å¼ç§°ä¹‹ä¸ºç®€å•è¯·æ±‚ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œæ€ä¹ˆå®ç°è¿™ç§å†™æ³•çš„è¯·æ±‚æ–¹å¼å‘¢ï¼Ÿ</p>
<p>ä¸ä½¿ç”¨ class ï¼Œä½¿ç”¨ä¼ ç»Ÿå‡½æ•°ç±»å†™æ³•çš„è¯æ¯”è¾ƒå¥½å®ç°ï¼Œåªéœ€è¦åˆ¤æ–­å‡½æ•°æ˜¯å¦æ˜¯ new è°ƒç”¨ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨æ‰§è¡Œä¸åŒçš„é€»è¾‘å³å¯ã€‚</p>
<p>demo å¦‚ä¸‹</p>
<pre><code class="language-ts">function PreQuest() {
    if(!(this instanceof PreQuest)) {
        console.log('ä¸æ˜¯new è°ƒç”¨')
        return // ...some code
    }
   
   console.log('newè°ƒç”¨') 
   
   //... some code
}

// new è°ƒç”¨
const instance = new PreQuest(adapter)
instance.get('/api').then(res =&gt; console.log(res))

// ç®€å•è°ƒç”¨
PreQuest('/api').then(res =&gt; console.log(res))
</code></pre>
<p>class å†™æ³•çš„è¯ï¼Œä¸èƒ½è¿›è¡Œå‡½æ•°è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ class å®ä¾‹ä¸Šåšæ–‡ç« ã€‚</p>
<p>é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹ï¼Œçœ‹ä¸€ä¸‹ç”¨æ³•</p>
<pre><code class="language-ts">const prequest = new PreQuest(adapter)

prequest.get('http://localhost:3000/api')

prequest('http://localhost:3000/api')
</code></pre>
<p>é€šè¿‡ new å®ä¾‹åŒ–å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡æ˜¯ä¸èƒ½å¤Ÿå½“åšå‡½æ•°æ¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ new çš„å½¢å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚</p>
<p>å†çœ‹ä¸€ä¸‹ axios ä¸­ç”Ÿæˆå®ä¾‹çš„æ–¹æ³• <code>axios.create</code>, å¯ä»¥ä»ä¸­å¾—åˆ°çµæ„Ÿï¼Œå¦‚æœ <code>.create</code> æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¸ŠæŒ‚ä¸Šäº†æ‰€æœ‰ new å‡ºæ¥å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>ç®€å•è®¾è®¡ä¸€ä¸‹:</p>
<p>æ–¹å¼ä¸€: æ‹·è´åŸå‹ä¸Šçš„æ–¹æ³•</p>
<pre><code class="language-ts">class PreQuest {

    static create(adapter) {
        const instance = new PreQuest(adapter)
        
        function inner(opt) {
           return instance.request(opt)
        }
        
        for(let key in instance) {
            inner[key] = instance[key]
        }
        
        return inner
    }
}
</code></pre>
<p><strong>æ³¨æ„: åœ¨æŸäº›ç‰ˆæœ¬çš„ es ä¸­ï¼Œ<code>for in</code> å¾ªç¯éå†ä¸å‡º class ç”Ÿæˆå®ä¾‹åŸå‹ä¸Šçš„æ–¹æ³•ã€‚</strong></p>
<p>æ–¹å¼äºŒ: è¿˜å¯ä»¥ä½¿ç”¨ Proxy ä»£ç†ä¸€ä¸ªç©ºå‡½æ•°ï¼Œæ¥åŠ«æŒè®¿é—®ã€‚</p>
<pre><code class="language-ts">class PreQuest {
    
    // ...some code

    static create(adapter) {
        const instance = new PreQuest(adapter)
       
        return new Proxy(function (){}, {
          get(_, name) {
            return Reflect.get(instance, name)
          },
          apply(_, __, args) {
            return Reflect.apply(instance.request, instance, args)
          },
        })
    }
}
</code></pre>
<p>ä¸Šé¢ä¸¤ç§æ–¹æ³•çš„ç¼ºç‚¹åœ¨äºï¼Œé€šè¿‡ <code>create</code> æ–¹æ³•è¿”å›çš„å°†ä¸å†æ˜¯ <code>PreQuest</code> çš„å®ä¾‹ï¼Œå³</p>
<pre><code class="language-ts">const prequest = PreQuest.create(adapter)

prequest instanceof PreQuest  // false
</code></pre>
<p>ä¸ªäººç›®å‰è¿˜æ²¡æœ‰æƒ³åˆ°ï¼Œåˆ¤æ–­ <code>prequest</code> æ˜¯ä¸æ˜¯ <code>PreQuest</code> å®ä¾‹æœ‰ä»€ä¹ˆç”¨ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æƒ³åˆ°å¥½çš„è§£å†³åŠæ³•ã€‚æœ‰è§£å†³æ–¹æ¡ˆçš„è¯·åœ¨è¯„è®ºé‡Œå‘Šè¯‰æˆ‘ã€‚</p>
<p>ä½¿ç”¨ <code>.create</code> åˆ›å»º 'å®ä¾‹' çš„æ–¹å¼å¯èƒ½ä¸ç¬¦åˆç›´è§‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ Proxy åŠ«æŒ new æ“ä½œã€‚</p>
<p>Demoå¦‚ä¸‹:</p>
<pre><code class="language-ts">class InnerPreQuest {
  create() {
     // ...some code
  }
}

const PreQuest = new Proxy(InnerPreQuest, {
    construct(_, args) {
        return () =&gt; InnerPreQuest.create(...args)
    }
})
</code></pre>
<h3 id="è¯·æ±‚é”">è¯·æ±‚é”</h3>
<p>å¦‚ä½•å®ç°åœ¨è¯·æ±‚æ¥å£å‰ï¼Œå…ˆæ‹¿åˆ° token å†å»è¯·æ±‚ï¼Ÿ</p>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œé¡µé¢åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚</p>
<pre><code class="language-ts">const prequest = PreQuest.create(adapter)

prequest('/api/1').catch(e =&gt; e)     // auth fail
prequest('/api/2').catch(e =&gt; e)    // auth fail
prequest('/api/3').catch(e =&gt; e)    // auth fail
</code></pre>
<p>é¦–å…ˆå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸­é—´ä»¶ä¸ºå…¶æ·»åŠ  token</p>
<pre><code class="language-ts">prequest.use(async (ctx, next) =&gt; {
    ctx.request.headers['Authorization'] = `bearer ${token}`
    await next()
})
</code></pre>
<p>ä½† token å€¼ä»ä½•è€Œæ¥ï¼Ÿtoken éœ€è¦è¯·æ±‚æ¥å£å¾—æ¥ï¼Œå¹¶ä¸”éœ€è¦é‡æ–°åˆ›å»ºè¯·æ±‚å®ä¾‹ï¼Œä»¥é¿å…é‡æ–°èµ°æ·»åŠ  token çš„ä¸­é—´ä»¶çš„é€»è¾‘ã€‚</p>
<p>ç®€å•å®ç°ä¸€ä¸‹</p>
<pre><code class="language-ts">const tokenRequest = PreQuest.create(adapter)

let token = null
prequest.use(async (ctx, next) =&gt; {
    if(!token) {
        token = await tokenRequest('/token')
    }
    ctx.request.headers['Authorization'] = `bearer ${token}`
    await next()
})
</code></pre>
<p>è¿™é‡Œä½¿ç”¨äº† token å˜é‡ï¼Œæ¥é¿å…æ¯æ¬¡è¯·æ±‚æ¥å£ï¼Œéƒ½å»è°ƒæ¥å£æ‹¿ tokenã€‚</p>
<p>ä»£ç ä¹ä¸€çœ‹æ²¡æœ‰é—®é¢˜ï¼Œä½†ä»”ç»†ä¸€æƒ³ï¼Œå½“åŒæ—¶è¯·æ±‚å¤šä¸ªæ¥å£ï¼ŒtokenRequest è¯·æ±‚è¿˜æ²¡æœ‰å¾—åˆ°å“åº”æ—¶ï¼Œåé¢çš„è¯·æ±‚åˆéƒ½èµ°åˆ°è¿™ä¸ªä¸­é—´ä»¶ï¼Œæ­¤æ—¶ token å€¼ä¸ºç©ºï¼Œä¼šé€ æˆå¤šæ¬¡è°ƒç”¨ tokenRequestã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<p>å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¯ä»¥åŠ ä¸ªé”æœºåˆ¶æ¥å®ç°</p>
<pre><code class="language-ts">let token = null
let pending = false
prequest.use(async (ctx, next) =&gt; {
    if(!token) {
        if(pending) return
        pending = true
        token = await tokenRequest('/token')
        pending = flase
    }
    ctx.request.headers['Authorization'] = `bearer ${token}`
    await next()
})
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬åŠ äº† pending æ¥åˆ¤æ–­ tokenRequest çš„æ‰§è¡Œï¼ŒæˆåŠŸè§£å†³äº† tokenRequest æ‰§è¡Œå¤šæ¬¡çš„é—®é¢˜ï¼Œä½†åˆå¼•å…¥äº†æ–°çš„é—®é¢˜ï¼Œåœ¨æ‰§è¡Œ tokenRequest æ—¶ï¼Œåé¢åˆ°æ¥çš„è¯·æ±‚åº”å½“æ€ä¹ˆå¤„ç†ï¼Ÿä¸Šé¢çš„ä»£ç ï¼Œç›´æ¥ return æ‰äº†ï¼Œè¯·æ±‚å°†è¢«ä¸¢å¼ƒã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›ï¼Œè¯·æ±‚å¯ä»¥åœ¨è¿™é‡Œæš‚åœï¼Œå½“æ‹¿åˆ° token æ—¶ï¼Œå†è¯·æ±‚åé¢çš„ä¸­é—´ä»¶ã€‚</p>
<p>æš‚åœï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æƒ³åˆ°ä½¿ç”¨ asyncã€await æˆ–è€… promise æ¥å®ç°ã€‚ä½†åœ¨è¿™é‡Œå¦‚ä½•ç”¨å‘¢ï¼Ÿ</p>
<p>æˆ‘ä» axios çš„ <a href="https://github.com/axios/axios/blob/e9965bfafc82d8b42765705061b9ebe2d5532493/lib/cancel/CancelToken.js#L17">cancelToken</a> å®ç°ä¸­å¾—åˆ°äº†çµæ„Ÿã€‚axios ä¸­ï¼Œåˆ©ç”¨ promise ç®€å•å®ç°äº†ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°† Promise ä¸­çš„ resolve èµ‹å€¼åˆ°å¤–éƒ¨å±€éƒ¨å˜é‡ï¼Œå®ç°å¯¹ promise æµç¨‹çš„æ§åˆ¶ã€‚</p>
<p>ç®€å•å®ç°ä¸€ä¸‹</p>
<pre><code class="language-ts">let token = null
let pending = false
let resolvePromise
let promise = new Promise((resolve) =&gt; resolvePromise = resolve)

prequest.use(async (ctx, next) =&gt; {
    if(!token) {
        if(pending) {
            // promise æ§åˆ¶æµç¨‹
            token = await promise
        } else {
            pending = true
            token = await tokenRequest('/token')
            // è°ƒç”¨ resolveï¼Œä½¿å¾— promise å¯ä»¥æ‰§è¡Œå‰©ä½™çš„æµç¨‹
            resolvePromise(token)
            pending = flase
        }
    } 

    ctx.request.headers['Authorization'] = `bearer ${token}`
    await next()
})
</code></pre>
<p>å½“æ‰§è¡Œ tokenRequest æ—¶ï¼Œå…¶ä½™è¯·æ±‚çš„æ¥å£ï¼Œéƒ½ä¼šè¿›å…¥åˆ°ä¸€ä¸ª promise æ§åˆ¶çš„æµç¨‹ä¸­ï¼Œå½“ token å¾—åˆ°åï¼Œé€šè¿‡å¤–éƒ¨ resolve, æ§åˆ¶ promise ç»§ç»­æ‰§è¡Œï¼Œä»¥æ­¤è®¾ç½®è¯·æ±‚å¤´ï¼Œå’Œæ‰§è¡Œå‰©ä½™ä¸­é—´ä»¶ã€‚</p>
<p>è¿™ç§æ–¹å¼è™½ç„¶å®ç°äº†éœ€æ±‚ï¼Œä½†ä»£ç ä¸‘é™‹ä¸ç¾è§‚ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†çŠ¶æ€éƒ½å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚ä»¥å®ç°ç±»ä¼¼ä¸‹é¢è¿™ç§è°ƒç”¨ã€‚è¿™æ ·çš„è°ƒç”¨ç¬¦åˆç›´è§‰ä¸”ç¾è§‚ã€‚</p>
<pre><code class="language-ts">prequest.use(async (ctx, next) =&gt; {
  const token = await wrapper(tokenRequest)
  ctx.request.headers['Authorization'] = `bearer ${token}`
  await next()
})
</code></pre>
<p>æ€ä¹ˆå®ç°è¿™æ ·ä¸€ä¸ª wrapper å‡½æ•°ï¼Ÿ</p>
<p>é¦–å…ˆï¼ŒçŠ¶æ€ä¸èƒ½å°è£…åˆ° wrapper å‡½æ•°ä¸­ï¼Œå¦åˆ™æ¯æ¬¡éƒ½ä¼šç”Ÿæˆæ–°çš„çŠ¶æ€ï¼Œwrapper å°†å½¢åŒè™šè®¾ã€‚å¯ä»¥ä½¿ç”¨é—­åŒ…å‡½æ•°å°†çŠ¶æ€ä¿å­˜ã€‚</p>
<pre><code class="language-ts">function createWrapper() {
    let token = null
    let pending = false
    let resolvePromise
    let promise = new Promise((resolve) =&gt; resolvePromise = resolve)
    return function (fn) {
        if(pending) return promise
        if(token) return token

        pending = true

        token = await fn()

        pending = false
        resolvePromise(token)

        return token
    }
}
</code></pre>
<p>ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦åˆ©ç”¨ <code>createWrapper</code> ç”Ÿæˆä¸€ä¸ª <code>wrapper</code> å³å¯</p>
<pre><code class="language-ts">const wrapper = createWrapper()

prequest.use(async (ctx, next) =&gt; {
  const token = await wrapper(tokenRequest)
  ctx.request.headers['Authorization'] = `bearer ${token}`
  await next()
})
</code></pre>
<p>è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°æˆ‘ä»¬çš„ç›®çš„ã€‚</p>
<p>ä½†ï¼Œè¿™é‡Œçš„ä»£ç è¿˜æœ‰é—®é¢˜ï¼ŒçŠ¶æ€å°è£…åœ¨ createWrapper å†…éƒ¨ï¼Œå½“ token å¤±æ•ˆåï¼Œæˆ‘ä»¬å°†æ— ä»å¤„ç†ã€‚</p>
<p>æ¯”è¾ƒå¥½çš„åšæ³•æ˜¯ï¼Œå°†çŠ¶æ€ä» <code>createWrapper</code> å‚æ•°ä¸­ä¼ å…¥ã€‚</p>
<p>ä»£ç å®ç°ï¼Œè¯·å‚è€ƒ<a href="https://github.com/xdoer/PreQuest/blob/104c178e7c3a1b8edd8c6d36ad603e880297eba2/packages/lock/src/index.ts#L5">è¿™é‡Œ</a></p>
<h2 id="å®æˆ˜">å®æˆ˜</h2>
<p>ä»¥å¾®ä¿¡å°ç¨‹åºä¸ºä¾‹ã€‚å°ç¨‹åºä¸­è‡ªå¸¦çš„ <code>wx.request</code> å¹¶ä¸å¥½ç”¨ã€‚ä½¿ç”¨ä¸Šé¢æˆ‘ä»¬å°è£…çš„ä»£ç ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„æ‰“é€ å‡ºä¸€ä¸ªå°ç¨‹åºè¯·æ±‚åº“ã€‚</p>
<h3 id="å°è£…å°ç¨‹åºåŸç”Ÿè¯·æ±‚">å°è£…å°ç¨‹åºåŸç”Ÿè¯·æ±‚</h3>
<p>å°†åŸç”Ÿå°ç¨‹åºè¯·æ±‚ Promise åŒ–ï¼Œè®¾è®¡ä¼ å‚ opt å¯¹è±¡</p>
<pre><code class="language-ts">function adapter(opt) {
  const { path, method, baseURL, ...options } = opt
  const url = baseURL + path
  return new Promise((resolve, reject) =&gt; {
    wx.request({
      ...options,
      url,
      method,
      success: resolve,
      fail: reject,
    })
  })
}

</code></pre>
<h3 id="è°ƒç”¨">è°ƒç”¨</h3>
<pre><code class="language-ts">const instance = PreQuest.create(adapter)

// ä¸­é—´ä»¶æ¨¡å¼
instance.use(async (ctx, next) =&gt; {
    // ä¿®æ”¹è¯·æ±‚å‚æ•°
    ctx.request.path = '/prefix' + ctx.request.path
    
    await next()
    
    // ä¿®æ”¹å“åº”
    ctx.response.body = JSON.parse(ctx.response.body)
})

// æ‹¦æˆªå™¨æ¨¡å¼
instance.interecptor.request.use(
    (opt) =&gt; {
        opt.path = '/prefix' + opt.path
        return opt
    }
)

instance.request({ path: '/api', baseURL: 'http://localhost:3000' })

instance.get('http://localhost:3000/api')

instance.post('/api', { baseURL: 'http://loclahost:3000' })
</code></pre>
<h3 id="è·å–åŸç”Ÿè¯·æ±‚å®ä¾‹">è·å–åŸç”Ÿè¯·æ±‚å®ä¾‹</h3>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹åœ¨å°ç¨‹åºä¸­æ€æ ·ä¸­æ–­è¯·æ±‚</p>
<pre><code class="language-ts">const request = wx.request({
    // ...some code
})

request.abort()
</code></pre>
<p>ä½¿ç”¨æˆ‘ä»¬å°è£…çš„è¿™ä¸€å±‚ï¼Œå°†æ‹¿ä¸åˆ°åŸç”Ÿè¯·æ±‚å®ä¾‹ã€‚</p>
<p>é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»ä¼ å‚ä¸­å…¥æ‰‹</p>
<pre><code class="language-ts">function adapter(opt) {
    const { getNativeRequestInstance } = opt
    
    let resolvePromise: any
    getNativeRequestInstance(new Promise(resolve =&gt; (resolvePromise = resolve)))
    
    return new Promise(() =&gt; {
        const nativeInstance = wx.request(
           // some code
        )
        
        resolvePromise(nativeInstance)
    })
}
</code></pre>
<p>ç”¨æ³•å¦‚ä¸‹:</p>
<pre><code class="language-ts">const instance = PreQuest.create(adapter)

instance.post('http://localhost:3000/api', {
    getNativeRequestInstance(promise) {
      promise.then(instance =&gt; {
          instance.abort()
      })
    }
})
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå› ä¸º <code>wx.request</code> çš„æ‰§è¡Œæ˜¯åœ¨ n ä¸ªä¸­é—´ä»¶ã€æ‹¦æˆªå™¨ä¹‹åæ‰§è¡Œçš„ï¼Œé‡Œé¢å­˜åœ¨å¤§é‡å¼‚æ­¥ä»»åŠ¡ï¼Œæ‰€ä»¥é€šè¿‡ä¸Šé¢æ‹¿åˆ°çš„ <code>instance</code> åªèƒ½åœ¨å¼‚æ­¥ä¸­æ‰§è¡Œã€‚</p>
<h3 id="å…¼å®¹å¤šå¹³å°å°ç¨‹åº">å…¼å®¹å¤šå¹³å°å°ç¨‹åº</h3>
<p>æŸ¥çœ‹äº†å‡ ä¸ªå°ç¨‹åºå¹³å°å’Œå¿«åº”ç”¨ï¼Œå‘ç°è¯·æ±‚æ–¹å¼éƒ½æ˜¯å°ç¨‹åºçš„é‚£ä¸€å¥—ï¼Œé‚£å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥å°† <code>wx.request</code> æ‹¿å‡ºæ¥ï¼Œåˆ›å»ºå®ä¾‹çš„æ—¶å€™å†ä¼ è¿›å»ã€‚</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ä¸Šé¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬åŸºæœ¬å®ç°äº†ä¸€ä¸ªä¸è¯·æ±‚å†…æ ¸æ— å…³çš„è¯·æ±‚åº“ï¼Œå¹¶ä¸”è®¾è®¡äº†ä¸¤ç§æ‹¦æˆªè¯·æ±‚å’Œå“åº”çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œå–œå¥½è‡ªç”±é€‰æ‹©ã€‚</p>
<p>è¿™ç§å†…æ ¸è£…å¸çš„æ–¹å¼éå¸¸å®¹æ˜“æ‰©å±•ã€‚å½“é¢å¯¹ä¸€ä¸ª axios ä¸æ”¯æŒçš„å¹³å°æ—¶ï¼Œä¹Ÿä¸ç”¨è´¹åŠ²çš„å»æ‰¾å¼€æºå¥½ç”¨çš„è¯·æ±‚åº“äº†ã€‚æˆ‘ç›¸ä¿¡å¾ˆå¤šäººåœ¨å¼€å‘å°ç¨‹åºçš„æ—¶å€™ï¼ŒåŸºæœ¬éƒ½æœ‰å»æ‰¾ axios-miniprogram çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æˆ‘ä»¬çš„ PreQuest é¡¹ç›®ï¼Œå¯ä»¥ä½“éªŒåˆ°ç±»ä¼¼ axios çš„èƒ½åŠ›ã€‚</p>
<p><a href="https://github.com/xdoer/PreQuest">PreQuest</a> é¡¹ç›®ä¸­ï¼Œé™¤äº†ä¸Šé¢æåˆ°çš„å†…å®¹ï¼Œè¿˜æä¾›äº†å…¨å±€é…ç½®ã€å…¨å±€ä¸­é—´ä»¶ã€åˆ«åè¯·æ±‚ç­‰åŠŸèƒ½ã€‚é¡¹ç›®ä¸­ä¹Ÿæœ‰åŸºäº <code>PreQuest</code> å°è£…çš„è¯·æ±‚åº“ï¼Œ<a href="https://github.com/xdoer/PreQuest/tree/main/packages/miniprogram">@prequest/miniprogram</a>,<a href="https://github.com/xdoer/PreQuest/tree/main/packages/fetch">@prequest/fetch</a>...ä¹Ÿé’ˆå¯¹ä¸€äº›ä½¿ç”¨åŸç”Ÿ xhrã€fetch ç­‰ API çš„é¡¹ç›®ï¼Œæä¾›äº†ä¸€ç§ä¸ä¾µå…¥çš„æ–¹å¼æ¥èµ‹äºˆ PreQuestçš„èƒ½åŠ› <a href="https://github.com/xdoer/PreQuest/tree/main/packages/wrapper">@prequest/wrapper</a></p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://github.com/axios/axios">axios</a>: https://github.com/axios/axios</p>
<p><a href="https://github.com/umijs/umi-request">umi-request</a>:https://github.com/umijs/umi-request</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Fower: ä¸€ä¸ªå¤šå¹³å°åŸå­ç±» CSS In JS æ ·å¼åº“]]></title>
        <id>https://aiyou.life/post/ZSut5c_dE/</id>
        <link href="https://aiyou.life/post/ZSut5c_dE/">
        </link>
        <updated>2021-04-28T12:41:50.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨è¿‡å»çš„ä¸€å¹´åŠä¸­ï¼Œæˆ‘ä»¬å›¢é˜Ÿåˆ†åˆ«ä½¿ç”¨äº† Taro  React å¼€å‘å°ç¨‹åºï¼Œ React å¼€å‘ Web ç¨‹åº å’Œä½¿ç”¨  React Native å¼€å‘ Appã€‚ä½¿ç”¨çš„æ ·å¼æ„å»ºä¹Ÿå„ç§å„æ ·ï¼Œå¹¶ä¸ç»Ÿä¸€ï¼Œåœ¨å°ç¨‹åºä¸­ï¼Œä½¿ç”¨ SCSSï¼Œåœ¨ Web ä¸­ä½¿ç”¨ tailwind, åœ¨  React Native ä¸­ä½¿ç”¨ StyleSheet.create åˆ›å»ºæ ·å¼ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨è¿‡å»çš„ä¸€å¹´åŠä¸­ï¼Œæˆ‘ä»¬å›¢é˜Ÿåˆ†åˆ«ä½¿ç”¨äº† Taro  React å¼€å‘å°ç¨‹åºï¼Œ React å¼€å‘ Web ç¨‹åº å’Œä½¿ç”¨  React Native å¼€å‘ Appã€‚ä½¿ç”¨çš„æ ·å¼æ„å»ºä¹Ÿå„ç§å„æ ·ï¼Œå¹¶ä¸ç»Ÿä¸€ï¼Œåœ¨å°ç¨‹åºä¸­ï¼Œä½¿ç”¨ SCSSï¼Œåœ¨ Web ä¸­ä½¿ç”¨ tailwind, åœ¨  React Native ä¸­ä½¿ç”¨ StyleSheet.create åˆ›å»ºæ ·å¼ã€‚</p>
<!-- more -->
<p>åœ¨è¿™ä¸‰ç§å†™æ³•ä¸­æ¥å›åˆ‡æ¢æ˜¯ç—›è‹¦çš„ã€‚</p>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>æˆ‘ä»¬ä» tailwind ä¸­è·å¾—äº†çµæ„Ÿï¼Œ å°† tailwind çš„åŸå­æ ·å¼ ä¸  JSX Prop ç»“åˆï¼Œå¼€å‘äº† Fowerã€‚Fower åœ¨  JSX ç»„ä»¶å¤–åŒ…è£…äº†ä¸€å±‚ï¼Œé€šè¿‡æ”¶é›†æ•´åˆåŸå­æ ·å¼å±æ€§ï¼Œç”Ÿæˆ className æˆ–è€… style å±æ€§ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°å†…å±‚ç»„ä»¶ä¸­ã€‚ç”±äº Fower ç»„ä»¶æœ¬è´¨æ˜¯ä¸€ä¸ª  JSX ç»„ä»¶ï¼Œå› è€Œä¹Ÿè·å¾—äº† VSCode çš„æ™ºèƒ½æç¤ºï¼Œä¹¦å†™æ ·å¼æ—¶ï¼Œåªéœ€è¦æ‰“ä¸ªé¦–å­—æ¯ï¼Œå°±å¯ä»¥è”æƒ³å‡ºæ‰€æœ‰çš„åŸå­æ ·å¼ï¼Œå›è½¦å³å¯å¡«å……å±æ€§ï¼Œè¿™ç§å¼€å‘ä½“éªŒæ˜¯ç›¸å½“çˆ½çš„ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://aiyou.life/post-images/1619614139846.png" alt="" loading="lazy"></figure>
<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒFower é€šè¿‡é™„åŠ å„ç§å±æ€§åç¼€ï¼Œæ”¯æŒäº†ä¼ªç±»ï¼Œåª’ä½“æŸ¥è¯¢ï¼Œä¸»é¢˜åˆ‡æ¢ï¼Œæš—é»‘æ¨¡å¼ç­‰åŠŸèƒ½ï¼›æä¾›äº†ä¸€äº›å¸ƒå±€å±æ€§ï¼Œå¯ä»¥å¿«é€Ÿè®©å¤šå­å…ƒç´ å‚ç›´ã€æ°´å¹³å±…ä¸­ï¼›ä¹Ÿæœ‰ä¸€äº›åŠŸèƒ½å±æ€§ï¼Œå¯ä»¥å¿«é€Ÿè£å‰ªæ–‡å­—ï¼Œçœç•¥æ˜¾ç¤ºï¼›å¯ä»¥é€šè¿‡ä¸€ä¸ªå±æ€§ï¼Œæ„å»ºå‡ºä¸€ä¸ªæ–¹å½¢æˆ–è€…åœ†ï¼›è¿˜æœ‰åŠŸèƒ½å¼ºåŠ²çš„ css å±æ€§ï¼Œè®©ä½ ä½¿ç”¨å„ç§å­å…ƒç´ é€‰æ‹©å™¨ã€‚ã€‚ã€‚é™¤äº†å†…ç½®çš„è¿™äº›å±æ€§ï¼ŒFower ä¹Ÿæä¾›äº†ç›¸å…³ APIï¼Œå¯ä»¥è®©ä½ å¯ä»¥å®šåˆ¶åŒ–ä½ è‡ªå·±çš„å±æ€§å®ç°ã€‚</p>
<p>æˆ‘ä»¬é™¤äº†å¯¹  React, Taro  React,  React Native å°è£…äº†ç»„ä»¶åŒ…å¤–ï¼Œè¿˜é’ˆå¯¹ Vue, Svelte ç­‰æ¡†æ¶è¿›è¡Œäº†éƒ¨åˆ†å…¼å®¹å’Œé€‚é…ï¼ŒFower æä¾›äº† VSCode æ’ä»¶ï¼Œè§£å†³äº†åœ¨  React Like ä¹‹å¤–çš„æ¡†æ¶çš„æ™ºèƒ½æç¤ºã€‚</p>
<p>ä½¿ç”¨ Fowerï¼ŒåŸºæœ¬ä¸Š<strong>å¯ä»¥è®©ä½ ä¸ç”¨å†å†™çƒ¦äººçš„ CSS æ–‡ä»¶</strong></p>
<h2 id="å¯¹æ¯”">å¯¹æ¯”</h2>
<p>ç›¸æ¯”äº Tailwind, Fower çš„ä¼˜åŠ¿æ˜¯æ˜æ˜¾çš„ã€‚</p>
<blockquote>
<ul>
<li>VSCode æ’ä»¶ã€‚Tailwind çš„ä½¿ç”¨ç¦»ä¸å¼€ VSCode æ’ä»¶ã€‚Fower åœ¨  React Like æ¡†æ¶ä¸­ï¼Œåˆ©ç”¨ VSCode æ™ºèƒ½æç¤ºå°±å¯ä»¥è”æƒ³å‡ºå„ç§å±æ€§ï¼Œåœ¨å…¶ä»–æ¡†æ¶ä¸­ï¼Œæ‰éœ€è¦å®‰è£… VSCode æ’ä»¶</li>
<li>å¼€ç®±å³ç”¨ã€‚Fower åªéœ€è¦å®‰è£…å¯¹åº”çš„æ¡†æ¶åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è¿›è¡Œç¹æ‚çš„é…ç½®ã€‚</li>
<li>ä½“ç§¯ã€‚å¯¹äºç±»ä¼¼ <code>p1</code>, <code>p2</code> åˆ° <code>p100</code> è¿™ç§å±æ€§ï¼ŒTailwind ä¸­æšä¸¾äº†æ¯ä¸€ä¸ªå±æ€§çš„æ ·å¼ï¼Œå¯¼è‡´ä½“ç§¯å¼‚å¸¸çš„åºå¤§ã€‚Fower åœ¨  React Like ä¸­å±äºè¿è¡Œæ—¶åº“ï¼Œå¯¹å±æ€§å…·æœ‰ç¼–ç¨‹æ€§ï¼Œå¯ä»¥åŠ¨æ€ç”Ÿæˆæ ·å¼ï¼Œæ‰€ä»¥ä½“ç§¯éå¸¸å°ã€‚åœ¨é  React Like æ¡†æ¶ä¸­ï¼ŒFower é€šè¿‡æ”¶é›†æ¨¡æ¿çš„åŸå­å±æ€§æ ·å¼ä¹Ÿæ˜¯åŠ¨æ€ç”Ÿæˆæ ·å¼ã€‚</li>
<li>å¤šç«¯ä½¿ç”¨ã€‚Fower é’ˆå¯¹å¸‚é¢ä¸Šä¸»æµçš„æ¡†æ¶è¿›è¡Œäº†é’ˆå¯¹æ€§é€‚é…ï¼Œä½ å¯ä»¥åœ¨  React, Preact, Vue, Svelte,  React Native, Taro  React å°ç¨‹åº, Remax å°ç¨‹åºç­‰å¹³å°ä½¿ç”¨ Fowerã€‚Tailwind ä¸æ”¯æŒåœ¨  React Native ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ Taro, Remax ç­‰å°ç¨‹åºç¯å¢ƒä¸­æ²¡æœ‰æ”¯æŒã€‚</li>
</ul>
</blockquote>
<p>ç”±äº Fower æ˜¯è¿è¡Œæ—¶ UI åº“ï¼Œæ‰€ä»¥ç›¸å¯¹äº Tailwind æœ‰ä¸€å®šçš„è¿è¡Œæ—¶æŸè€—ã€‚ä½†å¯¹äºè®¾å¤‡ç®—åŠ›è¶Šæ¥è¶Šå¼ºå¤§çš„ä»Šå¤©ï¼Œè¿™ç‚¹æŸè€—å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä½† Fower è¿˜æ˜¯å°½å¯èƒ½çš„ä½¿ç”¨äº†å„ç§æ‰‹æ®µæé«˜è¿è¡Œæ•ˆç‡ï¼ŒFower å†…éƒ¨å¯¹æ‰€æœ‰éå†è¿‡çš„å±æ€§è¿›è¡Œç¼“å­˜ï¼Œæå¤§æé«˜è¿è¡Œé€Ÿåº¦ã€‚</p>
<h2 id="é¡¹ç›®">é¡¹ç›®</h2>
<p><a href="https://fower.vercel.app/">å®˜æ–¹æ–‡æ¡£ï¼ˆhttps://fower.vercel.app/ï¼‰</a></p>
<p><a href="https://github.com/forsigner/fower">é¡¹ç›®åœ°å€ï¼ˆhttps://github.com/forsigner/fowerï¼‰</a></p>
<h2 id="åŠŸèƒ½ä¸€è§ˆ">åŠŸèƒ½ä¸€è§ˆ</h2>
<p>ä¸‹é¢æ¼”ç¤ºäº†ä½¿ç”¨ Fower/react æ¡†æ¶åŒ…çš„ Box ç»„ä»¶ç¼–å†™çš„ demoã€‚å®é™…ä¸Šï¼Œç›´æ¥ä½¿ç”¨ Box æ ‡ç­¾ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼Œä½†éœ€è¦é¢å¤–çš„é…ç½®ã€‚</p>
<h3 id="åŸºæœ¬ä½¿ç”¨"><a href="https://fower.vercel.app/zh-cn/docs/basic">åŸºæœ¬ä½¿ç”¨</a></h3>
<p>Fower æä¾›äº†å¤§é‡çš„åŸå­æ ·å¼å±æ€§ï¼Œå¯ä»¥æé€Ÿæ„å»º UIã€‚</p>
<pre><code class="language-html">&lt;Box text2XL fontBold green500 className=&quot;user&quot; style={{ fontWeight: 'bold' }}&gt;
  Hi, Fower
&lt;/Box&gt;
</code></pre>
<h3 id="å¯ç¼–ç¨‹åŠ¨æ€æ ·å¼">å¯ç¼–ç¨‹/åŠ¨æ€æ ·å¼</h3>
<p>ä½ å¯ä»¥é€šè¿‡ä¸ºå±æ€§èµ‹å€¼çš„æ–¹å¼ï¼Œæ¥ç¼–å†™åŠ¨æ€æ ·å¼</p>
<pre><code class="language-html">&lt;Box
  text-14
  display=&quot;block&quot;
  color=&quot;red&quot;
  blue={false}
  p-10
  m-10rem
  bg=&quot;red&quot;
  bgRed={true}
  bgBlue={false}
&gt;
  Hi, Fower
&lt;/Box&gt;
</code></pre>
<h3 id="css-å±æ€§"><a href="https://fower.vercel.app/zh-cn/docs/css-prop">CSS å±æ€§</a></h3>
<p>Fower ä¸­æä¾›äº†å¼ºå¤§çš„ CSS å±æ€§ï¼Œå®ç°äº†å¤§éƒ¨åˆ† CSS çš„åŠŸèƒ½ã€‚</p>
<pre><code class="language-html">&lt;Box
  text4XL
  css={{
    backgroundColor: '#edf2f7',
    ':hover': {
      backgroundColor: '#feebc8',
    },
    '.title': {
      fontWeight: 'bold',
    },
    span: {
      color: 'deeppink',
    },
  }}
&gt;
  &lt;Box className=&quot;title&quot;&gt;Nested demo&lt;/Box&gt;
  &lt;span&gt;Hi, Fower!&lt;/span&gt;
&lt;/Box&gt;
</code></pre>
<h3 id="ä¼ªç±»å“åº”å¼"><a href="https://fower.vercel.app/zh-cn/docs/pseudo">ä¼ªç±»/å“åº”å¼</a></h3>
<p>Fower é€šè¿‡åç¼€çš„æ–¹å¼ï¼Œæ”¯æŒäº†ä¼ªç±»ï¼Œå“åº”å¼ç­‰åŠŸèƒ½</p>
<pre><code class="language-html">&lt;Box text2XL text3XL--hover red--first-child fontBold green500&gt;
  &lt;Box&gt;Hi, Fower&lt;/Box&gt;
&lt;/Box&gt;
&lt;Box textSM textLG--sm text4XL--md text6XL--lg&gt;
  Lorem ipsum dolor sit amet
&lt;/Box&gt;
</code></pre>
<h3 id="é¢œè‰²åŠ©æ‰‹"><a href="https://fower.vercel.app/zh-cn/docs/color-helper">é¢œè‰²åŠ©æ‰‹</a></h3>
<p>é¢œè‰²åŠ©æ‰‹å¯ä»¥å¿«é€Ÿå¢åŠ æˆ–å‡å°‘é¢œè‰²çš„äº®åº¦ï¼Œé€æ˜åº¦ç­‰ç­‰</p>
<pre><code class="language-html">&lt;Box toEvenly toCenterY&gt;
  &lt;Box red300&gt;normal&lt;/Box&gt;
  &lt;Box red300--D40&gt;darken&lt;/Box&gt;
&lt;/Box&gt;
</code></pre>
<h3 id="ä¸»é¢˜"><a href="https://fower.vercel.app/zh-cn/docs/theme">ä¸»é¢˜</a></h3>
<p>Fower å†…ç½®äº†ä¸»é¢˜ã€‚ä½ å¯ä»¥é€šè¿‡ setTheme API æ›´æ”¹å’Œæ·»åŠ é…ç½®ã€‚</p>
<pre><code class="language-html">import { setTheme } from '@fower/core'

setTheme({
  spacings: {
    10086: 110,
  },
  color: {
    gray10086: '#FFFFFF'
  }
})

&lt;Box textSM bgGray10086 bgGray10086--dark p10086&gt;
  Lorem ipsum dolor sit amet
&lt;/Box&gt;
</code></pre>
<h3 id="ä¸ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ä¸€èµ·ä½¿ç”¨">ä¸ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ä¸€èµ·ä½¿ç”¨</h3>
<p>ä¸Šæ–‡ä¸­æåˆ° Fower åŸç†æ˜¯é€šè¿‡ç»™ç°æœ‰ç»„ä»¶åŒ…è£…äº†ä¸€å±‚ï¼Œé€šè¿‡æ”¶é›†æ•´åˆåŸå­æ ·å¼å±æ€§ï¼Œæœ€ç»ˆå°† className æˆ– style å±æ€§æ³¨å…¥åˆ°å†…å±‚ç»„ä»¶ã€‚å› è€Œä¸ç¬¬ä¸‰æ–¹ç»„ä»¶ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦åˆ©ç”¨ styled API åŒ…è£…å³å¯ã€‚</p>
<pre><code class="language-html">import { Button as AntdButton } from 'antd'
import { styled } from '@fower/styled'

const Button = styled(AntdButton)

&lt;Button red300 red400={false} text={7 + 7}&gt;
  normal
&lt;/Button&gt;
</code></pre>
<h3 id="å±æ€§å†²çª">å±æ€§å†²çª</h3>
<p>Fower ç»„ä»¶æä¾›çš„å±æ€§ä¸ä¸‰æ–¹å±æ€§å†²çªæ—¶ï¼ŒFower ä¹Ÿæä¾›äº†è§£å†³æ–¹æ¡ˆã€‚</p>
<pre><code class="language-html">import { Button as AntdButton } from 'antd'
import { styled } from '@fower/styled'

const Button = styled(AntdButton)

&lt;Button excludedProps={['block']} block&gt;
  normal
&lt;/Button&gt;
</code></pre>
<h3 id="ç±»å">ç±»å</h3>
<p>Fower åŒæ ·æ”¯æŒäº† tailwind çš„ç”¨æ³•</p>
<pre><code class="language-html">&lt;Box className=&quot;toCenter square-400 bgRed400&quot;&gt;
  &lt;Box className=&quot;white&quot;&gt;Lorem ipsum&lt;/Box&gt;
&lt;/Box&gt;
</code></pre>
<h3 id="åŠ¨ç”»">åŠ¨ç”»</h3>
<p>Fower æä¾›äº† keyframes APIï¼Œå¯ä»¥å¿«é€Ÿåˆ›å»ºåŠ¨ç”»ã€‚</p>
<pre><code class="language-html">import { Box } from '@fower/react';
import { keyframes } from '@fower/core';

const bounce = keyframes({
  'from, 20%, 53%, 80%, to': {
    transform: 'translate3d(0,0,0)',
    padding: 10,
  },
    '40%, 43%': {
    transform: 'translate3d(0, -30px, 0)',
  },
})

&lt;Box
  text-30
  css={{
    animation: `${bounce} 1s ease infinite`,
  }}
&gt;
  40 Lorem ipsum dolor sit amet
&lt;/Box&gt;
</code></pre>
<h3 id="æ‰©å±•">æ‰©å±•</h3>
<p>Fower æä¾›äº† <a href="https://fower.vercel.app/zh-cn/docs/add-atom">addAtom</a> API å¯ä»¥å¿«é€Ÿæ‰©å±•åŸå­æ ·å¼å±æ€§ã€‚ä½†è¿™åªèƒ½åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
<p>Fower æä¾›äº†çµæ´»çš„æ’ä»¶æœºåˆ¶ï¼Œä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„æ ·å¼ Utilï¼Œä¾›ä»–äººä½¿ç”¨ã€‚</p>
<pre><code class="language-html">import { setConfig } from '@fower/core';
import ellipsis from 'fower-plugin-ellipsis';

setConfig({
  plugin: [ellipsis],
});
</code></pre>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ç»è¿‡å›¢é˜ŸåŠå¹´çš„ä¸æ‡ˆåŠªåŠ›ï¼ŒFower æ—¥æ¸å®Œå–„ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨é¡¹ç›®ä¸­ç§¯æä½¿ç”¨ã€‚ç›®å‰åœ¨æˆ‘ä»¬å°ç¨‹åºé¡¹ç›®ä¸­åšåˆ°äº†ä»…æœ‰ä¸€ä¸ª app.scss æ ·å¼æ–‡ä»¶çš„åœ°æ­¥ã€‚æˆ‘ä»¬å°è£…äº†å¾ˆå¤šæ¡†æ¶åŒ…ï¼Œä¹Ÿåœ¨ç§¯ææµ‹è¯•ä¸ä½¿ç”¨ï¼Œä½†éš¾å…ä¼šé‡åˆ°å¾ˆå¤š Bugï¼Œå¸Œæœ›å¤§å®¶ç§¯æè¯•ç”¨ä½¿ç”¨ Fowerï¼Œä¹Ÿå¸Œæœ› Fower é¡¹ç›®èƒ½å¤ŸçœŸæ­£çš„å¸®åŠ©ä½ è§£å†³æ ·å¼å¼€å‘çš„ç—›ç‚¹ã€‚è°¢è°¢å¤§å®¶ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://aiyou.life/post-images/1619618374404.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Taroå°ç¨‹åºå¼€å‘æå‡æ•ˆç‡çš„å‡ ç‚¹åˆ†äº«-è·¯ç”±ç¯‡]]></title>
        <id>https://aiyou.life/post/FkN_iGcYQ/</id>
        <link href="https://aiyou.life/post/FkN_iGcYQ/">
        </link>
        <updated>2020-09-22T13:00:12.000Z</updated>
        <summary type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå°ç¨‹åºå¼€å‘ä¸€ä¸ªé¡µé¢ï¼Œé¦–å…ˆè¦åœ¨ pages æ–‡ä»¶å¤¹åœ¨æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ appConfig ä¸­é…ç½®é¡µé¢å®Œæ•´çš„è·¯å¾„åœ°å€ï¼Œåœ¨è¿›è¡Œè·¯ç”±è·³è½¬æ—¶ï¼Œè¿˜éœ€è¦åœ¨ navigateTo ä¸­å†™ä¸‹å®Œæ•´çš„é¡µé¢è·¯å¾„ã€‚å½“é¡µé¢æ•°é‡å°‘ï¼Œä»£ç é‡å°æ—¶ï¼Œä¼¼ä¹å¯ä»¥æ¥å—ï¼Œä½†å½“ä»£ç é‡å¤§ï¼Œé¡¹ç›®å­˜åœ¨å¥½å‡ ä¸ªåˆ†åŒ…æ—¶ï¼Œé¡µé¢è·³è½¬è·¯å¾„ä¼šå˜å¾—éå¸¸é•¿ï¼Œä¹¦å†™é¡µé¢è·¯å¾„ä¼šå˜å¾—è¶Šæ¥è¶Šå›°éš¾ï¼Œä»£ç ä¹Ÿä¸å¤Ÿç¾è§‚å’Œç›´è§‚ã€‚è§£æè·¯ç”±å‚æ•°æ—¶ï¼Œè¿˜éœ€è¦ç»è¿‡å‡ æ­¥è½¬æ¢æ‰èƒ½å¾—åˆ°ã€‚ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå°ç¨‹åºå¼€å‘ä¸€ä¸ªé¡µé¢ï¼Œé¦–å…ˆè¦åœ¨ pages æ–‡ä»¶å¤¹åœ¨æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ appConfig ä¸­é…ç½®é¡µé¢å®Œæ•´çš„è·¯å¾„åœ°å€ï¼Œåœ¨è¿›è¡Œè·¯ç”±è·³è½¬æ—¶ï¼Œè¿˜éœ€è¦åœ¨ navigateTo ä¸­å†™ä¸‹å®Œæ•´çš„é¡µé¢è·¯å¾„ã€‚å½“é¡µé¢æ•°é‡å°‘ï¼Œä»£ç é‡å°æ—¶ï¼Œä¼¼ä¹å¯ä»¥æ¥å—ï¼Œä½†å½“ä»£ç é‡å¤§ï¼Œé¡¹ç›®å­˜åœ¨å¥½å‡ ä¸ªåˆ†åŒ…æ—¶ï¼Œé¡µé¢è·³è½¬è·¯å¾„ä¼šå˜å¾—éå¸¸é•¿ï¼Œä¹¦å†™é¡µé¢è·¯å¾„ä¼šå˜å¾—è¶Šæ¥è¶Šå›°éš¾ï¼Œä»£ç ä¹Ÿä¸å¤Ÿç¾è§‚å’Œç›´è§‚ã€‚è§£æè·¯ç”±å‚æ•°æ—¶ï¼Œè¿˜éœ€è¦ç»è¿‡å‡ æ­¥è½¬æ¢æ‰èƒ½å¾—åˆ°ã€‚ã€‚</p>
<!-- more -->
<h2 id="ç¯å¢ƒ">ç¯å¢ƒ</h2>
<p>åŸºç¡€ç¯å¢ƒ: taro 3.0.5 / react 16.10.0 / typescript 4.1.0</p>
<p>æŠ€æœ¯æ ˆ: React Hooks</p>
<h2 id="è·¯ç”±éƒ¨åˆ†">è·¯ç”±éƒ¨åˆ†</h2>
<p>Taro å°ç¨‹åºè·¯ç”±æ–¹æ³•è°ƒç”¨ç¤ºä¾‹</p>
<p>è·¯ç”±è·³è½¬</p>
<pre><code class="language-typescript">navigateTo({
  url: `/package-appointment/pages/manage-appointments/index?roomId=${roomId}&amp;appointmentId=${appointmentId}&amp;scriptId=${scriptId}`
})
</code></pre>
<p>å‚æ•°è§£æ</p>
<pre><code class="language-typescript">const { params } = useRouter()
const { roomId, appointmentId, scriptId } = params
const oRoomId = Number.parseInt(roomId)
const oAppointmentId = Number.parseInt(appointmentId)
const oScriptId = Number.parseInt(scriptId)
</code></pre>
<h2 id="ä¼˜åŒ–æ–¹æ¡ˆ">ä¼˜åŒ–æ–¹æ¡ˆ</h2>
<h3 id="part-1-è·¯ç”±è¡¨æ–‡ä»¶">PART 1 è·¯ç”±è¡¨æ–‡ä»¶</h3>
<p>æ–°å»ºä¸€ä¸ªè·¯ç”±è¡¨æ–‡ä»¶ routeTable.tsï¼Œä¸ºè·¯å¾„å‘½åã€‚</p>
<pre><code class="language-typescript">export enum URLs {
  INDEX = '/pages/index/index',
  MANAGE_APPOINTMENTS = '/package-appointment/pages/manage-appointments/index',
  INTENT_DETAIL = '/package-intent/pages/intent-detail/index'
}
</code></pre>
<p>è°ƒç”¨æ—¶ï¼Œåªéœ€è¦å¼•å…¥è·¯ç”±è¡¨æ–‡ä»¶</p>
<pre><code class="language-typescript">import { URLs } from '@/common/routeTable'
...
navigateTo({
  url: `${URLs.MANAGE_APPOINTMENTS}?roomId=${roomId}&amp;appointmentId=${appointmentId}&amp;scriptId=${scriptId}`
})
...
</code></pre>
<p>å¼•å…¥äº†è·¯ç”±è¡¨æ–‡ä»¶çš„åŒæ—¶ï¼Œå¼•å…¥äº†æ–°çš„é—®é¢˜ï¼Œæ–°å»ºä¸€ä¸ªé¡µé¢è¦ç»´æŠ¤ä¸¤ä¸ªè·¯ç”±åœ°å€æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ app.config ï¼Œå¦ä¸€ä¸ªå°±æ˜¯è·¯ç”±è¡¨æ–‡ä»¶ routeTableã€‚å¢åŠ äº†ç»´æŠ¤æˆæœ¬ï¼ŒåŒæ—¶ä¸¤ä¸ªæ–‡ä»¶ï¼Œåªè¦æœ‰ä¸€ç‚¹é”™è¯¯ï¼Œé¡µé¢å°±ä¸èƒ½æ­£ç¡®çš„è¢«è®¿é—®ã€‚æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<h3 id="part-2-è„šæœ¬æ›´æ–°è·¯ç”±è¡¨ä¸ç›¸å…³é…ç½®">PART 2 è„šæœ¬æ›´æ–°è·¯ç”±è¡¨ä¸ç›¸å…³é…ç½®</h3>
<p>æ— è®º app.config è·¯å¾„é…ç½®è¿˜æ˜¯è·¯ç”±è¡¨é…ç½®ï¼Œé¡µé¢ä¸è·¯å¾„æ˜¯å¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬å»å¤„ç†é—®é¢˜ã€‚é¦–å…ˆæ‰«ææºç æ–‡ä»¶å¤¹ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ‰¾åˆ° pages å’Œ package- ä¸‹çš„æ‰€æœ‰é¡µé¢ã€‚æ‰¾åˆ°æ–‡ä»¶åï¼Œè·å–æ–‡ä»¶å¤¹åç§°ä½œä¸ºè·¯ç”±è¡¨çš„ shortName, æ„é€ æ•°æ®åå³å¯æ›¿æ¢å’Œæ–°å»ºåˆ° app.config å’Œ routeTable ä¸­ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é¡ºå¸¦æŠŠ project.config.json ä¸­ miniprogram å­—æ®µæ›´æ–°ï¼Œç”¨äºå¼€å‘é¡µé¢è¿›è¡Œå¿«æ·è°ƒè¯•ã€‚</p>
<p>è„šæœ¬å®Œæˆä¹‹åï¼Œæ¯æ¬¡å¼€å‘é¡µé¢æ—¶ï¼Œåªéœ€è¦åœ¨ pages ç›®å½•ä¸‹æˆ–è€…åˆ†åŒ… pages ç›®å½•ä¸‹æ–°å»ºç›®å½•ï¼Œè¿è¡Œè„šæœ¬å‘½ä»¤å³å¯è‡ªåŠ¨æ›´æ–° app.config ã€ project.config å’Œ routeTableã€‚</p>
<p>æ³¨æ„:</p>
<blockquote>
<ul>
<li>æŸ¥æ‰¾é¡µé¢æ–‡ä»¶ï¼Œé»˜è®¤ pages ä¸‹çš„ä¸€çº§ç›®å½•ä¸ºæ‰€æœ‰é¡µé¢æ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦å¼€å‘è€…æ‹¥æœ‰è‰¯å¥½çš„å¼€å‘ä¹ æƒ¯ï¼Œå†™çš„é¡µé¢æ²¡æœ‰è¿›è¡ŒåµŒå¥—ã€‚</li>
<li>è„šæœ¬ä»£ç å¾ˆç®€å•ï¼Œå°±ä¸æ–°å»ºä»“åº“äº†ï¼Œå®Œæ•´ä»£ç å·²ç»è´´åˆ°äº†æœ€ä¸‹é¢</li>
</ul>
</blockquote>
<h3 id="part-3-åœ°å€å‚æ•°æ”¹é€ ">PART 3 åœ°å€å‚æ•°æ”¹é€ </h3>
<p>è§‚å¯Ÿ PART 1 éƒ¨åˆ†çš„ä»£ç ï¼Œå…¶å®å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶é€šè¿‡è·¯ç”±è¡¨å½¢å¼ç¼©çŸ­äº†ä¸€éƒ¨åˆ†åœ°å€çš„é•¿åº¦ï¼Œä½†æ˜¯å‚æ•°éƒ¨åˆ†è¿˜å¯ä»¥åšäº›æ–‡ç« ã€‚</p>
<pre><code class="language-typescript">// queryParams å°è£…
const covertObjToSearchParams = (searchObj: commonObjectProps = {}) =&gt; {
  let searchParams = ''
  for (let i in searchObj) {
    searchParams = searchParams + `${i}=${searchObj[i]}&amp;`
  }
  return searchParams.slice(0, -1)
}

const queryParams = covertObjToSearchParams({ roomId, appointmentId, scriptId })

navigateTo({
  url: `${URLs.MANAGE_APPOINTMENTS}?${queryParams}`
})

</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ä¼ é€’å‚æ•°ï¼Œç®€æ´ç›´è§‚ï¼Œæ–¹ä¾¿ä¸å°‘ã€‚</p>
<h3 id="part-4-è·¯ç”±è·³è½¬æ–¹æ³•æ”¹é€ ">PART 4 è·¯ç”±è·³è½¬æ–¹æ³•æ”¹é€ </h3>
<p>å°ç¨‹åºä¸­çš„æ–¹æ³•å¤§éƒ½éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå¯¹è±¡ä¼ é€’çš„å‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºå¤§å¤šæ•°æ–¹æ³•éƒ½æœ‰å¾ˆå¤šå‚æ•°ï¼Œé€šè¿‡å¯¹è±¡ä¼ å‚åˆ™æ˜¾å¾—ä»£ç æ•´æ´å‹å¥½ã€‚è§‚å¯Ÿæˆ‘ä»¬çš„ä»£ç ï¼Œç”¨åˆ°çš„æœ€å¤šçš„å°±æ˜¯ä¸€ä¸ª url å‚æ•°, é‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥å°†åœ°å€æ”¾åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä½ä¸Šã€‚</p>
<p>navigateTo æ–¹æ³•æ”¹é€ </p>
<pre><code class="language-typescript">import { navigateTo as originNavigateTo } from '@tarojs/taro'

export function navigateTo(url: string, params?: commonObjectProps, opt?: commonObjectProps) {
  if (!params) return originNavigateTo({ url, ...opt })

  const _url = `${url}?${covertObjToSearchParams(params)}`
  originNavigateTo({ url: _url, ...opt })
}
</code></pre>
<p>navigateTo è°ƒç”¨</p>
<pre><code class="language-typescript">navigateTo(URLs.MANAGE_APPOINTMENTS, { roomId, appointmentId, scriptId })`
</code></pre>
<p>ç›¸æ¯”å‰æ–‡ä¸­çš„æœ€å¼€å§‹æ—¶çš„è·¯ç”±è°ƒç”¨ï¼Œè¿™é‡Œæ›´åŠ ç®€æ´æ˜äº†</p>
<h3 id="part-5-è·¯ç”±å‚æ•°è§£ææ–¹æ³•æ”¹é€ ">PART 5 è·¯ç”±å‚æ•°è§£ææ–¹æ³•æ”¹é€ </h3>
<p>Taro ä¸­æä¾›äº† <strong>useRouter</strong> hookså»è§£æè·¯ç”±å‚æ•°ï¼Œä½†è¯¥ Hooks è§£æå‡ºçš„å‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚</p>
<p>å½“ä½¿ç”¨å‚æ•°æ—¶ï¼Œéœ€è¦å…ˆå¯¼å‡º <strong>params</strong> å¯¹è±¡ï¼Œç„¶åå†æ‹¿åˆ°å‚æ•°å€¼ï¼Œå¯¹äºä¸€äº›æ•°å­—ã€å¸ƒå°”ç±»å‹å€¼è¿˜åªèƒ½å†é€šè¿‡è½¬æ¢è·å¾—åŸå§‹å€¼ã€‚æµç¨‹ç¹çä¸”å¤æ‚ã€‚æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜?</p>
<p>é¦–å…ˆå¯¹ useRouter è¿›è¡Œåˆæ­¥å°è£…</p>
<pre><code class="language-typescript">import { useRouter as useOriginRouter } from '@tarojs/taro'

export function useRouter&lt;T&gt;(): T {
  const { params } = useOriginRouter()
  return params
}
</code></pre>
<p>å°è£…å®Œçš„ useRouter åªç®€åŒ–äº†å¯¼å‡º params çš„è¿‡ç¨‹ï¼Œè€Œå‚æ•°ç±»å‹è½¬æ¢è¿˜æ˜¯åªèƒ½æ ¹æ®å…·ä½“çš„å‚æ•°è¿›è¡Œå…·ä½“è½¬æ¢ã€‚é‚£è¿™æ ·çš„å°è£…å…¶å®è¿˜æ˜¯æœ‰ç‚¹é¸¡è‚‹ã€‚</p>
<p>é€šè¿‡ queryParams ä¼ é€’çš„å‚æ•°åªèƒ½æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„ï¼Œæ‰€ä»¥è§£æå‚æ•°ä¹Ÿåªèƒ½è§£æå‡ºå­—ç¬¦ä¸²ã€‚å› è€Œå¯ä»¥é€šè¿‡ <strong>JSON.stringify</strong> å°†å‚æ•°å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè§£ææ—¶å†åˆ©ç”¨ <strong>JSON.parse</strong> è§£æå‡ºä¿æœ‰åŸå§‹æ•°æ®ç±»å‹çš„å‚æ•°ã€‚</p>
<pre><code class="language-typescript">import { useRouter as useOriginRouter, navigateTo as originNavigateTo } from '@tarojs/taro'

// è·¯ç”±è·³è½¬
export function navigateTo(url: string, params?: object) {
  if (!params) return originNavigateTo({ url })

  const _url = `${url}?navParams=${JSON.stringify(params)}`
  originNavigateTo({ url: _url })
}

// è·¯ç”±è§£æ
export function useRouter&lt;T&gt;(): T {
  const { params } = useOriginRouter()

  try {
    const targetParams = params['navParams']
    if (targetParams) return JSON.parse(targetParams)
  } catch (e) {
    console.warn('å‚æ•°è§£æå¤±è´¥', e)
  }

  return {} as T
}
</code></pre>
<p>ä½¿ç”¨è¿™ç§å°è£…æ–¹å¼ï¼Œè™½ç„¶ URL ä¸ç›´è§‚ä¸”ä¸åˆ©äº SEOï¼Œä½†åœ¨å°ç¨‹åºç¯å¢ƒä¸­ï¼Œç”¨æˆ·æ ¹æœ¬ä¸ä¼šçœ‹åˆ° URLï¼Œä¸”åœ¨å½“å‰å°ç¨‹åºç¯å¢ƒä¸­ï¼ŒSEOä¼¼ä¹æ ¹æœ¬æ²¡ä»€ä¹ˆç”¨ã€‚</p>
<p>ä½¿ç”¨æˆ‘ä»¬å°è£…å¥½çš„ä»£ç ï¼Œæ–‡ç« å¼€å¤´ç»™å‡ºçš„ç¤ºä¾‹å¯ç®€åŒ–ä¸ºå¦‚ä¸‹ä»£ç :</p>
<pre><code class="language-typescript">import { navigateTo, useRouter } from '@/app'

navigateTo(URLs.MANAGE_APPOINTMENTS, { roomId, appointmentId, scriptId })
...

const { roomId, appointmentId, scriptId } = useRouter()
...

</code></pre>
<h2 id="å®Œæ•´è·¯ç”±è„šæœ¬ç”Ÿæˆå’Œä»£ç ">å®Œæ•´è·¯ç”±è„šæœ¬ç”Ÿæˆå’Œä»£ç </h2>
<p>è„šæœ¬ä»£ç å¾ˆç®€å•ï¼Œå°±ä¸æ–°å»ºä»“åº“å­˜äº†ã€‚</p>
<h3 id="ä¸»è„šæœ¬æ–‡ä»¶">ä¸»è„šæœ¬æ–‡ä»¶</h3>
<pre><code class="language-javascript">const path = require('path')
const fs = require('fs')
const { isDir, readDir, readFile, writeFile } = require('./util')
const PROJECT_CONFIG = require('../project.config.json')

const BASE_PATH = path.resolve(__dirname, '..')
const APP_CONFIG_PATH = path.resolve(BASE_PATH, 'src/app.config.ts')
const URL_TABLE_PATH = path.resolve(BASE_PATH, 'src/common/url.constant.ts')
const PACKAGE_CONFIG_PATH = path.resolve(BASE_PATH, 'project.config.json')

function handleMainPageConfig(dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'pages/${dir}/index'\n`)
  fileStr = fileStr.replace(/pages[\S\s]*subPackages/, `pages: [${paths}], subPackages`)
  return fileStr
}

function handleSubPageConfig(rootPath, dirsName, subPackage) {
  const [, name] = rootPath.split('-')
  subPackage.push({
    root: rootPath,
    name,
    pages: dirsName.map((name) =&gt; `pages/${name}/index`),
  })
  return subPackage
}

function handleMainRouteTable(dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'/pages/${dir}/index'\n`)
  for (let i = 0; i &lt; dirsName.length; i++) {
    const current = dirsName[i]
    const name = current
      .split('-')
      .map((v) =&gt; v.toUpperCase())
      .join('_')
    fileStr = fileStr + `${name}=${paths[i]},`
  }
  return fileStr
}

function handleSubRouteTable(rootPath, dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'/${rootPath}/pages/${dir}/index'\n`)
  for (let i = 0; i &lt; dirsName.length; i++) {
    const current = dirsName[i]
    const name = current
      .split('-')
      .map((v) =&gt; v.toUpperCase())
      .join('_')
    fileStr = fileStr + `${name}=${paths[i]},`
  }
  return fileStr
}

function handleMainProjectConfig(dirsName, routes) {
  const paths = dirsName.map((dir) =&gt; `pages/${dir}/index`)
  return routes.concat(paths.map((_path, idx) =&gt; {
    return {
      id: idx + 1,
      name: dirsName[idx],
      pathName: _path,
      query: '',
    }
  }))
}

function handleSubProjectConfig(rootPath, dirsName, routes) {
  const paths = dirsName.map((dir) =&gt; `${rootPath}/pages/${dir}/index`)
  return routes.concat(
    paths.map((_path, idx) =&gt; {
      return {
        id: idx + 1,
        name: dirsName[idx],
        pathName: _path,
        query: '',
      }
    }),
  )
}

async function updateAppConfig(fileStr, subPackage) {
  fileStr = fileStr.replace(/(subPackages[\S\s]*)window/g, `subPackages: ${JSON.stringify(subPackage)}, window`)
  await writeFile(APP_CONFIG_PATH, fileStr)
}

async function updateRouteTable(fileStr) {
  let routeTable = `
    // è‡ªåŠ¨ç”Ÿæˆ, pages æ–‡ä»¶å¤¹æ–°å»ºç›®å½•ï¼Œè¿è¡Œ npm run g
    export enum URLs {
      ${fileStr}
    }
  `
  await writeFile(URL_TABLE_PATH, routeTable)
}

async function updateProjectConfig(entrance) {
  PROJECT_CONFIG.condition.miniprogram.list = entrance
  await writeFile(PACKAGE_CONFIG_PATH, JSON.stringify(PROJECT_CONFIG, null, 2))
}

function sortDirs(dirsName) {
  const indexIdx = dirsName.findIndex((dirname) =&gt; dirname === 'index')
  if (indexIdx === -1) return dirsName.sort((a, b) =&gt; a.localeCompare(b))
  dirsName.splice(indexIdx, 1)
  dirsName = dirsName.sort((a, b) =&gt; a.localeCompare(b))
  dirsName.unshift('index')
  return dirsName
}

async function main(dirPath) {
  const baseDirsName = await readDir(dirPath)
  const target = baseDirsName.filter((dirName) =&gt; /^pages$|^package-\w+$/.test(dirName))

  // è¯»å–APPé…ç½®æ–‡ä»¶
  let appConfigFileStr = await readFile(APP_CONFIG_PATH)
  // app.config åˆ†åŒ…é…ç½®
  let subPackage = []

  // ç”Ÿæˆè·¯ç”±è¡¨æ–‡ä»¶
  let routeTableFileStr = ''
  
  // project.config é¡¹ç›®å¿«æ·å…¥å£é…ç½®
  let entrance = []
  let mainEntrance = []

  for await (let i of target) {
    if (i === 'pages') {
      const dirsName = sortDirs(await readDir(path.resolve(dirPath, i)))
      appConfigFileStr = handleMainPageConfig(dirsName, appConfigFileStr)
      routeTableFileStr = handleMainRouteTable(dirsName, routeTableFileStr)
      mainEntrance = handleMainProjectConfig(dirsName, [])
    } else {
      const dirsName = sortDirs(await readDir(path.resolve(dirPath, i, 'pages')))
      subPackage = handleSubPageConfig(i, dirsName, subPackage)
      routeTableFileStr = handleSubRouteTable(i, dirsName, routeTableFileStr)
      entrance = handleSubProjectConfig(i, dirsName, entrance)
    }
  }
  updateAppConfig(appConfigFileStr, subPackage)
  updateRouteTable(routeTableFileStr)
  updateProjectConfig(mainEntrance.concat(entrance))
}

// ä¸»å‡½æ•°
main(path.resolve(BASE_PATH, 'src'))

</code></pre>
<h3 id="å·¥å…·è„šæœ¬æ–‡ä»¶">å·¥å…·è„šæœ¬æ–‡ä»¶</h3>
<pre><code class="language-javascript">const path = require('path')
const fs = require('fs')

// å½“å‰è·¯å¾„æ˜¯æ–‡ä»¶å¤¹
function isDir(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.stat(filePath, (err, stats) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(stats.isDirectory())
      }
    })
  })
}

// è¯»å–å½“å‰æ–‡ä»¶å¤¹ç›®å½•
function readDir(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.readdir(filePath, 'utf8', (err, dir) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(dir)
      }
    })
  })
}

// è¯»å–æ–‡ä»¶
function readFile(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.readFile(filePath, (err, dir) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(dir.toString())
      }
    })
  })
}

// å†™æ–‡ä»¶
async function writeFile(filePath, fileStr) {
  return new Promise((resolve, reject) =&gt; {
    fs.writeFile(filePath, fileStr, (err, res) =&gt; {
      if (err) return reject(err)
      resolve(res)
    })
  })
}

// æ–‡ä»¶å¤¹æ‰«æ
async function fileScanner(filePath, fn) {
  const dir = await isDir(filePath)
  if (dir) {
    const dirs = await readDir(filePath)
    for await (const name of dirs) {
      fileScanner(path.resolve(filePath, name), fn)
    }
  } else {
    await fn(filePath)
  }
}

module.exports = {
  isDir,
  readDir,
  readFile,
  writeFile,
  fileScanner,
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ReactNativeæ¸è¿›å¼å›¾ç‰‡åŠ è½½]]></title>
        <id>https://aiyou.life/post/FEu-GtOkz/</id>
        <link href="https://aiyou.life/post/FEu-GtOkz/">
        </link>
        <updated>2020-09-05T16:22:37.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšReactNativeé¡¹ç›®ï¼Œæˆ‘ä»¬çš„é¡µé¢æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œå‘ç°å›¾ç‰‡åŠ è½½æ•ˆæœå¾ˆå¡é¡¿ã€‚äºæ˜¯ç ”ç©¶äº†ä¸€ä¸‹RNä¸‹å›¾ç‰‡æ¸è¿›åŠ è½½ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšReactNativeé¡¹ç›®ï¼Œæˆ‘ä»¬çš„é¡µé¢æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œå‘ç°å›¾ç‰‡åŠ è½½æ•ˆæœå¾ˆå¡é¡¿ã€‚äºæ˜¯ç ”ç©¶äº†ä¸€ä¸‹RNä¸‹å›¾ç‰‡æ¸è¿›åŠ è½½ã€‚</p>
<!-- more -->
<h2 id="åŸç†">åŸç†</h2>
<p>é¦–å…ˆç»™å›¾ç‰‡ä¸€ä¸ªå›ºå®šå®½é«˜çš„å®¹å™¨ï¼Œå®¹å™¨ä¸­æœ‰ä¸¤ä¸ªé€æ˜åº¦ä¸º0çš„ Image å…ƒç´ ï¼Œ å…¶ä¸­ä¸€ä¸ªåŠ è½½ç¼©ç•¥å›¾ï¼Œä¸€ä¸ªä¸ºåŸå›¾ï¼Œç›‘å¬å›¾ç‰‡åŠ è½½ï¼Œè°ƒæ•´é€æ˜åº¦ï¼Œç»™è¿‡æ¸¡åŠ¨ç”»ã€‚</p>
<h2 id="ä¾èµ–">ä¾èµ–</h2>
<pre><code class="language-bash">react-native-fast-image   ç”¨äºç¼“å­˜å›¾ç‰‡
react-spring/native   ç”¨äºå®ç°åŠ¨ç”»æ•ˆæœ
</code></pre>
<h2 id="å¯¹æ¯”å›¾">å¯¹æ¯”å›¾</h2>
<figure data-type="image" tabindex="1"><img src="https://aiyou.life/post-images/1599328089874.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ä¼˜åŒ–å‰</div>
<figure data-type="image" tabindex="2"><img src="https://aiyou.life/post-images/1599328239398.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ä¼˜åŒ–å</div>
<h2 id="æ ¸å¿ƒä»£ç ">æ ¸å¿ƒä»£ç </h2>
<pre><code class="language-typescript">import React, { FC } from 'react'
import { View, StyleSheet, ImageStyle, ViewStyle, animated } from 'react-native'
import FastImage, { FastImageProps } from 'react-native-fast-image'
import { animated } from 'react-spring/native'
import { useSpring } from 'react-spring'

const AnimatedFastImage = animated(FastImage)

interface ImgStyle extends ImageStyle {
  width: number | string
  height: number | string
}

interface Props extends FastImageProps {
  thumbnailSource?: FastImageProps['source']
  style: ImgStyle
  containerStyle?: ViewStyle
}

export const ProgressiveImage: FC&lt;Props&gt; = ({
  thumbnailSource,
  source,
  style,
  containerStyle,
  ...props
}) =&gt; {
  const [thumbOpStyle, setThumbOpStyle] = useSpring(() =&gt; ({ opacity: 0, config: { duration: 500 } }))
  const [imgOpStyle, setImgOpStyle] = useSpring(() =&gt; ({ opacity: 0, config: { duration: 500 } }))

  function handleThumbnailLoad() {
    setThumbOpStyle({ opacity: 1, config: { duration: 500 } })
  }

  function onImageLoad() {
    setImgOpStyle({ opacity: 1, config: { duration: 500 } })
  }

  return (
    &lt;View style={[styles.container, { width: style.width, height: style.height }, containerStyle]}&gt;
      {thumbnailSource &amp;&amp; (
        &lt;AnimatedFastImage
          {...props}
          source={thumbnailSource}
          style={[style, thumbOpStyle]}
          onLoad={handleThumbnailLoad}
          blurRadius={1}
        /&gt;
      )}
      &lt;AnimatedFastImage
        {...props}
        source={source}
        style={[styles.imageOverlay, imgOpStyle, style]}
        onLoad={onImageLoad}
      /&gt;
    &lt;/View&gt;
  )
}

const styles = StyleSheet.create({
  imageOverlay: {
    position: 'absolute',
    left: 0,
    right: 0,
    bottom: 0,
    top: 0,
  },
  container: {
    backgroundColor: '#e1e4e8',
  },
})

</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¤šè¡Œæ–‡æœ¬æº¢å‡ºçœç•¥]]></title>
        <id>https://aiyou.life/post/qo35dDzbQ/</id>
        <link href="https://aiyou.life/post/qo35dDzbQ/">
        </link>
        <updated>2020-09-05T05:04:44.000Z</updated>
        <summary type="html"><![CDATA[<p>å¤šè¡Œæ–‡æœ¬æº¢å‡ºçœç•¥æŠ€æœ¯æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œæ— è®ºæ˜¯åœ¨å‰ç«¯è¿˜æ˜¯APPç«¯ã€‚æ–‡å­—ä½•æ—¶æ¢è¡Œï¼Œæ¢è¡Œçš„æ˜¯å“ªä¸€ä¸ªå­—ï¼Œæ–‡å­—ä¼šå ç”¨å‡ è¡Œéƒ½éš¾ä»¥ç²¾ç¡®è®¡ç®—å’Œä¼°é‡ã€‚æœ¬æ–‡å°†æ¢è®¨å’Œå®ç°ä¸€ç§ç›¸å¯¹å®Œç¾çš„æ–¹æ³•ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¤šè¡Œæ–‡æœ¬æº¢å‡ºçœç•¥æŠ€æœ¯æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œæ— è®ºæ˜¯åœ¨å‰ç«¯è¿˜æ˜¯APPç«¯ã€‚æ–‡å­—ä½•æ—¶æ¢è¡Œï¼Œæ¢è¡Œçš„æ˜¯å“ªä¸€ä¸ªå­—ï¼Œæ–‡å­—ä¼šå ç”¨å‡ è¡Œéƒ½éš¾ä»¥ç²¾ç¡®è®¡ç®—å’Œä¼°é‡ã€‚æœ¬æ–‡å°†æ¢è®¨å’Œå®ç°ä¸€ç§ç›¸å¯¹å®Œç¾çš„æ–¹æ³•ã€‚</p>
<!-- more -->
<h1 id="å•è¡Œæ–‡æœ¬çœç•¥">å•è¡Œæ–‡æœ¬çœç•¥</h1>
<p>å•è¡Œæ–‡æœ¬çœç•¥è¾ƒä¸ºç®€å•ï¼Œä¸”å…¼å®¹æ€§è¾ƒå¥½ã€‚</p>
<p>è¦å®ç°å•è¡Œæ–‡æœ¬çœç•¥ï¼Œä¸‹é¢CSSå±æ€§ç¼ºä¸€ä¸å¯</p>
<pre><code class="language-css">width: 100px;  // å›ºå®šå®½åº¦
overflow: hidden;   // æº¢å‡ºéšè—
white-space: nowrap;    // æ–‡å­—ä¸æ¢è¡Œ
text-overflow: ellipsis;    // æ–‡å­—æº¢å‡ºæˆªæ–­
</code></pre>
<h1 id="å¤šè¡Œæ–‡æœ¬çœç•¥">å¤šè¡Œæ–‡æœ¬çœç•¥</h1>
<p>å½“æ¥åˆ°è¿™ä¸ªéœ€æ±‚çš„æ—¶å€™ï¼Œè€ƒè™‘åˆ°æˆ‘ä»¬äº§å“è¿è¡Œåœ¨å¾®ä¿¡å°ç¨‹åºï¼Œè€Œå°ç¨‹åºåœ¨IOSå’Œå®‰å“å¹³å°éƒ½æ˜¯ç”¨äº†webkitå†…æ ¸, å› è€Œä¸‹é¢çš„ä»£ç åº”å½“åœ¨ä¸¤ä¸ªå¹³å°éƒ½å¯ä»¥å¾ˆå¥½è¿è¡Œã€‚</p>
<p>webkit å†…æ ¸çš„æµè§ˆå™¨å¯ä»¥åŸç”Ÿå®ç°å¤šè¡Œæ–‡æœ¬æº¢å‡ºçœç•¥ã€‚</p>
<pre><code class="language-css">display: -webkit-boxï¼›
-webkit-box-orient: vertical;
-webkit-line-clamp: 2;
overflow: hiddenï¼›
text-overflow: ellipsisï¼›
</code></pre>
<p>ç„¶è€Œäº‹å®å¹¶éå¦‚æ­¤ã€‚å®é™…ä¸Šé¢ä»£ç åœ¨å®‰å“å¯ä»¥è¿è¡Œï¼Œä½†åœ¨IOSä¸‹åˆ™ç©ºç™½ã€‚<br>
<img src="https://aiyou.life/post-images/1599296417880.png" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">line-clampå…¼å®¹æ€§</div>
<figure data-type="image" tabindex="1"><img src="https://aiyou.life/post-images/1599295340251.png" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">å¾®ä¿¡å°ç¨‹åºè¿è¡Œç¯å¢ƒ</div>
<figure data-type="image" tabindex="2"><img src="https://aiyou.life/post-images/1599296818625.png" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">IOS WkWebView åŸºäº Webkit</div>
<p>æ‰¾äº†åŠå¤©èµ„æ–™ï¼Œä¹Ÿæ²¡æœ‰æ‰¾åˆ°åŸå› ã€‚çŒœæƒ³å¯èƒ½ WkWebView ä¸­çš„ webkit ç‰ˆæœ¬å¤ªä½çš„ç¼˜æ•…ã€‚</p>
<p>æ—¢ç„¶ä¸Šé¢çš„ä»£ç ä¸èƒ½ä½¿ç”¨ï¼Œåªèƒ½å°è¯•å…¶ä»–åŠæ³•ã€‚</p>
<h2 id="js-æ–¹å¼">JS æ–¹å¼</h2>
<p>JSè®¡ç®—è£å‰ªçš„æ–¹å¼è¢«æ’é™¤äº†</p>
<ul>
<li>ç¬¬ä¸€ï¼Œè¿™æœ‰æ‚–äºè¡Œä¸ºä¸å±•ç¤ºç›¸åˆ†ç¦»çš„ç†å¿µ</li>
<li>ç¬¬äºŒï¼Œè¦è€ƒè™‘æ±‰å­—ï¼Œè‹±æ–‡å­—æ¯ï¼Œå›¾æ ‡ï¼Œå…¨è§’åŠè§’ç¬¦å·ç­‰æ‰èƒ½ç›¸å¯¹å‡†ç¡®ç®—å‡ºæ–‡å­—å ç”¨å‡ è¡Œï¼Œè¦ä¸è¦è£åˆ‡</li>
<li>ç¬¬ä¸‰ï¼Œæˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯ä¸­è¦è§£æå¯Œæ–‡æœ¬ï¼Œå¯¹äºHTMLæ ‡ç­¾ï¼Œé“¾æ¥åœ°å€ç­‰è¦è€ƒè™‘çš„è¾ƒå¤šï¼Œå®ç°æ–¹æ¡ˆè¾ƒä¸ºå¤æ‚</li>
</ul>
<h2 id="css-æ–¹å¼">CSS æ–¹å¼</h2>
<h3 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h3>
<p>å¾ˆå®¹æ˜“å†™ä¸‹ä¸‹é¢è¿™äº›ä»£ç ï¼Œç¼ºç‚¹æ˜¯å›ºå®šé«˜åº¦ï¼Œæ–‡å­—æ•°é‡å¿…é¡»è¶…è¿‡ä¸¤è¡Œï¼Œå½“æ–‡å­—åªæœ‰ä¸€è¡Œæˆ–ä¸¤è¡Œæ—¶ï¼Œéƒ½ä¼šæ˜¾ç¤ºæœ«å°¾çš„çœç•¥å·ã€‚ä¸”æ–‡å­—è¶…è¿‡ä¸¤è¡Œï¼Œæœ«å°¾çš„çœç•¥å·æœ‰å¯èƒ½é®æŒ¡ä½ä¸€åŠçš„å­—ç¬¦ã€‚è¿™æ ·çš„æ•ˆæœä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<pre><code class="language-css">.container {
    position: 'relative';
    width: 200px;
    height: 40px;
    line-height: 20px;
    overflow: hidden;
}
.container::after {
    content: '...';
    display: 'block';
    position: 'absolute';
    right: 0;
    bottom: 0;
}
</code></pre>
<h3 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h3>
<p>CSS å¤„ç†çš„éš¾ç‚¹åœ¨äºçŸ¥é“æœ‰æ²¡æœ‰æ¢è¡Œï¼Œæ€è€ƒè‰¯ä¹…åæ— æœï¼Œä»ç½‘ä¸Šæ‰¾äº†æ‰¾èµ„æ–™ï¼Œå‘ç°ä¸€ç§å¾ˆå·§å¦™çš„åŠæ³•ã€‚è§£å†³äº†ä¸€éƒ¨åˆ†é—®é¢˜ã€‚</p>
<p>è¯¥æ–¹æ³•åˆ©ç”¨æµ®åŠ¨å…ƒç´ ç‰¹æ€§å®ç°ã€‚åŸç†å¾ˆç®€å•ï¼Œä½†æƒ³æ³•å¾ˆç‹¬ç‰¹ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªé™å®šä¸¤è¡Œçš„ä¾‹å­ã€‚</p>
<h4 id="ç¬¬ä¸€æ­¥åˆ›å»ºå¦‚å›¾å¸ƒå±€">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå¦‚å›¾å¸ƒå±€</h4>
<figure data-type="image" tabindex="3"><img src="https://aiyou.life/post-images/1599306945438.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ç¬¬ä¸€æ­¥</div>
<pre><code class="language-html">&lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;baseline&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;text&quot;&gt;è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬&lt;/div&gt;
    &lt;div class=&quot;omit&quot;&gt;...&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-less">.container {
    background: #099;
    max-height: 40px;
    line-height: 20px;
    .baseline {
        float: left;
        width: 20px;
        height: 40px;
        background: yellow;
    }
    .text {
        float: right;
        width: calc(100% - 20px);
        background: blueviolet;
        word-break: break-all;
    }
    .omit {
        float: right;
        content: &quot;...&quot;;
        width: 20px;
        height: 20px;
        background: red;
    }
}
</code></pre>
<h4 id="ç¬¬äºŒæ­¥çœç•¥å·å½’ä½">ç¬¬äºŒæ­¥ï¼šçœç•¥å·å½’ä½</h4>
<figure data-type="image" tabindex="4"><img src="https://aiyou.life/post-images/1599314322562.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ç¬¬äºŒæ­¥</div>
<pre><code class="language-less">...
    .omit {
        float: right;
        content: &quot;...&quot;;
        width: 20px;
        height: 20px;
        background: red;
        + position: relative;
        + left: 100%;
        + transform: translate(-100%, -100%);
    }
...
</code></pre>
<p>è¿™é‡Œåˆ©ç”¨ position: relative ç›¸å¯¹çˆ¶å…ƒç´ å°†è‡ªå·±å®šä½åˆ°äº†çˆ¶å…ƒç´ çš„å®½åº¦å¤–ï¼Œä¹‹ååˆ©ç”¨ transform å‘ä¸Šå‘å·¦ç§»åŠ¨äº†ä¸€ä¸ªè‡ªå·±çš„å®½é«˜ã€‚å½“åªæœ‰ä¸€è¡Œæ—¶ï¼Œçœç•¥å·ç§»å‡ºäº†è§†çº¿ä¹‹å¤–ï¼Œå½“ä¸¤è¡Œæ—¶ï¼Œçœç•¥å·å›å½’äº†æ­£ç¡®çš„ä½ç½®ã€‚</p>
<h4 id="ç¬¬ä¸‰æ­¥éšè—å¤šä½™å…ƒç´ ">ç¬¬ä¸‰æ­¥ï¼šéšè—å¤šä½™å…ƒç´ </h4>
<figure data-type="image" tabindex="5"><img src="https://aiyou.life/post-images/1599315200026.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ç¬¬ä¸‰æ­¥</div>
<pre><code class="language-less">...
.container {
    background: #099;
    max-height: 40px;
    line-height: 20px;
    ++ overflow: hidden;
    ...
    .text {
        float: right;
        -- width: calc(100% - 20px);
        ++ width: 100%;
        ++ margin-left: -20px;
        background: blueviolet;
        word-break: break-all;
    }
...
</code></pre>
<p>è¿™é‡Œä½¿ç”¨ margin-left ä¸ºè´Ÿï¼Œç›–ä½äº† baseline å…ƒç´ ã€‚è¿™æ ·ä¿è¯äº†åŸºæœ¬å¸ƒå±€ä¸å˜ï¼Œä¸”è¾¾åˆ°äº†å½±è—æ— å…³å…ƒç´ çš„ä½œç”¨ã€‚ç”±äºåœ¨çˆ¶å…ƒç´ ä¸­è®¾å®šäº† overflow: hidden, æ¸…é™¤æµ®åŠ¨ï¼Œæ‰€ä»¥çˆ¶å…ƒç´ çš„èƒŒæ™¯é¢œè‰²æ˜¾ç¤ºå‡ºæ¥äº†ã€‚</p>
<h4 id="å±€é™æ€§">å±€é™æ€§</h4>
<figure data-type="image" tabindex="6"><img src="https://aiyou.life/post-images/1599316233622.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">å±€é™</div>
ä½¿ç”¨è¯¥ç§æ–¹å¼ï¼Œå±€é™åœ¨äºå›ºå®šé«˜åº¦ã€‚baseline å…ƒç´ å¿…é¡»è®¾å®šä¸ºå›ºå®šé«˜åº¦ï¼Œå› è€Œæ’‘èµ·äº†çˆ¶å…ƒç´ çš„é«˜åº¦ã€‚
<h4 id="æ³¨æ„">æ³¨æ„</h4>
<ul>
<li>container å…ƒç´ ä¸­ maxHeight/Height å¿…é¡»æ˜¯ LineHeight çš„æ•´æ•°å€ã€‚å€æ•°è¡¨ç¤ºé™åˆ¶å‡ è¡Œ</li>
<li>container å…ƒç´ ä¸­ maxHeight/Height è¦ä¸ baseline å…ƒç´ çš„ height ä¿æŒä¸€è‡´</li>
<li>baseline å…ƒç´ å®½åº¦è¦ä¸ emit å…ƒç´ å®½åº¦ä¿æŒä¸€è‡´</li>
<li>emit å…ƒç´ é«˜åº¦è¦ä¸º container å…ƒç´ çš„è¡Œé«˜</li>
</ul>
<h4 id="åº”ç”¨æ¡ˆä¾‹">åº”ç”¨æ¡ˆä¾‹</h4>
<figure data-type="image" tabindex="7"><img src="https://aiyou.life/post-images/1599318337342.png" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">æŒ‡å°–æ¢æ¡ˆå°ç¨‹åºè¯„è®º</div>
<p>å¯¹æ¯”App Storeä¸­çš„è¯„è®ºï¼Œå¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„å®ç°è¿˜æ˜¯ç›¸å¯¹å®Œç¾<br>
<img src="https://aiyou.life/post-images/1599318937357.jpg" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">AppStoreè¯„è®º</div>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://juejin.im/post/5dc15b35f265da4d432a3d10#heading-9">å¯èƒ½æ˜¯æœ€å…¨çš„ â€œæ–‡æœ¬æº¢å‡ºæˆªæ–­çœç•¥â€ æ–¹æ¡ˆåˆé›†</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[TSå­¦ä¹ ç¬”è®°]]></title>
        <id>https://aiyou.life/post/-d73T0KeE/</id>
        <link href="https://aiyou.life/post/-d73T0KeE/">
        </link>
        <updated>2020-09-05T04:08:59.000Z</updated>
        <summary type="html"><![CDATA[<p>å¾ˆæ—©ä¹‹å‰å†™çš„ä¸€ç³»åˆ—å…³äºTypeScriptçš„å­¦ä¹ ç¬”è®°ï¼Œä¿å­˜åœ¨äº† Github ä»“åº“ã€‚ä¸æ˜¯å¾ˆæ–¹ä¾¿æŸ¥çœ‹ï¼Œç°è¿ç§»åˆ°Blogäº†</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¾ˆæ—©ä¹‹å‰å†™çš„ä¸€ç³»åˆ—å…³äºTypeScriptçš„å­¦ä¹ ç¬”è®°ï¼Œä¿å­˜åœ¨äº† Github ä»“åº“ã€‚ä¸æ˜¯å¾ˆæ–¹ä¾¿æŸ¥çœ‹ï¼Œç°è¿ç§»åˆ°Blogäº†</p>
<!-- more -->
<h2 id="åŸºç¡€ç±»å‹">åŸºç¡€ç±»å‹</h2>
<h3 id="å­—ç¬¦ä¸²æ•°å­—å¸ƒå°”å€¼">å­—ç¬¦ä¸²/æ•°å­—/å¸ƒå°”å€¼</h3>
<p>åªéœ€è¦åœ¨ç”³æ˜åé¢åŠ  <strong>:type</strong> å³å¯</p>
<pre><code class="language-typescript">let str: string = '12345'

let num: number = 12345

let bool: boolean = true

</code></pre>
<h3 id="æ•°ç»„">æ•°ç»„</h3>
<p>è¦æ±‚æ•°ç»„ä¸­æ¯ä¸€é¡¹çš„ç±»åˆ«éƒ½ç›¸åŒ</p>
<pre><code class="language-typescript">let ary: number[] = [1, 2, 3]

let ary: Array&lt;number&gt; = [1, 2, 3]
</code></pre>
<h3 id="å…ƒç»„">å…ƒç»„</h3>
<p>æ•°ç»„ç”³æ˜è¦æ±‚æ•°ç»„ä¸­æ¯ä¸€é¡¹éƒ½ç›¸åŒï¼Œå…ƒç»„å¯ä¸ºæ•°ç»„é¡¹ç”³æ˜ä¸åŒç±»å‹</p>
<pre><code class="language-typescript">let tuple: [string, number]

tuple = ['123', 123]

tuple[2] = 234 // æ­£ç¡®

tuple[1] = '234' // æ­£ç¡®

tuple[3] = true // é”™è¯¯

</code></pre>
<p>å¯ä»¥ä¸ºæ²¡æœ‰ç”³æ˜çš„ç±»å‹çš„æ•°ç»„é¡¹è¿›è¡Œèµ‹å€¼ï¼Œä½†æ˜¯ <strong>èµ‹å€¼ç±»å‹å¿…é¡»æ˜¯ç”³æ˜åˆ—è¡¨ä¸­å­˜åœ¨çš„ç±»å‹</strong></p>
<h3 id="æšä¸¾">æšä¸¾</h3>
<p>æšä¸¾ç±»å‹æ˜¯ TypeScript å¯¹ JavaScript çš„æ‰©å±•.</p>
<pre><code class="language-typescript">enum Color { Red = 1, Green, Blue }

let c: Color = Color.Green  // 2

let d: string = Color[2]  // 'Green'

</code></pre>
<p>é»˜è®¤ä»ä¸‹æ ‡0å¼€å§‹ç¼–å·ï¼Œä½†æ˜¯å¯ä»¥æ‰‹åŠ¨æŒ‡å®š.</p>
<p>ä½œç”¨å°±æ˜¯æ ¹æ®ä¸‹æ ‡æ‰¾å€¼ï¼Œæˆ–è€…æ ¹æ®å€¼æ‰¾ä¸‹æ ‡ã€‚</p>
<h3 id="any">Any</h3>
<p>æœªçŸ¥æˆ–è€…å¯å˜çš„å˜é‡ç±»å‹ç”±Anyè¿›è¡Œå£°æ˜</p>
<pre><code class="language-typescript">let ha: any = 4

ha = '44'  // æ­£ç¡®

ha = true  // æ­£ç¡®

ha = [] // æ­£ç¡®

let list: any[] = [1, true, &quot;free&quot;] // æ­£ç¡®
</code></pre>
<p>é‡åˆ°anyæ ‡è®°çš„å˜é‡ï¼Œç¼–è¯‘å™¨ä¼šè·³è¿‡ç±»å‹æ£€æŸ¥ï¼Œæ‰€ä»¥åªè¦åœ¨ JavaScript ä¸­å£°æ˜æ²¡é—®é¢˜å°±è¡Œ</p>
<h3 id="void">Void</h3>
<p>å£°æ˜ä¸º void ç±»å‹è¯´æ˜è¯¥å˜é‡æ²¡æœ‰ä»»ä½•å€¼ï¼Œåªèƒ½èµ‹äºˆ undefined æˆ–è€… nullï¼Œè¿™ç§æ“ä½œæ²¡ä»€ä¹ˆç”¨</p>
<p>å½“å‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œéœ€è¦å£°æ˜å‡½æ•°è¿”å›ä¸º void</p>
<pre><code class="language-typescript">let hh: void = undefined

function warnUser(): void {
  console.log(&quot;This is my warning message&quot;);
}

</code></pre>
<h3 id="null-undefined">Null / Undefined</h3>
<p>Null / Undefined æ˜¯ä¸¤ä¸ªç±»å‹ï¼Œç”³æ˜ä¹‹ååªèƒ½èµ‹å€¼æœ¬èº«ã€‚ã€‚ä½†è¿™æ ·åšæ²¡ä»€ä¹ˆç”¨...</p>
<p>é»˜è®¤æƒ…å†µä¸‹ null å’Œ undefined æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚ å°±æ˜¯è¯´ä½ å¯ä»¥æŠŠ null å’Œ undefined èµ‹å€¼ç»™ number ç±»å‹çš„å˜é‡ã€‚</p>
<h3 id="never">Never</h3>
<p>è¡¨ç¤ºæ°¸è¿œä¸å­˜åœ¨å€¼çš„ç±»å‹</p>
<pre><code class="language-typescript">// è¿”å›neverçš„å‡½æ•°å¿…é¡»å­˜åœ¨æ— æ³•è¾¾åˆ°çš„ç»ˆç‚¹
function error(message: string): never {
  throw new Error(message);
}

// æ¨æ–­çš„è¿”å›å€¼ç±»å‹ä¸ºnever
function fail() {
  return error(&quot;Something failed&quot;);
}

// è¿”å›neverçš„å‡½æ•°å¿…é¡»å­˜åœ¨æ— æ³•è¾¾åˆ°çš„ç»ˆç‚¹
function infiniteLoop(): never {
  while (true) {
  }
}
</code></pre>
<p>neverç±»å‹æ˜¯ä»»ä½•ç±»å‹çš„å­ç±»å‹ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™ä»»ä½•ç±»å‹ï¼›ç„¶è€Œï¼Œæ²¡æœ‰ç±»å‹æ˜¯ never çš„å­ç±»å‹æˆ–å¯ä»¥èµ‹å€¼ç»™ never ç±»å‹ï¼ˆé™¤äº† never æœ¬èº«ä¹‹å¤–ï¼‰ã€‚ å³ä½¿ any ä¹Ÿä¸å¯ä»¥èµ‹å€¼ç»™ neverã€‚</p>
<h3 id="object">Object</h3>
<p>é™¤numberï¼Œstringï¼Œbooleanï¼Œsymbolï¼Œnullæˆ–undefinedä¹‹å¤–çš„ç±»å‹ã€‚</p>
<h2 id="å˜é‡ç”³æ˜">å˜é‡ç”³æ˜</h2>
<p>å˜é‡ç”³æ˜æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œå°±æ˜¯ES6ä¸­çš„çŸ¥è¯†ï¼Œlet,const...</p>
<p>ç ”ç©¶ä¸€ä¸‹ä¸‹é¢è¿™ä¸ª</p>
<p>ç¤ºä¾‹ä»£ç </p>
<pre><code class="language-typescript">function f([first, second]: [number, number]) {
    console.log(first);
    console.log(second);
}

const input = [1, 2]

f(input); // æŠ¥é”™

</code></pre>
<p>è¿™æ˜¯ TypeScript ä¸­æ–‡ç½‘çš„ç¤ºä¾‹ä»£ç ã€‚ã€‚ç»“æœå±…ç„¶æŠ¥é”™äº†ã€‚ã€‚ç ”ç©¶äº†ä¸€ä¸‹æ˜ç™½äº†ä¸ºä»€ä¹ˆã€‚</p>
<p>é¦–å…ˆ typescript ç¯å¢ƒä¸‹ï¼Œåƒ <code>const input = [1, 2]</code> è¿™æ ·çš„å®šä¹‰ï¼Œæ•°ç»„é¡¹éƒ½ä¸ºæ•°å­—ï¼Œé»˜è®¤ç”³æ˜ä¸º<code>Array&lt;number&gt;</code>.æ‰€ä»¥ç›¸å½“äº<code>const input: Array&lt;number&gt; = [1, 2]</code></p>
<p>çœ‹å‡½æ•°å‚æ•° <code>[first, second]</code> , è°ƒç”¨å‡½æ•° <code>f(input)</code>, è¿™é‡Œç”¨åˆ°äº†å˜é‡è§£æ„ï¼Œ<code>input</code>æ˜¯ä¸€ä¸ªç”³æ˜ä¸ºæ‰€æœ‰å…ƒç´ éƒ½ä¸º number çš„ <strong>æ•°ç»„</strong>ã€‚å†çœ‹å‚æ•°åé¢çš„ç±»å‹å®šä¹‰ï¼Œè¿™æ˜¯ç”¨ <strong>å…ƒç»„</strong> å½¢å¼ç”³æ˜ä¼ å…¥å‚æ•°çš„ç±»å‹ã€‚ã€‚ä¼ å…¥çš„å‚æ•°ä¸å‚æ•°ç”³æ˜ç±»å‹ä¸ç¬¦ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚</p>
<p>æ­£ç¡®ä»£ç </p>
<pre><code class="language-typescript">function f([first, second]: Array&lt;number&gt;) {
    console.log(first);
    console.log(second);
}

const input = [1, 2]  // æˆ–è€… const input: Array&lt;number&gt; = [1, 2]

f(input); // æ­£ç¡®

</code></pre>
<p>æˆ–è€…</p>
<pre><code class="language-typescript">function f([first, second]: [number, number]) {
    console.log(first);
    console.log(second);
}

const input: [number, number] = [1, 2]

f(input); // æ­£ç¡®

</code></pre>
<h3 id="å¯¹è±¡è§£æ„">å¯¹è±¡è§£æ„</h3>
<h4 id="å±æ€§å€¼é‡å‘½å">å±æ€§å€¼é‡å‘½å</h4>
<p>ç¤ºä¾‹ä»£ç :</p>
<pre><code class="language-typescript">const { name: myName }: { name: string, age: number } = { name: 'han', age: 12 }
</code></pre>
<p>è¿™é‡Œå¾ˆä¹±ï¼Œé€ä¸€åˆ†æä¸€ä¸‹:</p>
<p>é¦–å…ˆä¸å«ç±»å‹æ£€æŸ¥çš„æœ€åŸºæœ¬çš„å¯¹è±¡å˜é‡è§£æ„æ˜¯è¿™æ ·çš„(ES6è¯­æ³•)</p>
<pre><code class="language-typescript">const { name } = { name: 'han', age: 12 }

// ä¸Šé¢è¿™ä¸€è¡Œç›¸å½“äº
const { name: name } = { name: 'han', age: 12 }
</code></pre>
<p>å¦‚æœè¦å¯¹nameå€¼é‡å‘½åï¼Œåˆ™éœ€è¦åœ¨ name ååŠ  :</p>
<pre><code class="language-typescript">const { name: myName } = { name: 'han', age: 12 }
</code></pre>
<p>TypeScript åœ¨ES6åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ç±»å‹æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ã€‚</p>
<p>ç±»å‹æ£€æŸ¥ä¸èƒ½åªæ£€æŸ¥è‡ªå·±éœ€è¦çš„æ•°æ®ï¼Œè€Œæ˜¯æ£€æŸ¥æ‰€æœ‰è¦è§£æ„çš„å¯¹è±¡ï¼Œæ‰€ä»¥<code>age: number</code>è¿™é‡Œå¿…ä¸å¯å°‘</p>
<p><strong>åœ¨ä½¿ç”¨å¯¹è±¡è§£æ„å‰ï¼Œä¸€å®šè¦ç‰¢è®°ES6çš„è§£æ„è¯­æ³•ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå†ä½¿ç”¨ TypeScript çš„ç±»å‹é™åˆ¶</strong></p>
<h4 id="å±•å¼€æ“ä½œç¬¦">å±•å¼€æ“ä½œç¬¦</h4>
<p>ä½¿ç”¨ä¸ES6ä¸€è‡´</p>
<p>çœ‹ä¸ªå°ä¾‹å­</p>
<pre><code class="language-typescript">class C {
  p = 12;
  m() {
  }
}

let c = new C();
let clone = { ...c };
clone.p;  // ok
clone.m();  // error
</code></pre>
<p>å½“å±•å¼€æ“ä½œç¬¦å±•å¼€ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šä¸¢å¤±æ–¹æ³•ã€‚å±•å¼€æ“ä½œç¬¦å±•å¼€çš„æ˜¯å¯æšä¸¾å±æ€§ã€‚</p>
<h2 id="æ¥å£">æ¥å£</h2>
<p>åŸæ–‡ç»™å‡ºä¸¤æ®µä»£ç </p>
<pre><code class="language-typescript">function printLabel(labelledObj: { label: string }) {
  console.log(labelledObj.label);
}

let myObj = { size: 10, label: &quot;Size 10 Object&quot; };

printLabel(myObj);

</code></pre>
<p>æ¥å£ç‰ˆæœ¬çš„</p>
<pre><code class="language-typescript">interface LabelledValue {
  label: string;
}

function printLabel(labelledObj: LabelledValue) {
  console.log(labelledObj.label);
}

let myObj = {size: 10, label: &quot;Size 10 Object&quot;};
printLabel(myObj);

</code></pre>
<p>é¦–å…ˆè¿™é‡Œæœ‰ç–‘é—®ï¼Œåœ¨ä¸Šé¢é‚£ç§æ–¹å¼å¯ä»¥å®ç°ç±»å‹æ£€æŸ¥çš„æƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆè¦æ¨å‡ºæ¥å£è¿™ä¸ªæ–°æ¦‚å¿µ?å…ˆæ¥ç€å¾€ä¸‹çœ‹</p>
<h3 id="å¯é€‰å±æ€§">å¯é€‰å±æ€§</h3>
<pre><code class="language-typescript">interface SquareConfig {
  color?: string;
  width?: number;
}

function createSquare(config: SquareConfig): {color: string; area: number} {
  let newSquare = {color: &quot;white&quot;, area: 100};
  if (config.color) {
    newSquare.color = config.color;
  }
  if (config.width) {
    newSquare.area = config.width * config.width;
  }
  return newSquare;
}

let mySquare = createSquare({color: &quot;black&quot;});  // ok

let mySquare = createSquare({});  // ok

let mySquare = createSquare();  // error

</code></pre>
<p>é¦–å…ˆçœ‹è°ƒç”¨è¿™é‡Œï¼Œä¼ å‚ç©ºå¯¹è±¡æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæ¥å£è§„å®šäº†æˆ‘ä»¬ color, width å¯ä¼ å¯ä¸ä¼ ã€‚ã€‚ä½†æ˜¯æ²¡å‘Šè¯‰æˆ‘ä»¬å‚æ•°æ˜¯å¯é€‰çš„ï¼Œæ‰€ä»¥ä¸ä¼ å‚ä¼šæŠ¥é”™ã€‚ã€‚</p>
<p>æ”¹é€ æˆå¦‚ä¸‹ä»£ç </p>
<pre><code class="language-typescript">function createSquare(config: SquareConfig = {}): {color: string; area: number} { 
  ...
}

let mySquare = createSquare();  // ok

</code></pre>
<p>åˆæ¬¡çœ‹è¿™ä¸ªå‡½æ•°æ˜¯æœ‰ç‚¹æ‡µé€¼çš„ã€‚<code>function createSquare(config: SquareConfig): {color: string; area: number}</code>ä¸­çš„<code>: {color: string; area: number}</code>æ˜¯ä»€ä¹ˆè§‚å¯Ÿäº†åŠå¤©ï¼Ÿå„ç§æµ‹è¯•ä¹‹åï¼Œæ‰æƒ³èµ·ï¼Œè¿™æ˜¯è§„å®šè¿”å›å€¼çš„ç±»å‹çš„...è¿™ç§å‡½æ•°å¤šç»ƒç»ƒå¤šå†™å†™å°±å¥½äº†</p>
<p>å†æ¥çœ‹æˆ‘ä»¬ç¬¬ä¸€éƒ¨åˆ†ç»™å‡ºçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦æ¨å‡ºæ¥å£è¿™ä¸ªæ¦‚å¿µï¼Œè¿™é‡Œè¿˜ä¸å¥½è¯´ï¼Œä½†æ˜¯å¯ä»¥ä¸ç”¨æ¥å£çš„æ–¹å¼å®ç°ä¸Šé¢çš„å‡½æ•°</p>
<pre><code class="language-typescript">function createSquare(config: {color?: string, width?: number} = {}): {color: string; area: number} { 
  ...
}

let mySquare = createSquare({color: &quot;red&quot;});  // ok

let mySquare = createSquare({});  // ok

let mySquare = createSquare();  // ok

</code></pre>
<h3 id="åªè¯»å±æ€§">åªè¯»å±æ€§</h3>
<pre><code class="language-typescript">interface Point {
  readonly x: number;
  readonly y: number;
}

let p1: Point = { x: 10, y: 20 };
p1.x = 5; // error!
</code></pre>
<p>åªè¯»å±æ€§åªèƒ½åœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™ç»™å‡ºåˆå§‹å€¼ï¼Œåç»­å°±æ²¡åŠæ³•è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ”¹é€ ä¸Šé¢çš„å‡½æ•°</p>
<pre><code class="language-typescript">interface SquareConfig {
  readonly color?: string;
  readonly width?: number;
}

function createSquare(config: SquareConfig = {}): { color: string; area: number } {
  let newSquare = { color: &quot;white&quot;, area: 100 };
  if (config.color) {
    config.color = &quot;red&quot;  // error
    newSquare.color = config.color
  }
  if (config.width) {
    config.width = 200  // error
    newSquare.area = config.width * config.width;
  }
  return newSquare;
}
</code></pre>
<p>æˆ‘ä»¬å°†æ¥å£ä¸­çš„ color å’Œ width éƒ½é…ç½®æˆ åªè¯» ã€‚æ‰€ä»¥å½“åœ¨å‡½æ•°ä½“ä¸­è¿›è¡Œä¿®æ”¹å‚æ•°æ—¶ä¼šæŠ¥é”™ã€‚</p>
<p>é‚£æˆ‘ä»¬æ€ä¹ˆä½¿ç”¨æ— æ¥å£çš„æ–¹æ³•è¾¾åˆ°åŒæ ·çš„æ•ˆæœ(é…ç½®å±æ€§ä¸å¯ä¿®æ”¹)?</p>
<p>æˆ‘ä»¬çŸ¥é“åŸç”ŸJSä¸­ï¼Œæ¯ä¸ªå±æ€§éƒ½åŒ…å«äº†ä¸€ä¸ªæè¿°ç¬¦ï¼Œæè¿°ç¬¦ä¸­æœ‰å››ä¸ªé…ç½®é¡¹ï¼Œå¯é…ç½®å±æ€§è¡Œä¸º</p>
<blockquote>
<ul>
<li>configurable: è¡¨ç¤ºèƒ½å¦é€šè¿‡deleteåˆ é™¤å±æ€§ä»è€Œé‡æ–°å®šä¹‰å±æ€§ï¼Œèƒ½å¦ä¿®æ”¹å±æ€§çš„ç‰¹æ€§ï¼Œæˆ–è€…èƒ½å¦æŠŠå±æ€§ä¿®æ”¹ä¸ºè®¿é—®å™¨å±æ€§ã€‚</li>
<li>enumerable: è¡¨ç¤ºèƒ½å¦é€šè¿‡for-inå¾ªç¯è¿”å›å±æ€§ã€‚</li>
<li>writable: è¡¨ç¤ºèƒ½å¦ä¿®æ”¹å±æ€§çš„å€¼ã€‚</li>
<li>value: åŒ…å«è¿™ä¸ªå±æ€§çš„æ•°æ®å€¼ã€‚</li>
</ul>
</blockquote>
<p>æˆ‘ä»¬åˆ©ç”¨å…¶ä¸­çš„ <strong>writable</strong> æ˜¯å¦å¯ä»¥å®ç°å‘¢?</p>
<p>çœ‹ä¸‹é¢çš„ä»£ç </p>
<pre><code class="language-typescript">function createSquare(config: {color?:string,width?:number} = {}): { color: string; area: number } {
  let newSquare = { color: &quot;white&quot;, area: 100 };

  Object.defineProperty(config, &quot;color&quot;, { writable: false})
  Object.defineProperty(config, &quot;width&quot;, { writable: false })
  
  if (config.color) {
    config.color = &quot;red&quot;
    newSquare.color = config.color
  }
  if (config.width) {
    config.width = 200
    newSquare.area = config.width * config.width;
  }
  return newSquare;
}

createSquare({ color: &quot;black&quot; }); // error

createSquare({})  // ok

createSquare()  // ok
</code></pre>
<p>ä»£ç å¯æ­£ç¡®é€šè¿‡TypeScriptçš„ç¼–è¯‘ï¼Œä½†æ˜¯åœ¨JavaScriptä»£ç è¿è¡Œæ—¶ä¼šå‡ºé”™ã€‚(TypeScriptåœ¨ç¼–è¯‘æ—¶æœŸæ£€æŸ¥é”™è¯¯ï¼Œæ£€æŸ¥çš„æ˜¯è¯­æ³•é”™è¯¯ã€‚æˆ‘ä»¬å†™çš„ä»£ç æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ç¼–è¯‘)</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶è¿™é‡Œå®ç°äº†ä¸æ¥å£åŸºæœ¬ç›¸åŒçš„æ•ˆæœï¼Œä½†æ˜¯ç¼–è¯‘é˜¶æ®µæ²¡åŠæ³•æ•æ‰åˆ°é”™è¯¯ã€‚</p>
<p>æ­¤å¤–è¿˜æœ‰åªè¯»ç±»å‹æ•°ç»„</p>
<pre><code class="language-typescript">let a: number[] = [1, 2, 3, 4];
let ro: ReadonlyArray&lt;number&gt; = a;

a.push(1) // ok
ro.push(2)  // error

let b = ro as Array&lt;number&gt;

b.push(1) // ok
</code></pre>
<p>æ•°ç»„è®¾ç½®æˆåªè¯»çš„ä¹‹åï¼Œå°†ä¸èƒ½å†ä½¿ç”¨åŸæ¥æ“ä½œæ•°ç»„çš„å„ç§æ–¹æ³•ã€‚ä½†æ˜¯è¿›è¡Œç±»å‹æ–­è¨€(ç±»å‹æ–­è¨€æ˜¯ä¸€ç§å¼ºåˆ¶è½¬åŒ–çš„æœºåˆ¶ï¼ŒTypeScriptè®¤ä¸ºäººæ¯”ç¨‹åºæ›´äº†è§£è¿™ä¸ªå˜é‡æ˜¯ä»€ä¹ˆç±»å‹)ä¹‹åå°±åˆå¯ä»¥äº†</p>
<h3 id="é¢å¤–çš„ç±»å‹æ£€æŸ¥">é¢å¤–çš„ç±»å‹æ£€æŸ¥</h3>
<p>è¿˜ä»¥ä¸Šé¢çš„ä»£ç ä¸ºä¾‹</p>
<pre><code class="language-typescript">interface SquareConfig {
  color?: string;
  width?: number;
}

function createSquare(config: SquareConfig): {color: string; area: number} {
  ...
}

let mySquare = createSquare({ height: 22 });  // æŠ¥é”™

</code></pre>
<p><s>å‘å‡½æ•°ä¸­ä¼ å…¥äº†æ¥å£è§„å®šçš„å±æ€§ä»¥å¤–çš„å±æ€§ï¼Œä¼šæŠ¥é”™ã€‚è¿™å…¶å®å¾ˆå¥½ç†è§£æ˜¯ä¸ºä»€ä¹ˆï¼Œæ²¡æœ‰ç»è¿‡ç±»å‹æ£€æŸ¥ç­‰æ‰‹æ®µå°±å°†ä¸€äº›å˜é‡å¸¦å…¥å‡½æ•°çš„è¿è¡Œç¯å¢ƒä¸­ï¼Œé‚£è¦ TypeScript æœ‰ä»€ä¹ˆç”¨å‘¢? TypeScript æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯å°†æ‰€æœ‰å˜é‡å¯ä»¥æŒæ§ï¼Œå“ªä¸€ä¸ªé˜¶æ®µæ•°æ®æ˜¯ä»€ä¹ˆçŠ¶æ€éƒ½æ˜¯æ˜æ˜ç™½ç™½çš„ã€‚</s></p>
<p>é‚£æ€ä¹ˆè§£å†³ä¸Šé¢çš„è¿™ä¸ªé—®é¢˜ ?</p>
<p>å¯ä»¥ä½¿ç”¨ç±»å‹æ–­è¨€ï¼Œå°†æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ–­è¨€æˆæ¥å£ç±»å‹çš„æ•°æ®</p>
<pre><code class="language-typescript">let mySquare = createSquare({ height: 22 } as SquareConfig);  
</code></pre>
<p><strong>è¿™é‡Œæ³¨æ„ä¸ºä»€ä¹ˆå°†{ height: 22} è½¬åŒ–æˆ SquareConfig ç±»å‹ä¹‹åå°±èƒ½ç”¨äº†ï¼Œæ˜æ˜ SquareConfig ä¸­å¹¶ä¸å­˜åœ¨ height å±æ€§ã€‚è¿™æ˜¯å› ä¸ºç±»å‹æ–­è¨€ä¸è¿›è¡Œç‰¹æ®Šçš„æ•°æ®æ£€æŸ¥å’Œè§£æ„</strong></p>
<p>åŸæ–‡ä¸­è¿˜ç»™å‡ºäº†&quot;å­—ç¬¦ä¸²ç´¢å¼•ç­¾å&quot;è¿™ç§æ–¹å¼</p>
<pre><code class="language-typescript">interface SquareConfig {
    color?: string;
    width?: number;
    [propName: string]: any;
}
</code></pre>
<p>è¡¨ç¤ºSquareConfigå¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å±æ€§ï¼Œå¹¶ä¸”åªè¦å®ƒä»¬ä¸æ˜¯ color å’Œ widthï¼Œé‚£ä¹ˆå°±æ— æ‰€è°“å®ƒä»¬çš„ç±»å‹æ˜¯ä»€ä¹ˆ</p>
<p>&quot;å­—ç¬¦ä¸²ç´¢å¼•ç­¾å&quot;è¿™é‡Œå…ˆæ”¾ç€ï¼Œä¹‹åå†å­¦ä¹ </p>
<p>æœ€åä¹Ÿæ˜¯æœ€ä¸æ¨èçš„ä¸€ç§æ˜¯ç»•è¿‡æ£€æŸ¥</p>
<pre><code class="language-typescript">createSquare({ colour: &quot;red&quot;, width: 100 });  // æŠ¥é”™

let squareOptions = { colour: &quot;red&quot;, width: 100 };
let mySquare = createSquare(squareOptions);   // æ­£ç¡®
</code></pre>
<p>è¿™é‡Œä¸ºä»€ä¹ˆèƒ½ç»•è¿‡æ£€æŸ¥????åŸæ–‡è§£é‡Šæ˜¯è¿™æ ·çš„<strong>å› ä¸º squareOptionsä¸ä¼šç»è¿‡é¢å¤–å±æ€§æ£€æŸ¥ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™</strong>.è¿™é‡Œä¿ç•™ç–‘é—®..</p>
<p>è¯·æ•™äº†å¤§ç¥ä¹‹åæ˜ç™½äº† <a href="part-3(1)-add.md">TypeScriptç»•è¿‡ç¼–è¯‘å™¨æ£€æŸ¥çš„ä¸€ç‚¹å›°æƒ‘</a></p>
<h3 id="å‡½æ•°ç±»å‹">å‡½æ•°ç±»å‹</h3>
<pre><code class="language-typescript">interface SearchFunc {
  (source: string, subString: string): boolean;
}

let mySearch: SearchFunc;
mySearch = function(source, subString) {
  let result = source.search(subString);
  return result &gt; -1;
}

// ä»£ç ç›¸å½“äº
let mySearch: (source: string, subString: string) =&gt; boolean = function (source, subString) : boolean {
  let result = source.search(subString);
  return result &gt; -1;
}

// (source: string, subString: string) =&gt; boolean ä¹Ÿæ˜¯è§„èŒƒå‡½æ•°å†™æ³•çš„ä¸€ç§å½¢å¼
</code></pre>
<p>mySearchå‡½æ•° æ˜¯ SearchFunc ç±»å‹çš„ï¼ŒSearchFunc æ¥å£ä¸­å®šä¹‰äº†å¿…é¡»è¦ä¼ å…¥çš„å‚æ•°åŠå‚æ•°ç±»åˆ«ï¼Œä»¥åŠè¿”å›å€¼çš„ç±»åˆ«ã€‚é‚£ç¤ºä¾‹ä¸­å‡½æ•°å®šä¹‰ä¸­çš„å‚æ•°ç±»å‹æŒ‡å®šæ˜¾å¾—æœ‰äº›å¤šä½™äº†ï¼Œå»æ‰ä¹Ÿæ˜¯æ²¡é”™çš„</p>
<pre><code class="language-typescript">mySearch = function(source, subString) {
  ...
}
</code></pre>
<p>å¦å¤–å®šä¹‰å‡½æ•°çš„å‡½æ•°å‚æ•°åç§°æ˜¯å¯ä»¥æ”¹å˜çš„,å‡½æ•°çš„å‚æ•°ä¼šé€ä¸ªè¿›è¡Œæ£€æŸ¥,ä½ç½®å¯¹äº†å°±è¡Œ</p>
<pre><code class="language-typescript">mySearch = function(sur, sub) {
  ...
}
</code></pre>
<p>é‚£è¿™é‡Œä¼ å…¥ä¸€ä¸ªéœ€è¦å˜é‡è§£æ„çš„å¯¹è±¡ï¼Œæ¥å£è¯¥æ€ä¹ˆå®šä¹‰?</p>
<p>å¦‚ä¸‹</p>
<pre><code class="language-typescript">function test({ sid }) {
  ...
}

test({ sid: '123', num: 123 })
</code></pre>
<p>å®šä¹‰å¦‚ä¸‹:</p>
<pre><code class="language-typescript">interface Sid {
  sid: string,
  [propName: string]: any;
}

interface Test {
  (sid: Sid, num: number): number
}

const test: Test = function ({ sid }, num) {
  return Number.parseInt(sid) + num
}

test({ sid: '123', ha: '234' }, 2)
</code></pre>
<h3 id="å¯ç´¢å¼•çš„ç±»å‹">å¯ç´¢å¼•çš„ç±»å‹</h3>
<pre><code class="language-typescript">interface StringArray {
  [index: number]: string;
}

let myArray: StringArray;
myArray = [&quot;Bob&quot;, &quot;Fred&quot;];

let myStr: string = myArray[0];
</code></pre>
<p>è¡¨ç¤ºäº†å½“ç”¨ number å»ç´¢å¼• StringArray æ—¶ä¼šå¾—åˆ° string ç±»å‹çš„è¿”å›å€¼ã€‚è¿™å°±ç›¸å½“äºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„</p>
<p>è¿™ç§ä¸œè¥¿å®šä¹‰æˆä¸€ä¸ªæ•°ç»„ä¸å°±å®Œäº†?ä¸ºä»€ä¹ˆè¦å¼„å‡ºè¿™ç§ä¸œè¥¿?</p>
<h3 id="ç±»ç±»å‹">ç±»ç±»å‹</h3>
<h4 id="å®ç°æ¥å£">å®ç°æ¥å£</h4>
<p>ä¸C#æˆ–Javaé‡Œæ¥å£çš„åŸºæœ¬ä½œç”¨ä¸€æ ·ï¼ŒTypeScriptä¹Ÿèƒ½å¤Ÿç”¨å®ƒæ¥æ˜ç¡®çš„å¼ºåˆ¶ä¸€ä¸ªç±»å»ç¬¦åˆæŸç§å¥‘çº¦</p>
<pre><code class="language-typescript">interface ClockInterface {
  currentTime: Date;
  setTime(d: Date): void;
}

class Clock implements ClockInterface {
  currentTime: Date;
  constructor() {
    this.currentTime = new Date()
  }
  setTime(d: Date) {
    this.currentTime = d;
  }
}
</code></pre>
<p><s>æ¥å£ä¸­æè¿°çš„æ•°æ®å’Œæ–¹æ³•æŒ‚è½½åˆ°åŸå‹ä¸Š</s></p>
<p>æ¥å£ä¸­å®šä¹‰çš„å±æ€§å°†åœ¨ç±»ä¸­å±æ€§ä¸Šå®šä¹‰ã€‚å®šä¹‰çš„æ–¹æ³•å°†æŒ‚è½½åˆ°åŸå‹ä¸Šã€‚</p>
<h4 id="ç±»é™æ€éƒ¨åˆ†ä¸å®ä¾‹éƒ¨åˆ†çš„åŒºåˆ«">ç±»é™æ€éƒ¨åˆ†ä¸å®ä¾‹éƒ¨åˆ†çš„åŒºåˆ«</h4>
<pre><code class="language-typescript">// å‡½æ•°æ¥å£
interface ClockConstructor {
    // å®šä¹‰äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¿”å› ClockInterface ç±»å‹æ•°æ®
    new (hour: number, minute: number): ClockInterface;
}

// ç±»æ¥å£
interface ClockInterface {
    // å®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿ç±»éœ€è¦å®ç°çš„å‡½æ•°ã€‚
    tick():void;
}

// å‚æ•° ctor ä¸ºæ„é€ å‡½æ•°
function createClock(ctor: ClockConstructor, hour: number, minute: number): ClockInterface {
    return new ctor(hour, minute);
}

// ç»§æ‰¿ç±»éœ€è¦å®ç° tick å‡½æ•°
class DigitalClock implements ClockInterface {
    constructor(h: number, m: number) { }
    tick() {
        console.log(&quot;beep beep&quot;);
    }
}
class AnalogClock implements ClockInterface {
    constructor(h: number, m: number) { }
    tick() {
        console.log(&quot;tick tock&quot;);
    }
}

let digital = createClock(DigitalClock, 12, 17);
let analog = createClock(AnalogClock, 7, 32);
</code></pre>
<p>ä¸¤ä¸ªç±»å‡ç»§æ‰¿è‡ª ClockInterface , æ‰€ä»¥ä»–ä»¬åº”å½“å®ç°æ¥å£ä¸­çš„ tick å‡½æ•°ã€‚</p>
<p>è§‚å¯Ÿå‡½æ•° createClock</p>
<p>å‚æ•°<code>ctor: ClockConstructor</code>ç›¸å½“äº<code>const ctor : ClockConstructor = DigitalClock</code></p>
<p>äºæ˜¯å†çœ‹ æ¥å£ClockConstructorï¼Œæ¥å£ä¸­è¡¨æ˜ï¼Œå®ç°è¯¥æ¥å£çš„å‡½æ•°éœ€è¦è¿”å› ClockInterface çš„ä¸€ä¸ªå®ä¾‹</p>
<p>ç›´æ¥å®šä¹‰ä¸€ä¸ªæ¥å£è§„èŒƒç±»ä¸­çš„é™æ€éƒ¨åˆ†å’Œå®ä¾‹éƒ¨åˆ†ä¸å¥½å®ç°ã€‚ä»£ç ä¸­ä½¿ç”¨äº†ä¸¤ä¸ªæ¥å£å®ç°åˆ†åˆ«è§„èŒƒè¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p>
<p>ClockInterface æ¥å£ç›´æ¥è§„èŒƒäº†å®ä¾‹éƒ¨åˆ†å‡½æ•°</p>
<p>ClockConstructor æ¥å£è§„èŒƒäº†æ„é€ å‡½æ•°ï¼Œè§„èŒƒäº†é™æ€éƒ¨åˆ†</p>
<h3 id="ç»§æ‰¿æ¥å£">ç»§æ‰¿æ¥å£</h3>
<p>çœ‹ä»£ç ã€å¾ˆå®¹æ˜“æ˜ç™½</p>
<pre><code class="language-typescript">interface Shape {
    color: string;
}

interface PenStroke {
    penWidth: number;
}

interface Square extends Shape, PenStroke {
    sideLength: number;
}

let square = &lt;Square&gt;{};
square.color = &quot;blue&quot;;
square.sideLength = 10;
square.penWidth = 5.0;
</code></pre>
<h3 id="æ··åˆç±»å‹">æ··åˆç±»å‹</h3>
<p>çœ‹ä»£ç </p>
<pre><code class="language-typescript">interface Counter {
    (start: number): string;
    interval: number;
    reset(): void;
}

function getCounter(): Counter {
    let counter = &lt;Counter&gt;function (start: number) { };
    // ç›¸å½“äº let counter = function (start: number) { } as Counter;
    counter.interval = 123;
    counter.reset = function () { };
    return counter;
}

let c = getCounter();
c(10);
c.reset();
c.interval = 5.0;
</code></pre>
<p>æ¥å£ä¸­å®šä¹‰äº†ä¸‰ç§ç±»å‹ï¼Œç”¨åœ¨å‡½æ•°ä¸Šï¼Œå‡½æ•°åº”å½“åŒ…å«ä¸€ä¸ª number å‚æ•°ï¼Œè¿”å› string ç±»å‹æ•°æ®ï¼Œè§‚å¯Ÿ getCounter å‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªåä¸º counter å‡½æ•°ï¼Œå‡½æ•°è¢«å¼ºè½¬ä¸º Counter ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥æŒ‚è½½åœ¨ Counter æ¥å£ä¸­å®šä¹‰çš„ reset å’Œ interval</p>
<h3 id="æ¥å£ç»§æ‰¿ç±»">æ¥å£ç»§æ‰¿ç±»</h3>
<p>çœ‹ä»£ç </p>
<pre><code class="language-typescript">class Control {
    private state: any;
}

interface SelectableControl extends Control {
    select(): void;
}

class Button extends Control implements SelectableControl {
    select() { }
}

class TextBox extends Control {
    select() { }
}

// é”™è¯¯ï¼šâ€œImageâ€ç±»å‹ç¼ºå°‘â€œstateâ€å±æ€§ã€‚
class Image implements SelectableControl {
    select() { }
}

class Location {

}
</code></pre>
<p>åŸæ–‡è¯´åˆ°&quot;æ¥å£ç»§æ‰¿ç±»æ—¶ï¼Œä¼šç»§æ‰¿å…¶çš„ private å’Œ protected æˆå‘˜&quot;ã€‚å®é™…ä¸Šå°†ä¸Šé¢ä»£ç  Control ç±»ä¸­çš„ private æ”¹ä¸º public ,Image ç±»ä¹Ÿä¼šæŠ¥é”™ã€‚</p>
<h2 id="ç±»">ç±»</h2>
<p>å…ˆçœ‹ä»£ç </p>
<pre><code class="language-typescript">class Animal {
    name: string;
    constructor(theName: string) { this.name = theName; }
    move(distanceInMeters: number = 0) {
        console.log(`${this.name} moved ${distanceInMeters}m.`);
    }
}

class Snake extends Animal {
    constructor(name: string) { super(name); }
    move(distanceInMeters = 5) {
        console.log(&quot;Slithering...&quot;);
        super.move(distanceInMeters);
    }
}

class Horse extends Animal {
    constructor(name: string) { super(name); }
    move(distanceInMeters = 45) {
        console.log(&quot;Galloping...&quot;);
        super.move(distanceInMeters);
    }
}

let sam = new Snake(&quot;Sammy the Python&quot;);
let tom: Animal = new Horse(&quot;Tommy the Palomino&quot;);

sam.move();
tom.move(34);
</code></pre>
<p>åƒæ˜¯ Java å’Œ ES6 è¯­æ³•çš„æ··åˆã€‚å¾ˆå¥½çœ‹æ‡‚</p>
<p>å®šä¹‰åˆ° constructor ä¸­çš„å±æ€§ï¼Œéœ€è¦åœ¨ class çš„å¤§æ‹¬å·å†…è¡¨æ˜æ˜¯ä»€ä¹ˆç±»å‹çš„</p>
<h2 id="private-ä¿®é¥°ç¬¦">private ä¿®é¥°ç¬¦</h2>
<p>ç§æœ‰å±æ€§ä¿®é¥°ç¬¦ã€‚è¢«ä¿®é¥°å±æ€§åªèƒ½åœ¨å½“å‰ç±»ä¸­è¢«è®¿é—®ã€‚</p>
<pre><code class="language-typescript">class Animal {
    private name: string;
    constructor(theName: string) { this.name = theName; }
}

class Rhino extends Animal {
    constructor() { super(&quot;Rhino&quot;); }
}

class Employee {
    private name: string;
    constructor(theName: string) { this.name = theName; }
}

let animal = new Animal(&quot;Goat&quot;);
let rhino = new Rhino();
let employee = new Employee(&quot;Bob&quot;);

animal = rhino;
animal = employee; // é”™è¯¯: Animal ä¸ Employee ä¸å…¼å®¹.
</code></pre>
<p>åªæœ‰å½“ ç§æœ‰å±æ€§ æ¥æºäºåŒä¸€å¤„æ—¶ï¼Œæ‰å…¼å®¹</p>
<h2 id="protected-ä¿®é¥°ç¬¦">protected ä¿®é¥°ç¬¦</h2>
<p>ä¿æŠ¤å±æ€§ä¿®é¥°ç¬¦ã€‚è¢«ä¿®é¥°å±æ€§é™¤äº†èƒ½åœ¨å½“å‰ç±»è¢«è®¿é—®ï¼Œè¿˜å¯ä»¥è¢«æ´¾ç”Ÿç±»è®¿é—®</p>
<pre><code class="language-typescript">class Person {
    protected name: string;
    protected constructor(theName: string) { this.name = theName; }
}

// Employee èƒ½å¤Ÿç»§æ‰¿ Person
class Employee extends Person {
    private department: string;

    constructor(name: string, department: string) {
        super(name);
        this.department = department;
    }

    public getElevatorPitch() {
        return `Hello, my name is ${this.name} and I work in ${this.department}.`;
    }
}

let howard = new Employee(&quot;Howard&quot;, &quot;Sales&quot;);
let john = new Person(&quot;John&quot;); // é”™è¯¯: 'Person' çš„æ„é€ å‡½æ•°æ˜¯è¢«ä¿æŠ¤çš„.

</code></pre>
<h2 id="public-ä¿®é¥°ç¬¦">public ä¿®é¥°ç¬¦</h2>
<p>åœ¨å“ªéƒ½èƒ½è¢«è®¿é—®åˆ°ã€‚æ²¡æœ‰ä¿®é¥°ç¬¦æ—¶ï¼Œé»˜è®¤ä¸º public</p>
<h2 id="readonly-ä¿®é¥°ç¬¦">readonly ä¿®é¥°ç¬¦</h2>
<p>æ•°æ®åªè¯»ã€‚åªè¯»å±æ€§å¿…é¡»åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°é‡Œè¢«åˆå§‹åŒ–</p>
<h2 id="getset-å­˜å–å™¨">get/set å­˜å–å™¨</h2>
<p>ç®€å•çœ‹ä¸ªä¾‹å­å°±å¥½</p>
<pre><code class="language-typescript">let passcode = &quot;secret passcode&quot;;

class Employee {
    private _fullName: string;

    get fullName(): string {
        return this._fullName;
    }

    set fullName(newName: string) {
        if (passcode &amp;&amp; passcode == &quot;secret passcode&quot;) {
            this._fullName = newName;
        }
        else {
            console.log(&quot;Error: Unauthorized update of employee!&quot;);
        }
    }
}

let employee = new Employee();
employee.fullName = &quot;Bob Smith&quot;;
if (employee.fullName) {
    alert(employee.fullName);
}
</code></pre>
<h2 id="é™æ€å±æ€§">é™æ€å±æ€§</h2>
<p>é™æ€å±æ€§å­˜åœ¨äºç±»æœ¬èº«ä¸Šé¢è€Œä¸æ˜¯ç±»çš„å®ä¾‹ä¸Šã€‚</p>
<pre><code class="language-typescript">class Grid {
    static origin = {x: 0, y: 0};
    calculateDistanceFromOrigin(point: {x: number; y: number;}) {
        let xDist = (point.x - Grid.origin.x);
        let yDist = (point.y - Grid.origin.y);
        return Math.sqrt(xDist * xDist + yDist * yDist) / this.scale;
    }
    constructor (public scale: number) { }
}

let grid1 = new Grid(1.0);  // 1x scale
let grid2 = new Grid(5.0);  // 5x scale

console.log(grid1.calculateDistanceFromOrigin({x: 10, y: 10}));
console.log(grid2.calculateDistanceFromOrigin({x: 10, y: 10}));
</code></pre>
<p>æ”¹å†™æˆæˆ‘ä»¬å¸¸è§çš„ JavaScript å½¢å¼</p>
<pre><code class="language-javascript">function Grid (scale) {
  this.scale = scale
}

Grid.origin = { x:0, y:0} // è¿™ä¸ªå°±æ˜¯ TypeScript ä¸­çš„é™æ€å±æ€§

Grid.prototype.calculateDistanceFromOrigin = function (point) {
  ...
}

</code></pre>
<h2 id="æŠ½è±¡ç±»">æŠ½è±¡ç±»</h2>
<p>æŠ½è±¡ç±»åšä¸ºå…¶å®ƒæ´¾ç”Ÿç±»çš„åŸºç±»ä½¿ç”¨</p>
<pre><code class="language-typescript">abstract class Department {

    constructor(public name: string) {
    }

    printName(): void {
        console.log('Department name: ' + this.name);
    }

    abstract printMeeting(): void; // å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­å®ç°
}

class AccountingDepartment extends Department {

    constructor() {
        super('Accounting and Auditing'); // åœ¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨ super()
    }

    printMeeting(): void {
        console.log('The Accounting Department meets each Monday at 10am.');
    }

    generateReports(): void {
        console.log('Generating accounting reports...');
    }
}

let department: Department; // å…è®¸åˆ›å»ºä¸€ä¸ªå¯¹æŠ½è±¡ç±»å‹çš„å¼•ç”¨
department = new Department(); // é”™è¯¯: ä¸èƒ½åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»çš„å®ä¾‹
department = new AccountingDepartment(); // å…è®¸å¯¹ä¸€ä¸ªæŠ½è±¡å­ç±»è¿›è¡Œå®ä¾‹åŒ–å’Œèµ‹å€¼
department.printName();
department.printMeeting();
department.generateReports(); // é”™è¯¯: æ–¹æ³•åœ¨å£°æ˜çš„æŠ½è±¡ç±»ä¸­ä¸å­˜åœ¨
</code></pre>
<p>æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ä¸åŒ…å«å…·ä½“å®ç°å¹¶ä¸”å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­å®ç°.ç›¸å¯¹äºæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼ŒæŠ½è±¡ç±»å®šä¹‰æŠ½ç›¸å…³æ–¹æ³•ï¼Œéœ€è¦åŠ  abstract å…³é”®å­—ã€‚</p>
<p>æ¥å£ä¸æŠ½è±¡ç±»çš„åŒºåˆ«:æ¥å£ä¸­çš„å®šä¹‰å¿…é¡»åœ¨å…¶ç»§æ‰¿ä¸­è¿›è¡Œå®ç°ï¼Œæ¥å£ä¸­æœ¬èº«ä¸åŒ…å«å®ç°ï¼Œåªæœ‰å®šä¹‰ã€‚æŠ½è±¡ç±»ä¸­çš„æ™®é€šå‡½æ•°éœ€è¦å…·ä½“å®ç°ï¼ŒæŠ½è±¡å‡½æ•°åˆ™åœ¨æ´¾ç”Ÿå„ç±»ä¸­è¿›è¡Œå®ç°ã€‚</p>
<h2 id="å‡½æ•°">å‡½æ•°</h2>
<pre><code class="language-typescript">let myAdd: (x: number, y: number) =&gt; number = function (x: number, y: number): number { return x + y; };
</code></pre>
<p>çœ‹æ•™ç¨‹ä¸­ç»™å‡ºçš„è¿™ä¸ªå®ä¾‹ï¼Œä¸æ˜¯ç‰¹åˆ«å®¹æ˜“çœ‹æ‡‚</p>
<p>ä»¥ç­‰å·ä¸ºåˆ†ç•Œçº¿ã€‚å·¦è¾¹å®šä¹‰äº†ä¸€ä¸ªå˜é‡ myAdd , å†’å·åè¡¨æ˜äº†ç±»å‹:ä¸¤ä¸ª number å‚æ•°å’Œè¿”å› number ç±»å‹æ•°æ®</p>
<p><strong>åœ¨ TypeScript çš„ç±»å‹å®šä¹‰ä¸­ï¼Œ=&gt; ç”¨æ¥è¡¨ç¤ºå‡½æ•°çš„å®šä¹‰ï¼Œå·¦è¾¹æ˜¯è¾“å…¥ç±»å‹ï¼Œéœ€è¦ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œå³è¾¹æ˜¯è¾“å‡ºç±»å‹ã€‚</strong></p>
<p>å®Œæ•´çš„ä¸€ä¸ªå‡½æ•°åº”å½“æ˜¯ä¸Šé¢è¿™ç§å®šä¹‰ï¼Œä½†å¯ä»¥çœç•¥éƒ¨åˆ†</p>
<p>ä»£ç å¦‚ä¸‹:</p>
<pre><code class="language-typescript">// ç”±å³è¾¹å¯ä»¥æ¨æ–­å·¦è¾¹
let myAdd = function(x: number, y: number): number { return x + y; };

// ç”±å·¦è¾¹å¯ä»¥æ¨æ–­å³è¾¹
let myAdd: (baseValue: number, increment: number) =&gt; number =
    function(x, y) { return x + y; };
</code></pre>
<h3 id="å‰©ä½™å‚æ•°">å‰©ä½™å‚æ•°</h3>
<pre><code class="language-typescript">function buildName(firstName: string, ...restOfName: string[]) {
  return firstName + &quot; &quot; + restOfName.join(&quot; &quot;);
}

let buildNameFun: (fname: string, ...rest: string[]) =&gt; string = buildName;
</code></pre>
<p>æ³¨æ„ä¸ ES6 åŒºåˆ«åœ¨äºéœ€è¦è§„èŒƒ æ•°ç»„ç±»å‹</p>
<h3 id="this">this</h3>
<p>ç›´æ¥è°ƒç”¨ this æ—¶æ³¨æ„ this ä¸º any ç±»å‹ã€‚éœ€è¦æ‰‹åŠ¨æŒ‡å®šä¸€ä¸‹ this çš„ç±»å‹</p>
<p>å®ä¾‹å¦‚ä¸‹</p>
<pre><code class="language-typescript">interface Card {
    suit: string;
    card: number;
}
interface Deck {
    suits: string[];
    cards: number[];
    createCardPicker(this: Deck): () =&gt; Card;
}
let deck: Deck = {
    suits: [&quot;hearts&quot;, &quot;spades&quot;, &quot;clubs&quot;, &quot;diamonds&quot;],
    cards: Array(52),
    // NOTE: The function now explicitly specifies that its callee must be of type Deck
    createCardPicker: function(this: Deck) {
        return () =&gt; {
            let pickedCard = Math.floor(Math.random() * 52);
            let pickedSuit = Math.floor(pickedCard / 13);

            return {suit: this.suits[pickedSuit], card: pickedCard % 13};
        }
    }
}

let cardPicker = deck.createCardPicker();
let pickedCard = cardPicker();

alert(&quot;card: &quot; + pickedCard.card + &quot; of &quot; + pickedCard.suit);
</code></pre>
<p>æ–‡æ¡£ä¸­è¯´ç›´æ¥è°ƒç”¨ this ä¼šæŠ¥é”™ï¼Œä½†æ˜¯æˆ‘åœ¨å®é™…æµ‹è¯•ä¸­å¹¶æ²¡æœ‰å‘ç°è¿™ä¸ªé—®é¢˜...å®ä¾‹ä»£ç æ˜¯å¤„ç† this ä¹‹åçš„ä»£ç ã€‚å¯ä»¥ çœ‹åˆ°æ‰‹åŠ¨æŒ‡å®šäº†ä¸€æ³¢thisæ˜¯ä»€ä¹ˆ</p>
<h3 id="å‡½æ•°é‡è½½">å‡½æ•°é‡è½½</h3>
<p>ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œé‡è½½æ¦‚å¿µæ˜¯:åœ¨å‡½æ•°åç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ ¹æ®å‚æ•°ä¸ªæ•°ã€å‚æ•°ç±»å‹ä¸åŒçš„æƒ…å†µä¸‹è°ƒç”¨ä¸åŒçš„å‡½æ•°ã€‚</p>
<p>ä½†åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°åç›¸åŒçš„è¯ï¼Œä¼šå–æœ€åå®šä¹‰çš„å‡½æ•°ã€‚</p>
<p>TypeScript ä¸­å‡½æ•°é‡è½½æ˜¯ ç”³æ˜äº†ç›¸åŒå‡½æ•°åç§°ï¼Œåªæ˜¯å‚æ•°ç±»å‹ã€ä¸ªæ•°ã€è¿”å›ç±»å‹ä¸åŒã€‚å…·ä½“å‡½æ•°å®ç°è¿˜æ˜¯åªæœ‰ä¸€ä¸ªã€‚</p>
<pre><code class="language-typescript">let suits = [&quot;hearts&quot;, &quot;spades&quot;, &quot;clubs&quot;, &quot;diamonds&quot;];

// å®šä¹‰äº†ä¸¤ç§å‡½æ•°
// {suit: string; card: number; }[] è¡¨ç¤ºæ•°ç»„æ¯ä¸€é¡¹éƒ½æ˜¯ åŒ…å« suit å’Œ card çš„å¯¹è±¡
function pickCard(x: {suit: string; card: number; }[]): number;

function pickCard(x: number): {suit: string; card: number; };

// å‡½æ•°å…·ä½“å®ç°
function pickCard(x): any {

    if (typeof x == &quot;object&quot;) {
        let pickedCard = Math.floor(Math.random() * x.length);
        return pickedCard;
    }

    else if (typeof x == &quot;number&quot;) {
        let pickedSuit = Math.floor(x / 13);
        return { suit: suits[pickedSuit], card: x % 13 };
    }
}

let myDeck = [{ suit: &quot;diamonds&quot;, card: 2 }, { suit: &quot;spades&quot;, card: 10 }, { suit: &quot;hearts&quot;, card: 4 }];
let pickedCard1 = myDeck[pickCard(myDeck)];

alert(&quot;card: &quot; + pickedCard1.card + &quot; of &quot; + pickedCard1.suit);

let pickedCard2 = pickCard(15);
alert(&quot;card: &quot; + pickedCard2.card + &quot; of &quot; + pickedCard2.suit);
</code></pre>
<h2 id="æ³›å‹">æ³›å‹</h2>
<h3 id="æ³›å‹å˜é‡">æ³›å‹å˜é‡</h3>
<p>å…ˆçœ‹ä¾‹å­</p>
<pre><code class="language-typescript">function Test( ary: any ): any {
  return ary
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°éšè—äº†ä¸€äº›ä¿¡æ¯ã€‚æˆ‘ä»¬ä¼ å…¥ä¸€äº›å‚æ•°ï¼Œå¹¶ä¸çŸ¥é“å‡½æ•°ä¼šè¿”å›å“ªäº›ç±»å‹çš„æ•°æ®ã€‚</p>
<p>æ³›å‹å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„</p>
<p>å†çœ‹ç”¨æ³›å‹æ”¹å†™ä¹‹åçš„ä¾‹å­</p>
<pre><code class="language-typescript">function Test&lt;T&gt; (ary: T): T {
  return ary
}
</code></pre>
<p>Tä¸æŒ‡ä»£å…·ä½“çš„ç±»å‹ï¼Œåªè¡¨æ˜ç±»å‹ä¸€è‡´ã€‚</p>
<p>å‡½æ•°è°ƒç”¨ç¤ºä¾‹</p>
<pre><code class="language-typescript">const t = Test&lt;string&gt;(&quot;abcd&quot;)

// çœç•¥å†™æ³•å¦‚ä¸‹
const t2 = Test(&quot;abcd&quot;)
</code></pre>
<p>ç›¸è¾ƒäº any, åˆ©ç”¨æ³›å‹å¯ä»¥æ˜ç¡®è¿”å›ä»€ä¹ˆç±»å‹æ•°æ®</p>
<p>åŠ ä¸Š &lt;&gt; ä¹‹åï¼Œå¾ˆå®¹æ˜“å’Œ ç±»å‹æ–­è¨€ æ··äº†ï¼Œæ‰€ä»¥å¹³æ—¶ç”¨ ç±»å‹æ–­è¨€ æ—¶ï¼Œç”¨ as å½¢å¼</p>
<h3 id="æ³›å‹æ¥å£">æ³›å‹æ¥å£</h3>
<pre><code class="language-typescript">// ä»£ç 1
interface GenericIdentityFn {
    &lt;T&gt;(arg: T): T;
}

function identity&lt;T&gt;(arg: T): T {
    return arg;
}

let myIdentity: GenericIdentityFn = identity;
myIdentity(2)

// ä»£ç 2
interface GenericIdentityFn&lt;T&gt; {
    (arg: T): T;
}

function identity&lt;T&gt;(arg: T): T {
    return arg;
}

let myIdentity: GenericIdentityFn&lt;number&gt; = identity;
myIdentity(2)
</code></pre>
<p>ä»£ç 1 ä¸­å¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•°è‡ªåŠ¨æ¨æ–­å‡º T æ˜¯ä»€ä¹ˆç±»å‹çš„</p>
<p>ä»£ç 2 ç›¸è¾ƒäºä»£ç 1 æ³›å‹å‚æ•°å½“ä½œæ•´ä¸ªæ¥å£çš„ä¸€ä¸ªå‚æ•°ã€‚åœ¨å®šä¹‰ myIdentity æ—¶å°±æŒ‡å®š T æ˜¯ä»€ä¹ˆç±»å‹ï¼Œç›¸å¯¹æ¥è¯´ ä»£ç 2æ›´æ¸…æ™°</p>
<h3 id="æ³›å‹ç±»">æ³›å‹ç±»</h3>
<p>åŸæ–‡ç»™å‡ºçš„ä»£ç å¹¶ä¸èƒ½æ­£ç¡®è¿è¡Œï¼Œæˆ‘æ·»åŠ äº†ä¸€äº›å†…å®¹</p>
<pre><code class="language-typescript">const parm = '123'
class GenericNumber&lt;T&gt; {
  zeroValue: T;
  add: (x: T, y: T) =&gt; T;
  static n: T = &lt;T&gt;(parm)   // æŠ¥é”™
  constructor ( n: T) {
    this.zeroValue = n
    this.add = function (x, y) {
      return &lt;T&gt;(x)
    }
  }
}

let myGenericNumber = new GenericNumber&lt;number&gt;(1);
myGenericNumber.zeroValue = 0;
myGenericNumber.add = function (x, y) { return x + y; };
</code></pre>
<p>å…¶å®åˆ°è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºï¼Œæ³›å‹å…¶å®å°±æ˜¯ç»Ÿä¸€ç±»å‹ç”¨çš„ã€‚</p>
<p>æ³›å‹ç±»æŒ‡çš„æ˜¯å®ä¾‹éƒ¨åˆ†çš„ç±»å‹ï¼Œç±»çš„é™æ€å±æ€§ä¸èƒ½ä½¿ç”¨æ³›å‹ç±»å‹</p>
<h3 id="æ³›å‹çº¦æŸ">æ³›å‹çº¦æŸ</h3>
<pre><code class="language-typescript">interface Lengthwise {
    length: number;
}

function loggingIdentity&lt;T extends Lengthwise&gt;(arg: T): T {
    console.log(arg.length);  // Now we know it has a .length property, so no more error
    return arg;
}
</code></pre>
<p>å¦‚ä»£ç æ‰€ç¤ºã€‚æ³›å‹çº¦æŸè§„èŒƒä¼ å…¥çš„ T ç±»å‹å…·æœ‰ä»€ä¹ˆæ ·çš„ç‰¹å¾ã€‚ç¤ºä¾‹ä»£ç éœ€è¦ä¼ å…¥å…·æœ‰ length å±æ€§çš„ç±»å‹æ•°æ®</p>
<h3 id="åœ¨æ³›å‹ä¸­ä½¿ç”¨ç±»ç±»å‹">åœ¨æ³›å‹ä¸­ä½¿ç”¨ç±»ç±»å‹</h3>
<p>çœ‹ä»£ç </p>
<pre><code class="language-typescript">class BeeKeeper {
    hasMask: boolean;
}

class ZooKeeper {
    nametag: string;
}

class Animal {
    numLegs: number;
}

class Bee extends Animal {
    keeper: BeeKeeper;
}

class Lion extends Animal {
    keeper: ZooKeeper;
}

function createInstance&lt;A extends Animal&gt;(c: new () =&gt; A): A {
    return new c();
}

createInstance(Lion).keeper.nametag;  // typechecks!
createInstance(Bee).keeper.hasMask;   // typechecks!
</code></pre>
<p>é¦–å…ˆä»£ç å®šä¹‰äº†5ä¸ªç±»ï¼Œç±»ä¸­åˆ†åˆ«å®šä¹‰äº†å±æ€§(ç¤ºä¾‹ä»£ç ä¸å®Œæ•´ï¼Œç¼º constructor).</p>
<p>è§‚å¯Ÿ Bee å’Œ Lionï¼Œå¯ä»¥å‘ç°ä¸¤è€…å‡ç»§æ‰¿è‡ª Animal ç±»ï¼Œç”±æ­¤ï¼ŒäºŒè€…å‡å¯ä»¥è°ƒç”¨ Animal ç±»ä¸­çš„å…¬æœ‰å±æ€§ numLegsã€‚å†çœ‹ Bee ä¸­çš„  keep , æ•°æ®ç±»å‹ä¸º BeeKeeper, ç”±æ­¤ ç”±Bee åˆ›å»ºçš„å®ä¾‹å¯ä»¥é€šè¿‡ keeper æ¥è°ƒç”¨ BeeKeeper ä¸­çš„æ•°æ®ã€‚LionåŒç†</p>
<p>å†çœ‹ createInstance å‡½æ•°ï¼Œä½¿ç”¨æ³›å‹çº¦æŸ ä¼ å…¥çš„ç±»å‹å¿…é¡»å…·æœ‰ Animal ç±»ä¸­çš„ numLegs å±æ€§ã€‚å› ä¸º Bee å’Œ Lion å‡ç»§æ‰¿è‡ª Animalï¼Œæ‰€æœ‰éƒ½æœ‰è¿™ä¸ªå±æ€§ã€‚çœ‹å‡½æ•°å‚æ•°cæ˜¯ä¸€ä¸ª Aç±»å‹çš„æ„é€ å‡½æ•°</p>
<h2 id="æšä¸¾-2">æšä¸¾</h2>
<p><a href="part-1.md">åŸºç¡€ç±»å‹</a> ä¸­ç®€å•ä»‹ç»äº†æšä¸¾ç±»å‹ã€‚</p>
<p>çœ‹ä»£ç </p>
<pre><code class="language-typescript">enum Color {
  Green,
  Blue,
  Red
}
</code></pre>
<p>ä½¿ç”¨ enum å…³é”®å­—å®šä¹‰ä¸€ä¸ª æšä¸¾ç±»å‹ æ•°æ®ç»“æ„ã€‚</p>
<p>ä½¿ç”¨ç¤ºä¾‹:</p>
<pre><code class="language-typescript">const red: string = Color[2]

const color: number = Color.Red
</code></pre>
<p>å¦‚ä¸Šçš„å®šä¹‰ Color ä»£ç ï¼Œé»˜è®¤ä½¿ç”¨ 0,1,2...é€’å¢ç¼–å·ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šç¼–å·</p>
<p>å¦‚ä¸‹</p>
<pre><code class="language-typescript">enum Color {
  Green= 2,
  Blue= 4,
  Red
}
</code></pre>
<p>åŸæ–‡ä»£ç ä¸­ç»™å‡ºè¿™æ ·ä¸€ä¸ªä¾‹å­</p>
<pre><code class="language-typescript">enum Response {
  No = 0,
  Yes = 1,
}

function respond(recipient: string, message: Response): void {
  // ...
}

respond(&quot;Princess Caroline&quot;, Response.Yes)

</code></pre>
<p>å°è¯•å°†å‡½æ•°å‚æ•°ä¸­çš„ Response æ”¹ä¸º number, ç»“æœè¿˜æ˜¯æ­£ç¡®çš„</p>
<pre><code class="language-typescript">const message: Response = 1
</code></pre>
<p>è¿™å°±è¯´æ˜<strong>æ•°å­—ç±»å‹ä¸æšä¸¾ç±»å‹å…¼å®¹</strong></p>
<h3 id="å­—ç¬¦ä¸²æšä¸¾">å­—ç¬¦ä¸²æšä¸¾</h3>
<p>ä¸Šé¢æ˜¯ä½¿ç”¨æ•°å­—ç¼–å·è¿›è¡Œå¼•ç´¢ï¼Œå®é™…è¿˜å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æšä¸¾</p>
<pre><code class="language-typescript">enum Color {
  Green='This is green',
  Blue='This is blue',
  Red='this is red'
}
</code></pre>
<h3 id="è®¡ç®—çš„å’Œå¸¸é‡æˆå‘˜">è®¡ç®—çš„å’Œå¸¸é‡æˆå‘˜</h3>
<pre><code class="language-typescript">enum FileAccess {
    None,
    Read = 1 &lt;&lt; 1,
    Write = 1 &lt;&lt; 2,
    ReadWrite  = Read | Write,
    G = &quot;123&quot;.length
}
</code></pre>
<p><code>&lt;&lt;</code>æ˜¯ js ä¸­çš„ä½ç§»è¿ç®—ç¬¦ï¼Œ <code>|</code> æ˜¯æˆ–è¿ç®—ç¬¦</p>
<h2 id="ç±»å‹æ¨è®º">ç±»å‹æ¨è®º</h2>
<h3 id="æœ€ä½³é€šç”¨ç±»å‹">æœ€ä½³é€šç”¨ç±»å‹</h3>
<p>çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<pre><code class="language-typescript">let x = [1, '2']  // æ­£ç¡®

x = [true, '3'] // é”™è¯¯
</code></pre>
<p>å®šä¹‰æ—¶æ²¡æœ‰ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨æ–­ x æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p>
<p>ä»£ç ä¸­ x è¢«æ¨æ–­ä¸º å…ƒç»„ <code>[number, string]</code>, æ‰€ä»¥ x èµ‹å€¼ <code>[true, '3']</code> å¤±è´¥</p>
<p>å†çœ‹è¿™ä¸ª</p>
<pre><code class="language-typescript">let zoo = [new Rhino(), new Elephant(), new Snake()];
</code></pre>
<p>ä¼šè¢«æ¨æ–­ä¸ºè”åˆæ•°ç»„ç±»å‹</p>
<p>ç›¸å½“äº</p>
<pre><code class="language-typescript">let zoo:(Rhino, Elephant, Snake)[] = [new Rhino(), new Elephant(), new Snake()];
</code></pre>
<h2 id="ç±»å‹å…¼å®¹æ€§">ç±»å‹å…¼å®¹æ€§</h2>
<p>TypeScripté‡Œçš„ç±»å‹å…¼å®¹æ€§æ˜¯åŸºäºç»“æ„å­ç±»å‹çš„ã€‚ ç»“æ„ç±»å‹æ˜¯ä¸€ç§åªä½¿ç”¨å…¶æˆå‘˜æ¥æè¿°ç±»å‹çš„æ–¹å¼ã€‚ å®ƒæ­£å¥½ä¸åä¹‰ï¼ˆnominalï¼‰ç±»å‹å½¢æˆå¯¹æ¯”ã€‚åœ¨åŸºäºåä¹‰ç±»å‹çš„ç±»å‹ç³»ç»Ÿä¸­ï¼Œæ•°æ®ç±»å‹çš„å…¼å®¹æ€§æˆ–ç­‰ä»·æ€§æ˜¯é€šè¿‡æ˜ç¡®çš„å£°æ˜å’Œ/æˆ–ç±»å‹çš„åç§°æ¥å†³å®šçš„ã€‚è¿™ä¸ç»“æ„æ€§ç±»å‹ç³»ç»Ÿä¸åŒï¼Œå®ƒæ˜¯åŸºäºç±»å‹çš„ç»„æˆç»“æ„ï¼Œä¸”ä¸è¦æ±‚æ˜ç¡®åœ°å£°æ˜ã€‚</p>
<p>è¿˜æ˜¯ç»™ä¸€äº›å®ä¾‹ä»£ç è‡ªå·±çœ‹</p>
<pre><code class="language-typescript">// æ¡ˆä¾‹1
interface Named {
    name: string;
}

class Person {
    name: string;
}

let p: Named;
p = new Person(); // æ­£ç¡®

// æ¡ˆä¾‹2
interface Named {
    name: string;
}

let x: Named;
let y = { name: 'Alice', location: 'Seattle' };
x = y;

// æ¡ˆä¾‹3
let x = (a: number) =&gt; 0;
let y = (b: number, s: string) =&gt; 0;

y = x; // æ­£ç¡®
x = y; // é”™è¯¯

// æ¡ˆä¾‹4
interface Named {
    name: string;
}

class Person {
    name: number;
}

let p: Named;
p = new Person(); // é”™è¯¯

</code></pre>
<p>æ¡ˆä¾‹1 ä¸­ Named æ¥å£ä¸ Person ç±»å…·æœ‰ç›¸åŒçš„ç»„æˆç»“æ„ï¼Œæ‰€ä»¥å…è®¸èµ‹å€¼</p>
<p>æ¡ˆä¾‹2 ä¸­ <code>{ name: 'Alice', location: 'Seattle' }</code>ä¸­åŒ…å«äº† x ä¸­éœ€è¦çš„ name å±æ€§ï¼Œæ‰€ä»¥å…è®¸èµ‹å€¼</p>
<p>æ¡ˆä¾‹3 ä¸­ å‡½æ•°å‚æ•° æ¯”è¾ƒäºŒè€…å¯¹åº”ä½ç½®çš„å‚æ•°ç±»å‹æ˜¯å¦ç›¸åŒã€‚</p>
<p>x å‡½æ•°çš„å‚æ•°ç±»å‹éƒ½èƒ½åœ¨ y å‡½æ•°ä¸­æ‰¾åˆ°å¯¹åº”ç±»å‹ã€‚æ‰€ä»¥å¯ä»¥å…¼å®¹ã€‚è¿™é‡Œæ³¨æ„ä¸ æ¡ˆä¾‹2 çš„åŒºåˆ«ï¼Œæ¡ˆä¾‹2 æ˜¯å³è¾¹å¤šï¼Œä½†æ¡‰æ ‘è¿™é‡Œæ˜¯å·¦è¾¹å¤š</p>
<p>æ¡ˆä¾‹4 ä¸­ è™½ç„¶äºŒè€…éƒ½æœ‰ name å±æ€§ï¼Œä½†ç±»å‹ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ä¸å…¼å®¹</p>
<h3 id="æšä¸¾-3">æšä¸¾</h3>
<p>æšä¸¾ç±»å‹ä¸æ•°å­—ç±»å‹å…¼å®¹ï¼Œå¹¶ä¸”æ•°å­—ç±»å‹ä¸æšä¸¾ç±»å‹å…¼å®¹ã€‚ä¸åŒæšä¸¾ç±»å‹ä¹‹é—´æ˜¯ä¸å…¼å®¹çš„ã€‚</p>
<h3 id="ç±»-2">ç±»</h3>
<p>ç±»ä¸å¯¹è±¡å­—é¢é‡å’Œæ¥å£å·®ä¸å¤šï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼šç±»æœ‰é™æ€éƒ¨åˆ†å’Œå®ä¾‹éƒ¨åˆ†çš„ç±»å‹ã€‚ <strong>æ¯”è¾ƒä¸¤ä¸ªç±»ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œåªæœ‰å®ä¾‹çš„æˆå‘˜ä¼šè¢«æ¯”è¾ƒ</strong>ã€‚ é™æ€æˆå‘˜å’Œæ„é€ å‡½æ•°ä¸åœ¨æ¯”è¾ƒçš„èŒƒå›´å†…ã€‚</p>
<p>å®ä¾‹éƒ¨åˆ†æ˜¯åªæœ‰åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œæ‰åˆå§‹åŒ–çš„æ•°æ®ï¼Œé™æ€éƒ¨åˆ†å°±æ˜¯å°†å±æ€§ç›´æ¥æŒ‚åœ¨åˆ°æ„é€ å‡½æ•°ä¸Š(åœ¨ TypeScript ä¸­é™æ€éƒ¨åˆ†ä½¿ç”¨å…³é”®å­— static æ ‡è¯†)ã€‚</p>
<pre><code class="language-typescript">class Animal{
  name: string
  static age: number = 12
  constructor (n: string) {
    this.name = n
  }
  setName (name: string) {
    this.name = name
  }
}

class Person{
  name: string
  static aged: number = 100
  constructor(n: string, age?: number ) {
    this.name = n
  }
  setName (name: string) {
    this.name = name
  }
}

let an: Animal = new Animal('1')
let pn: Person = new Person('2')

pn = an // æ­£ç¡®
</code></pre>
<p>æ³¨æ„ä¸Šé¢ä»£ç ä¸­ name å±æ€§å®é™…æ˜¯ public ç±»å‹ï¼Œå½“æ”¹ä¸º private æˆ–è€… protected æ—¶å°±æŠ¥é”™äº†ã€‚ä½†å¦‚æœ Animal å’Œ Person ç±»ä¸­çš„ name å‡ç»§æ‰¿è‡ªçˆ¶ç±»ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆå…¼å®¹äº†ã€‚</p>
<h2 id="é«˜çº§ç±»å‹">é«˜çº§ç±»å‹</h2>
<h3 id="äº¤å‰ç±»å‹">äº¤å‰ç±»å‹</h3>
<p>è¿™ç§ç±»å‹å®é™…ä¸­æ²¡è§è¿‡ç”¨ã€‚ã€‚è¿™é‡Œè¿˜æ˜¯æ”¾ä¸€ä¸‹ä»£ç ï¼Œè‡ªå·±çœ‹</p>
<pre><code class="language-typescript">function extend&lt;T, U&gt;(first: T, second: U): T &amp; U {
    let result = &lt;T &amp; U&gt;{};
    for (let id in first) {
        (&lt;any&gt;result)[id] = (&lt;any&gt;first)[id];
    }
    for (let id in second) {
        if (!result.hasOwnProperty(id)) {
            (&lt;any&gt;result)[id] = (&lt;any&gt;second)[id];
        }
    }
    return result;
}

class Person {
    constructor(public name: string) { }
}
interface Loggable {
    log(): void;
}
class ConsoleLogger implements Loggable {
    log() {
        // ...
    }
}
var jim = extend(new Person(&quot;Jim&quot;), new ConsoleLogger());
var n = jim.name;
jim.log();
</code></pre>
<p>çœ‹ä¸€ä¸‹è¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„</p>
<p>ç”¨ ES6 æ”¹å†™ä¸€ä¸‹</p>
<pre><code class="language-typescript">class Person {
  constructor (name) {
    this.name = name
  }
}

class ConsoleLogger {
  log () {
    // ...
  }
}

function extend (obj1, obj2) {
  const result = {}
  for (let i in obj1) {
    result[i] = obj1[i]
  }
  for (let i in obj2) {
    result[i] = obj2[i]
  }
  return result
}

</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»£ç å®é™…åœ¨ extend å‡½æ•°ä¸­åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡é›†åˆäº† obj1,obj2 ä¸­æ‰€æœ‰å¯éå†çš„å±æ€§</p>
<h3 id="è”åˆç±»å‹">è”åˆç±»å‹</h3>
<p>è”åˆç±»å‹è¡¨ç¤ºä¸€ä¸ªå€¼å¯ä»¥æ˜¯å‡ ç§ç±»å‹ä¹‹ä¸€ã€‚ ç”¨ç«–çº¿ | åˆ†éš”æ¯ä¸ªç±»å‹ï¼Œæ‰€ä»¥ number | string | boolean è¡¨ç¤ºä¸€ä¸ªå€¼å¯ä»¥æ˜¯ numberï¼Œ stringï¼Œæˆ– booleanã€‚</p>
<pre><code class="language-typescript">interface Bird {
    fly();
    layEggs();
}

interface Fish {
    swim();
    layEggs();
}

function getSmallPet(): Fish | Bird {
    // ...
}

let pet = getSmallPet();
pet.layEggs(); // æ­£ç¡®
pet.swim();    // å¤±è´¥
</code></pre>
<p>å¦‚æœä¸€ä¸ªå€¼æ˜¯è”åˆç±»å‹ï¼Œæˆ‘ä»¬åªèƒ½è®¿é—®æ­¤è”åˆç±»å‹çš„æ‰€æœ‰ç±»å‹é‡Œå…±æœ‰çš„æˆå‘˜ã€‚</p>
<h3 id="ç±»å‹ä¿æŠ¤ä¸åŒºåˆ†ç±»å‹">ç±»å‹ä¿æŠ¤ä¸åŒºåˆ†ç±»å‹</h3>
<p>çœ‹ç¤ºä¾‹ä»£ç </p>
<pre><code class="language-typescript">let pet = getSmallPet();

// æ¯ä¸€ä¸ªæˆå‘˜è®¿é—®éƒ½ä¼šæŠ¥é”™,å› ä¸ºæˆ‘ä»¬åªèƒ½è®¿é—®æ­¤è”åˆç±»å‹çš„æ‰€æœ‰ç±»å‹é‡Œå…±æœ‰çš„æˆå‘˜
if (pet.swim) {
    pet.swim();
}
else if (pet.fly) {
    pet.fly();
}

</code></pre>
<p>å¦‚æœæƒ³è¦è®¿é—®åˆ°çš„è¯ï¼Œéœ€è¦è¿›è¡Œ ç±»å‹æ–­è¨€</p>
<pre><code class="language-typescript">let pet = getSmallPet();

if ((&lt;Fish&gt;pet).swim) {
    (&lt;Fish&gt;pet).swim();
}
else {
    (&lt;Bird&gt;pet).fly();
}
</code></pre>
<h3 id="ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ä¿æŠ¤">ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ä¿æŠ¤</h3>
<p>å¦‚ä½•åœ¨ç±»å‹æ£€æŸ¥åï¼Œèƒ½å¤Ÿæ¸…æ¥šçš„çŸ¥é“æ˜¯ä»€ä¹ˆç±»å‹å‘¢?</p>
<p>çœ‹ä¸‹é¢ä»£ç </p>
<pre><code class="language-typescript">function isFish(pet: Fish | Bird): pet is Fish {
    return (&lt;Fish&gt;pet).swim !== undefined;
}

if (isFish(pet)) {
    pet.swim();
}
else {
    pet.fly();
}

</code></pre>
<p>pet is Fishå°±æ˜¯ç±»å‹è°“è¯ã€‚è°“è¯ä¸º parameterName is Typeè¿™ç§å½¢å¼</p>
<p>å¦‚ä¸Šä»£ç åªèƒ½è¯†åˆ« Fish, å¦‚æœè¦è¯†åˆ« Bird è¿˜éœ€è¦å†™ä¸ªå‡½æ•°</p>
<pre><code class="language-typescript">function isBird(pet: Fish | Bird): pet is Bird {
    return (&lt;Bird&gt;pet).fly !== undefined;
}
</code></pre>
<p>è¿™æ ·ä»£ç é‡å¢åŠ äº†å¥½å¤šã€‚äºæ˜¯æœ‰äº†ä¸‹é¢çš„ typeof ç±»å‹ ä¿æŠ¤</p>
<h3 id="typeof-ç±»å‹ä¿æŠ¤">typeof ç±»å‹ä¿æŠ¤</h3>
<pre><code class="language-typescript">function padLeft(value: string, padding: string | number) {
    if (typeof padding === &quot;number&quot;) {
        return Array(padding + 1).join(&quot; &quot;) + value;
    }
    if (typeof padding === &quot;string&quot;) {
        return padding + value;
    }
    throw new Error(`Expected string or number, got '${padding}'.`);
}
</code></pre>
<p>&quot;typename&quot;å¿…é¡»æ˜¯ &quot;number&quot;ï¼Œ &quot;string&quot;ï¼Œ &quot;boolean&quot;æˆ– &quot;symbol&quot;</p>
<h3 id="instanceof-ç±»å‹ä¿æŠ¤">instanceof ç±»å‹ä¿æŠ¤</h3>
<p>ä¸ typeof ç›¸ä¼¼</p>
<pre><code class="language-typescript">interface Padder {
    getPaddingString(): string
}

class SpaceRepeatingPadder implements Padder {
    constructor(private numSpaces: number) { }
    getPaddingString() {
        return Array(this.numSpaces + 1).join(&quot; &quot;);
    }
}

class StringPadder implements Padder {
    constructor(private value: string) { }
    getPaddingString() {
        return this.value;
    }
}

function getRandomPadder() {
    return Math.random() &lt; 0.5 ?
        new SpaceRepeatingPadder(4) :
        new StringPadder(&quot;  &quot;);
}

// ç±»å‹ä¸ºSpaceRepeatingPadder | StringPadder
let padder: Padder = getRandomPadder();

if (padder instanceof SpaceRepeatingPadder) {
    padder; // ç±»å‹ç»†åŒ–ä¸º'SpaceRepeatingPadder'
}
if (padder instanceof StringPadder) {
    padder; // ç±»å‹ç»†åŒ–ä¸º'StringPadder'
}
</code></pre>
<h3 id="ç±»å‹åˆ«å">ç±»å‹åˆ«å</h3>
<p>ç±»å‹åˆ«åä¼šç»™ä¸€ä¸ªç±»å‹èµ·ä¸ªæ–°åå­—<br>
çœ‹ä¾‹å­</p>
<pre><code class="language-typescript">type Name = string;
type NameResolver = () =&gt; string;
type NameOrResolver = Name | NameResolver;
type Container&lt;T&gt; = { value: T };
type Tree&lt;T&gt; = {
    value: T;
    left?: Tree&lt;T&gt;;
    right?: Tree&lt;T&gt;;
}

type Easing = &quot;ease-in&quot; | &quot;ease-out&quot; | &quot;ease-in-out&quot;

</code></pre>
<p>ä¸æ¥å£åŒºåˆ«:</p>
<p>1ã€ç±»å‹åˆ«åä¸èƒ½è¢« extendså’Œ implements</p>
<p>2ã€æ¥å£åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åå­—ï¼Œå¯ä»¥åœ¨å…¶å®ƒä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œç±»å‹åˆ«åå¹¶ä¸åˆ›å»ºæ–°åå­—</p>
<h3 id="thiså¤šæ€">thiså¤šæ€</h3>
<pre><code class="language-typescript">class BasicCalculator {
    public constructor(protected value: number = 0) { }
    public currentValue(): number {
        return this.value;
    }
    public add(operand: number): this {
        this.value += operand;
        return this;
    }
    public multiply(operand: number): this {
        this.value *= operand;
        return this;
    }
    // ... other operations go here ...
}

let v = new BasicCalculator(2)
            .multiply(5)
            .add(1)
            .currentValue();

class ScientificCalculator extends BasicCalculator {
    public constructor(value = 0) {
        super(value);
    }
    public sin() {
        this.value = Math.sin(this.value);
        return this;
    }
    // ... other operations go here ...
}

let v = new ScientificCalculator(2)
        .multiply(5)
        .sin()
        .add(1)
        .currentValue();

</code></pre>
<h3 id="ç´¢å¼•ç±»å‹">ç´¢å¼•ç±»å‹</h3>
<pre><code class="language-typescript">function pluck&lt;T, K extends keyof T&gt;(o: T, names: K[]): T[K][] {
  return names.map(n =&gt; o[n]);
}

interface Person {
    name: string;
    age: number;
}
let person: Person = {
    name: 'Jarid',
    age: 35
};
let strings: string[] = pluck(person, ['name']); // ok, string[]
</code></pre>
<p><strong>keyof T</strong> ç´¢å¼•ç±»å‹æŸ¥è¯¢æ“ä½œç¬¦ã€‚å¯¹äºä»»ä½•ç±»å‹ Tï¼Œ keyof Tçš„ç»“æœä¸º Tä¸Šå·²çŸ¥çš„å…¬å…±å±æ€§åçš„è”åˆ</p>
<p>ä¾‹å¦‚:</p>
<pre><code class="language-typescript">let personProps: keyof Person; // 'name' | 'age'
</code></pre>
<h3 id="æ˜ å°„ç±»å‹">æ˜ å°„ç±»å‹</h3>
<p>ç”¨å¤„åœ¨äº å°†ä¸€ä¸ªå·²çŸ¥çš„ç±»å‹æ¯ä¸ªå±æ€§éƒ½å˜ä¸ºå¯é€‰çš„</p>
<pre><code class="language-typescript">type Readonly&lt;T&gt; = {
    readonly [P in keyof T]: T[P];
}
type Partial&lt;T&gt; = {
    [P in keyof T]?: T[P];
}
type PersonPartial = Partial&lt;Person&gt;;
type ReadonlyPerson = Readonly&lt;Person&gt;;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åˆ©ç”¨æ ‘è“æ´¾æ­å»ºä¸ªäººæœåŠ¡å™¨]]></title>
        <id>https://aiyou.life/post/4xGLEq7xe/</id>
        <link href="https://aiyou.life/post/4xGLEq7xe/">
        </link>
        <updated>2019-11-21T02:41:18.000Z</updated>
        <summary type="html"><![CDATA[<p>å¤§å­¦æ—¶ç”¨çš„è…¾è®¯äº‘ä¼˜æƒ åˆ°æœŸäº†ï¼Œç»­è´¹è¦æ¯ä¸ªæœˆ60å¤šå—é’±ï¼Œæœ‰ç‚¹è‚‰ç–¼ã€‚å› è€Œä¹°äº†ä¸€å—æ ‘è“æ´¾ï¼Œæƒ³è¦ç ”ç©¶ä¸€ä¸‹æ€ä¹ˆå°†ä»–ææˆä¸€ä¸ªæœåŠ¡å™¨ã€‚æ‹–æ‹‰äº†å‡ ä¸ªæœˆï¼Œæœ€è¿‘æ€»ç®—æ˜¯æå¥½äº†ã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ä¸‹æˆ‘çš„æ­å»ºè¿‡ç¨‹ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¤§å­¦æ—¶ç”¨çš„è…¾è®¯äº‘ä¼˜æƒ åˆ°æœŸäº†ï¼Œç»­è´¹è¦æ¯ä¸ªæœˆ60å¤šå—é’±ï¼Œæœ‰ç‚¹è‚‰ç–¼ã€‚å› è€Œä¹°äº†ä¸€å—æ ‘è“æ´¾ï¼Œæƒ³è¦ç ”ç©¶ä¸€ä¸‹æ€ä¹ˆå°†ä»–ææˆä¸€ä¸ªæœåŠ¡å™¨ã€‚æ‹–æ‹‰äº†å‡ ä¸ªæœˆï¼Œæœ€è¿‘æ€»ç®—æ˜¯æå¥½äº†ã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ä¸‹æˆ‘çš„æ­å»ºè¿‡ç¨‹ã€‚</p>
<!-- more -->
<h2 id="ç‰©æ–™å‡†å¤‡">ç‰©æ–™å‡†å¤‡</h2>
<blockquote>
<ul>
<li>æœåŠ¡å™¨ä¸€å°ã€‚æˆ‘ä½¿ç”¨æ ‘è“æ´¾å½“æœåŠ¡å™¨ã€‚å¯¹äºæ€§èƒ½æœ‰éœ€æ±‚çš„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç”µè„‘ä¸»æœºæˆ–è€…ä¹°å°ç‰©ç†æœåŠ¡å™¨ã€‚æ³¨æ„å¹³è¡¡å¥½åŠŸè€—ä¸æ€§èƒ½çš„å…³ç³»ï¼Œæ¯•ç«Ÿä¸€å°ç”µè„‘ä¸»æœºæˆ–ç‰©ç†æœº24å°æ—¶å¼€æœºï¼Œè€—ç”µé‡ä¹Ÿä¸å°ã€‚</li>
<li>æ™ºèƒ½è·¯ç”±å™¨ä¸€å°ã€‚æˆ‘å®¶ç”¨çš„æ–è®¯K2ï¼Œåˆ·äº†æ½˜å¤šæ‹‰ç³»ç»Ÿã€‚æ™ºèƒ½è·¯ç”±å™¨æ„å‘³ç€ç³»ç»Ÿæ˜¯åŸºäºOpenWrtçš„ï¼Œå¯ä»¥å®‰è£…å„ç§è½¯ä»¶ã€‚</li>
<li>äº’è”ç½‘ã€‚è¿™é‡Œå•ç‹¬åˆ—å‡ºæ¥ï¼Œæ˜¯å› ä¸ºå¯¹äº’è”ç½‘ä¹Ÿæœ‰è¦æ±‚ã€‚ç½‘ç»œéœ€è¦æœ‰å…¬ç½‘IP,æœ€å¥½å¼€æ”¾äº†80ç«¯å£ã€‚å¾ˆå¤šäº’è”ç½‘æœåŠ¡æä¾›å•†(ISP)ç»™ç”¨æˆ·æä¾›çš„éƒ½æ˜¯ç»è¿‡NATè½¬å‘çš„å†…ç½‘åœ°å€ï¼Œå¹¶ä¸”å±è”½äº†80ç«¯å£ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ‰“ç”µè¯åˆ°ISPå®¢æœè¦æ±‚ç»™è°ƒæˆå…¬ç½‘IPå’Œå¼€æ”¾80ç«¯å£ã€‚å½“ç„¶å®åœ¨è°ƒä¸äº†ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½‘ç©¿é€æ¥è§£å†³å…¬ç½‘IPçš„é—®é¢˜ï¼Œä½†ç«¯å£å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œè®¿é—®çš„æ—¶å€™ï¼Œåªèƒ½é…åˆç«¯å£æ¥è®¿é—®ã€‚</li>
</ul>
</blockquote>
<p>å½“ç„¶ï¼ŒæœåŠ¡å™¨ç›´è¿äº’è”ç½‘ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™æ ·çš„è¯ï¼Œæ­å»ºè¿‡ç¨‹æ›´ç®€ä¾¿ï¼Œç¼ºç‚¹æ˜¯ç½‘ç»œåˆ©ç”¨ç‡ä½ã€‚</p>
<h2 id="åœ°å€è§£æ">åœ°å€è§£æ</h2>
<p>å°½ç®¡ISPåˆ†é…ç»™æˆ‘ä»¬äº†å…¬ç½‘IPï¼Œä½†å¾ˆå¤§ç¨‹åº¦ä¸Šå…¬ç½‘IPæ˜¯éšç€æ¯æ¬¡æ‹¨å·ä¼šä¸åœå˜åŠ¨(æ¯”å¦‚å®¶é‡Œåœç”µã€é‡å¯è·¯ç”±å™¨ç­‰éƒ½ä¼šé‡æ–°æ‹¨å·)ï¼Œæ¯æ¬¡æ‹¿åˆ°çš„å°†æ˜¯ä¸€ä¸ªæ–°çš„å…¬ç½‘IPã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸¤ä¸ªç«¯é€šä¿¡çš„å‰ææ˜¯çŸ¥é“å¯¹æ–¹çš„IPåœ°å€ï¼ŒIPåœ°å€å˜åŠ¨çš„è¯ï¼Œå°†ä¸èƒ½é€šä¿¡ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­:æˆ‘å’Œå°æ˜ç»å¸¸æ‰“ç”µè¯ï¼Œæœ‰ä¸€å¤©å°æ˜æŠŠç”µè¯å·æ¢äº†ï¼Œæˆ‘æ‰“ä»–åŸæ¥çš„ç”µè¯å·ï¼Œå°±å¯èƒ½æ— äººæ¥å¬æˆ–è€…è¢«å…¶ä»–é™Œç”Ÿäººæ¥åˆ°äº†ï¼Œé‚£åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘åªèƒ½å»ä»–å®¶è·‘ä¸€è¶Ÿï¼Œé—®é—®ä»–çš„æ–°ç”µè¯å·ï¼Œä»¥åæˆ‘ä¿©å°±åˆèƒ½äº’ç›¸æ‰“ç”µè¯äº†ã€‚åŸŸåå°±æ˜¯ä»–çš„å®¶åº­åœ°å€ï¼ŒIPå°±æ˜¯ç”µè¯å·ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®åŸŸåé€šè¿‡DNSæœåŠ¡æ¥è·å–IPã€‚æœ‰äººå¯èƒ½ä¼šç–‘æƒ‘ï¼Œå…¬ç½‘IPå˜åŠ¨åï¼ŒåŸŸåæ˜¯æ€ä¹ˆçŸ¥é“ä½ çš„IPå˜åŠ¨å‘¢?</p>
<h3 id="ddns">DDNS</h3>
<p>DNSæˆ‘ä»¬éƒ½çŸ¥é“æ˜¯ç”¨æ¥å°†åŸŸåè§£ææˆIPçš„ã€‚é‚£DDNSæ˜¯ä»€ä¹ˆ?DDNSï¼ˆDynamic Domain Name Serverï¼ŒåŠ¨æ€åŸŸåæœåŠ¡ï¼‰æ˜¯å°†ç”¨æˆ·çš„åŠ¨æ€IPåœ°å€æ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šçš„åŸŸåè§£ææœåŠ¡ä¸Šï¼Œç”¨æˆ·æ¯æ¬¡è¿æ¥ç½‘ç»œçš„æ—¶å€™å®¢æˆ·ç«¯ç¨‹åºå°±ä¼šé€šè¿‡ä¿¡æ¯ä¼ é€’æŠŠè¯¥ä¸»æœºçš„åŠ¨æ€IPåœ°å€ä¼ é€ç»™ä½äºæœåŠ¡å•†ä¸»æœºä¸Šçš„æœåŠ¡å™¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç¨‹åºè´Ÿè´£æä¾›DNSæœåŠ¡å¹¶å®ç°åŠ¨æ€åŸŸåè§£æã€‚<br>
ç”±ä¸Šè¿°æ¦‚å¿µå¯çŸ¥ï¼Œåªè¦æˆ‘ä»¬åœ¨è·¯ç”±å™¨æ¯æ¬¡è”ç½‘æ—¶ï¼Œç›‘æ§IPåœ°å€å˜åŠ¨ï¼Œå°±æœ‰åŠæ³•æ›´æ–°DNSè§£æè®°å½•ã€‚é‚£æ€ä¹ˆå®Œæˆç›‘æ§å’Œæ›´æ–°?</p>
<h3 id="é˜¿é‡Œddns">é˜¿é‡ŒDDNS</h3>
<p>æä¾›ç±»ä¼¼æœåŠ¡çš„å‚å•†æœ‰å¾ˆå¤šï¼Œå›½å†…åšçš„æœ€å¥½çš„è¿˜æ˜¯é˜¿é‡Œã€‚ç›¸å…³æ–‡æ¡£ç‚¹å‡»<a href="https://help.aliyun.com/document_detail/141482.html">è¿™é‡Œ</a>..é‡Œé¢å‚è€ƒä»£ç ç»™çš„æ˜¯Javaç‰ˆæœ¬çš„ã€‚å…¶ä»–å®ç°å¯ä»¥åœ¨GitHubä¸Šæœä¸€ä¸‹ã€‚ä¸ªäººè§‰å¾—æœ€å¥½è¿˜æ˜¯é€‰æ‹©bashå®ç°ï¼Œä½¿ç”¨Cronå®šæ—¶ä»»åŠ¡å®šæ—¶æ‰§è¡Œå°±è¡Œã€‚</p>
<p><strong>æ³¨æ„</strong>:æœ‰äº›æ™ºèƒ½è·¯ç”±å™¨é‡Œæœ¬èº«å°±å¸¦æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæ— è®ºæ˜¯å›ºä»¶é›†æˆè¿˜æ˜¯æ’ä»¶å½¢å¼çš„ã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘å®¶è·¯ç”±å™¨å›ºä»¶é›†æˆäº†é˜¿é‡ŒDDNS<br>
<img src="https://aiyou.life/post-images/1574309892496.png" alt="" loading="lazy"></p>
<h3 id="åŸŸå">åŸŸå</h3>
<p>å¯¹åŸŸåå…¶å®æ²¡æœ‰ä»€ä¹ˆè¦æ±‚ï¼Œé˜¿é‡Œäº‘ä¸Šéšä¾¿ä¹°ä¸€ä¸ªå°±è¡Œäº†ã€‚å¾ˆä¾¿å®œï¼Œ10å¹´åªè¦60å¤šå—ã€‚<br>
å¦‚å›¾æ‰€ç¤º<br>
<img src="https://aiyou.life/post-images/1574311032422.png" alt="" loading="lazy"><br>
è®°å½•å‰å››æ¡ï¼Œæ˜¯æŒ‡å‘GitHubPageï¼Œä¹Ÿå°±æ˜¯æœ¬åšå®¢çš„åœ°å€ã€‚é˜¿é‡ŒDDNSé…ç½®æ­£ç¡®çš„è¯ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆæœ€åä¸€æ¡è®°å½•ï¼Œåœ°å€æŒ‡å‘äº†æˆ‘å®¶çš„è·¯ç”±å™¨ã€‚</p>
<h3 id="å†…ç½‘ç©¿é€">å†…ç½‘ç©¿é€</h3>
<p>ä¸Šé¢ä»‹ç»çš„å‰ææ˜¯ä½ æœ‰å…¬ç½‘IPçš„æƒ…å†µä¸‹ã€‚æ²¡æœ‰å…¬ç½‘IPåªèƒ½é å†…ç½‘ç©¿é€æ¥æä¾›WebæœåŠ¡ã€‚ç›¸å…³æ•™ç¨‹å¯ä»¥GoogleæŸ¥çœ‹ã€‚<br>
å†…ç½‘ç©¿é€ä¼˜ç‚¹æ˜¯ä¸éœ€è¦å…¬ç½‘IPï¼Œç¼ºç‚¹æ˜¯ä¾èµ–æœåŠ¡æä¾›å•†çš„ç¨³å®šæ€§ï¼Œä¸”ä¸èƒ½è‡ªå®šä¹‰åŸŸåã€‚å¦‚æœäººå®¶æœåŠ¡å™¨æŒ‚äº†ï¼Œæˆ–è€…åŸŸååˆ°æœŸäº†ï¼Œä½ è¿™é‡Œä¹Ÿä¸èƒ½ç”¨äº†ã€‚</p>
<p><strong>æ³¨æ„</strong>: æœ‰äº›æ™ºèƒ½è·¯ç”±å™¨é‡Œæœ¬èº«å°±å¸¦æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œæ— è®ºæ˜¯å›ºä»¶é›†æˆè¿˜æ˜¯æ’ä»¶å½¢å¼çš„ã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘å®¶è·¯ç”±å™¨å›ºä»¶é›†æˆäº†å†…ç½‘ç©¿é€å·¥å…·<br>
<img src="https://aiyou.life/post-images/1574312158496.png" alt="" loading="lazy"></p>
<h3 id="éªŒè¯">éªŒè¯</h3>
<p>åœ°å€è§£æé…ç½®å®Œæˆä¹‹åï¼Œéœ€è¦éªŒè¯ä¸€ä¸‹æ˜¯å¦è§£ææˆåŠŸ</p>
<pre><code class="language-bash">ping -c 4 www.aiyou.life
</code></pre>
<p>æŸ¥çœ‹è§£æåˆ°çš„IPæ˜¯å¦ä¸å…¬ç½‘IPä¸€è‡´</p>
<p>å¦‚å›¾æ‰€ç¤º<br>
<img src="https://aiyou.life/post-images/1574312401056.png" alt="" loading="lazy"></p>
<h2 id="ç«¯å£è½¬å‘">ç«¯å£è½¬å‘</h2>
<p>åœ°å€è§£æé…ç½®å®Œæˆåï¼Œæ‰€æœ‰é€šè¿‡åŸŸåçš„è®¿é—®éƒ½å°†ç›´æ¥è¯·æ±‚åˆ°äº†è·¯ç”±å™¨ä¸Šã€‚æ‰€ä»¥éœ€è¦é€šè¿‡ç«¯å£è½¬å‘ï¼Œå°†è¯·æ±‚è½¬åˆ°å†…ç½‘ä¸­çš„æœåŠ¡å™¨ä¸Šã€‚è¿™ä¸€æ­¥å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦è®°ä½å‡ ä¸ªå¸¸ç”¨çš„ç«¯å£ï¼Œé…ç½®ä¸€ä¸‹å°±è¡Œäº†ã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œæ¥è‡ªäº’è”ç½‘çš„80ç«¯å£è¯·æ±‚ï¼Œéƒ½ä¼šè½¬å‘åˆ°æˆ‘çš„æ ‘è“æ´¾æœåŠ¡å™¨(192.168.111)ä¸Šã€‚<br>
<img src="https://aiyou.life/post-images/1574313048391.png" alt="" loading="lazy"></p>
<p>è¿™ä¸€æ­¥éªŒè¯ä¹Ÿå¾ˆå®¹æ˜“ï¼Œåœ¨æœåŠ¡å™¨ä¸Šè£…ä¸ªNginxå³å¯ã€‚ç„¶åé€šè¿‡åŸŸåè®¿é—®ï¼ŒæŸ¥çœ‹æ˜¯å¦è½¬å‘åˆ°äº†Nginxé¡µé¢ã€‚</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œå³ä¸ºæˆåŠŸï¼ˆChromeå’ŒSafariéƒ½æŠŠwwwç»™éšè—äº†ï¼Œå®é™…å®Œæ•´åœ°å€æ˜¯ www.aiyou.lifeï¼‰<br>
<img src="https://aiyou.life/post-images/1574313486613.png" alt="" loading="lazy"></p>
<h2 id="åº”ç”¨è½¬å‘">åº”ç”¨è½¬å‘</h2>
<p>å½“åªæœ‰ä¸€ä¸ªé™æ€åº”ç”¨æ—¶ï¼Œåªéœ€è¦æ›¿æ¢ä¸€ä¸‹Nginxé»˜è®¤çš„æ–‡ä»¶å°±å¯ä»¥äº†ã€‚ä½†æˆ‘ä»¬çš„æœåŠ¡å™¨è‚¯å®šä¸æ­¢éƒ¨ç½²ä¸€ä¸ªåº”ç”¨ï¼Œä¸”ä¹Ÿä¸ä¸€å®šæ˜¯é™æ€çš„ã€‚å› è€Œéœ€è¦è€ƒè™‘ä½¿ç”¨Nginxè¿›è¡Œæ­£å‘/åå‘ä»£ç†ã€‚é˜¿é‡ŒDDNSç†è®ºä¸Šåº”è¯¥æ˜¯æ”¯æŒå¤šåŸŸåæŒ‡å‘åŒä¸€ä¸ªIPåœ°å€çš„ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘å¯ä»¥ä¸ºæ¯ä¸€ä¸ªåº”ç”¨åˆ†é…ä¸€ä¸ªäºŒçº§åŸŸåï¼ŒNginxä»£ç†é…ç½®ä¸åŒçš„server_nameå³å¯ã€‚ä½†æˆ‘å°è¯•äº†åŠå¤©ä¹Ÿæ²¡æœ‰è¯•æˆåŠŸã€‚æ‰€ä»¥åªèƒ½æ ¹æ®è®¿é—®è·¯å¾„ï¼Œä»£ç†åˆ°ä¸åŒçš„åº”ç”¨ã€‚</p>
<p>é…ç½®ä»£ç†æ—¶éœ€è¦ä»”ç»†æŸ¥é˜…Nginxæ–‡æ¡£<br>
å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¨å¤©è¢«è¿™ä¸¤ä¸ª / å‘äº†ä¸€å¤©æ—¶é—´ğŸ˜­<br>
<img src="https://aiyou.life/post-images/1574314812013.png" alt="" loading="lazy"></p>
<p>è½¬å‘åˆ°å…¶ä»–åº”ç”¨æ—¶ï¼Œåªéœ€è¦å†æ·»åŠ ä¸€ä¸ª location å³å¯ã€‚</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ç°ä»£æ™ºèƒ½å®¶ç”¨è·¯ç”±å™¨å¤§éƒ½åŸºäºOpenWrtç³»ç»Ÿï¼Œè€ŒOpenWrtæ˜¯åŸºäºLinuxä¸“ä¸ºè·¯ç”±å™¨æ‰“é€ çš„ç³»ç»Ÿã€‚è·¯ç”±å™¨ä½œä¸ºå®¶åº­ç½‘ç»œä¸­æ¢ï¼Œå…¶å®åŠŸèƒ½æ˜¯å¾ˆéªšçš„ï¼Œå¯ç©æ€§å¾ˆå¼ºã€‚è™½ç„¶è·¯ç”±å™¨é…ç½®ä¸é«˜ï¼Œä½†ä¹è¶£ä¸å°±æ˜¯åœ¨æœ‰é™çš„èµ„æºä¸­æå‡ºä¸åŒçš„èŠ±æ ·å—?</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å…³äºæé«˜setTimeoutä¸setIntervalç²¾ç¡®åº¦çš„æ¢ç´¢]]></title>
        <id>https://aiyou.life/post/kokne79MF/</id>
        <link href="https://aiyou.life/post/kokne79MF/">
        </link>
        <updated>2019-11-10T09:54:20.000Z</updated>
        <summary type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒsetTimeoutä¸setIntervaléƒ½ä¸æ˜¯ç²¾ç¡®çš„è®¡æ—¶å™¨ï¼Œå®ƒè¿˜ä¸å½“å‰ä¸»çº¿ç¨‹ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¤§å°æ•°é‡æœ‰å…³ã€‚å½“ä¸»çº¿ç¨‹ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæ¯•æ—¶,setTimeoutä¸setIntervalå°±ä¸ä¼šå‡†ç¡®çš„åœ¨ t æ—¶é—´åè¿è¡Œã€‚é‚£æ€ä¹ˆæ‰èƒ½æé«˜äºŒè€…çš„ç²¾ç¡®åº¦å‘¢?</p>
]]></summary>
        <content type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒsetTimeoutä¸setIntervaléƒ½ä¸æ˜¯ç²¾ç¡®çš„è®¡æ—¶å™¨ï¼Œå®ƒè¿˜ä¸å½“å‰ä¸»çº¿ç¨‹ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¤§å°æ•°é‡æœ‰å…³ã€‚å½“ä¸»çº¿ç¨‹ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæ¯•æ—¶,setTimeoutä¸setIntervalå°±ä¸ä¼šå‡†ç¡®çš„åœ¨ t æ—¶é—´åè¿è¡Œã€‚é‚£æ€ä¹ˆæ‰èƒ½æé«˜äºŒè€…çš„ç²¾ç¡®åº¦å‘¢?</p>
<!-- more -->
<h2 id="1-settimeoutsetintervalç”¨æ³•">1. setTimeout/setIntervalç”¨æ³•</h2>
<p>è¿™é‡Œè¿˜æ˜¯ç®€å•æä¸€å˜´å§ã€‚è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯å®šæ—¶å™¨å‡½æ•°ï¼ŒsetTimeoutè¡¨ç¤ºå›è°ƒå‡½æ•°åœ¨ t æ—¶é—´åè¿è¡Œï¼ŒsetIntervalè¡¨ç¤ºå›è°ƒå‡½æ•°æ¯éš” t æ—¶é—´è¿è¡Œã€‚</p>
<pre><code class="language-javascript">setTimeout(function(){
    ...
}, t)

setInterval(function(){
    ...
}, t)
</code></pre>
<div style="text-align:center;font-size:80%">ä»£ç  1.1</div>
<p>åœ¨ CSS3/HTML5ä¹‹å‰ï¼ŒäºŒè€…å¸¸ç”¨æ¥ç»˜åˆ¶é¡µé¢åŠ¨ç”»ã€‚CSS3/HTML5ä¹‹åï¼Œå¸¸ç”¨cssæ¥ç»˜åˆ¶åŠ¨ç”»ã€‚å¦å¤–è¿˜ä¸€ä¸ªAPIæ˜¯requestAnimationFrame. è¯¥å‡½æ•°ä¸setIntervalç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºè¯¥å‡½æ•°æ²¡æœ‰ t å‚æ•°ï¼Œé»˜è®¤æ˜¯å±å¹•åˆ·æ–°çš„æ¯å¸§è°ƒç”¨ä¸€æ¬¡ã€‚æ¯ç§’è°ƒç”¨ï¼ˆ1/å±å¹•åˆ·æ–°ç‡ï¼‰æ¬¡</p>
<pre><code class="language-javascript">requestAnimationFrame(function(){
    // DOMåŠ¨ç”»
})
</code></pre>
<div style="text-align:center;font-size:80%">ä»£ç  1.2</div>
<h2 id="2-å‘ç°é—®é¢˜">2. å‘ç°é—®é¢˜</h2>
<p>Jsæ˜¯ä¸€ä¸ªå•çº¿ç¨‹è¯­è¨€ï¼ŒåŒä¸€æ—¶é—´åªèƒ½åšåŒä¸€ä»¶äº‹æƒ…ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œå¦‚æœåŒä¸€æ—¶é—´èƒ½åšå¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå¤šä»»åŠ¡éƒ½åœ¨æ“ä½œDOMæ—¶ï¼Œé¡µé¢è¯¥æ€ä¹ˆæ˜¾ç¤ºå‘¢?å› è€ŒJSè®¾è®¡ä¸ºäº†å•çº¿ç¨‹,ä½†å•çº¿ç¨‹ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚çº¿ç¨‹é˜»å¡ï¼ŒCPUåˆ©ç”¨ç‡ä¸é«˜ç­‰é—®é¢˜ã€‚çœ‹ä»£ç 2.1</p>
<pre><code class="language-javascript">setTimeout(function () {
    console.log('task finished after ' + (Date.now() - startTime) + 'ms')
}, 0)

for (let i = 0 ; i &lt; 9000 ; i++) {
    console.log(5 + 8 + 8 + 8)
}
console.log('ä¸»çº¿ç¨‹å¤æ‚ä»»åŠ¡è€—æ—¶:' + (Date.now() - startTime) + 'ms')
</code></pre>
<div style="text-align:center;font-size:80%">ä»£ç  2.1</div>
<p>æ‰§è¡Œç»“æœå¦‚å›¾ 2.1 æ‰€ç¤º<br>
<img src="https://aiyou.life/post-images/1573436890372.png" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">å›¾ 2.1</div>
<p>forå¾ªç¯æ˜¯ä¸€ä¸ªè€—æ—¶ä»»åŠ¡,é˜»å¡äº†setTimeoutçš„æ‰§è¡Œã€‚æˆ‘ä»¬è®¾å®š0ç§’åæ‰§è¡Œè¾“å‡ºï¼Œå¯å®é™…ç»“æœæ˜¯åœ¨1243msä¹‹åè¾“å‡ºï¼Œæ‰€ä»¥setTimeoutçš„ t å‚æ•°å®šæ—¶ä¸å¤Ÿç²¾ç¡®ã€‚</p>
<!-- **ç»“è®º**: *ä¸»çº¿ç¨‹é‡Œå®é™…ä¸Šæ˜¯æ²¡æœ‰åŠæ³•ç²¾ç¡®æŒ‰æ—¶æ‰§è¡ŒsetTimeout/setIntervalçš„å›è°ƒå‡½æ•°ã€‚å½“æµè§ˆå™¨jså¼•æ“è§£æä»£ç é‡åˆ° setTimeout/setInterval æ—¶ï¼Œä¼šå°†ä»–ä»¬æ³¨å†Œåˆ°ä¸‹ä¸€ä¸ªå®ä»»åŠ¡é˜Ÿåˆ—ï¼Œåªæœ‰æ‰§è¡Œå®Œå½“å‰å®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡åï¼Œæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚ä»£ç çš„æ‰§è¡Œæœ¬èº«å°±æ¶ˆè€—æ—¶é—´*ã€‚ -->
<p>å…³äºäº‹ä»¶å¾ªç¯ã€å®ä»»åŠ¡ã€å¾®ä»»åŠ¡ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://juejin.im/post/5bac87b6f265da0a906f78d8">ç¬”è¯•é¢˜â€”â€”JavaScriptäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼ˆevent loopã€macrotaskã€microtaskï¼‰</a></p>
<p>é‚£ä¹ˆåˆ°åº•è¦æ€ä¹ˆè§£å†³ç²¾ç¡®åº¦é—®é¢˜å‘¢?</p>
<h2 id="3-è§£å†³é—®é¢˜">3. è§£å†³é—®é¢˜</h2>
<p>å‰æ–‡æˆ‘ä»¬ä¸€ç›´åœ¨æåŠä¸»çº¿ç¨‹ä¸»çº¿ç¨‹çš„ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•åˆ©ç”¨å…¶å®ƒçº¿ç¨‹è¿›è¡Œè®¡æ—¶å‘¢?å½“ä»£ç æ‰§è¡Œåˆ°ç‰¹å®šä½ç½®ï¼Œé€šçŸ¥å…¶å®ƒçº¿ç¨‹ä¸­å¼€å§‹è®¡æ—¶ä»»åŠ¡ï¼Œä¸»çº¿ç¨‹ç»§ç»­å®Œæˆå¤æ‚ä»»åŠ¡ï¼Œé‚£ä¹ˆå°±ä¸ä¼šé˜»å¡è®¡æ—¶å™¨çš„è¿è¡Œï¼Œè¿™æ ·çš„è¯è®¡æ—¶ç²¾ç¡®åº¦å°±æé«˜äº†ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒJSä¸æ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€å—ï¼Œæ€ä¹ˆèƒ½åˆ©ç”¨é™¤äº†ä¸»çº¿ç¨‹ä¹‹å¤–çš„å…¶ä»–çº¿ç¨‹å‘¢?</p>
<p>åœ¨HTML5ä¸­ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker">Worker</a>çš„å¼•å…¥ä½¿å¾—æˆ‘ä»¬æœ‰äº†åˆ©ç”¨å…¶å®ƒçº¿ç¨‹çš„èƒ½åŠ›ã€‚æ³¨æ„:<strong>Workerä¸­ä¸èƒ½æ“ä½œDOM</strong>ã€‚</p>
<p>äº‹æƒ…å¥½åŠäº†ã€‚æ´‹æ´‹æ´’æ´’å†™ä¸‹å¦‚ä¸‹ä»£ç :</p>
<pre><code class="language-javascript">// workerç”Ÿæˆå™¨
const createWorker = (fn, options) =&gt; {
    const blob = new Blob(['(' + fn.toString() + ')()']);
    const url = URL.createObjectURL(blob);
    if (options) {
        return new Worker(url, options);
    }
    return new Worker(url);
} 
// ç”Ÿæˆworker
const worker = createWorker(function () {
    onmessage = function(e) {
        console.log('è¿›å…¥WebWorker')
        let count = 1
        let startTime = Date.now()
        let timer = setInterval(function () {
            if (count++ === e.data) {
                clearInterval(timer)
                postMessage(startTime)
            }
        }, 1000)
    }
})

// å°†ä»£ç 2.1ä¸­çš„setTimeoutæ›¿æ¢ä¸ºäº† worker
// workerçº¿ç¨‹ä»»åŠ¡
const startTime = Date.now()
worker.postMessage(10)
worker.onmessage = function (e) {
    console.log('Workerçº¿ç¨‹ä»»åŠ¡å†…éƒ¨è€—æ—¶:' + (Date.now() - e.data) + 'ms')
    console.log('Workerçº¿ç¨‹ä»»åŠ¡è€—æ—¶:'+ (Date.now() - startTime) + 'ms')
    this.terminate()
}
// ä¸»çº¿ç¨‹ä»»åŠ¡
for (let i = 0 ; i &lt; 5000 ; i++) {
    console.log(5 + 8 + 8 + 8)
} 
console.log('ä¸»çº¿ç¨‹å¤æ‚ä»»åŠ¡è€—æ—¶:' + (Date.now() - startTime) + 'ms')
</code></pre>
<div style="text-align:center;font-size:80%">ä»£ç  3.1</div>
<p>ä»£ç ä¸­, worker çº¿ç¨‹æ¯ç§’è¿è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ï¼Œè¿›è¡Œè®¡æ•°ï¼Œå½“å›è°ƒå‡½æ•°æ‰§è¡Œäº† 10 æ¬¡æ—¶ï¼Œé€šçŸ¥ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹æ‰“å° worker çº¿ç¨‹è¿è¡Œæ—¶é—´ã€‚</p>
<p>ä»£ç è¿è¡Œç»“æœå¦‚å›¾3.1æ‰€ç¤º<br>
<img src="https://aiyou.life/post-images/1573401585223.png" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">å›¾ 3.1</div>
<p>è¿è¡Œç»“æœå¹¶ä¸ç¬¦åˆé¢„æœŸã€‚é¢„æœŸç»“æœåº”å½“æ˜¯<strong>Workerçº¿ç¨‹ä»»åŠ¡å†…éƒ¨è€—æ—¶</strong>ä¸<strong>Workerçº¿ç¨‹ä»»åŠ¡è€—æ—¶</strong>ç›¸å·®ä¸å¤šã€‚å‡ºç°è¿™ä¸ªç»“æœçš„åŸå› åœ¨äºjsä»£ç åœ¨æ‰§è¡Œåˆ°<code>worker.postMessage(10)</code>æ—¶,å¹¶æ²¡æœ‰é€šçŸ¥åˆ°Workerå¼€å§‹å·¥ä½œï¼Œè€Œæ˜¯ç­‰å¾…å½“å‰ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•ï¼Œæ‰å¼€å§‹è°ƒç”¨ WorkerğŸ˜­..è¿™é‡Œä¸åƒfetchå‡½æ•°é‚£æ ·ï¼Œä»£ç æ‰§è¡Œåˆ°fetchæ—¶,æµè§ˆå™¨å¦å¼€çº¿ç¨‹å»å¤„ç†è¯·æ±‚ï¼Œæ‹¿åˆ°ç»“æœå†è¿›è¡Œå›è°ƒ,å…¶ä»–ä»£ç æ¥ç€è¿è¡Œã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†,workeræ˜¯å±äºå®ä»»åŠ¡è¿˜æ˜¯å¾®ä»»åŠ¡å‘¢?<br>
éªŒè¯ä»£ç å¦‚ä¸‹:</p>
<pre><code class="language-javascript">...
setTimeout(()=&gt;{
    console.log('SetTimeout')
}, 0)
const worker = createWorker(function () {
    onmessage = function(e) {
    console.log('è¿›å…¥WebWorker ')
    let count = 1
    let startTime = Date.now()
    let timer = setInterval(function () {
            if (count++ === e.data) {
                clearInterval(timer)
                postMessage(startTime)
            }
        }, 1000)
    }
})
...
</code></pre>
<div style="text-align:center;font-size:80%">ä»£ç  3.2</div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹:<br>
<img src="https://aiyou.life/post-images/1573403893208.png" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">å›¾ 3.2</div>
<p><code>SetTimeout</code>åœ¨<code>è¿›å…¥WebWorker</code>ä¹‹å‰è¾“å‡º,è¯´æ˜<strong>Workeræ˜¯å®ä»»åŠ¡</strong></p>
<h2 id="4-æ›´è¿›ä¸€æ­¥">4. æ›´è¿›ä¸€æ­¥</h2>
<p>ä¸Šä¸€èŠ‚ä¸­,æˆ‘ä»¬è€ƒè™‘å°†è®¡æ—¶å™¨å‡½æ•°ä¸¢åˆ°Workerä¸­å»æ‰§è¡Œ.ä½†å®é™…è¿è¡Œç»“æœå¹¶ä¸ç¬¦åˆé¢„æœŸã€‚é‚£æˆ‘ä»¬æ¢ä¸€ç§æ€è·¯ï¼Œå°†ä¸»çº¿ç¨‹è€—æ—¶ä»»åŠ¡ä¸¢åˆ°Workeræ‰§è¡Œï¼Œè®¡æ—¶å™¨ç²¾åº¦ä¼šæé«˜å—?ç­”æ¡ˆæ˜¯è‚¯å®šçš„<br>
çœ‹å¦‚ä¸‹ä»£ç 4.1:</p>
<pre><code class="language-javascript">const startTime = Date.now()
setTimeout(function () {
    console.log('task finished after ' + (Date.now() - startTime) + 'ms')
}, 0)
// å°†ä»£ç 2.1ä¸­çš„è€—æ—¶ä»»åŠ¡æ”¾åˆ°worker
const createWorker = (fn, options) =&gt; {
    const blob = new Blob(['(' + fn.toString() + ')()']);
    const url = URL.createObjectURL(blob);
    if (options) {
        return new Worker(url, options);
    }
    return new Worker(url);
}
const worker = createWorker(function () {
    const startTime = Date.now()
    for (let i = 0; i &lt; 9000; i++) {
        console.log(5 + 8 + 8 + 8)
        if (i === 9000 - 1) {
            postMessage(startTime)
        }
    }
})
worker.postMessage('start')
worker.onmessage = function (e) {
    console.log('Workerçº¿ç¨‹ä»»åŠ¡å†…éƒ¨è€—æ—¶:' + (Date.now() - e.data) + 'ms')
    console.log('Workerçº¿ç¨‹ä»»åŠ¡è€—æ—¶:'+ (Date.now() - startTime) + 'ms')
    this.terminate()
}
</code></pre>
<div style="text-align:center;font-size:80%">ä»£ç  4.1</div>
<p>è¿è¡Œç»“æœå¦‚å›¾4.1:<br>
<img src="https://aiyou.life/post-images/1573437200815.png" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">å›¾ 4.1</div>
<p>å¯¹æ¯”ä¸Šæ–‡ä»£ç 2.1,å¯ä»¥çœ‹åˆ°è®¡æ—¶å™¨ç²¾åº¦æé«˜äº†ä¸å°‘ã€‚</p>
<p>å°†Workeræ›¿æ¢æˆsetTimeoutè¯•è¯•</p>
<pre><code class="language-javascript">const startTime = Date.now()
setTimeout(function () {
    console.log('task finished after ' + (Date.now() - startTime) + 'ms')
}, 0)
// å°†ä»£ç 2.1ä¸­è€—æ—¶ä»»åŠ¡æ”¾åˆ°setTimeoutä¸­
setTimeout(function () {
    for (let i = 0 ; i &lt; 9000 ; i++) {
        console.log(5 + 8 + 8 + 8)
    }
    console.log('ä¸»çº¿ç¨‹å¤æ‚ä»»åŠ¡è€—æ—¶:' + (Date.now() - startTime) + 'ms')
}, 0)
</code></pre>
<div style="text-align:center;font-size:80%">ä»£ç  4.2</div>
<p>è¿è¡Œç»“æœå¦‚å›¾4.2:<br>
<img src="https://aiyou.life/post-images/1573808921223.png" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">å›¾ 4.2</div>
<p>å¯¹æ¯”ä¸Šæ–‡ä»£ç 2.1,å¯ä»¥çœ‹åˆ°è®¡æ—¶å™¨ç²¾åº¦ä¹Ÿæé«˜äº†ä¸å°‘ã€‚</p>
<p><strong>æ€»ç»“</strong>:<em>ä¸»çº¿ç¨‹é‡åˆ°è€—æ—¶ä»»åŠ¡ï¼Œåº”å½“è€ƒè™‘å°†å…¶ä¸¢åˆ°ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ä¸­å»æ‰§è¡Œï¼Œè¿™æ ·ä¸ä¼šé˜»å¡å½“å‰ä»»åŠ¡é˜Ÿåˆ—çš„æ‰§è¡Œã€‚é¢˜ç›®ä¸­è®²åˆ°è¦æé«˜è®¡æ—¶å™¨å‡½æ•°ç²¾åº¦ï¼Œå®é™…è®¡æ—¶å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå®ä»»åŠ¡ã€‚è®¡æ—¶å™¨ä¸è€—æ—¶ä»»åŠ¡åœ¨ä¸¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œè¦ä¿è¯è®¡æ—¶å™¨ä»»åŠ¡åœ¨å‰ï¼Œè¿™æ ·å°±å¯ä»¥æé«˜è®¡æ—¶å™¨ç²¾åº¦ã€‚å†è€…ï¼Œè®¡æ—¶å™¨å‡½æ•°è¦å°½é‡é å‰ï¼Œå…ˆäºå…¶ä»–ä»£ç æ‰§è¡Œï¼Œå› ä¸ºä»£ç æ‰§è¡Œæœ¬èº«ä¹Ÿä¼šæ¶ˆè€—æ—¶é—´</em>ã€‚</p>
<h2 id="5-æœ€ä½³å®æˆ˜">5. æœ€ä½³å®æˆ˜</h2>
<p>ä¸»çº¿ç¨‹é‡åˆ°æ— å…³DOMçš„è€—æ—¶ä»»åŠ¡æ—¶ï¼Œåº”å½“é¦–å…ˆè€ƒè™‘ä½¿ç”¨Workerè¿›è¡Œå¤„ç†ä¸è®¡ç®—ã€‚è¿™æ ·æ‰ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚ä»£ç 4.2ä¸­ï¼Œæˆ‘ä»¬å°è¯•å°†è€—æ—¶ä»»åŠ¡æ”¾åˆ°ä¸»çº¿ç¨‹çš„ä¸­çš„ä¸‹ä¸€ä¸ªå®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœä»»åŠ¡æœ‰ä¸Šä¸‡æ•°æ®è¿›è¡Œè®¡ç®—ï¼Œè¿˜æ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚Workerè™½ç„¶å±äºå®ä»»åŠ¡ï¼Œä½†åªæ˜¯å°†æ•°æ®ä¼ è¾“åˆ°Workerçº¿ç¨‹ï¼Œç”±Workerè¿›è¡Œè®¡ç®—ã€‚è®¡ç®—å®Œæˆåï¼Œé€šçŸ¥ä¸»çº¿ç¨‹ã€‚</p>
<h2 id="6-å®ç°ä¸€ä¸ªç›¸å¯¹ç²¾ç¡®çš„setinterval">6. å®ç°ä¸€ä¸ªç›¸å¯¹ç²¾ç¡®çš„setInterval</h2>
<pre><code class="language-javascript">function loop(fn, interval) {
    const startTime = Date.now()
    let count = 0
    let currentInterval = interval
    let timer = 0
    function inner() {
        count++
        let offset = new Date().getTime() - (startTime + count * interval)
        currentInterval = interval - offset
        console.log('ä»£ç æ‰§è¡Œæ—¶é—´ï¼š' + offset, 'ä¸‹æ¬¡å¾ªç¯é—´éš”' + currentInterval)
        timer = setTimeout(inner, currentInterval)
        fn(timer)
    }
    setTimeout(inner, currentInterval)
}

let count = 0
loop(function (timer) {
    console.log('å¤–éƒ¨å‡½æ•°')
    if (count++ === 10) {
        console.log('å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•')
        clearTimeout(timer)
    }
}, 1000)
</code></pre>
<p>å¦‚ä¸Šä»£ç ,æˆ‘ä»¬æ„é€ äº†ä¸€ä¸ªä¸<code>setInterval</code>å‡½æ•°åŠŸèƒ½ç±»ä¼¼çš„loopå‡½æ•°ã€‚æ’å…¥ä¸»çº¿ç¨‹çš„ä»»åŠ¡çš„æ—¶é—´æ’é™¤äº†ä»£ç çš„æ‰§è¡Œæ—¶é—´,ç›¸å¯¹äºsetIntervalç²¾åº¦æé«˜äº†å¾ˆå¤šã€‚ä½†å½“ä»£ç çš„æ‰§è¡Œæ—¶é—´å¤§äºè®¾å®šçš„tæ—¶,ä¸»çº¿ç¨‹æ’å…¥ä»»åŠ¡æ—¶é—´ä¹Ÿä¸ä¼šå‡†ã€‚</p>
<h2 id="7-åè®°">7. åè®°</h2>
<p>è¿™ä¸ªé—®é¢˜æ¥è‡ªäºå…¬ä¼—å·ä¸Šçœ‹åˆ°çš„æŸå¤§å‚çš„é¢è¯•é¢˜ã€‚å› è€Œå¼•å‘äº†ä¸€ç³»åˆ—æ€è€ƒä¸æ¢è®¨ï¼Œé¡ºä¾¿ç ”ç©¶äº†ä¸€ä¸‹WebWorkerã€‚å…¶å®æé«˜setTimeoutä¸setIntervalè®¡æ—¶ç²¾ç¡®åº¦æœ¬èº«æ˜¯ä¸€ä»¶æ— æ„ä¹‰çš„äº‹æƒ…ï¼Œå®é™…ä¸­æœ¬å°±æ²¡æœ‰è¿™æ ·çš„åº”ç”¨åœºæ™¯ï¼Œä½†æ¢ç´¢çš„è¿‡ç¨‹è¿˜æ˜¯è›®æœ‰æ„ä¹‰çš„(å°±æ˜¯æœ‰ç‚¹è€—è´¹å¤´å‘ğŸ˜­)ã€‚ã€‚</p>
]]></content>
    </entry>
</feed>