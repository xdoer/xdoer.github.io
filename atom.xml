<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://aiyou.life</id>
    <title>æ–‡äº«æ—¥å¿—</title>
    <updated>2021-08-31T11:01:51.087Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://aiyou.life"/>
    <link rel="self" href="https://aiyou.life/atom.xml"/>
    <logo>https://aiyou.life/images/avatar.png</logo>
    <icon>https://aiyou.life/favicon.ico</icon>
    <rights>All rights reserved 2021, æ–‡äº«æ—¥å¿—</rights>
    <entry>
        <title type="html"><![CDATA[Restful-API çš„ä¸€ç§åŠ¨æ€ç”Ÿæˆæ•°æ®ç±»å‹çš„æ–¹æ³•]]></title>
        <id>https://aiyou.life/post/QqaRhC3Gf/</id>
        <link href="https://aiyou.life/post/QqaRhC3Gf/">
        </link>
        <updated>2021-08-31T03:34:31.000Z</updated>
        <summary type="html"><![CDATA[<p>ä½¿ç”¨ TypeScript å¼€å‘å‰ç«¯é¡¹ç›®ï¼Œå®Œå–„çš„ç±»å‹æ‰¹æ³¨æ˜¯éå¸¸æå‡å¼€å‘æ•ˆç‡çš„ã€‚ç„¶è€Œï¼Œå½“é‡åˆ° Restfulï¼Œä¼¼ä¹åªèƒ½ä¸º Restful è¿”å›çš„ JSON æ•°æ®æ‰‹åŠ¨ä¹¦å†™ç±»å‹ï¼Œéšç€æ¥å£è¶Šæ¥è¶Šå¤šï¼Œæ‰‹å†™ç±»å‹æ˜¯ç¹çä¸”ä½æ•ˆçš„ã€‚ æœ‰æ²¡æœ‰ä¸€ç§ç®€å•çš„æ–¹å¼ï¼Œå¯ä»¥æ‹¿åˆ°è¿”å›æ•°æ®çš„ç±»å‹å‘¢ï¼Ÿ</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä½¿ç”¨ TypeScript å¼€å‘å‰ç«¯é¡¹ç›®ï¼Œå®Œå–„çš„ç±»å‹æ‰¹æ³¨æ˜¯éå¸¸æå‡å¼€å‘æ•ˆç‡çš„ã€‚ç„¶è€Œï¼Œå½“é‡åˆ° Restfulï¼Œä¼¼ä¹åªèƒ½ä¸º Restful è¿”å›çš„ JSON æ•°æ®æ‰‹åŠ¨ä¹¦å†™ç±»å‹ï¼Œéšç€æ¥å£è¶Šæ¥è¶Šå¤šï¼Œæ‰‹å†™ç±»å‹æ˜¯ç¹çä¸”ä½æ•ˆçš„ã€‚ æœ‰æ²¡æœ‰ä¸€ç§ç®€å•çš„æ–¹å¼ï¼Œå¯ä»¥æ‹¿åˆ°è¿”å›æ•°æ®çš„ç±»å‹å‘¢ï¼Ÿ</p>
<!-- more -->
<h2 id="json-ç±»å‹æ–‡ä»¶ç”Ÿæˆ">JSON ç±»å‹æ–‡ä»¶ç”Ÿæˆ</h2>
<h3 id="json-ç±»å‹">JSON ç±»å‹</h3>
<p>Json ä¸­æ•°æ®ç±»å‹æœ‰ 6 ç§: string ã€numberã€booleanã€arrayã€objectã€null</p>
<p>å…¶ä¸­ stringã€numberã€boolean çš„ç±»å‹å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>typeof</code> åˆ¤åˆ«ç±»å‹ã€‚</p>
<p>null æœ‰äº›å¤æ‚ï¼Œå®ƒå¯èƒ½æ˜¯å…¶ä»– 5 ä¸­ç±»å‹ä¸­çš„ä¸€ç§ï¼Œæ— æ³•åˆ¤æ–­å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå› è€Œåªèƒ½å¡«å…… any</p>
<p>å¯¹äº objectï¼Œå®ƒå¯èƒ½ç”± Json çš„ 6 ç§æ•°æ®ç»“æ„ç»„æˆï¼Œå¯ä»¥ä½¿ç”¨é€’å½’éå†çš„æ–¹å¼ï¼Œæ¥åˆ¤æ–­ value çš„ç±»å‹</p>
<p>è€Œå¯¹äº array ï¼Œarray ä¸­çš„æ¯ä¸€é¡¹æ•°æ®ç»“æ„åº”å½“éƒ½æ˜¯ç›¸åŒçš„ï¼Œå› è€Œåªéœ€è¦å–å‡ºç¬¬ä¸€é¡¹è¿›è¡Œå¤„ç†ï¼Œå¤„ç†é€»è¾‘ä¸ä¸Šè¿°å‡ ç§ç±»å‹ç›¸åŒã€‚</p>
<h3 id="æ–‡ä»¶ç”Ÿæˆ">æ–‡ä»¶ç”Ÿæˆ</h3>
<p>å¯ä»¥ä½¿ç”¨ node fs apiï¼Œåˆ©ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„å½¢å¼ï¼Œå°† JSON ç±»å‹å¤„ç†åï¼Œè¾“å‡ºåˆ°ç±»å‹æ–‡ä»¶ä¸­ã€‚è¿™æ ·ç®€å•ä¸”æœ‰æ•ˆï¼Œä½†ä¸é‚£ä¹ˆä¼˜é›…ï¼Œä¸”æ˜“å‡ºé”™ã€‚</p>
<p>å¯ä»¥å€ŸåŠ© <a href="https://ts-morph.com/">ts-morph</a> è¿™ä¸ªåº“ï¼Œæ¥å®Œæˆç±»å‹çš„ç”Ÿæˆå’Œå¯¼å‡ºã€‚</p>
<p>ts-morph ä½¿ç”¨ä¼ªä»£ç å¦‚ä¸‹:</p>
<pre><code class="language-text">const project = createProject()
project.addInterface({ name, value }).setIsExport(true)
saveProject(project)
</code></pre>
<p>ç›¸æ¯” fs APIï¼Œts-morph ä½¿ç”¨æ›´ç®€å•</p>
<h2 id="restful-æ•´åˆ">Restful æ•´åˆ</h2>
<p>å¯ä»¥æ ¹æ® JSON æ•°æ®ç”Ÿæˆç±»å‹æ–‡ä»¶åï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œåœ¨è¯·æ±‚åº“çš„æ‹¦æˆªå™¨ä¸­ï¼Œæ‹¦æˆªå“åº”ï¼Œæ‰§è¡Œ JSON ç±»å‹æ–‡ä»¶ç”Ÿæˆã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå‰ç«¯é¡¹ç›®ä¸­ï¼ŒNode API ä¸èƒ½ä½¿ç”¨ï¼Œå› ä¸ºä½ çš„ä»£ç æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨çš„ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<h3 id="ç±»å‹ç”Ÿæˆå™¨è„šæœ¬">ç±»å‹ç”Ÿæˆå™¨è„šæœ¬</h3>
<p>æ—¢ç„¶å‰ç«¯é¡¹ç›®ä¸­ä¸èƒ½é›†æˆJSONç±»å‹æ–‡ä»¶ç”Ÿæˆå·¥å…·ï¼Œé‚£ä¹ˆå¯ä»¥ç¼–å†™ Node è„šæœ¬æ¥è§£å†³é—®é¢˜ã€‚åç«¯æä¾›ä¸€ä¸ªæ¥å£åï¼Œå‰ç«¯æ–°å¢ä¸€ä¸ªæ¥å£ï¼Œè„šæœ¬é…ç½®æ–‡ä»¶ä¹Ÿè¦æ³¨å†Œä¸€ä¸ªæ¥å£ï¼Œæœ€åè¿è¡Œä¸€ä¸‹è„šæœ¬å³å¯ã€‚</p>
<p>é‚£ä¹ˆçœ‹çœ‹è„šæœ¬éœ€è¦å®Œæˆå“ªäº›åŠŸèƒ½ã€‚</p>
<p>é¦–å…ˆè„šæœ¬éœ€è¦é›†æˆä¸€ä¸ªè¯·æ±‚åº“ï¼Œç”¨ä»¥å‘èµ·è¯·æ±‚ï¼Œæ¥æ”¶æœåŠ¡ç«¯çš„ JSON æ•°æ®ã€‚</p>
<p>ç„¶åè¿˜è¦é›†æˆä¸Šé¢çš„ JSONç±»å‹æ–‡ä»¶ç”Ÿæˆè„šæœ¬ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜éœ€è¦ç»´æŠ¤ä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­è¦æœ‰è¯·æ±‚å‚æ•°åˆ—è¡¨ï¼Œç”¨ä»¥åŠ¨æ€ç”Ÿæˆç±»å‹æ–‡ä»¶ã€‚ä¸ºäº†é¿å…åŒæ—¶å‘èµ·çš„è¯·æ±‚æ•°é‡å¤ªå¤šï¼Œå¯¼è‡´ç”µè„‘æ­»æœºï¼Œæˆ–è€…æœåŠ¡ç«¯å®•æœºï¼Œè¿˜è¦å¯¹è¯·æ±‚è¿›è¡Œå¹¶å‘æ§åˆ¶ã€‚</p>
<p>æ¯æ¬¡æ‰§è¡Œè„šæœ¬ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šå†å‘é€ä¸€éï¼Œæ‰€ä»¥è¿˜è¦è€ƒè™‘æ£€æµ‹æ–‡ä»¶æ˜¯å¦ç”Ÿæˆï¼Œå†å»è¯·æ±‚ã€‚</p>
<p>è€ƒè™‘åˆ°å¯ç»´æŠ¤æ€§ï¼Œå»ºè®®å•ç‹¬ç»´æŠ¤ä¸€ä¸ª URL çš„æ˜ å°„æ–‡ä»¶ï¼Œåœ¨Nodeè„šæœ¬å’Œå‰ç«¯é¡¹ç›®ï¼Œå¼•ç”¨ URL æ–‡ä»¶çš„URL åœ°å€ã€‚</p>
<p>æœ‰äº†è¿™æ ·ä¸€ä¸ªè„šæœ¬ï¼Œæ¯æ¬¡æ–°å¢ä¸€ä¸ªæ¥å£æ—¶ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ä¸€ä¸‹æ¥å£å’Œè¯·æ±‚å‚æ•°ï¼Œç„¶åæ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹è„šæœ¬ã€‚è¿™æ ·ä¹Ÿä¸å¤ªæ–¹ä¾¿ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://github.com/paulmillr/chokidar">chokidar</a> ç›‘å¬æ–‡ä»¶å˜æ›´ï¼Œä½¿ç”¨ shelljs æ¥æ‰§è¡Œè„šæœ¬ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„æ­¥éª¤ç¹çä¸”å¤æ‚ï¼Œç»´æŠ¤è¿™æ ·ä¸€ä¸ªå¤æ‚é…ç½®æ–‡ä»¶ï¼Œä¼šè®©äººæœ›è€Œå´æ­¥ã€‚å¹¶ä¸”è¿™æ ·çš„é…ç½®æ–‡ä»¶å¯¹äºä¸€äº›å¤æ‚çš„è¯·æ±‚ï¼Œæ¶‰åŠåˆ°çš„ Token æ ¡éªŒï¼Œ Post çš„ Body å¤„ç†ï¼Œå“åº”çš„ Data çš„å¤„ç†ç­‰ç­‰éƒ½è¦åŒºåˆ«ä¸å‰ç«¯é¡¹ç›®ï¼Œå†å•ç‹¬å¤„ç†ä¸€éã€‚</p>
<p>æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼Œæ¥å®Œæˆç±»å‹ç”Ÿæˆçš„ç›®çš„ï¼Ÿ</p>
<h3 id="server-clinet-ç±»å‹ç”Ÿæˆå™¨">Server-Clinet ç±»å‹ç”Ÿæˆå™¨</h3>
<p>å†™è¿™æ ·ä¸€ä¸ªè„šæœ¬ï¼Œä¸»è¦çš„éš¾ç‚¹åœ¨äºNodeè„šæœ¬æ€ä¹ˆä¾¿æ·çš„æ‹¿åˆ°å‰ç«¯é¡¹ç›®çš„å“åº”æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å‰ç«¯æ‹¿åˆ°æ•°æ®åæ€ä¹ˆé€šçŸ¥åˆ°è„šæœ¬ï¼Ÿ</p>
<p>è¿™ä¹ˆä¸€æƒ³ï¼Œäº‹æƒ…å°±ç®€å•äº†ï¼Œå¦‚æœ Node è„šæœ¬ä¸­å¼€å¯ä¸€ä¸ª HTTP Serverï¼Œå‰ç«¯æ‹¿åˆ°æ•°æ®åï¼Œå†å‘ HTTP Server å‘èµ·ä¸€ä¸ª POST è¯·æ±‚ï¼Œå°†ä¸€äº›å‚æ•°æºå¸¦è¿‡å»ï¼ŒæŒ‡æŒ¥ HTTP Server å‘ç›®æ ‡ç›®å½•ç”Ÿæˆç±»å‹æ–‡ä»¶å³å¯ã€‚</p>
<p>ä½†è¿™ä¸€å¥—æµç¨‹è¿˜æœ‰ä¸ªç¼ºç‚¹ï¼Œç±»å‹æ–‡ä»¶æ˜¯â€œè¿è¡Œæ—¶â€ç”Ÿæˆçš„ï¼Œç”Ÿæˆç±»å‹æ–‡ä»¶å‰ï¼Œéœ€è¦å‰ç«¯é¡¹ç›®å…ˆè°ƒç”¨ä¸€æ¬¡è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œè¿™ä¸€ç‚¹ç¼ºç‚¹æ— ä¼¤å¤§é›…ï¼Œå¼€å‘ä»£ç æ—¶ï¼Œè‚¯å®šéœ€è¦å…ˆæµ‹è¯•æ¥å£èƒ½ä¸èƒ½é€šä»€ä¹ˆçš„ã€‚</p>
<h2 id="æ•ˆæœå±•ç¤º">æ•ˆæœå±•ç¤º</h2>
<p>åŸºäºå‡ å¤©çš„å°è¯•ï¼Œæˆ‘å¼€å‘äº†å‡ ä¸ªåº“ï¼Œå®Œæˆäº†è¿™æ ·ä¸€ä»¶äº‹æƒ…ï¼Œæœ€åçœ‹ demo çš„æ•ˆæœï¼Œè¿˜ä¸é”™ã€‚</p>
<h3 id="demo-é¡¹ç›®">Demo é¡¹ç›®</h3>
<p>æˆ‘åŸºäº Vite React TypeScript å†™äº†ä¸€ä¸ª demo é¡¹ç›®ï¼š<a href="https://github.com/xdoer/restful-types-generate-example">restful-types-generate-example</a>ã€‚</p>
<p>clone é¡¹ç›®åï¼Œè¿è¡Œ yarn å®‰è£…, yarn dev å¯åŠ¨é¡¹ç›®ï¼Œç‚¹å‡»é¡µé¢æŒ‰é’®ï¼Œå‘èµ·è¯·æ±‚åå³å¯çœ‹åˆ°æ•ˆæœã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://aiyou.life/post-images/1630407294021.gif" alt="" loading="lazy"></figure>
<h3 id="jsontypesgenerator">JsonTypesGenerator</h3>
<p><a href="https://github.com/xdoer/json-types-generator">json-types-generator</a> æ˜¯æ ¹æ®ç¬¬ä¸€å°èŠ‚ä¸­ä»‹ç»çš„åŸç†å®Œæˆçš„</p>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p>
<pre><code class="language-ts">import jsonTypesGenerator from 'json-types-generator'

const json = { a: { b: 1, c: { d: true } } }

jsonTypesGenerator({
   data: json,
   outPutPath: '/User/xdoer/types.ts',
   rootInterfaceName: 'ChinaRegion',
   customInterfaceName(key, value, data) {
      if (key === 'b') return 'Province'
   },
})
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ï¼Œå°†ä¼šåœ¨ <code>/User/xdoer/types.ts</code> æ–‡ä»¶ä¸­ç”Ÿæˆå¯¼å‡º interface ä¸º <code>ChinaRegion</code> çš„ç±»å‹æ–‡ä»¶ï¼Œäº§ç”Ÿçš„ä¸­é—´ inteface åç§°ä¸º <code>Province</code>ï¼Œä¸­é—´äº§ç‰©é»˜è®¤çš„ interface åç§°ä¸º key çš„å¤§å†™</p>
<pre><code class="language-ts">&lt;!----/User/xdoer/types.ts----&gt;
export interface ChinaRegion {
    a: Province
}

export interface Province {
    b: number
    c: C
}

export interface C {
    d: boolean
}
</code></pre>
<h3 id="responsetypesserver">ResponseTypesServer</h3>
<p><a href="https://github.com/xdoer/PreQuest/tree/main/packages/response-types-server">response-types-server</a> æ˜¯ä¸Šæ–‡æåˆ°çš„ Server-Clinet ç±»å‹ç”Ÿæˆå™¨ ä¸­çš„ Server éƒ¨åˆ†ã€‚åªéœ€è¦å‘è¿™ä¸ªServer å‘é€ POST è¯·æ±‚ï¼Œå³å¯ç”Ÿæˆç±»å‹ã€‚</p>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p>
<pre><code class="language-ts">import server from '@prequest/response-types-server'

// é»˜è®¤å¼€å¯çš„ç«¯å£ä¸º 10086
server()

// ä½ å¯ä»¥é€šè¿‡ä¼ å‚æŒ‡å®šç«¯å£
server({ port: 10010 })
</code></pre>
<p>å‘é€çš„è¯·æ±‚ï¼Œè·¯å¾„ä»»æ„ï¼Œ POST è¯·æ±‚å‚æ•°ä¸º:</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ç±»å‹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>outPutDir</td>
<td>string</td>
<td>ç±»å‹æ–‡ä»¶è¾“å‡ºç›®å½•</td>
</tr>
<tr>
<td>outPutName</td>
<td>string</td>
<td>æ–‡ä»¶åç§°</td>
</tr>
<tr>
<td>overwrite</td>
<td>boolean</td>
<td>æ–‡ä»¶å¯å¤å†™</td>
</tr>
<tr>
<td>data</td>
<td>Json</td>
<td>è¦è§£æçš„ Json æ•°æ®</td>
</tr>
<tr>
<td>interfaceName</td>
<td>string</td>
<td>å¯¼å‡ºçš„æ¥å£åç§°</td>
</tr>
</tbody>
</table>
<h3 id="responsetypesclient">ResponseTypesClient</h3>
<p><a href="https://github.com/xdoer/PreQuest/tree/main/packages/response-types-client">response-types-client</a> æ˜¯ä¸Šæ–‡æåˆ°çš„ Server-Clinet ç±»å‹ç”Ÿæˆå™¨ ä¸­çš„ Client éƒ¨åˆ†ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸­é—´ä»¶ Wrapperï¼Œåªè¦å°†å…¶æ³¨å†Œåˆ°è¯·æ±‚åº“ä¸­é—´ä»¶ä¸­ï¼Œå³å¯å‘èµ·è¯·æ±‚ã€‚</p>
<p>ä¸‹é¢çš„ demo ä½¿ç”¨äº†æˆ‘è‡ªå·±å°è£…çš„è¯·æ±‚åº“ PreQuestï¼ŒåŸºäº Koa ä¸­é—´ä»¶æ¨¡å‹çš„è¯·æ±‚åº“åº”è¯¥éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚è¯´ Umi-Requestã€‚å¯¹äº Axiosï¼Œéœ€è¦è‡ªå·±åœ¨æ‹¦æˆªå™¨ä¸­å®ç°ï¼Œä¹Ÿéå¸¸å®¹æ˜“ã€‚</p>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-ts">import { create, Request, Response } from '@prequest/xhr'
import generateMiddleware, { TypesGeneratorInject } from '@prequest/response-types-client'

// ç”Ÿæˆä¸­é—´ä»¶
const middleware = generateMiddleware&lt;Request, Response&gt;({
  enable: process.env.NODE_ENV === 'development',
  httpAgent: create({ path: 'http://localhost:10010/' }),
  outPutDir: 'src/api-types'
  parseResponse(res) {
    // res åº”å½“è¿”å›æ¥å£ data æ•°æ®
    return res as any
  },
  typesGeneratorConfig(req, res) {
    const { path } = req
    const { data } = res

    if (!path) throw new Error('path not found')

    // æ ¹æ®è¯·æ±‚è·¯å¾„ç”Ÿæˆæ–‡ä»¶åå’Œç±»å‹å¯¼å‡ºåç§°
    const outPutName = path.replace(/.*\/(\w+)/, (_, __) =&gt; __)
    const interfaceName = outPutName.replace(/^[a-z]/, g =&gt; g.toUpperCase())

    return {
      data,
      outPutName,
      interfaceName,
      overwrite: true,
    }
  },
})

// æ³¨å…¥ TypesGeneratorInjectï¼Œ å¯åœ¨è¯·æ±‚æ—¶ï¼Œæ ¹æ® rewriteType å‚æ•°å¼ºåˆ¶é‡æ–°ç”Ÿæˆç±»å‹æ–‡ä»¶
export const prequest = create&lt;TypesGeneratorInject, {}&gt;({ baseURL: 'http://localhost:3000' })
// æ³¨å†Œä¸­é—´ä»¶
prequest.use(middleware)
</code></pre>
<h3 id="responsetypesgenerator">ResponseTypesGenerator</h3>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰åŸºäºä¸Šæ–‡ &quot;ç±»å‹ç”Ÿæˆå™¨è„šæœ¬&quot; ä¸€èŠ‚ä¸­çš„åŸç†ï¼Œè¿›è¡Œäº†ä¸€ä¸ªå¤±è´¥çš„å°è¯•:<a href="https://github.com/xdoer/PreQuest/tree/main/packages/response-types-generator">response-types-generator</a>ï¼Œä¹Ÿä¸€å¹¶æ”¾åˆ°è¿™é‡Œï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ä»¥ä¸ŠåŸºäºæˆ‘æµ…è–„çš„å­¦è¯†è¿›è¡Œçš„ä¸€äº›å¯¹ Restful å“åº”çš„ JSON æ•°æ®ç±»å‹ç”Ÿæˆçš„ä¸€äº›æ¢ç´¢ï¼Œå¦‚æœæ‚¨å‘ç°äº†æ–‡ä¸­çš„ä¸€äº›é”™è¯¯ä¹‹å¤„ï¼Œæˆ–è€…æœ‰æ›´ç®€ä¾¿çš„æ–¹å¼ç”Ÿæˆç±»å‹æ–‡ä»¶ï¼Œæ¬¢è¿åœ¨è¯„è®ºé‡Œæå‡ºæ¥ï¼Œå¤§å®¶ä¸€èµ·æ¢è®¨ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‡ ä¸ªDemo çœ‹æ‡‚ ESM ä¸ CommonJS å·®å¼‚]]></title>
        <id>https://aiyou.life/post/SV2erlm_4/</id>
        <link href="https://aiyou.life/post/SV2erlm_4/">
        </link>
        <updated>2021-07-21T12:20:41.000Z</updated>
        <summary type="html"><![CDATA[<p>CommonJS ä½œä¸º Node ç«¯æ¨¡å—å¯¼å…¥çš„äº‹å®æ–¹æ¡ˆï¼Œä¸ ES æ ‡å‡†æå‡ºçš„ ES Module æœ‰ä½•å·®å¼‚å‘¢ï¼Ÿ</p>
]]></summary>
        <content type="html"><![CDATA[<p>CommonJS ä½œä¸º Node ç«¯æ¨¡å—å¯¼å…¥çš„äº‹å®æ–¹æ¡ˆï¼Œä¸ ES æ ‡å‡†æå‡ºçš„ ES Module æœ‰ä½•å·®å¼‚å‘¢ï¼Ÿ</p>
<!-- more -->
<h2 id="ä¸€-commonjs-å’Œ-esm-éƒ½å¯ä»¥å¯¹å¼•å…¥çš„å¯¹è±¡è¿›è¡Œèµ‹å€¼">ä¸€ã€CommonJS å’Œ ESM éƒ½å¯ä»¥å¯¹å¼•å…¥çš„å¯¹è±¡è¿›è¡Œèµ‹å€¼</h2>
<h3 id="11-commonjs-æ¨¡å—">1.1 CommonJS æ¨¡å—</h3>
<pre><code class="language-js">&lt;!--- å®šä¹‰å…¥å£æ–‡ä»¶ main.js ---&gt;
const { a } = require('./test')

setTimeout(() =&gt; {
  console.log(a.value)
}, 200)

console.log(a.value)

&lt;!--- å®šä¹‰æ¨¡å—æ–‡ä»¶ test.js ---&gt;
const a = { value: 1 }

setTimeout(() =&gt; {
  a.value = 2
}, 100)

module.exports = { a }
</code></pre>
<p><strong><em>è¾“å‡º: 1, 2</em></strong></p>
<h3 id="12-esm-æ¨¡å—">1.2 ESM æ¨¡å—</h3>
<pre><code class="language-js">&lt;!--- å®šä¹‰å…¥å£æ–‡ä»¶ main.mjs ---&gt;
import  { a }  from './test.mjs'

setTimeout(() =&gt; {
  console.log(a.value)
}, 200)

console.log(a.value)

&lt;!--- å®šä¹‰æ¨¡å—æ–‡ä»¶ test.mjs ---&gt;
let a = { value: 1 }

setTimeout(() =&gt; {
  a.value = 2
}, 100)

export { a }
</code></pre>
<p><strong><em>è¾“å‡º: 1, 2</em></strong></p>
<h3 id="13-åŠ¨æ€-esm">1.3 åŠ¨æ€ ESM</h3>
<pre><code class="language-js">&lt;!--- å®šä¹‰å…¥å£æ–‡ä»¶ main.mjs ---&gt;
const { a } = await import('./test.mjs')

setTimeout(() =&gt; {
  console.log(a.value)
}, 200)

console.log(a.value)

&lt;!--- å®šä¹‰æ¨¡å—æ–‡ä»¶ test.mjs ---&gt;
let a = { value: 1 }

setTimeout(() =&gt; {
  a.value = 2
}, 100)

export { a }
</code></pre>
<p><strong><em>è¾“å‡º: 1, 2</em></strong></p>
<h2 id="äºŒ-commonjs-æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´esm-æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨">äºŒã€CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒESM æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨</h2>
<h3 id="21-commonjs-æ¨¡å—">2.1 CommonJS æ¨¡å—</h3>
<pre><code class="language-js">&lt;!--- å®šä¹‰å…¥å£æ–‡ä»¶ main.js ---&gt;
const { a } = require('./test')

setTimeout(() =&gt; {
  console.log(a)
}, 200)

console.log(a)

&lt;!--- å®šä¹‰æ¨¡å—æ–‡ä»¶ test.js ---&gt;
let a = 1

setTimeout(() =&gt; {
  a = 2
}, 100)

module.exports = { a }
</code></pre>
<p><strong><em>è¾“å‡º: 1, 1</em></strong></p>
<h3 id="22-esm-æ¨¡å—">2.2 ESM æ¨¡å—</h3>
<pre><code class="language-js">&lt;!--- å®šä¹‰å…¥å£æ–‡ä»¶ main.mjs ---&gt;
import { a }  from './test.mjs'

setTimeout(() =&gt; {
  console.log(a)
}, 200)

console.log(a)

&lt;!--- å®šä¹‰æ¨¡å—æ–‡ä»¶ test.mjs ---&gt;
let a = 1

setTimeout(() =&gt; {
  a = 2
}, 100)

export { a }
</code></pre>
<p><strong><em>è¾“å‡º: 1, 2</em></strong></p>
<h3 id="23-åŠ¨æ€-esm">2.3 åŠ¨æ€ ESM</h3>
<pre><code class="language-js">&lt;!--- å®šä¹‰å…¥å£æ–‡ä»¶ main.mjs ---&gt;
const { a } = await import('./test.mjs')

setTimeout(() =&gt; {
  console.log(a)
}, 200)

console.log(a)

&lt;!--- å®šä¹‰æ¨¡å—æ–‡ä»¶ test.mjs ---&gt;
let a = 1

setTimeout(() =&gt; {
  a = 2
}, 100)

export { a }
</code></pre>
<p><strong><em>è¾“å‡º: 1, 1</em></strong></p>
<h2 id="ä¸‰-es6-module-åªå­˜åªè¯»ä¸èƒ½æ”¹å˜å…¶å€¼æŒ‡é’ˆæŒ‡å‘ä¸èƒ½å˜">ä¸‰ã€ES6 Module åªå­˜åªè¯»ï¼Œä¸èƒ½æ”¹å˜å…¶å€¼ï¼ŒæŒ‡é’ˆæŒ‡å‘ä¸èƒ½å˜</h2>
<pre><code class="language-js">import * as a from './test.mjs'

a = 2 // throw a error
</code></pre>
<p>import å¯¼å…¥çš„å€¼ç±»ä¼¼ const å®šä¹‰ï¼Œå€¼ä¸èƒ½æ”¹å˜</p>
<h2 id="å››-commonjs-æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½es6-æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£">å››ã€CommonJS æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒES6 æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£</h2>
<h2 id="äº”-commonjs-æ¨¡å—çš„-requireæ˜¯åŒæ­¥åŠ è½½æ¨¡å—es6-æ¨¡å—çš„-import-å‘½ä»¤æ˜¯å¼‚æ­¥åŠ è½½">äº”ã€CommonJS æ¨¡å—çš„ require()æ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼ŒES6 æ¨¡å—çš„ import å‘½ä»¤æ˜¯å¼‚æ­¥åŠ è½½</h2>
<pre><code class="language-js">const { a } = await import('./test.mjs')
</code></pre>
<h2 id="å…­-commonjs-æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½es6-æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£">å…­ã€CommonJS æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒES6 æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£</h2>
<p>CommonJS åŠ è½½çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå³ module.exports å±æ€§ï¼‰ï¼Œè¯¥å¯¹è±¡åªæœ‰åœ¨è„šæœ¬è¿è¡Œå®Œæ‰ä¼šç”Ÿæˆã€‚è€Œ ESM ä¸æ˜¯å¯¹è±¡ï¼Œå®ƒçš„å¯¹å¤–æ¥å£åªæ˜¯ä¸€ç§é™æ€å®šä¹‰ï¼Œåœ¨ä»£ç é™æ€è§£æé˜¶æ®µå°±ä¼šç”Ÿæˆ</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Taro è‡ªå®šä¹‰ showModal]]></title>
        <id>https://aiyou.life/post/UNWTwtWxa/</id>
        <link href="https://aiyou.life/post/UNWTwtWxa/">
        </link>
        <updated>2021-06-26T07:53:18.000Z</updated>
        <summary type="html"><![CDATA[<p>å¾®ä¿¡å°ç¨‹åºæä¾›äº†å¾ˆå¤šç±»ä¼¼ <code>wx.showModal</code>ã€<code>wx.showLoading</code> è¿™ç±» APIï¼Œè¿™ç±» API è™½ç„¶æ–¹ä¾¿ä½¿ç”¨ï¼Œä½†æ˜¯æ ·å¼ä¸‘é™‹ï¼Œå¾€å¾€ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>æœ‰æ²¡æœ‰åŠæ³•è®©æˆ‘ä»¬çš„è‡ªå®šä¹‰å¼¹çª—ã€loading ç­‰å¯ä»¥é€šè¿‡ç±»ä¼¼å¾®ä¿¡çš„è¿™ç§ API è¿›è¡Œéšå¿ƒæ‰€æ¬²çš„è°ƒç”¨å‘¢ï¼Ÿ</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¾®ä¿¡å°ç¨‹åºæä¾›äº†å¾ˆå¤šç±»ä¼¼ <code>wx.showModal</code>ã€<code>wx.showLoading</code> è¿™ç±» APIï¼Œè¿™ç±» API è™½ç„¶æ–¹ä¾¿ä½¿ç”¨ï¼Œä½†æ˜¯æ ·å¼ä¸‘é™‹ï¼Œå¾€å¾€ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>æœ‰æ²¡æœ‰åŠæ³•è®©æˆ‘ä»¬çš„è‡ªå®šä¹‰å¼¹çª—ã€loading ç­‰å¯ä»¥é€šè¿‡ç±»ä¼¼å¾®ä¿¡çš„è¿™ç§ API è¿›è¡Œéšå¿ƒæ‰€æ¬²çš„è°ƒç”¨å‘¢ï¼Ÿ</p>
<!-- more -->
<p>é¦–å…ˆæ”¾ä¸€ä¸‹æ•ˆæœå›¾:<br>
<img src="https://aiyou.life/post-images/1624694046612.gif" alt="" loading="lazy"><br>
å¯ä»¥çœ‹åˆ°åªåœ¨ Index é¡µé¢å†™äº†ä¸€ä¸ªæŒ‰é’®ï¼Œå°±å¯ä»¥è§¦å‘æ‰“å¼€å¼¹çª—ã€‚</p>
<p>æ¥ç€æ€»ç»“ä¸€ä¸‹å…¨æ–‡:</p>
<blockquote>
<ul>
<li>åˆ©ç”¨è„šæœ¬å°†æ¯ä¸ªå¼¹çª—æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªå¼¹çª—é…ç½®</li>
<li>æ ¹æ®å¼¹çª—é…ç½®ï¼Œå¼¹çª— wrapper ç»„ä»¶ map æ¯ä¸€ä¸ªå¼¹çª—</li>
<li>ä½¿ç”¨ webpack-loader å°† wrapper ç»„ä»¶æ³¨å…¥åˆ°æ¯ä¸ªé¡µé¢</li>
<li>ä½¿ç”¨ chokidar ç›‘å¬å¼¹çª—æ–‡ä»¶çš„åˆ›å»ºï¼Œè‡ªåŠ¨è¿è¡Œè„šæœ¬ï¼Œæ›´æ–°å¼¹çª—é…ç½®</li>
<li>è®¾è®¡ API å¼çš„è°ƒç”¨é£æ ¼</li>
</ul>
</blockquote>
<p>ä¸‹æ–‡æ¶‰åŠçš„æŠ€æœ¯æ ˆä¸º: Taro ReactHook TypeScriptã€‚å¯èƒ½ä¸å…·æœ‰é€šç”¨æ€§ï¼Œä½†å¦‚æœèƒ½ä¸ºæ‚¨å¸¦æ¥ä¸€äº›æ€è€ƒå’Œæ„Ÿæ‚Ÿä¹Ÿæ˜¯æå¥½çš„ã€‚</p>
<h2 id="ç›®æ ‡">ç›®æ ‡</h2>
<p>é¦–å…ˆè§‚å¯Ÿä¸€ä¸‹ç‰¹ç‚¹ï¼š</p>
<pre><code class="language-ts">wx.showModal({
  title: &quot;æç¤º&quot;,
  content: &quot;æ“ä½œä¸åˆæ³•&quot;,
});
</code></pre>
<blockquote>
<ul>
<li>1ã€API å¼è°ƒç”¨.</li>
<li>2ã€å…¨å±€æ€§.åœ¨å°ç¨‹åºä»»æ„åœ°æ–¹éƒ½å¯ä»¥è°ƒç”¨</li>
</ul>
</blockquote>
<h2 id="api-å¼çš„è°ƒç”¨">API å¼çš„è°ƒç”¨</h2>
<p>å½“è¿›è¡Œè¿™æ ·ä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®å’ŒçŠ¶æ€ï¼Œé€šè¿‡ä¸€å®šçš„æ–¹å¼ï¼Œä¼ å…¥åˆ°æŸä¸ªç»„ä»¶ä¸­ï¼Œç»„ä»¶å†è¿›è¡Œå“åº”ã€‚ä¼ é€’æ•°æ®çš„æ–¹å¼æœ‰ props ä¸ contextã€‚ä¼ é€’ props æ–¹æ¡ˆé¦–å…ˆæ’é™¤äº†ï¼Œå› ä¸ºä½ ä¸å¯èƒ½æ¯ä¸ªç»„ä»¶è¦ä¼ å…¥å¼¹çª—çš„ propsï¼Œé‚£ä¹ˆä½¿ç”¨ context æ–¹æ¡ˆå‘¢ï¼Ÿä½¿ç”¨ context éœ€è¦åœ¨åº”ç”¨é¡¶å±‚æä¾›ä¸€ä¸ª Providerï¼Œå°†æ‰€æœ‰å¼¹çª—æ•°æ®å’Œæ˜¾éšçŠ¶æ€ï¼Œä¸ä¿®æ”¹æ•°æ®çš„æ–¹æ³•ä¼ å…¥ Provider ä¸­ï¼Œåœ¨ Consumer ä¸­ map å‡ºæ‰€æœ‰å¼¹çª—æ•°æ®ï¼Œåœ¨éœ€è¦æ‰“å¼€æˆ–å…³é—­å¼¹çª—çš„åœ°æ–¹ï¼Œä½¿ç”¨ <code>this.context</code> æˆ–è€… <code>useContext</code> æ‹¿åˆ°ä¿®æ”¹æ•°æ®æ–¹æ³•ï¼Œç„¶åæ‰èƒ½æ§åˆ¶å¼¹çª—çŠ¶æ€ã€‚</p>
<p>ä¸‹é¢æä¾›äº†ä¸€ä»½ä½¿ç”¨ context æ–¹æ¡ˆçš„ä¼ªä»£ç </p>
<pre><code class="language-tsx">const ModalContext = createContext(null)

&lt;!---- app.tsx å…¥å£æ–‡ä»¶ ----&gt;
export default function (props) {
  const [config, setConfig] = useState(modals)
  return (
    &lt;ModalContext.Provider value={{config, setConfig}}&gt;
      {props.children}
    &lt;/ModalContext.Provider&gt;
  )
}

&lt;!---- wrapper.tsx å¼¹çª— wrapper ç»„ä»¶----&gt;
// è¿™é‡Œè®¾è®¡çš„æ˜¯ n å¤šä¸ª modal å®ä¾‹ï¼ŒåŸå› æ˜¯å°† loadingã€actionSheet ç­‰ç»Ÿç§°ä¸º modal.
export function Wrapper() {
  return (
    &lt;ModalContext.Consumer&gt;
      {
        ({config}) =&gt; {
          return (
            &lt;&gt;
              {
                config.map(c =&gt; {
                  return (
                    &lt;Modal data={c} /&gt;
                  )
                })
              }
            &lt;/Modal&gt;
          )
        }
      }
    &lt;/ModalContext.Consumer&gt;
  )
}

&lt;!---- index.tsx é¦–é¡µæ–‡ä»¶----&gt;
export default function () {
  const { setConfig } = useContext(ModalContext)

  return (
    &lt;View&gt;
      {/* è¿™é‡Œå°±ä¸ç»†å†™äº†ï¼ŒåŸç†å¤§å®¶å¯ä»¥çœ‹æ‡‚ */}
      &lt;View onClick={() =&gt; setConfig((d) =&gt; { name: 'a' ,visible: true, data: 1 })}&gt;æ‰“å¼€ A å¼¹çª—&lt;/View&gt;
      &lt;Wrapper /&gt;
    &lt;/View&gt;
  )
}
</code></pre>
<p>å¯¹äº wrapper ç»„ä»¶ï¼Œéœ€è¦å¼•å…¥åˆ°æ¯ä¸€ä¸ªé¡µé¢æ–‡ä»¶ï¼Œè°ƒç”¨å¼¹çª—æ—¶ä½¿ç”¨ <code>useContext</code> ä¹Ÿå¯ä»¥æ¥å—ï¼Œä½†ä¸€å®šæ³¨æ„ä¼˜åŒ–ï¼Œä»»ä½•ä¸€å¤„ <code>setConfig</code> éƒ½ä¼šå¯¼è‡´å¼•å…¥ <code>useContext(ModalContext)</code> çš„ç»„ä»¶æˆ–é¡µé¢é‡æ–°æ¸²æŸ“ã€‚</p>
<p>æ€ä¹ˆé¿å…è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<p>å¦‚æœèƒ½å°†é¡¶å±‚çš„ <code>setConfig</code> å­˜åˆ°å¤–éƒ¨ï¼Œæ¯æ¬¡ä»å¤–éƒ¨æ–‡ä»¶å¼•å…¥ setConfig æ–¹æ³•è°ƒç”¨ã€ä¸ç›´æ¥ä½¿ç”¨ useContextï¼Œå¹¶é…åˆ memo å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</p>
<p>ä¼ªä»£ç å¦‚ä¸‹:</p>
<pre><code class="language-ts">&lt;!---- useStore è‡ªå®šä¹‰ hook ----&gt;
export let setModalConfig

export function useStore(initValue) {
  const [config, setConfig] = useState(initValue)
  setModalConfig = setConfig
  return [config, setConfig]
}

&lt;!---- app.tsx å…¥å£æ–‡ä»¶ ----&gt;
export default function (props) {
  const [config, setConfig] = useStore(modals)
  return (
    &lt;ModalContext.Provider value={{config, setConfig}}&gt;
      {props.children}
    &lt;/ModalContext.Provider&gt;
  )
}
</code></pre>
<p>å¦‚æœå°†æ¯ä¸€ä¸ª <code>useState</code> çš„ <code>data</code> å’Œ <code>setData</code> å­˜åˆ°å¤–éƒ¨ï¼Œå¹¶ä¸ºå…¶åˆ†é…ä¸€ä¸ªæ ‡è¯†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»æ„åœ°æ–¹æ ¹æ®æ ‡è¯†æ‹¿åˆ° useState ä¸­çš„æ•°æ®å’Œæ–¹æ³•ã€‚</p>
<p>åŸºäºæ­¤ï¼Œæˆ‘ä»¬å°è£…äº†ä¸€å¥—ç®€å•æ˜“ç”¨çš„çŠ¶æ€ç®¡ç†å·¥å…· <a href="https://github.com/forsigner/stook">stook</a></p>
<p>ç®€æ˜“å®ç°å¦‚ä¸‹:</p>
<pre><code class="language-ts">export const stores[] = []

// å¤–éƒ¨ä¿®æ”¹ hook çŠ¶æ€
export function mutate(key, value) {
  const cacheIdx = stores.findIndex(store =&gt; store.key === key)
  stores[cacheIdx].cbs.forEach(cb =&gt; cb(value))
}

// å¤–éƒ¨è·å– hooks çŠ¶æ€
export function getState(key) {
  const cacheIdx = stores.findIndex(store =&gt; store.key === key)
  return stores[cacheIdx].value
}

export function useStore(key, initValue?: any) {
    const cache = stores.find(store =&gt; store.key === key)
    // å¯¹äºä¸€ä¸ªç›¸åŒ key çš„ useState, é¦–å…ˆå°è¯•ä½¿ç”¨ç¼“å­˜æ•°æ®åˆå§‹åŒ–
    const [state, setState] = useState(cache?.value || initValue)

    // é˜²æ­¢åŒä¸€ä¸ª setState è¢«ç¼“å­˜å¤šæ¬¡
    if (!cache?.cbs.find(cb =&gt; cb === setState)) {
      if (!cache) {
        // å¯¹äºåŒåçš„ key, valueåº”å½“æ˜¯ç›¸åŒçš„ï¼Œéœ€è¦å°†æ¯ä¸€ä¸ªä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ä¿å­˜
        stores.push({ key, value: state, cbs: [setState] })
      } else {
        cache.cbs.push(setState)
      }
    }

    useEffect(() =&gt; {
      // ç»„ä»¶æˆ–é¡µé¢å¸è½½
      return () =&gt; {
        const cacheIdx = stores.findIndex(store =&gt; store.key === key)
        const idx = stores[cacheIdx]!.cbs.findIndex(cb =&gt; cb === setState)
        cache!.cbs.splice(idx, 1)
        if (!cache?.cbs.length) {
          stores.splice(cacheIdx, 1)
        }
      }
    }, [key, setState])

    return [
      state,
      function (value) {
        let newValue = value
        if (typeof value === 'function') {
          newValue = value(state)
        }
        const cache = stores.find(store =&gt; store.key === key)!
        cache.value = newValue
        cache.cbs.forEach(cb =&gt; cb(value))
      }
    ]
}
</code></pre>
<p>æ ¹æ®æˆ‘ä»¬è®¾è®¡çš„çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œé‚£ä¹ˆå¯ä»¥å®Œå…¨æ‘’å¼ƒ context çš„æ–¹æ¡ˆäº†ã€‚</p>
<pre><code class="language-tsx">&lt;!---- app.tsx å…¥å£æ–‡ä»¶ ----&gt;
export default function (props) {
  return props.children
}

&lt;!---- wrapper.tsx å¼¹çª— wrapper ç»„ä»¶----&gt;
export function Wrapper() {
  const [modalConfig] = useStore('modal', config)
  return (
    &lt;&gt;
      {
        ({ modalConfig }) =&gt; {
          return (
            &lt;&gt;
              {
                modalConfig.map(c =&gt; {
                  return (
                    &lt;Modal data={c} /&gt;
                  )
                })
              }
            &lt;/&gt;
          )
        }
      }
    &lt;/&gt;
  )
}

&lt;!---- index.tsx é¦–é¡µæ–‡ä»¶----&gt;
export default function () {
  return (
    &lt;View&gt;
      &lt;View onClick={() =&gt; mutate('modal', (d) =&gt; {})}&gt;æ‰“å¼€ A å¼¹çª—&lt;/View&gt;
      &lt;Wrapper /&gt;
    &lt;/View&gt;
  )
}
</code></pre>
<p>æœ‰äº†è¿™äº›åŸºç¡€ï¼Œé€šè¿‡ API å¼çš„è°ƒç”¨å¼¹çª—å°±å¥½å®ç°äº†å¾ˆå¤š</p>
<pre><code class="language-ts">class Service {
  openCommonModal(data) {
    mutate(&quot;modal&quot;, (config) =&gt; {
      const commonConfig = config.find(({ name }) =&gt; name === &quot;common&quot;);
      commonConfig.visible = true;
      commonConfig.data = data;
      return [...config];
    });
  }
}
export const service = new Service();
</code></pre>
<p>è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥é€šè¿‡ <code>service.openCommonModal</code> çš„æ–¹å¼æ‰“å¼€å¼¹çª—äº†.</p>
<h2 id="å…¨å±€è°ƒç”¨">å…¨å±€è°ƒç”¨</h2>
<p>å°ç¨‹åºä¸­æ²¡æœ‰åŠæ³•å®šä¹‰ä¸€ä¸ªå…¨å±€ç»„ä»¶ï¼Œåªèƒ½å°†ç»„ä»¶å¼•å…¥åˆ°æ¯ä¸€ä¸ªé¡µé¢ä¸­ã€‚å€ŸåŠ© webpack-loaderï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ¯ä¸ªé¡µé¢è‡ªåŠ¨æ³¨å…¥ç»„ä»¶çš„èƒ½åŠ›ã€‚</p>
<p>æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ª webpack-loaderï¼Œæ¥å®Œæˆè¿™æ ·çš„äº‹æƒ… <a href="https://github.com/xdoer/taro-inject-component-loader">taro-inject-component-loader</a></p>
<p>æ³¨å…¥åçš„æ¯ä¸€ä¸ªé¡µé¢ï¼Œéƒ½å¼•å…¥äº†å¼¹çª—ç»„ä»¶ï¼Œå› è€Œå¯ä»¥åœ¨ä»»æ„åœ°æ–¹è¿›è¡Œ service å¼¹çª—çš„è°ƒç”¨ã€‚</p>
<h2 id="è‡ªåŠ¨åŒ–">è‡ªåŠ¨åŒ–</h2>
<p>ä¸Šé¢æˆ‘ä»¬ä¸€ç›´ä½¿ç”¨äº†ä¸€ä¸ªå«åš config çš„ä¸œè¥¿ï¼Œconfig ç±»ä¼¼è·¯ç”±è¡¨æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ª Modal ç»„ä»¶å’Œåç§°çš„æ˜ å°„è¡¨</p>
<pre><code class="language-ts">const config = [
  {
    name: &quot;common&quot;,
    component: CommonModal,
  },
];
</code></pre>
<p>ä¸ºäº†æ–¹ä¾¿ç»´æŠ¤ï¼Œå»ºè®®å°†æ‰€æœ‰çš„ modal æ–‡ä»¶æ”¾ç½®åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚</p>
<pre><code class="language-text">|---src
|----|----modals
|----|------|------common.tsx
|----|------|------loading.tsx
|----|------|------actionSheet.tsx
</code></pre>
<p>è¿™æ ·çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬å·¥å…·ï¼Œéå†è¯¥æ–‡ä»¶å¤¹ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä»½é…ç½®æ–‡ä»¶ã€‚æ•ˆæœä¸ umi çº¦å®šå¼è·¯ç”±ç±»ä¼¼ã€‚æ­¤å¤–ï¼Œå¯ä»¥ä½¿ç”¨ chokidar ç›‘å¬ modals æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„åˆ é™¤å’Œåˆ›å»ºï¼Œæ¥è‡ªåŠ¨æ›´æ–° config é…ç½®æ–‡ä»¶ã€‚</p>
<p>å…¶å®ä¸å…‰æ˜¯ config é…ç½®æ–‡ä»¶ã€å¦‚æœä»”ç»†è§‚å¯Ÿ service æ–‡ä»¶çš„è¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è„šæœ¬ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä»½ service æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬å›¢é˜Ÿè®¾è®¡å’Œå®ç°äº†ä¸€å¥—è„šæœ¬å·¥å…·æ¥å®Œæˆè¿™æ ·çš„åŠŸèƒ½ã€‚</p>
<blockquote>
<ul>
<li><a href="https://github.com/forsigner/generated">generated</a>.ä¸€ä¸ª cli å·¥å…·ï¼Œä¸»è¦ç”¨æ¥è¿è¡Œé…ç½®çš„è„šæœ¬æ–‡ä»¶</li>
<li><a href="https://github.com/xdoer/generated-plugin-taro-modal-service">generated-plugin-taro-modal-service</a>.ä½¿ç”¨äº† <a href="https://ts-morph.com/">ts-morph</a> ç”Ÿæˆå¼¹çª—é…ç½®æ–‡ä»¶ã€‚</li>
<li><a href="https://github.com/xdoer/webpack-plugin-chokidar/blob/main/README_zh.md">webpack-plugin-chokidar</a>. ç»“åˆ webpack å’Œ chokidarï¼Œä¼˜åŒ–äº† åœ¨ webpack ä¸­ä½¿ç”¨çš„ api è®¾è®¡</li>
</ul>
</blockquote>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>å¸Œæœ›æ­¤æ–‡èƒ½ä¸ºå¤§å®¶å¸¦æ¥å¸®åŠ©ã€‚</p>
<p>æœ¬æ–‡æ¶‰åŠåˆ°çš„å†…å®¹å’Œæ¨¡æ¿åœ¨<a href="https://github.com/xdoer/TaroTemplate">è¿™é‡Œ</a>ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å†™ä¸€ä¸ªå€’è®¡æ—¶ğŸ˜¢ï¼Ÿ]]></title>
        <id>https://aiyou.life/post/iWhkaOqqO/</id>
        <link href="https://aiyou.life/post/iWhkaOqqO/">
        </link>
        <updated>2021-06-01T08:20:34.000Z</updated>
        <summary type="html"><![CDATA[<p>å¦‚ä½•å†™ä¸€ä¸ªé«˜æ€§èƒ½ã€æ˜“æ‰©å±•ã€æ˜“ç”¨çš„è®¡æ—¶å™¨ï¼Ÿ</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¦‚ä½•å†™ä¸€ä¸ªé«˜æ€§èƒ½ã€æ˜“æ‰©å±•ã€æ˜“ç”¨çš„è®¡æ—¶å™¨ï¼Ÿ</p>
<!-- more -->
<p>æŸæ—¥ï¼Œæ¥åˆ°äº†äº§å“éœ€æ±‚ï¼Œè¯´è¦åŠ ä¸€ä¸ªæŠ¢è´­åˆ—è¡¨é¡µé¢ï¼Œåˆ—è¡¨ä¸­æ¯ä¸€é¡¹è¦åŠ ä¸€ä¸ªæŠ¢è´­å€’è®¡æ—¶ï¼Œæ²¡å¤šæƒ³ï¼Œä½¿ç”¨ <code>setInterval</code> å¿«é€Ÿå®ç°äº†ã€‚</p>
<p>éšç€åˆ—è¡¨ä¸­é¡¹ç›®è¶Šæ¥è¶Šå¤šï¼Œå„ä¸ªé¡¹ç›®çš„å€’è®¡æ—¶è¶Šæ¥è¶Šä¸å‡†ï¼Œä¸”é¡µé¢å˜çš„è¶Šæ¥è¶Šå¡ã€‚</p>
<p>å…¶å®å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œn å¤šä¸ª <code>setInterval</code> å®ä¾‹åŒæ—¶è¿è¡Œï¼Œé˜»å¡äº† JS çº¿ç¨‹ï¼Œå¯¼è‡´é¡µé¢è¶Šæ¥è¶Šå¡ï¼Œè®¡æ—¶å™¨è®¡æ—¶å‡ºç°äº†åå·®ã€‚æœ‰æ²¡æœ‰åŠæ³•ç”¨ä¸€ä¸ª <code>setInterval</code> å®ä¾‹ï¼Œè¿›è¡Œå¤šä¸ªå€’è®¡æ—¶å‘¢?</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹ <code>setInterval</code> ç”¨æ³•:</p>
<pre><code class="language-js">setInterval(() =&gt; {
    // callback
}, 1000)
</code></pre>
<p>å¦‚æœåœ¨ <code>setInterval</code> ä¸­æ‰§è¡Œå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>ç®€å•å®ç°ä¸€ä¸‹:</p>
<pre><code class="language-js">class Timer {
    private timerId
    private cbs = []
    private cbId = 0

    constructor(delay) {
        this.delay = delay
    }

    private start() {
        this.timerId = setInterval(() =&gt; {
            this.cbs.forEach(item =&gt; {
                item.cb()
            })
        }, this.delay)
    }

    private stop() {
        clearInterval(this.timerId)
    }

    add(cb) {
        const id = this.cbId++
        this.cbs.push({ cb, id })
        if(!this.timerId) this.start()
        return id
    }

    remove(cbId) {
        const cbIdx = this.cbs.findIndex(({ id }) =&gt; id === cbId)
        this.cbs.splice(cbIdx, 1)
        if(!this.cbs.length) this.stop()
    }
}
</code></pre>
<p>é—®é¢˜åˆæ¥äº†ï¼Œä¸åŒçš„å›è°ƒå‡½æ•°ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„è®¡æ—¶é—´éš”ï¼Œè¿™æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<p>å¯ä»¥é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè®¡ç®— <code>setInterval</code> çš„æ‰§è¡Œæ¬¡æ•°ï¼Œæ‰§è¡Œæ¬¡æ•° * é—´éš”æ—¶é—´å°±æ˜¯æ‰§è¡Œæ€»æ—¶é—´ï¼Œæœ‰äº†æ‰§è¡Œæ€»æ—¶é—´å°±å¥½åŠäº†ï¼Œåªéœ€è¦è¿›è¡Œä½™è¿ç®—å³å¯ã€‚</p>
<p>é¦–å…ˆè®¾è®¡ cb å¯¹è±¡æ•°æ®ç»“æ„</p>
<pre><code class="language-js">interface CallBack {
    id: number   // å›è°ƒ id
    cb: () =&gt; any   // å›è°ƒå‡½æ•°
    interval: number    // æ‰§è¡Œå›è°ƒé—´éš”
}
</code></pre>
<p>å†æ¥å®ç°demo:</p>
<pre><code class="language-js">// some code
let count = 0
let delay = 1000
let cbs: CallBack[] = []
 setInterval(() =&gt; {
    cbs.forEach(({ cb, interval }) =&gt; {
        if(!(count * delay % interval)) {
            cb()
        }
    })
}, delay)
// some code
</code></pre>
<p>ä¸Šé¢ demo ä¸­å†™æ­»äº†æ‰§è¡Œé—´éš”ä¸º 1000msï¼Œé‚£å¯¹äºæ³¨å†Œäº† 500ms æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ¥è®²ï¼Œä¼šå»¶è¿Ÿ 500ms åæ‰æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥éå†æ‰€æœ‰ cbsï¼Œä»ä¸­è·å–æœ€å°çš„ interval å½“åš delay å³å¯ã€‚</p>
<pre><code class="language-js">// some code
const min = this.cbs[0].interval
const delay = this.cbs.reduce((min, cur) =&gt;  cur.interval &lt; min ? cur.interval : min,min)
// some code
</code></pre>
<p>ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦ new ä¸€ä¸ª Timer å®ä¾‹ï¼Œåœ¨éœ€è¦å€’è®¡æ—¶çš„åœ°æ–¹ï¼Œé€šè¿‡ add æ·»åŠ å›è°ƒå‡½æ•°å³å¯è‡ªåŠ¨å¯åŠ¨è®¡æ—¶å™¨ï¼Œåˆ é™¤æ—¶ï¼Œè°ƒç”¨ remove æ–¹æ³•ï¼Œåˆ é™¤å®Œæ‰€æœ‰æ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼Œè®¡æ—¶å™¨è‡ªåŠ¨åœæ­¢ã€‚</p>
<pre><code class="language-js">const timer = new Timer()

const timerId = timer.add(() =&gt; {}, 1000)
timer.remove(timerId)
</code></pre>
<p>æˆ–è€…å†æ”¹é€ ä¸€ä¸‹ï¼Œå®ç°ç±»ä¼¼ <code>setTimeout</code> å’Œ <code>setInterval</code> çš„è°ƒç”¨æ–¹å¼</p>
<pre><code class="language-js">const setTimeoutInterval = timer.add.bind(timer)
const clearTimeoutInterval = timer.remove.bind(timer)
</code></pre>
<p>è°ƒç”¨</p>
<pre><code class="language-js">const timer = setTimeoutInterval(() =&gt; {
    // some code
})

clearTimeoutInterval(timerId)
</code></pre>
<p>æ”¹é€ åçš„å€’è®¡æ—¶æ€§èƒ½æ— ç–‘å¥½äº†è®¸å¤šï¼Œé¡µé¢ä¸å†å¡é¡¿ã€‚ä¸”æ— è®ºæ·»åŠ å¤šå°‘ä¸ªè®¡æ—¶å›è°ƒï¼Œå®ƒè¿è¡Œçš„éƒ½æ˜¯åŒä¸€ä¸ªè®¡æ—¶å®ä¾‹ã€‚</p>
<p>ä½¿ç”¨ <code>setInterval</code> çš„è®¡æ—¶è¿˜æ˜¯è¶Šæ¥è¶Šä¸å‡†ï¼Œ<code>setInterval</code> ä¼šå°†å›è°ƒå‡½æ•°é—´éš”æ’å…¥ JS çº¿ç¨‹ä¸­ï¼Œä½†çº¿ç¨‹å¦‚æœæ­£åœ¨æ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼Œæ’å…¥çš„å›è°ƒå‡½æ•°å°†åç§»å…¶åº”å½“åœ¨çš„ä½ç½®ï¼Œæ»åæ‰§è¡Œï¼Œä¸‹ä¸€æ¬¡æ’å…¥çš„ä½ç½®ï¼Œå‚ç…§äº†æ»åæ’å…¥çš„ä½ç½®ï¼Œæ‰€ä»¥å¯¼è‡´è¿è¡Œæ—¶é—´è¶Šé•¿ï¼Œåå·®è¶Šå¤§ã€‚</p>
<p>ä½¿ç”¨é€’å½’ <code>setTimeout</code> ï¼Œä¸æ–­ä¿®æ­£å°†å›è°ƒå‡½æ•°æ’å…¥çº¿ç¨‹çš„æ—¶é—´ï¼Œå³å¯è·å¾—ç›¸å¯¹å‡†ç¡®çš„å€’è®¡æ—¶ã€‚</p>
<p>ç®€å•å®ç°ä¸€ä¸‹:</p>
<pre><code class="language-js">let count = 0 // é€’å½’æ¬¡æ•°
let now = Date.now() // åˆå§‹æ‰§è¡Œæ—¶é—´

function countdown() {
    const offset = Date.now() - (now + count * 1000)
    const nextTime = 1000 - offset
    count++

    setTimeout(() =&gt; {
        countdown()
    }, nextTime)
}
countdown()
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬è®°å½•äº†åˆå§‹æ‰§è¡Œæ—¶é—´ï¼Œå’Œ countdown é€’å½’æ‰§è¡Œçš„æ¬¡æ•°ï¼Œæ ¹æ®è¿™ä¸¤è€…ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºåç§»æ—¶é—´å’Œä¸‹æ¬¡ <code>setTimeout</code> çš„æ—¶é—´ã€‚</p>
<p>æ”¹é€ åï¼Œè™½ç„¶å€’è®¡æ—¶å‡†ç¡®äº†è®¸å¤šã€‚ä½†ï¼Œåˆå›åˆ°äº†ä¸Šé¢çš„é—®é¢˜ï¼Œåˆ—è¡¨é¡¹è¶Šå¤šï¼Œ <code>setTimeout</code> å®ä¾‹è¶Šå¤šï¼Œé¡µé¢ä¹Ÿä¼šè¶Šæ¥è¶Šå¡ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>setTimeout</code> æ¨¡æ‹Ÿ <code>setinterval</code>ï¼Œå¹¶å°†å…¶æ›¿æ¢åˆ°ä¸Šé¢æˆ‘ä»¬çš„ <code>Timer</code> ç±»ä¸­ã€‚å³å¯è§£å†³é—®é¢˜ã€‚</p>
<pre><code class="language-js">function timeoutInterval(cb, interval = 1000ï¼Œ getTimerId) {
  let count = 0
  let now = Date.now()
  let timerId = null

  function countdown() {
    const offset = Date.now() - (now + count * interval)
    const nextTime = interval - offset
    count++

    timerId = setTimeout(() =&gt; {
      countdown()
      cb()
    }, nextTime)

    getTimerId(timerId)
  }

  countdown()
}
</code></pre>
<p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨é€’å½’ <code>setTimeout</code>, æ‰€ä»¥æ¯æ¬¡ç”Ÿæˆçš„ <code>timeId</code> éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è®¾è®¡å°†å…¶é€šè¿‡ <code>cb</code> å›è°ƒå‡½æ•°çš„å‚æ•°ä¼ å‡ºã€‚</p>
<p>ç”¨æ³•å¦‚ä¸‹:</p>
<pre><code class="language-js">let i = 0
timeoutInterval(
    () =&gt; {
    // do something
    }, 
    1000,
    (timerId) =&gt; {
        this.timerId = timerId
    }
)
</code></pre>
<p>å°†å…¶æ›¿æ¢åˆ° <code>Timer</code> ç±»ä¸­</p>
<pre><code class="language-js">class Timer {
    // some code
    private start() {
        timeoutInterval(
            () =&gt; {
                this.cbs.forEach(item =&gt; {
                    item.cb()
                })
            }, 
            1000,
            (timerId) =&gt; {
                this.timerId = timerId
            }
        )
    }
    // some code
}
</code></pre>
<p>æ”¹é€ åçš„å€’è®¡æ—¶æ€§èƒ½è‰¯å¥½ï¼Œä¸”å› ä¸ºåªæœ‰ä¸€ä¸ªè®¡æ—¶å®ä¾‹ï¼Œé¡µé¢ä¹Ÿä¸ä¼šå¡é¡¿ã€‚</p>
<p>å…·ä½“å®ç°è¯·æŸ¥é˜…ä»£ç : <a href="https://github.com/xdoer/TimeoutInterval">TimeoutInterval</a></p>
<p>å¯¹äºä¸€äº›ç§’æ€æŠ¢è´­åœºæ™¯ï¼Œè¿™ç§å€’è®¡æ—¶æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºæœ¬åœ°æ—¶é—´ä¸æœåŠ¡å™¨æ—¶é—´æœ‰åå·®ï¼Œå¦‚æœæŠ¢è´­å•çº¯ç”±å‰ç«¯å€’è®¡æ—¶æ¥æ§åˆ¶ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å‡ºç°ç”¨æˆ·ä¿®æ”¹æœ¬æœºæ—¶é—´ï¼Œé¡µé¢å°±å‡ºç°äº†è´­ä¹°æŒ‰é’®å¯ä»¥ç›´æ¥è´­ä¹°çš„ bugã€‚ç”±æœ¬åœ°è®¡æ—¶å¼•èµ·çš„ bugï¼Œåœ¨ç›®å‰å¸‚é¢ä¸Šçš„ APP ä¸Šå¾ˆå¸¸è§ï¼Œé™¤äº†æŠ¢è´­åœºæ™¯å¤–ï¼Œæ¥å£é˜²é‡æ”¾æœºåˆ¶ä¸­ä¼šæ ¡éªŒå®¢æˆ·ç«¯è¯·æ±‚æºå¸¦çš„æ—¶é—´æˆ³ï¼Œé€šå¸¸çº¦å®šï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶é—´æˆ³ä¸æœåŠ¡ç«¯æ—¶é—´åå·®åœ¨ 60s ä¹‹å¤–ï¼Œåˆ™è¯¥è¯·æ±‚æ— æ•ˆï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹æœ¬æœºæ—¶é—´åï¼Œæ‰“å¼€æŸäº› APPï¼Œä¼šçœ‹åˆ°ç©ºç™½é¡µé¢ã€‚</p>
<p>è§£å†³åŠæ³•å¾ˆç®€å•ã€‚</p>
<p>æ‰“å¼€åº”ç”¨åï¼Œé¦–å…ˆå°†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„åç§»æ—¶é—´å­˜åˆ°æœ¬åœ°ï¼Œç§’æ€å€’è®¡æ—¶çš„æ—¶å€™ï¼Œå°†åç§»æ—¶é—´åŠ ä¸Šå³å¯ã€‚è¿™æ ·çš„è¯ï¼Œæ— è®ºå®¢æˆ·ç«¯æ—¶é—´æ˜¯æå‰è¿˜æ˜¯ä¹‹åï¼Œéƒ½å¯¹åº”ç”¨æ²¡æœ‰å½±å“ã€‚</p>
<p>ç®€å•å†™ä¸ª demo:</p>
<pre><code class="language-js">// é¦–å…ˆè·å–åç§»æ—¶é—´
prequest('/api').then(res =&gt; {
    // nginx æœåŠ¡å™¨ï¼Œå¯ä»¥ä»å“åº”å¤´æ‹¿åˆ°æ—¶é—´
    const date = res.headers.Date
    const offsetTime = Date.now() - new Date(date).getTime()
    localStorage.setItem('offsetTime', offsetTime)
})

// å°è£…è·å–æ—¶é—´æ–¹æ³•
function getNow() {
    const offset = localStorage.getItem('offsetTime')
    return Date.now() + Number.parseInt(offset)
}
</code></pre>
<p>å›åˆ°æˆ‘ä»¬çš„è®¡æ—¶å™¨ä»£ç ï¼Œåªéœ€è¦å°†å…¶ä¸­çš„ <code>Date.now()</code> æ–¹æ³•æ›¿æ¢æˆ è¿™é‡Œçš„ <code>getNow()</code> å³å¯ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸Šé¢çš„ä»£ç å·²ç»å¯ä»¥åº”å¯¹å¤§éƒ¨åˆ†è®¡æ—¶åœºæ™¯ï¼Œä½†å¯¹äºç§’æ€åœºæ™¯æ¥è¯´ï¼Œæœ¬åœ°è¿è¡Œçš„å€’è®¡æ—¶å¯èƒ½è¿˜æ˜¯ä¸å¤Ÿå¯é ï¼Œå¯ä»¥è®¾è®¡é—´æ­‡æ€§è¯·æ±‚æ¥å£è·å–æœåŠ¡ç«¯æ—¶é—´ï¼Œæ›´æ–°å€’è®¡æ—¶ï¼Œæ¥è·å¾—æ›´é«˜è®¡æ—¶ç²¾ç¡®åº¦ã€‚</p>
<p>é¦–å…ˆå¤§è‡´è®¾è®¡è·å–æœåŠ¡ç«¯æ—¶é—´æ–¹æ³•</p>
<pre><code class="language-js">async function getServerTime() {
    const start = Date.now()    // å¼€å¯è¯·æ±‚æ—¶é—´
    const serverTime = await prequest('/api').then(res =&gt; ...)
    const endTime = Date.now()
    return serverTime + (endTime - startTime) / 2
}
</code></pre>
<p>è¿™é‡Œè€ƒè™‘äº†è¯·æ±‚ç½‘ç»œæ¶ˆè€—çš„æ—¶é—´ã€‚</p>
<p>å…¶æ¬¡è€ƒè™‘æˆ‘ä»¬å€’è®¡æ—¶ï¼Œå½“æ¯æ¬¡æ‹¿åˆ°æœåŠ¡ç«¯æ—¶é—´åï¼ŒåŠ ä¸Š <code>interval</code> æ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦å’Œç›®æ ‡æ—¶é—´ç›¸ç­‰å³å¯ã€‚</p>
<p>demoå¦‚ä¸‹</p>
<pre><code class="language-js">let now = Date.now()
let interval = 1000
setInterval(() =&gt; {
    if (now + interval &gt;=  endTime) {
        // some code
    }
}, interval)

setInterval(() =&gt; {
    getServerTime(res).then(res =&gt; now = res)
}, 5000)
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬ç»´æŠ¤äº†ä¸¤ä¸ªè®¡æ—¶å™¨ï¼Œä¸€ä¸ªè´Ÿè´£è¯·æ±‚æ¥å£æ›´æ–° <code>now</code> æ•°æ®ï¼Œä¸€ä¸ªè¿›è¡Œæ­£å¸¸å€’è®¡æ—¶ï¼Œå†™æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>å½“æœ‰ n å¤šä¸ªè¿™æ ·çš„å€’è®¡æ—¶å®ä¾‹ï¼Œä»£ç å°†ä¸å¯ç»´æŠ¤ã€‚å¯ä»¥æ”¹é€ ä¸€ä¸‹ä»£ç ï¼Œä½¿ç”¨ç±»ä¼¼äº‹ä»¶å‘å¸ƒè®¢é˜…çš„æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>é¦–å…ˆå®ç°ä¸€ä¸ª <code>manager</code> æ¥å®ç°äº‹ä»¶å‘å¸ƒè®¢é˜…çš„é€»è¾‘</p>
<pre><code class="language-js">class CountDowmManager {
    queue = []
    tiemrId = null

    constructor({ getRemoteDate, interval }) {
        this.getRemoteDate = getRemoteDate
        this.interval = interval
    }

    private start() {
        this.timerId = timer.add(() =&gt; {
            this.getNow()
        }, this.interval)
    }

    private stop() {
        timer.remove(this.timerId)
    }

    on (countdown) {
        this.queue.push(countdown)
        if(!this.timerId) this.start()
    }

    off(countdown) {
        this.queue.splice(this.queue.findIndex(i =&gt; i === countdown), 1)
        if(!this.queue.length) this.stop()
    }

    private async getNow() {
        try {
            const start = Date.now()
            const nowStr = await this.opt.getRemoteDate()
            const end = Date.now()
            this.queue.forEach((instance) =&gt; (instance.now = new Date(nowStr).getTime() + (end - start) / 2)
        } catch (e) {
            console.log('fix time fail', e)
        }
    }
}
</code></pre>
<p>åœ¨ <code>CountDownManager</code> ç±»ä¸­ï¼Œç»´æŠ¤äº†ä¸€ä¸ª <code>countdown</code> å®ä¾‹çš„é˜Ÿåˆ—ï¼Œæ¯éš” <code>interval</code> ä¸ªæ—¶é—´ï¼Œä¼šè¯·æ±‚æ¥å£ï¼Œæ›´æ–°æ‰€æœ‰å®ä¾‹çš„ <code>now</code> å€¼ã€‚åŒæ—¶è®¾è®¡å°†è·å–æœåŠ¡å™¨æ—¶é—´çš„å‡½æ•°ç”±å‚æ•°ä¼ å…¥ï¼Œå·²æ»¡è¶³ä¸åŒåœºæ™¯çš„ä¸åŒéœ€æ±‚ã€‚</p>
<p>æ¥ç€ï¼Œè®¾è®¡å€’è®¡æ—¶</p>
<pre><code class="language-js">class CountDown {
    now = Date.now()
    timerId = null

   // ... some code
    start() {
        this.timerId = timer.add(() =&gt; {
            this.now += interval

            if (this.now &gt;= endTime) {
                // some code
                return
            }
        })
    }

    // some code
}
</code></pre>
<p>ç”¨æ³•å¦‚ä¸‹:</p>
<pre><code class="language-js">const manager = new CountDownManager()

const instance1 = new CountDown()
const instance2 = new CountDown()

manager.on(instance1) 
manager.on(instance2)
</code></pre>
<p>ä¸Šé¢çš„ <code>CounDown</code>  ä»£ç ä¸­ï¼Œåªè€ƒè™‘äº†ä½¿ç”¨ <code>server</code> æ›´æ–°æ—¶é—´çš„åœºæ™¯ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸Šé¢ä½¿ç”¨æœ¬åœ°æ—¶é—´è¿›è¡Œçš„å€’è®¡æ—¶ï¼Œæ•´åˆåˆ° <code>countDown</code> ç±»ä¸­ã€‚å…¶æ¬¡ï¼Œå¯ä»¥è®¾è®¡å°† <code>manager</code> ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥åˆ° <code>countdown</code> å®ä¾‹ï¼Œè¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨çš„æ³¨å†Œå’Œç§»é™¤ <code>countdown</code> å®ä¾‹ï¼Œå°† <code>managr</code> å½“å‚æ•°ä¼ å…¥ï¼Œåœ¨åˆå§‹åŒ–å®ä¾‹æ—¶ï¼Œå°±å¯ä»¥è‡ªåŠ¨å°†å½“å‰å®ä¾‹æ³¨å†Œï¼›å½“å€’è®¡æ—¶ç»“æŸï¼Œè‡ªåŠ¨å°†å½“å‰å®ä¾‹ç§»é™¤ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®æ˜¯å¦ä¼ å…¥ <code>manager</code> æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨æœåŠ¡ç«¯æ¥æ›´æ–°æ—¶é—´ã€‚</p>
<p>æ”¹é€ ä¸€ä¸‹ä»£ç </p>
<pre><code class="language-js">class CountDown() {

    constructor({ manager, ...opt }) {
        this.manager = manager
        manager ? this.useServerToCountDown(...opt) : this.useLocalToCountDown(...opt)
    }

    useServerToCountDown() {
        // ...some code
        this.manager.on(this)
    }

    // ...some code

    clear() {
        timer.clear(this.timer)
        if(this.manager) {
            this.manager.off(this)
        }
    }
}
</code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œå¥½æ‰©å±•ï¼Œæ˜“ç”¨çš„è®¡æ—¶å™¨äº†ã€‚</p>
<p>å®Œæ•´ä»£ç è¯·æŸ¥é˜… <a href="https://github.com/xdoer/CountDown">CountDown</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æƒ³åˆ°çš„ä¸€äº›å¾ˆå¥½çš„é¢è¯•é¢˜]]></title>
        <id>https://aiyou.life/post/4XYWTWTx/</id>
        <link href="https://aiyou.life/post/4XYWTWTx/">
        </link>
        <updated>2021-05-30T07:32:50.000Z</updated>
        <summary type="html"><![CDATA[<p>å†™ä»£ç çš„æ—¶å€™ï¼Œæƒ³åˆ°çš„å’Œé‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚æƒ³æ¥å¯ä»¥åšé¢è¯•é¢˜ã€‚ç‰¹è®°å½•äºæ­¤ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å†™ä»£ç çš„æ—¶å€™ï¼Œæƒ³åˆ°çš„å’Œé‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚æƒ³æ¥å¯ä»¥åšé¢è¯•é¢˜ã€‚ç‰¹è®°å½•äºæ­¤ã€‚</p>
<!-- more -->
<h2 id="å¯¹è±¡">å¯¹è±¡</h2>
<p>1ã€<code>{} === {}</code> æ˜¯å¦ç›¸ç­‰ï¼Ÿ<br>
2ã€<code>obj.a === obj.a</code> æ˜¯å¦ç›¸ç­‰?</p>
<pre><code class="language-ts">const obj = {
    a: {}
}
</code></pre>
<p>3ã€æ€æ ·ä½¿ <code>obj.a !== obj.a</code></p>
<pre><code class="language-ts">const obj = {
    get a() {
        return {}
    }
}
</code></pre>
<p>4ã€<code>obj.a === obj.a</code> æ˜¯å¦ç›¸ç­‰? <code>obj.a</code> è®¿é—®åˆ°çš„æ˜¯å“ªä¸€ä¸ªï¼Ÿ</p>
<pre><code class="language-ts">const obj = {
    a: {}
    get a() {
        return {}
    }
}
</code></pre>
<p>5ã€<code>getter</code> è®¿é—®ä¸è®¿é—®å™¨è®¿é—®æœ‰ä½•åŒºåˆ«ï¼Ÿ<br>
getter å¯å®šä¹‰åœ¨å®ä¾‹å’Œç±»ä¸Šï¼Œå€¼ä¸ºä¸€ä¸ªæ— å‚æ•°çš„å‡½æ•°ï¼Œå¯ä»¥æƒ°æ€§èµ‹å€¼ã€‚</p>
<p>6ã€<code>getter</code> è®¿é—®ä¸è®¿é—®å™¨å­˜åœ¨ç›¸åŒå±æ€§çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•é€šè¿‡<code>getter</code>è®¿é—®</p>
<pre><code class="language-ts">const obj = {
    a: {}
    get a() {
        return {}
    }
}
</code></pre>
<p>å½“åœ¨å®ä¾‹ä¸Šå®šä¹‰ <code>getter</code> è®¿é—®ï¼Œåˆ™ <code>getter</code> å­˜åœ¨äºå®ä¾‹ä¸Šã€‚è™½ç„¶å¯ä»¥å®šä¹‰åŒåå±æ€§ï¼Œä½†å´è®¿é—®ä¸åˆ° ã€‚</p>
<p>ä½¿ç”¨ <code>delete obj.a</code> å°†ä¼šéƒ½åˆ æ‰ã€‚</p>
<p>å¯ä»¥è€ƒè™‘å°†å…¶å®šä¹‰åˆ°åŸå‹ä¸Šã€‚</p>
<pre><code class="language-ts">class A {
    a = 1
    get a() {
        return 2
    }
}
const obj = new A()

obj.a === 1 // true
obj.__proto__a === 2 // true

delete obj.a

obj.a === 2 // true
</code></pre>
<p>7ã€<code>arr[0] === null</code> æ˜¯å¦ç›¸ç­‰ï¼Ÿä¸ºä»€ä¹ˆ?</p>
<pre><code class="language-ts">const obj = { a: 1 }
const arr = [obj]
obj = null
</code></pre>
<p>8ã€<code>arr.get(obj) === null</code> æ˜¯å¦ç›¸ç­‰ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p>
<pre><code class="language-ts">let obj = { a: 1 }
const map = new WeakMap()
map.set(obj, { a: 1 })
obj = null
</code></pre>
<p>9ã€a, b, c çš„åŒºåˆ«ï¼Ÿå¦‚ä½•åœ¨ class å†™æ³•ä¸Šçš„åŸå‹ä¸Šå®šä¹‰å€¼ï¼Ÿ</p>
<pre><code class="language-ts">class A {
    a = 1

    constructor() {
        this.b = 2
    }

    c() {
        return 3
    }
}
</code></pre>
<p>a, b, c çš„åŒºåˆ«ï¼Ÿå¦‚ä½•åœ¨åŸå‹ä¸Šå®šä¹‰å€¼ï¼Ÿ</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç”±å°è£…ä¸€ä¸ªè¯·æ±‚åº“æ‰€æƒ³åˆ°çš„]]></title>
        <id>https://aiyou.life/post/M4RcI3wfU/</id>
        <link href="https://aiyou.life/post/M4RcI3wfU/">
        </link>
        <updated>2021-05-06T07:32:44.000Z</updated>
        <summary type="html"><![CDATA[<p>æ˜¯å¦æœ‰ä¸€ç§æ–¹å¼ï¼Œä»åº•å‘ä¸Šçš„ï¼Œé’ˆå¯¹ä¸åŒçš„è¯·æ±‚å†…æ ¸å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºå…¶èµ‹äºˆè¯·æ±‚åº“æ‹¦æˆªå™¨ã€ä¸­é—´ä»¶ã€å¿«æ·è¯·æ±‚ç­‰å‡ ä¸ªé€šç”¨åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿ç•™ä¸åŒè¯·æ±‚å†…æ ¸çš„å·®å¼‚åŒ–ï¼Ÿ</p>
]]></summary>
        <content type="html"><![CDATA[<p>æ˜¯å¦æœ‰ä¸€ç§æ–¹å¼ï¼Œä»åº•å‘ä¸Šçš„ï¼Œé’ˆå¯¹ä¸åŒçš„è¯·æ±‚å†…æ ¸å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºå…¶èµ‹äºˆè¯·æ±‚åº“æ‹¦æˆªå™¨ã€ä¸­é—´ä»¶ã€å¿«æ·è¯·æ±‚ç­‰å‡ ä¸ªé€šç”¨åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿ç•™ä¸åŒè¯·æ±‚å†…æ ¸çš„å·®å¼‚åŒ–ï¼Ÿ</p>
<!-- more -->
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ€è¿‘æƒ³å†™ä¸€ä¸ªå¯ä»¥é€‚é…å¤šå¹³å°çš„è¯·æ±‚åº“ï¼Œåœ¨ç ”ç©¶ xhr å’Œ fetch å‘ç°äºŒè€…çš„å‚æ•°ã€å“åº”ã€å›è°ƒå‡½æ•°ç­‰å·®åˆ«å¾ˆå¤§ã€‚æƒ³åˆ°å¦‚æœè¯·æ±‚åº“æƒ³è¦é€‚é…å¤šå¹³å°ï¼Œéœ€è¦ç»Ÿä¸€çš„ä¼ å‚å’Œå“åº”æ ¼å¼ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šåœ¨è¯·æ±‚åº“å†…éƒ¨åšå¤§é‡çš„åˆ¤æ–­ï¼Œè¿™æ ·ä¸ä½†è´¹æ—¶è´¹åŠ›ï¼Œè¿˜ä¼šå±è”½æ‰åº•å±‚è¯·æ±‚å†…æ ¸å·®å¼‚ã€‚</p>
<p>é˜…è¯» axios å’Œ umi-request æºç æ—¶æƒ³åˆ°ï¼Œè¯·æ±‚åº“å…¶å®åŸºæœ¬éƒ½åŒ…å«äº†æ‹¦æˆªå™¨ã€ä¸­é—´ä»¶å’Œå¿«æ·è¯·æ±‚ç­‰å‡ ä¸ªé€šç”¨çš„ï¼Œä¸å…·ä½“è¯·æ±‚è¿‡ç¨‹æ— å…³çš„åŠŸèƒ½ã€‚ç„¶åé€šè¿‡ä¼ å‚ï¼Œè®©ç”¨æˆ·æ¥è§¦åº•å±‚è¯·æ±‚å†…æ ¸ã€‚é—®é¢˜åœ¨äºï¼Œè¯·æ±‚åº“å†…ç½®å¤šä¸ªåº•å±‚è¯·æ±‚å†…æ ¸ï¼Œå†…æ ¸æ”¯æŒçš„å‚æ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸Šå±‚åº“å¯èƒ½åšä¸€äº›å¤„ç†ï¼ŒæŠ¹å¹³ä¸€äº›å‚æ•°çš„å·®å¼‚åŒ–ï¼Œä½†å¯¹äºåº•å±‚å†…æ ¸çš„ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œè¦ä¹ˆæ”¾å¼ƒï¼Œè¦ä¹ˆåªèƒ½åœ¨å‚æ•°åˆ—è¡¨ä¸­åŠ å…¥ä¸€äº›å…·ä½“å†…æ ¸çš„ç‰¹æœ‰çš„å‚æ•°ã€‚æ¯”å¦‚åœ¨ axios ä¸­ï¼Œå®ƒçš„è¯·æ±‚é…ç½®å‚æ•°åˆ—è¡¨ä¸­ï¼Œç½—åˆ—äº†ä¸€äº› <a href="https://axios-http.com/docs/req_config">browser only</a>çš„å‚æ•°ï¼Œé‚£å¯¹äºåªéœ€è¦åœ¨ node ç¯å¢ƒä¸­è¿è¡Œçš„ axios æ¥è¯´ï¼Œå‚æ•°å¤šå°‘æœ‰äº›å†—ä½™ï¼Œå¹¶ä¸”å¦‚æœ axios è¦æ”¯æŒå…¶ä»–è¯·æ±‚å†…æ ¸(æ¯”å¦‚å°ç¨‹åºã€å¿«åº”ç”¨ã€åä¸ºé¸¿è’™ç­‰)ï¼Œé‚£ä¹ˆå‚æ•°å†—ä½™ä¹Ÿå°†è¶Šæ¥è¶Šå¤§ï¼Œæ‰©å±•æ€§ä¹Ÿå·®ã€‚</p>
<p>æ¢ä¸ªæ€è·¯æ¥æƒ³ï¼Œæ—¢ç„¶å®ç°ä¸€ä¸ªé€‚é…å¤šå¹³å°çš„ç»Ÿä¸€çš„è¯·æ±‚åº“æœ‰è¿™äº›é—®é¢˜ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥ä»åº•å‘ä¸Šçš„ï¼Œé’ˆå¯¹ä¸åŒçš„è¯·æ±‚å†…æ ¸ï¼Œæä¾›ä¸€ç§æ–¹å¼å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºå…¶èµ‹äºˆæ‹¦æˆªå™¨ã€ä¸­é—´ä»¶ã€å¿«æ·è¯·æ±‚ç­‰å‡ ä¸ªé€šç”¨åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿ç•™ä¸åŒè¯·æ±‚å†…æ ¸çš„å·®å¼‚åŒ–ï¼Ÿ</p>
<h2 id="è®¾è®¡å®ç°">è®¾è®¡å®ç°</h2>
<p>æˆ‘ä»¬çš„è¯·æ±‚åº“è¦æƒ³ä¸è¯·æ±‚å†…æ ¸æ— å…³ï¼Œé‚£ä¹ˆåªèƒ½é‡‡ç”¨å†…æ ¸ä¸è¯·æ±‚åº“ç›¸åˆ†ç¦»çš„æ¨¡å¼ã€‚ä½¿ç”¨æ—¶ï¼Œéœ€è¦å°†è¯·æ±‚å†…æ ¸ä¼ å…¥ï¼Œåˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹ï¼Œå†è¿›è¡Œä½¿ç”¨ã€‚æˆ–è€…åŸºäºè¯·æ±‚åº“ï¼Œä¼ å…¥å†…æ ¸ï¼Œé¢„ç½®è¯·æ±‚å‚æ•°æ¥è¿›è¡ŒäºŒæ¬¡å°è£…ã€‚</p>
<h3 id="åŸºæœ¬æ¶æ„">åŸºæœ¬æ¶æ„</h3>
<p>é¦–å…ˆå®ç°ä¸€ä¸ªåŸºæœ¬çš„æ¶æ„</p>
<pre><code class="language-ts">class PreQuest {
    constructor(private adapter)
    
    request(opt) {
        return this.adapter(opt)
    }
}

const adapter = (opt) =&gt; nativeRequestApi(opt)
// eg: const adapter = (opt) =&gt; fetch(opt).then(res =&gt; res.json())

// åˆ›å»ºå®ä¾‹
const prequest = new PreQuest(adapter)

// è¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯ adapter å‡½æ•°
prequest.request({ url: 'http://localhost:3000/api' })
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œé¥¶äº†ä¸ªå¼¯ï¼Œé€šè¿‡å®ä¾‹æ–¹æ³•è°ƒç”¨äº† adapter å‡½æ•°ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼Œä¸ºä¿®æ”¹è¯·æ±‚å’Œå“åº”æä¾›äº†æƒ³è±¡ç©ºé—´ã€‚</p>
<pre><code class="language-ts">class PreQuest {
    // ...some code
    
    async request(opt){
        const options = modifyReqOpt(opt)
        const res = await this.adapter(options)
        return modifyRes(res)
    }

    // ...some code
}
</code></pre>
<h3 id="ä¸­é—´ä»¶">ä¸­é—´ä»¶</h3>
<p>å¯ä»¥é‡‡ç”¨ koa çš„æ´‹è‘±æ¨¡å‹ï¼Œå¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªå’Œä¿®æ”¹ã€‚</p>
<p>ä¸­é—´ä»¶è°ƒç”¨ç¤ºä¾‹:</p>
<pre><code class="language-ts">const prequest = new PreQuest(adapter)

prequest.use(async (ctx, next) =&gt; {
    ctx.request.path = '/perfix' + ctx.request.path
    await next()
    ctx.response.body = JSON.parse(ctx.response.body)
})
</code></pre>
<p>å®ç°ä¸­é—´ä»¶åŸºæœ¬æ¨¡å‹ï¼Ÿ</p>
<pre><code class="language-ts">class Middleware {
    // ä¸­é—´ä»¶åˆ—è¡¨
    cbs = []
    
    // æ³¨å†Œä¸­é—´ä»¶
    use(cb) {
       this.cbs.push(cb)
       return this
    }
    
    // æ‰§è¡Œä¸­é—´ä»¶
    exec(ctx, next){

        let times = -1
    
        const dispatch = (pointer = 0): Promise&lt;any&gt; =&gt; {
            if (cbs.length &lt; pointer) return Promise.resolve()

            const fn = this.cbs[pointer] || next

            if (pointer &lt;= times) throw new Error('next function only can be called once')
             // ç¡®ä¿æ¯ä¸ªä¸­é—´ä»·ä¸­ next æ–¹æ³•åªè°ƒç”¨ä¸€æ¬¡
             times = pointer

            // æ´‹è‘±æ¨¡å‹
             return fn(ctx, () =&gt; dispatch(++pointer))
        }

        return dispatch()
    }
}
</code></pre>
<p>å…¨å±€ä¸­é—´ä»¶ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ª use å’Œ exec çš„é™æ€æ–¹æ³•å³å¯ã€‚</p>
<p>PreQuest ç»§æ‰¿è‡ª Middleware ç±»ï¼Œå³å¯åœ¨å®ä¾‹ä¸Šæ³¨å†Œä¸­é—´ä»¶ã€‚</p>
<p>é‚£ä¹ˆæ€ä¹ˆåœ¨è¯·æ±‚å‰è°ƒç”¨ä¸­é—´ä»¶?</p>
<pre><code class="language-ts">class PreQuest extends Middleware {
    // ...some code
     
    async request(opt) {
    
        const ctx = {
            request: opt,
            response: {}
        }
        
        // æ‰§è¡Œä¸­é—´ä»¶
        async this.exec(ctx, async (ctx) =&gt; {
            ctx.response = await this.adapter(ctx.request)
        })
        
        return ctx.response
    }
        
    // ...some code
}

</code></pre>
<p>ä¸­é—´ä»¶æ¨¡å‹ä¸­ï¼Œå‰ä¸€ä¸ªä¸­é—´ä»¶çš„è¿”å›å€¼æ˜¯ä¼ ä¸åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ä¸­ï¼Œæ‰€ä»¥æ˜¯é€šè¿‡ä¸€ä¸ªå¯¹è±¡åœ¨ä¸­é—´ä»¶ä¸­ä¼ é€’å’Œèµ‹å€¼ã€‚</p>
<h3 id="æ‹¦æˆªå™¨">æ‹¦æˆªå™¨</h3>
<p>æ‹¦æˆªå™¨æ˜¯ä¿®æ”¹å‚æ•°å’Œå“åº”çš„å¦ä¸€ç§æ–¹å¼ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹ axios ä¸­æ‹¦æˆªå™¨æ˜¯æ€ä¹ˆç”¨çš„ã€‚</p>
<pre><code class="language-ts">import axios from 'axios'

const instance = axios.create()

instance.interceptor.request.use(
    (opt) =&gt; modifyOpt(opt),
    (e) =&gt; handleError(e)
)
</code></pre>
<p>æ ¹æ®ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªåŸºæœ¬ç»“æ„</p>
<pre><code class="language-ts">class Interceptor {
    cbs = []
    
    // æ³¨å†Œæ‹¦æˆªå™¨
    use(successHandler, errorHandler) {
        this.cbs.push({ successHandler, errorHandler })
    }
    
    exec(opt) {
      return this.cbs.reduce(
        (t, c, idx) =&gt; t.then(c.successHandler, this.handles[idx - 1]?.errorHandler),
        Promise.resolve(opt)
      )
      .catch(this.handles[this.handles.length - 1].errorHandler)
    }
}
</code></pre>
<p>ä»£ç å¾ˆç®€å•ï¼Œæœ‰ç‚¹éš¾åº¦çš„å°±æ˜¯æ‹¦æˆªå™¨çš„æ‰§è¡Œäº†ã€‚è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªçŸ¥è¯†ç‚¹: Array.reduce å’Œ Promise.then ç¬¬äºŒä¸ªå‚æ•°çš„ä½¿ç”¨ã€‚</p>
<p>æ³¨å†Œæ‹¦æˆªå™¨æ—¶ï¼Œ<code>successHandler</code> ä¸ <code>errorHandler</code> æ˜¯æˆå¯¹çš„ï¼Œ successHandler ä¸­æŠ›å‡ºçš„é”™è¯¯ï¼Œè¦åœ¨å¯¹åº”çš„ errorHandler ä¸­å¤„ç†ï¼Œæ‰€ä»¥ errorHandler æ¥æ”¶åˆ°çš„é”™è¯¯ï¼Œæ˜¯ä¸Šä¸€ä¸ªæ‹¦æˆªå™¨ä¸­æŠ›å‡ºçš„ã€‚</p>
<p>æ‹¦æˆªå™¨æ€ä¹ˆä½¿ç”¨å‘¢?</p>
<pre><code class="language-ts">class PreQuest {
    // ... some code
    interceptor = {
        request: new Interceptor()
        response: new Interceptor()
    }
    
    // ...some code
    
    async request(opt){
        
        // æ‰§è¡Œæ‹¦æˆªå™¨ï¼Œä¿®æ”¹è¯·æ±‚å‚æ•°
        const options = await this.interceptor.request.exec(opt)
        
        const res = await this.adapter(options)
        
        // æ‰§è¡Œæ‹¦æˆªå™¨ï¼Œä¿®æ”¹å“åº”æ•°æ®
        const response = await this.interceptor.response.exec(res)
        
        return response
    }
    
}
</code></pre>
<h3 id="æ‹¦æˆªå™¨ä¸­é—´ä»¶">æ‹¦æˆªå™¨ä¸­é—´ä»¶</h3>
<p>æ‹¦æˆªå™¨ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œä¸­é—´ä»¶æ¥å®ç°ã€‚è¯·æ±‚æ‹¦æˆªå™¨åœ¨ <code>await next()</code> å‰æ‰§è¡Œï¼Œå“åº”æ‹¦æˆªå™¨åœ¨å…¶åã€‚</p>
<pre><code class="language-ts">const instance = new Middleware()

instance.use(async (ctx, next) =&gt; {
    // Promise é“¾å¼è°ƒç”¨ï¼Œæ›´æ”¹è¯·æ±‚å‚æ•°
    await Promise.resolve().then(reqInterceptor1).then(reqInterceptor2)...
    // æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€æˆ–æ‰§è¡Œåˆ° this.adapter å‡½æ•°
    await next()
    // Promise é“¾å¼è°ƒç”¨ï¼Œæ›´æ”¹å“åº”æ•°æ®
    await Promise.resolve().then(resInterceptor1).then(resInterceptor2)...
})
</code></pre>
<p>æ‹¦æˆªå™¨æœ‰è¯·æ±‚æ‹¦æˆªå™¨å’Œå“åº”æ‹¦æˆªå™¨ä¸¤ç±»ã€‚</p>
<pre><code class="language-ts">class InterceptorMiddleware {
    request = new Interceptor()
    response = new Interceptor()
    
    // æ³¨å†Œä¸­é—´ä»¶
    register: async (ctx, next) {
        ctx.request = await this.request.exec(ctx.request)
        await next()
        ctx.response = await thie.response.exec(ctx.response)
    }
}
</code></pre>
<p>ä½¿ç”¨</p>
<pre><code class="language-ts">const instance = new Middleware()
const interceptor = new InterceptorMiddleware()

// æ³¨å†Œæ‹¦æˆªå™¨
interceptor.request.use(
    (opt) =&gt; modifyOpt(opt),
    (e) =&gt; handleError(e)
)

// æ³¨å†Œåˆ°ä¸­é—´ä¸­
instance.use(interceptor.register)
</code></pre>
<h3 id="ç±»å‹è¯·æ±‚">ç±»å‹è¯·æ±‚</h3>
<p>è¿™é‡Œæˆ‘æŠŠç±»ä¼¼ <code>instance.get('/api')</code> è¿™æ ·çš„è¯·æ±‚å«åšç±»å‹è¯·æ±‚ã€‚åº“ä¸­é›†æˆç±»å‹è¯·æ±‚çš„è¯ï¼Œéš¾å…ä¼šå¯¹å¤–éƒ¨ä¼ å…¥çš„adapter å‡½æ•°çš„å‚æ•°è¿›è¡Œæ±¡æŸ“ã€‚å› ä¸ºéœ€è¦ä¸ºè¯·æ±‚æ–¹å¼ <code>get</code> å’Œè·¯å¾„ <code>/api</code> åˆ†é…é”®åï¼Œå¹¶ä¸”å°†å…¶æ··å…¥åˆ°å‚æ•°ä¸­ï¼Œé€šå¸¸åœ¨ä¸­é—´ä»¶ä¸­ä¼šæœ‰ä¿®æ”¹è·¯å¾„çš„éœ€æ±‚ã€‚</p>
<p>å®ç°å¾ˆç®€å•ï¼Œåªéœ€è¦éå† HTTP è¯·æ±‚ç±»å‹ï¼Œå¹¶å°†å…¶æŒ‚åœ¨ this ä¸‹å³å¯</p>
<pre><code class="language-ts">class PreQuest {
    constructor(private adapter) {
        this.mount()
    }
    
    // æŒ‚è½½æ‰€æœ‰ç±»å‹çš„åˆ«åè¯·æ±‚
    mount() {
       methods.forEach(method =&gt; {
           this[method] = (path, opt) =&gt; {
             // æ··å…¥ path å’Œ method å‚æ•°
             return this.request({ path, method, ...opt })
           }
       })
    }
    
    // ...some code

    request(opt) {
        // ...some code
    }
}

</code></pre>
<h3 id="ç®€å•è¯·æ±‚">ç®€å•è¯·æ±‚</h3>
<p>axios ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢è¿™ç§å½¢å¼è¿›è¡Œè°ƒç”¨</p>
<pre><code class="language-ts">axios('http://localhost:3000/api').then(res =&gt; console.log(res))
</code></pre>
<p>æˆ‘å°†è¿™ç§è¯·æ±‚æ–¹å¼ç§°ä¹‹ä¸ºç®€å•è¯·æ±‚ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œæ€ä¹ˆå®ç°è¿™ç§å†™æ³•çš„è¯·æ±‚æ–¹å¼å‘¢ï¼Ÿ</p>
<p>ä¸ä½¿ç”¨ class ï¼Œä½¿ç”¨ä¼ ç»Ÿå‡½æ•°ç±»å†™æ³•çš„è¯æ¯”è¾ƒå¥½å®ç°ï¼Œåªéœ€è¦åˆ¤æ–­å‡½æ•°æ˜¯å¦æ˜¯ new è°ƒç”¨ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨æ‰§è¡Œä¸åŒçš„é€»è¾‘å³å¯ã€‚</p>
<p>demo å¦‚ä¸‹</p>
<pre><code class="language-ts">function PreQuest() {
    if(!(this instanceof PreQuest)) {
        console.log('ä¸æ˜¯new è°ƒç”¨')
        return // ...some code
    }
   
   console.log('newè°ƒç”¨') 
   
   //... some code
}

// new è°ƒç”¨
const instance = new PreQuest(adapter)
instance.get('/api').then(res =&gt; console.log(res))

// ç®€å•è°ƒç”¨
PreQuest('/api').then(res =&gt; console.log(res))
</code></pre>
<p>class å†™æ³•çš„è¯ï¼Œä¸èƒ½è¿›è¡Œå‡½æ•°è°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ class å®ä¾‹ä¸Šåšæ–‡ç« ã€‚</p>
<p>é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹ï¼Œçœ‹ä¸€ä¸‹ç”¨æ³•</p>
<pre><code class="language-ts">const prequest = new PreQuest(adapter)

prequest.get('http://localhost:3000/api')

prequest('http://localhost:3000/api')
</code></pre>
<p>é€šè¿‡ new å®ä¾‹åŒ–å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡æ˜¯ä¸èƒ½å¤Ÿå½“åšå‡½æ•°æ¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ new çš„å½¢å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚</p>
<p>å†çœ‹ä¸€ä¸‹ axios ä¸­ç”Ÿæˆå®ä¾‹çš„æ–¹æ³• <code>axios.create</code>, å¯ä»¥ä»ä¸­å¾—åˆ°çµæ„Ÿï¼Œå¦‚æœ <code>.create</code> æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¸ŠæŒ‚ä¸Šäº†æ‰€æœ‰ new å‡ºæ¥å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<p>ç®€å•è®¾è®¡ä¸€ä¸‹:</p>
<p>æ–¹å¼ä¸€: æ‹·è´åŸå‹ä¸Šçš„æ–¹æ³•</p>
<pre><code class="language-ts">class PreQuest {

    static create(adapter) {
        const instance = new PreQuest(adapter)
        
        function inner(opt) {
           return instance.request(opt)
        }
        
        for(let key in instance) {
            inner[key] = instance[key]
        }
        
        return inner
    }
}
</code></pre>
<p><strong>æ³¨æ„: åœ¨æŸäº›ç‰ˆæœ¬çš„ es ä¸­ï¼Œ<code>for in</code> å¾ªç¯éå†ä¸å‡º class ç”Ÿæˆå®ä¾‹åŸå‹ä¸Šçš„æ–¹æ³•ã€‚</strong></p>
<p>æ–¹å¼äºŒ: è¿˜å¯ä»¥ä½¿ç”¨ Proxy ä»£ç†ä¸€ä¸ªç©ºå‡½æ•°ï¼Œæ¥åŠ«æŒè®¿é—®ã€‚</p>
<pre><code class="language-ts">class PreQuest {
    
    // ...some code

    static create(adapter) {
        const instance = new PreQuest(adapter)
       
        return new Proxy(function (){}, {
          get(_, name) {
            return Reflect.get(instance, name)
          },
          apply(_, __, args) {
            return Reflect.apply(instance.request, instance, args)
          },
        })
    }
}
</code></pre>
<p>ä¸Šé¢ä¸¤ç§æ–¹æ³•çš„ç¼ºç‚¹åœ¨äºï¼Œé€šè¿‡ <code>create</code> æ–¹æ³•è¿”å›çš„å°†ä¸å†æ˜¯ <code>PreQuest</code> çš„å®ä¾‹ï¼Œå³</p>
<pre><code class="language-ts">const prequest = PreQuest.create(adapter)

prequest instanceof PreQuest  // false
</code></pre>
<p>ä¸ªäººç›®å‰è¿˜æ²¡æœ‰æƒ³åˆ°ï¼Œåˆ¤æ–­ <code>prequest</code> æ˜¯ä¸æ˜¯ <code>PreQuest</code> å®ä¾‹æœ‰ä»€ä¹ˆç”¨ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰æƒ³åˆ°å¥½çš„è§£å†³åŠæ³•ã€‚æœ‰è§£å†³æ–¹æ¡ˆçš„è¯·åœ¨è¯„è®ºé‡Œå‘Šè¯‰æˆ‘ã€‚</p>
<p>ä½¿ç”¨ <code>.create</code> åˆ›å»º 'å®ä¾‹' çš„æ–¹å¼å¯èƒ½ä¸ç¬¦åˆç›´è§‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ Proxy åŠ«æŒ new æ“ä½œã€‚</p>
<p>Demoå¦‚ä¸‹:</p>
<pre><code class="language-ts">class InnerPreQuest {
  create() {
     // ...some code
  }
}

const PreQuest = new Proxy(InnerPreQuest, {
    construct(_, args) {
        return () =&gt; InnerPreQuest.create(...args)
    }
})
</code></pre>
<h3 id="è¯·æ±‚é”">è¯·æ±‚é”</h3>
<p>å¦‚ä½•å®ç°åœ¨è¯·æ±‚æ¥å£å‰ï¼Œå…ˆæ‹¿åˆ° token å†å»è¯·æ±‚ï¼Ÿ</p>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œé¡µé¢åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚</p>
<pre><code class="language-ts">const prequest = PreQuest.create(adapter)

prequest('/api/1').catch(e =&gt; e)     // auth fail
prequest('/api/2').catch(e =&gt; e)    // auth fail
prequest('/api/3').catch(e =&gt; e)    // auth fail
</code></pre>
<p>é¦–å…ˆå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸­é—´ä»¶ä¸ºå…¶æ·»åŠ  token</p>
<pre><code class="language-ts">prequest.use(async (ctx, next) =&gt; {
    ctx.request.headers['Authorization'] = `bearer ${token}`
    await next()
})
</code></pre>
<p>ä½† token å€¼ä»ä½•è€Œæ¥ï¼Ÿtoken éœ€è¦è¯·æ±‚æ¥å£å¾—æ¥ï¼Œå¹¶ä¸”éœ€è¦é‡æ–°åˆ›å»ºè¯·æ±‚å®ä¾‹ï¼Œä»¥é¿å…é‡æ–°èµ°æ·»åŠ  token çš„ä¸­é—´ä»¶çš„é€»è¾‘ã€‚</p>
<p>ç®€å•å®ç°ä¸€ä¸‹</p>
<pre><code class="language-ts">const tokenRequest = PreQuest.create(adapter)

let token = null
prequest.use(async (ctx, next) =&gt; {
    if(!token) {
        token = await tokenRequest('/token')
    }
    ctx.request.headers['Authorization'] = `bearer ${token}`
    await next()
})
</code></pre>
<p>è¿™é‡Œä½¿ç”¨äº† token å˜é‡ï¼Œæ¥é¿å…æ¯æ¬¡è¯·æ±‚æ¥å£ï¼Œéƒ½å»è°ƒæ¥å£æ‹¿ tokenã€‚</p>
<p>ä»£ç ä¹ä¸€çœ‹æ²¡æœ‰é—®é¢˜ï¼Œä½†ä»”ç»†ä¸€æƒ³ï¼Œå½“åŒæ—¶è¯·æ±‚å¤šä¸ªæ¥å£ï¼ŒtokenRequest è¯·æ±‚è¿˜æ²¡æœ‰å¾—åˆ°å“åº”æ—¶ï¼Œåé¢çš„è¯·æ±‚åˆéƒ½èµ°åˆ°è¿™ä¸ªä¸­é—´ä»¶ï¼Œæ­¤æ—¶ token å€¼ä¸ºç©ºï¼Œä¼šé€ æˆå¤šæ¬¡è°ƒç”¨ tokenRequestã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<p>å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¯ä»¥åŠ ä¸ªé”æœºåˆ¶æ¥å®ç°</p>
<pre><code class="language-ts">let token = null
let pending = false
prequest.use(async (ctx, next) =&gt; {
    if(!token) {
        if(pending) return
        pending = true
        token = await tokenRequest('/token')
        pending = flase
    }
    ctx.request.headers['Authorization'] = `bearer ${token}`
    await next()
})
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬åŠ äº† pending æ¥åˆ¤æ–­ tokenRequest çš„æ‰§è¡Œï¼ŒæˆåŠŸè§£å†³äº† tokenRequest æ‰§è¡Œå¤šæ¬¡çš„é—®é¢˜ï¼Œä½†åˆå¼•å…¥äº†æ–°çš„é—®é¢˜ï¼Œåœ¨æ‰§è¡Œ tokenRequest æ—¶ï¼Œåé¢åˆ°æ¥çš„è¯·æ±‚åº”å½“æ€ä¹ˆå¤„ç†ï¼Ÿä¸Šé¢çš„ä»£ç ï¼Œç›´æ¥ return æ‰äº†ï¼Œè¯·æ±‚å°†è¢«ä¸¢å¼ƒã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›ï¼Œè¯·æ±‚å¯ä»¥åœ¨è¿™é‡Œæš‚åœï¼Œå½“æ‹¿åˆ° token æ—¶ï¼Œå†è¯·æ±‚åé¢çš„ä¸­é—´ä»¶ã€‚</p>
<p>æš‚åœï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æƒ³åˆ°ä½¿ç”¨ asyncã€await æˆ–è€… promise æ¥å®ç°ã€‚ä½†åœ¨è¿™é‡Œå¦‚ä½•ç”¨å‘¢ï¼Ÿ</p>
<p>æˆ‘ä» axios çš„ <a href="https://github.com/axios/axios/blob/e9965bfafc82d8b42765705061b9ebe2d5532493/lib/cancel/CancelToken.js#L17">cancelToken</a> å®ç°ä¸­å¾—åˆ°äº†çµæ„Ÿã€‚axios ä¸­ï¼Œåˆ©ç”¨ promise ç®€å•å®ç°äº†ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°† Promise ä¸­çš„ resolve èµ‹å€¼åˆ°å¤–éƒ¨å±€éƒ¨å˜é‡ï¼Œå®ç°å¯¹ promise æµç¨‹çš„æ§åˆ¶ã€‚</p>
<p>ç®€å•å®ç°ä¸€ä¸‹</p>
<pre><code class="language-ts">let token = null
let pending = false
let resolvePromise
let promise = new Promise((resolve) =&gt; resolvePromise = resolve)

prequest.use(async (ctx, next) =&gt; {
    if(!token) {
        if(pending) {
            // promise æ§åˆ¶æµç¨‹
            token = await promise
        } else {
            pending = true
            token = await tokenRequest('/token')
            // è°ƒç”¨ resolveï¼Œä½¿å¾— promise å¯ä»¥æ‰§è¡Œå‰©ä½™çš„æµç¨‹
            resolvePromise(token)
            pending = flase
        }
    } 

    ctx.request.headers['Authorization'] = `bearer ${token}`
    await next()
})
</code></pre>
<p>å½“æ‰§è¡Œ tokenRequest æ—¶ï¼Œå…¶ä½™è¯·æ±‚çš„æ¥å£ï¼Œéƒ½ä¼šè¿›å…¥åˆ°ä¸€ä¸ª promise æ§åˆ¶çš„æµç¨‹ä¸­ï¼Œå½“ token å¾—åˆ°åï¼Œé€šè¿‡å¤–éƒ¨ resolve, æ§åˆ¶ promise ç»§ç»­æ‰§è¡Œï¼Œä»¥æ­¤è®¾ç½®è¯·æ±‚å¤´ï¼Œå’Œæ‰§è¡Œå‰©ä½™ä¸­é—´ä»¶ã€‚</p>
<p>è¿™ç§æ–¹å¼è™½ç„¶å®ç°äº†éœ€æ±‚ï¼Œä½†ä»£ç ä¸‘é™‹ä¸ç¾è§‚ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†çŠ¶æ€éƒ½å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚ä»¥å®ç°ç±»ä¼¼ä¸‹é¢è¿™ç§è°ƒç”¨ã€‚è¿™æ ·çš„è°ƒç”¨ç¬¦åˆç›´è§‰ä¸”ç¾è§‚ã€‚</p>
<pre><code class="language-ts">prequest.use(async (ctx, next) =&gt; {
  const token = await wrapper(tokenRequest)
  ctx.request.headers['Authorization'] = `bearer ${token}`
  await next()
})
</code></pre>
<p>æ€ä¹ˆå®ç°è¿™æ ·ä¸€ä¸ª wrapper å‡½æ•°ï¼Ÿ</p>
<p>é¦–å…ˆï¼ŒçŠ¶æ€ä¸èƒ½å°è£…åˆ° wrapper å‡½æ•°ä¸­ï¼Œå¦åˆ™æ¯æ¬¡éƒ½ä¼šç”Ÿæˆæ–°çš„çŠ¶æ€ï¼Œwrapper å°†å½¢åŒè™šè®¾ã€‚å¯ä»¥ä½¿ç”¨é—­åŒ…å‡½æ•°å°†çŠ¶æ€ä¿å­˜ã€‚</p>
<pre><code class="language-ts">function createWrapper() {
    let token = null
    let pending = false
    let resolvePromise
    let promise = new Promise((resolve) =&gt; resolvePromise = resolve)
    return function (fn) {
        if(pending) return promise
        if(token) return token

        pending = true

        token = await fn()

        pending = false
        resolvePromise(token)

        return token
    }
}
</code></pre>
<p>ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦åˆ©ç”¨ <code>createWrapper</code> ç”Ÿæˆä¸€ä¸ª <code>wrapper</code> å³å¯</p>
<pre><code class="language-ts">const wrapper = createWrapper()

prequest.use(async (ctx, next) =&gt; {
  const token = await wrapper(tokenRequest)
  ctx.request.headers['Authorization'] = `bearer ${token}`
  await next()
})
</code></pre>
<p>è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°æˆ‘ä»¬çš„ç›®çš„ã€‚</p>
<p>ä½†ï¼Œè¿™é‡Œçš„ä»£ç è¿˜æœ‰é—®é¢˜ï¼ŒçŠ¶æ€å°è£…åœ¨ createWrapper å†…éƒ¨ï¼Œå½“ token å¤±æ•ˆåï¼Œæˆ‘ä»¬å°†æ— ä»å¤„ç†ã€‚</p>
<p>æ¯”è¾ƒå¥½çš„åšæ³•æ˜¯ï¼Œå°†çŠ¶æ€ä» <code>createWrapper</code> å‚æ•°ä¸­ä¼ å…¥ã€‚</p>
<p>ä»£ç å®ç°ï¼Œè¯·å‚è€ƒ<a href="https://github.com/xdoer/PreQuest/blob/104c178e7c3a1b8edd8c6d36ad603e880297eba2/packages/lock/src/index.ts#L5">è¿™é‡Œ</a></p>
<h2 id="å®æˆ˜">å®æˆ˜</h2>
<p>ä»¥å¾®ä¿¡å°ç¨‹åºä¸ºä¾‹ã€‚å°ç¨‹åºä¸­è‡ªå¸¦çš„ <code>wx.request</code> å¹¶ä¸å¥½ç”¨ã€‚ä½¿ç”¨ä¸Šé¢æˆ‘ä»¬å°è£…çš„ä»£ç ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„æ‰“é€ å‡ºä¸€ä¸ªå°ç¨‹åºè¯·æ±‚åº“ã€‚</p>
<h3 id="å°è£…å°ç¨‹åºåŸç”Ÿè¯·æ±‚">å°è£…å°ç¨‹åºåŸç”Ÿè¯·æ±‚</h3>
<p>å°†åŸç”Ÿå°ç¨‹åºè¯·æ±‚ Promise åŒ–ï¼Œè®¾è®¡ä¼ å‚ opt å¯¹è±¡</p>
<pre><code class="language-ts">function adapter(opt) {
  const { path, method, baseURL, ...options } = opt
  const url = baseURL + path
  return new Promise((resolve, reject) =&gt; {
    wx.request({
      ...options,
      url,
      method,
      success: resolve,
      fail: reject,
    })
  })
}

</code></pre>
<h3 id="è°ƒç”¨">è°ƒç”¨</h3>
<pre><code class="language-ts">const instance = PreQuest.create(adapter)

// ä¸­é—´ä»¶æ¨¡å¼
instance.use(async (ctx, next) =&gt; {
    // ä¿®æ”¹è¯·æ±‚å‚æ•°
    ctx.request.path = '/prefix' + ctx.request.path
    
    await next()
    
    // ä¿®æ”¹å“åº”
    ctx.response.body = JSON.parse(ctx.response.body)
})

// æ‹¦æˆªå™¨æ¨¡å¼
instance.interecptor.request.use(
    (opt) =&gt; {
        opt.path = '/prefix' + opt.path
        return opt
    }
)

instance.request({ path: '/api', baseURL: 'http://localhost:3000' })

instance.get('http://localhost:3000/api')

instance.post('/api', { baseURL: 'http://loclahost:3000' })
</code></pre>
<h3 id="è·å–åŸç”Ÿè¯·æ±‚å®ä¾‹">è·å–åŸç”Ÿè¯·æ±‚å®ä¾‹</h3>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹åœ¨å°ç¨‹åºä¸­æ€æ ·ä¸­æ–­è¯·æ±‚</p>
<pre><code class="language-ts">const request = wx.request({
    // ...some code
})

request.abort()
</code></pre>
<p>ä½¿ç”¨æˆ‘ä»¬å°è£…çš„è¿™ä¸€å±‚ï¼Œå°†æ‹¿ä¸åˆ°åŸç”Ÿè¯·æ±‚å®ä¾‹ã€‚</p>
<p>é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»ä¼ å‚ä¸­å…¥æ‰‹</p>
<pre><code class="language-ts">function adapter(opt) {
    const { getNativeRequestInstance } = opt
    
    let resolvePromise: any
    getNativeRequestInstance(new Promise(resolve =&gt; (resolvePromise = resolve)))
    
    return new Promise(() =&gt; {
        const nativeInstance = wx.request(
           // some code
        )
        
        resolvePromise(nativeInstance)
    })
}
</code></pre>
<p>ç”¨æ³•å¦‚ä¸‹:</p>
<pre><code class="language-ts">const instance = PreQuest.create(adapter)

instance.post('http://localhost:3000/api', {
    getNativeRequestInstance(promise) {
      promise.then(instance =&gt; {
          instance.abort()
      })
    }
})
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå› ä¸º <code>wx.request</code> çš„æ‰§è¡Œæ˜¯åœ¨ n ä¸ªä¸­é—´ä»¶ã€æ‹¦æˆªå™¨ä¹‹åæ‰§è¡Œçš„ï¼Œé‡Œé¢å­˜åœ¨å¤§é‡å¼‚æ­¥ä»»åŠ¡ï¼Œæ‰€ä»¥é€šè¿‡ä¸Šé¢æ‹¿åˆ°çš„ <code>instance</code> åªèƒ½åœ¨å¼‚æ­¥ä¸­æ‰§è¡Œã€‚</p>
<h3 id="å…¼å®¹å¤šå¹³å°å°ç¨‹åº">å…¼å®¹å¤šå¹³å°å°ç¨‹åº</h3>
<p>æŸ¥çœ‹äº†å‡ ä¸ªå°ç¨‹åºå¹³å°å’Œå¿«åº”ç”¨ï¼Œå‘ç°è¯·æ±‚æ–¹å¼éƒ½æ˜¯å°ç¨‹åºçš„é‚£ä¸€å¥—ï¼Œé‚£å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥å°† <code>wx.request</code> æ‹¿å‡ºæ¥ï¼Œåˆ›å»ºå®ä¾‹çš„æ—¶å€™å†ä¼ è¿›å»ã€‚</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ä¸Šé¢çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬åŸºæœ¬å®ç°äº†ä¸€ä¸ªä¸è¯·æ±‚å†…æ ¸æ— å…³çš„è¯·æ±‚åº“ï¼Œå¹¶ä¸”è®¾è®¡äº†ä¸¤ç§æ‹¦æˆªè¯·æ±‚å’Œå“åº”çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œå–œå¥½è‡ªç”±é€‰æ‹©ã€‚</p>
<p>è¿™ç§å†…æ ¸è£…å¸çš„æ–¹å¼éå¸¸å®¹æ˜“æ‰©å±•ã€‚å½“é¢å¯¹ä¸€ä¸ª axios ä¸æ”¯æŒçš„å¹³å°æ—¶ï¼Œä¹Ÿä¸ç”¨è´¹åŠ²çš„å»æ‰¾å¼€æºå¥½ç”¨çš„è¯·æ±‚åº“äº†ã€‚æˆ‘ç›¸ä¿¡å¾ˆå¤šäººåœ¨å¼€å‘å°ç¨‹åºçš„æ—¶å€™ï¼ŒåŸºæœ¬éƒ½æœ‰å»æ‰¾ axios-miniprogram çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æˆ‘ä»¬çš„ PreQuest é¡¹ç›®ï¼Œå¯ä»¥ä½“éªŒåˆ°ç±»ä¼¼ axios çš„èƒ½åŠ›ã€‚</p>
<p><a href="https://github.com/xdoer/PreQuest">PreQuest</a> é¡¹ç›®ä¸­ï¼Œé™¤äº†ä¸Šé¢æåˆ°çš„å†…å®¹ï¼Œè¿˜æä¾›äº†å…¨å±€é…ç½®ã€å…¨å±€ä¸­é—´ä»¶ã€åˆ«åè¯·æ±‚ç­‰åŠŸèƒ½ã€‚é¡¹ç›®ä¸­ä¹Ÿæœ‰åŸºäº <code>PreQuest</code> å°è£…çš„è¯·æ±‚åº“ï¼Œ<a href="https://github.com/xdoer/PreQuest/tree/main/packages/miniprogram">@prequest/miniprogram</a>,<a href="https://github.com/xdoer/PreQuest/tree/main/packages/fetch">@prequest/fetch</a>...ä¹Ÿé’ˆå¯¹ä¸€äº›ä½¿ç”¨åŸç”Ÿ xhrã€fetch ç­‰ API çš„é¡¹ç›®ï¼Œæä¾›äº†ä¸€ç§ä¸ä¾µå…¥çš„æ–¹å¼æ¥èµ‹äºˆ PreQuestçš„èƒ½åŠ› <a href="https://github.com/xdoer/PreQuest/tree/main/packages/wrapper">@prequest/wrapper</a></p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://github.com/axios/axios">axios</a>: https://github.com/axios/axios</p>
<p><a href="https://github.com/umijs/umi-request">umi-request</a>:https://github.com/umijs/umi-request</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Fower: ä¸€ä¸ªå¤šå¹³å°åŸå­ç±» CSS In JS æ ·å¼åº“]]></title>
        <id>https://aiyou.life/post/ZSut5c_dE/</id>
        <link href="https://aiyou.life/post/ZSut5c_dE/">
        </link>
        <updated>2021-04-28T12:41:50.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨è¿‡å»çš„ä¸€å¹´åŠä¸­ï¼Œæˆ‘ä»¬å›¢é˜Ÿåˆ†åˆ«ä½¿ç”¨äº† Taro  React å¼€å‘å°ç¨‹åºï¼Œ React å¼€å‘ Web ç¨‹åº å’Œä½¿ç”¨  React Native å¼€å‘ Appã€‚ä½¿ç”¨çš„æ ·å¼æ„å»ºä¹Ÿå„ç§å„æ ·ï¼Œå¹¶ä¸ç»Ÿä¸€ï¼Œåœ¨å°ç¨‹åºä¸­ï¼Œä½¿ç”¨ SCSSï¼Œåœ¨ Web ä¸­ä½¿ç”¨ tailwind, åœ¨  React Native ä¸­ä½¿ç”¨ StyleSheet.create åˆ›å»ºæ ·å¼ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨è¿‡å»çš„ä¸€å¹´åŠä¸­ï¼Œæˆ‘ä»¬å›¢é˜Ÿåˆ†åˆ«ä½¿ç”¨äº† Taro  React å¼€å‘å°ç¨‹åºï¼Œ React å¼€å‘ Web ç¨‹åº å’Œä½¿ç”¨  React Native å¼€å‘ Appã€‚ä½¿ç”¨çš„æ ·å¼æ„å»ºä¹Ÿå„ç§å„æ ·ï¼Œå¹¶ä¸ç»Ÿä¸€ï¼Œåœ¨å°ç¨‹åºä¸­ï¼Œä½¿ç”¨ SCSSï¼Œåœ¨ Web ä¸­ä½¿ç”¨ tailwind, åœ¨  React Native ä¸­ä½¿ç”¨ StyleSheet.create åˆ›å»ºæ ·å¼ã€‚</p>
<!-- more -->
<p>åœ¨è¿™ä¸‰ç§å†™æ³•ä¸­æ¥å›åˆ‡æ¢æ˜¯ç—›è‹¦çš„ã€‚</p>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>æˆ‘ä»¬ä» tailwind ä¸­è·å¾—äº†çµæ„Ÿï¼Œ å°† tailwind çš„åŸå­æ ·å¼ ä¸  JSX Prop ç»“åˆï¼Œå¼€å‘äº† Fowerã€‚Fower åœ¨  JSX ç»„ä»¶å¤–åŒ…è£…äº†ä¸€å±‚ï¼Œé€šè¿‡æ”¶é›†æ•´åˆåŸå­æ ·å¼å±æ€§ï¼Œç”Ÿæˆ className æˆ–è€… style å±æ€§ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°å†…å±‚ç»„ä»¶ä¸­ã€‚ç”±äº Fower ç»„ä»¶æœ¬è´¨æ˜¯ä¸€ä¸ª  JSX ç»„ä»¶ï¼Œå› è€Œä¹Ÿè·å¾—äº† VSCode çš„æ™ºèƒ½æç¤ºï¼Œä¹¦å†™æ ·å¼æ—¶ï¼Œåªéœ€è¦æ‰“ä¸ªé¦–å­—æ¯ï¼Œå°±å¯ä»¥è”æƒ³å‡ºæ‰€æœ‰çš„åŸå­æ ·å¼ï¼Œå›è½¦å³å¯å¡«å……å±æ€§ï¼Œè¿™ç§å¼€å‘ä½“éªŒæ˜¯ç›¸å½“çˆ½çš„ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://aiyou.life/post-images/1619614139846.png" alt="" loading="lazy"></figure>
<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒFower é€šè¿‡é™„åŠ å„ç§å±æ€§åç¼€ï¼Œæ”¯æŒäº†ä¼ªç±»ï¼Œåª’ä½“æŸ¥è¯¢ï¼Œä¸»é¢˜åˆ‡æ¢ï¼Œæš—é»‘æ¨¡å¼ç­‰åŠŸèƒ½ï¼›æä¾›äº†ä¸€äº›å¸ƒå±€å±æ€§ï¼Œå¯ä»¥å¿«é€Ÿè®©å¤šå­å…ƒç´ å‚ç›´ã€æ°´å¹³å±…ä¸­ï¼›ä¹Ÿæœ‰ä¸€äº›åŠŸèƒ½å±æ€§ï¼Œå¯ä»¥å¿«é€Ÿè£å‰ªæ–‡å­—ï¼Œçœç•¥æ˜¾ç¤ºï¼›å¯ä»¥é€šè¿‡ä¸€ä¸ªå±æ€§ï¼Œæ„å»ºå‡ºä¸€ä¸ªæ–¹å½¢æˆ–è€…åœ†ï¼›è¿˜æœ‰åŠŸèƒ½å¼ºåŠ²çš„ css å±æ€§ï¼Œè®©ä½ ä½¿ç”¨å„ç§å­å…ƒç´ é€‰æ‹©å™¨ã€‚ã€‚ã€‚é™¤äº†å†…ç½®çš„è¿™äº›å±æ€§ï¼ŒFower ä¹Ÿæä¾›äº†ç›¸å…³ APIï¼Œå¯ä»¥è®©ä½ å¯ä»¥å®šåˆ¶åŒ–ä½ è‡ªå·±çš„å±æ€§å®ç°ã€‚</p>
<p>æˆ‘ä»¬é™¤äº†å¯¹  React, Taro  React,  React Native å°è£…äº†ç»„ä»¶åŒ…å¤–ï¼Œè¿˜é’ˆå¯¹ Vue, Svelte ç­‰æ¡†æ¶è¿›è¡Œäº†éƒ¨åˆ†å…¼å®¹å’Œé€‚é…ï¼ŒFower æä¾›äº† VSCode æ’ä»¶ï¼Œè§£å†³äº†åœ¨  React Like ä¹‹å¤–çš„æ¡†æ¶çš„æ™ºèƒ½æç¤ºã€‚</p>
<p>ä½¿ç”¨ Fowerï¼ŒåŸºæœ¬ä¸Š<strong>å¯ä»¥è®©ä½ ä¸ç”¨å†å†™çƒ¦äººçš„ CSS æ–‡ä»¶</strong></p>
<h2 id="å¯¹æ¯”">å¯¹æ¯”</h2>
<p>ç›¸æ¯”äº Tailwind, Fower çš„ä¼˜åŠ¿æ˜¯æ˜æ˜¾çš„ã€‚</p>
<blockquote>
<ul>
<li>VSCode æ’ä»¶ã€‚Tailwind çš„ä½¿ç”¨ç¦»ä¸å¼€ VSCode æ’ä»¶ã€‚Fower åœ¨  React Like æ¡†æ¶ä¸­ï¼Œåˆ©ç”¨ VSCode æ™ºèƒ½æç¤ºå°±å¯ä»¥è”æƒ³å‡ºå„ç§å±æ€§ï¼Œåœ¨å…¶ä»–æ¡†æ¶ä¸­ï¼Œæ‰éœ€è¦å®‰è£… VSCode æ’ä»¶</li>
<li>å¼€ç®±å³ç”¨ã€‚Fower åªéœ€è¦å®‰è£…å¯¹åº”çš„æ¡†æ¶åŒ…ï¼Œå³å¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è¿›è¡Œç¹æ‚çš„é…ç½®ã€‚</li>
<li>ä½“ç§¯ã€‚å¯¹äºç±»ä¼¼ <code>p1</code>, <code>p2</code> åˆ° <code>p100</code> è¿™ç§å±æ€§ï¼ŒTailwind ä¸­æšä¸¾äº†æ¯ä¸€ä¸ªå±æ€§çš„æ ·å¼ï¼Œå¯¼è‡´ä½“ç§¯å¼‚å¸¸çš„åºå¤§ã€‚Fower åœ¨  React Like ä¸­å±äºè¿è¡Œæ—¶åº“ï¼Œå¯¹å±æ€§å…·æœ‰ç¼–ç¨‹æ€§ï¼Œå¯ä»¥åŠ¨æ€ç”Ÿæˆæ ·å¼ï¼Œæ‰€ä»¥ä½“ç§¯éå¸¸å°ã€‚åœ¨é  React Like æ¡†æ¶ä¸­ï¼ŒFower é€šè¿‡æ”¶é›†æ¨¡æ¿çš„åŸå­å±æ€§æ ·å¼ä¹Ÿæ˜¯åŠ¨æ€ç”Ÿæˆæ ·å¼ã€‚</li>
<li>å¤šç«¯ä½¿ç”¨ã€‚Fower é’ˆå¯¹å¸‚é¢ä¸Šä¸»æµçš„æ¡†æ¶è¿›è¡Œäº†é’ˆå¯¹æ€§é€‚é…ï¼Œä½ å¯ä»¥åœ¨  React, Preact, Vue, Svelte,  React Native, Taro  React å°ç¨‹åº, Remax å°ç¨‹åºç­‰å¹³å°ä½¿ç”¨ Fowerã€‚Tailwind ä¸æ”¯æŒåœ¨  React Native ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ Taro, Remax ç­‰å°ç¨‹åºç¯å¢ƒä¸­æ²¡æœ‰æ”¯æŒã€‚</li>
</ul>
</blockquote>
<p>ç”±äº Fower æ˜¯è¿è¡Œæ—¶ UI åº“ï¼Œæ‰€ä»¥ç›¸å¯¹äº Tailwind æœ‰ä¸€å®šçš„è¿è¡Œæ—¶æŸè€—ã€‚ä½†å¯¹äºè®¾å¤‡ç®—åŠ›è¶Šæ¥è¶Šå¼ºå¤§çš„ä»Šå¤©ï¼Œè¿™ç‚¹æŸè€—å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä½† Fower è¿˜æ˜¯å°½å¯èƒ½çš„ä½¿ç”¨äº†å„ç§æ‰‹æ®µæé«˜è¿è¡Œæ•ˆç‡ï¼ŒFower å†…éƒ¨å¯¹æ‰€æœ‰éå†è¿‡çš„å±æ€§è¿›è¡Œç¼“å­˜ï¼Œæå¤§æé«˜è¿è¡Œé€Ÿåº¦ã€‚</p>
<h2 id="é¡¹ç›®">é¡¹ç›®</h2>
<p><a href="https://fower.vercel.app/">å®˜æ–¹æ–‡æ¡£ï¼ˆhttps://fower.vercel.app/ï¼‰</a></p>
<p><a href="https://github.com/forsigner/fower">é¡¹ç›®åœ°å€ï¼ˆhttps://github.com/forsigner/fowerï¼‰</a></p>
<h2 id="åŠŸèƒ½ä¸€è§ˆ">åŠŸèƒ½ä¸€è§ˆ</h2>
<p>ä¸‹é¢æ¼”ç¤ºäº†ä½¿ç”¨ Fower/react æ¡†æ¶åŒ…çš„ Box ç»„ä»¶ç¼–å†™çš„ demoã€‚å®é™…ä¸Šï¼Œç›´æ¥ä½¿ç”¨ Box æ ‡ç­¾ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„ï¼Œä½†éœ€è¦é¢å¤–çš„é…ç½®ã€‚</p>
<h3 id="åŸºæœ¬ä½¿ç”¨"><a href="https://fower.vercel.app/zh-cn/docs/basic">åŸºæœ¬ä½¿ç”¨</a></h3>
<p>Fower æä¾›äº†å¤§é‡çš„åŸå­æ ·å¼å±æ€§ï¼Œå¯ä»¥æé€Ÿæ„å»º UIã€‚</p>
<pre><code class="language-html">&lt;Box text2XL fontBold green500 className=&quot;user&quot; style={{ fontWeight: 'bold' }}&gt;
  Hi, Fower
&lt;/Box&gt;
</code></pre>
<h3 id="å¯ç¼–ç¨‹åŠ¨æ€æ ·å¼">å¯ç¼–ç¨‹/åŠ¨æ€æ ·å¼</h3>
<p>ä½ å¯ä»¥é€šè¿‡ä¸ºå±æ€§èµ‹å€¼çš„æ–¹å¼ï¼Œæ¥ç¼–å†™åŠ¨æ€æ ·å¼</p>
<pre><code class="language-html">&lt;Box
  text-14
  display=&quot;block&quot;
  color=&quot;red&quot;
  blue={false}
  p-10
  m-10rem
  bg=&quot;red&quot;
  bgRed={true}
  bgBlue={false}
&gt;
  Hi, Fower
&lt;/Box&gt;
</code></pre>
<h3 id="css-å±æ€§"><a href="https://fower.vercel.app/zh-cn/docs/css-prop">CSS å±æ€§</a></h3>
<p>Fower ä¸­æä¾›äº†å¼ºå¤§çš„ CSS å±æ€§ï¼Œå®ç°äº†å¤§éƒ¨åˆ† CSS çš„åŠŸèƒ½ã€‚</p>
<pre><code class="language-html">&lt;Box
  text4XL
  css={{
    backgroundColor: '#edf2f7',
    ':hover': {
      backgroundColor: '#feebc8',
    },
    '.title': {
      fontWeight: 'bold',
    },
    span: {
      color: 'deeppink',
    },
  }}
&gt;
  &lt;Box className=&quot;title&quot;&gt;Nested demo&lt;/Box&gt;
  &lt;span&gt;Hi, Fower!&lt;/span&gt;
&lt;/Box&gt;
</code></pre>
<h3 id="ä¼ªç±»å“åº”å¼"><a href="https://fower.vercel.app/zh-cn/docs/pseudo">ä¼ªç±»/å“åº”å¼</a></h3>
<p>Fower é€šè¿‡åç¼€çš„æ–¹å¼ï¼Œæ”¯æŒäº†ä¼ªç±»ï¼Œå“åº”å¼ç­‰åŠŸèƒ½</p>
<pre><code class="language-html">&lt;Box text2XL text3XL--hover red--first-child fontBold green500&gt;
  &lt;Box&gt;Hi, Fower&lt;/Box&gt;
&lt;/Box&gt;
&lt;Box textSM textLG--sm text4XL--md text6XL--lg&gt;
  Lorem ipsum dolor sit amet
&lt;/Box&gt;
</code></pre>
<h3 id="é¢œè‰²åŠ©æ‰‹"><a href="https://fower.vercel.app/zh-cn/docs/color-helper">é¢œè‰²åŠ©æ‰‹</a></h3>
<p>é¢œè‰²åŠ©æ‰‹å¯ä»¥å¿«é€Ÿå¢åŠ æˆ–å‡å°‘é¢œè‰²çš„äº®åº¦ï¼Œé€æ˜åº¦ç­‰ç­‰</p>
<pre><code class="language-html">&lt;Box toEvenly toCenterY&gt;
  &lt;Box red300&gt;normal&lt;/Box&gt;
  &lt;Box red300--D40&gt;darken&lt;/Box&gt;
&lt;/Box&gt;
</code></pre>
<h3 id="ä¸»é¢˜"><a href="https://fower.vercel.app/zh-cn/docs/theme">ä¸»é¢˜</a></h3>
<p>Fower å†…ç½®äº†ä¸»é¢˜ã€‚ä½ å¯ä»¥é€šè¿‡ setTheme API æ›´æ”¹å’Œæ·»åŠ é…ç½®ã€‚</p>
<pre><code class="language-html">import { setTheme } from '@fower/core'

setTheme({
  spacings: {
    10086: 110,
  },
  color: {
    gray10086: '#FFFFFF'
  }
})

&lt;Box textSM bgGray10086 bgGray10086--dark p10086&gt;
  Lorem ipsum dolor sit amet
&lt;/Box&gt;
</code></pre>
<h3 id="ä¸ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ä¸€èµ·ä½¿ç”¨">ä¸ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ä¸€èµ·ä½¿ç”¨</h3>
<p>ä¸Šæ–‡ä¸­æåˆ° Fower åŸç†æ˜¯é€šè¿‡ç»™ç°æœ‰ç»„ä»¶åŒ…è£…äº†ä¸€å±‚ï¼Œé€šè¿‡æ”¶é›†æ•´åˆåŸå­æ ·å¼å±æ€§ï¼Œæœ€ç»ˆå°† className æˆ– style å±æ€§æ³¨å…¥åˆ°å†…å±‚ç»„ä»¶ã€‚å› è€Œä¸ç¬¬ä¸‰æ–¹ç»„ä»¶ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦åˆ©ç”¨ styled API åŒ…è£…å³å¯ã€‚</p>
<pre><code class="language-html">import { Button as AntdButton } from 'antd'
import { styled } from '@fower/styled'

const Button = styled(AntdButton)

&lt;Button red300 red400={false} text={7 + 7}&gt;
  normal
&lt;/Button&gt;
</code></pre>
<h3 id="å±æ€§å†²çª">å±æ€§å†²çª</h3>
<p>Fower ç»„ä»¶æä¾›çš„å±æ€§ä¸ä¸‰æ–¹å±æ€§å†²çªæ—¶ï¼ŒFower ä¹Ÿæä¾›äº†è§£å†³æ–¹æ¡ˆã€‚</p>
<pre><code class="language-html">import { Button as AntdButton } from 'antd'
import { styled } from '@fower/styled'

const Button = styled(AntdButton)

&lt;Button excludedProps={['block']} block&gt;
  normal
&lt;/Button&gt;
</code></pre>
<h3 id="ç±»å">ç±»å</h3>
<p>Fower åŒæ ·æ”¯æŒäº† tailwind çš„ç”¨æ³•</p>
<pre><code class="language-html">&lt;Box className=&quot;toCenter square-400 bgRed400&quot;&gt;
  &lt;Box className=&quot;white&quot;&gt;Lorem ipsum&lt;/Box&gt;
&lt;/Box&gt;
</code></pre>
<h3 id="åŠ¨ç”»">åŠ¨ç”»</h3>
<p>Fower æä¾›äº† keyframes APIï¼Œå¯ä»¥å¿«é€Ÿåˆ›å»ºåŠ¨ç”»ã€‚</p>
<pre><code class="language-html">import { Box } from '@fower/react';
import { keyframes } from '@fower/core';

const bounce = keyframes({
  'from, 20%, 53%, 80%, to': {
    transform: 'translate3d(0,0,0)',
    padding: 10,
  },
    '40%, 43%': {
    transform: 'translate3d(0, -30px, 0)',
  },
})

&lt;Box
  text-30
  css={{
    animation: `${bounce} 1s ease infinite`,
  }}
&gt;
  40 Lorem ipsum dolor sit amet
&lt;/Box&gt;
</code></pre>
<h3 id="æ‰©å±•">æ‰©å±•</h3>
<p>Fower æä¾›äº† <a href="https://fower.vercel.app/zh-cn/docs/add-atom">addAtom</a> API å¯ä»¥å¿«é€Ÿæ‰©å±•åŸå­æ ·å¼å±æ€§ã€‚ä½†è¿™åªèƒ½åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
<p>Fower æä¾›äº†çµæ´»çš„æ’ä»¶æœºåˆ¶ï¼Œä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„æ ·å¼ Utilï¼Œä¾›ä»–äººä½¿ç”¨ã€‚</p>
<pre><code class="language-html">import { setConfig } from '@fower/core';
import ellipsis from 'fower-plugin-ellipsis';

setConfig({
  plugin: [ellipsis],
});
</code></pre>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>ç»è¿‡å›¢é˜ŸåŠå¹´çš„ä¸æ‡ˆåŠªåŠ›ï¼ŒFower æ—¥æ¸å®Œå–„ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨é¡¹ç›®ä¸­ç§¯æä½¿ç”¨ã€‚ç›®å‰åœ¨æˆ‘ä»¬å°ç¨‹åºé¡¹ç›®ä¸­åšåˆ°äº†ä»…æœ‰ä¸€ä¸ª app.scss æ ·å¼æ–‡ä»¶çš„åœ°æ­¥ã€‚æˆ‘ä»¬å°è£…äº†å¾ˆå¤šæ¡†æ¶åŒ…ï¼Œä¹Ÿåœ¨ç§¯ææµ‹è¯•ä¸ä½¿ç”¨ï¼Œä½†éš¾å…ä¼šé‡åˆ°å¾ˆå¤š Bugï¼Œå¸Œæœ›å¤§å®¶ç§¯æè¯•ç”¨ä½¿ç”¨ Fowerï¼Œä¹Ÿå¸Œæœ› Fower é¡¹ç›®èƒ½å¤ŸçœŸæ­£çš„å¸®åŠ©ä½ è§£å†³æ ·å¼å¼€å‘çš„ç—›ç‚¹ã€‚è°¢è°¢å¤§å®¶ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://aiyou.life/post-images/1619618374404.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Taroå°ç¨‹åºå¼€å‘æå‡æ•ˆç‡çš„å‡ ç‚¹åˆ†äº«-è·¯ç”±ç¯‡]]></title>
        <id>https://aiyou.life/post/FkN_iGcYQ/</id>
        <link href="https://aiyou.life/post/FkN_iGcYQ/">
        </link>
        <updated>2020-09-22T13:00:12.000Z</updated>
        <summary type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå°ç¨‹åºå¼€å‘ä¸€ä¸ªé¡µé¢ï¼Œé¦–å…ˆè¦åœ¨ pages æ–‡ä»¶å¤¹åœ¨æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ appConfig ä¸­é…ç½®é¡µé¢å®Œæ•´çš„è·¯å¾„åœ°å€ï¼Œåœ¨è¿›è¡Œè·¯ç”±è·³è½¬æ—¶ï¼Œè¿˜éœ€è¦åœ¨ navigateTo ä¸­å†™ä¸‹å®Œæ•´çš„é¡µé¢è·¯å¾„ã€‚å½“é¡µé¢æ•°é‡å°‘ï¼Œä»£ç é‡å°æ—¶ï¼Œä¼¼ä¹å¯ä»¥æ¥å—ï¼Œä½†å½“ä»£ç é‡å¤§ï¼Œé¡¹ç›®å­˜åœ¨å¥½å‡ ä¸ªåˆ†åŒ…æ—¶ï¼Œé¡µé¢è·³è½¬è·¯å¾„ä¼šå˜å¾—éå¸¸é•¿ï¼Œä¹¦å†™é¡µé¢è·¯å¾„ä¼šå˜å¾—è¶Šæ¥è¶Šå›°éš¾ï¼Œä»£ç ä¹Ÿä¸å¤Ÿç¾è§‚å’Œç›´è§‚ã€‚è§£æè·¯ç”±å‚æ•°æ—¶ï¼Œè¿˜éœ€è¦ç»è¿‡å‡ æ­¥è½¬æ¢æ‰èƒ½å¾—åˆ°ã€‚ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå°ç¨‹åºå¼€å‘ä¸€ä¸ªé¡µé¢ï¼Œé¦–å…ˆè¦åœ¨ pages æ–‡ä»¶å¤¹åœ¨æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ appConfig ä¸­é…ç½®é¡µé¢å®Œæ•´çš„è·¯å¾„åœ°å€ï¼Œåœ¨è¿›è¡Œè·¯ç”±è·³è½¬æ—¶ï¼Œè¿˜éœ€è¦åœ¨ navigateTo ä¸­å†™ä¸‹å®Œæ•´çš„é¡µé¢è·¯å¾„ã€‚å½“é¡µé¢æ•°é‡å°‘ï¼Œä»£ç é‡å°æ—¶ï¼Œä¼¼ä¹å¯ä»¥æ¥å—ï¼Œä½†å½“ä»£ç é‡å¤§ï¼Œé¡¹ç›®å­˜åœ¨å¥½å‡ ä¸ªåˆ†åŒ…æ—¶ï¼Œé¡µé¢è·³è½¬è·¯å¾„ä¼šå˜å¾—éå¸¸é•¿ï¼Œä¹¦å†™é¡µé¢è·¯å¾„ä¼šå˜å¾—è¶Šæ¥è¶Šå›°éš¾ï¼Œä»£ç ä¹Ÿä¸å¤Ÿç¾è§‚å’Œç›´è§‚ã€‚è§£æè·¯ç”±å‚æ•°æ—¶ï¼Œè¿˜éœ€è¦ç»è¿‡å‡ æ­¥è½¬æ¢æ‰èƒ½å¾—åˆ°ã€‚ã€‚</p>
<!-- more -->
<h2 id="ç¯å¢ƒ">ç¯å¢ƒ</h2>
<p>åŸºç¡€ç¯å¢ƒ: taro 3.0.5 / react 16.10.0 / typescript 4.1.0</p>
<p>æŠ€æœ¯æ ˆ: React Hooks</p>
<h2 id="è·¯ç”±éƒ¨åˆ†">è·¯ç”±éƒ¨åˆ†</h2>
<p>Taro å°ç¨‹åºè·¯ç”±æ–¹æ³•è°ƒç”¨ç¤ºä¾‹</p>
<p>è·¯ç”±è·³è½¬</p>
<pre><code class="language-typescript">navigateTo({
  url: `/package-appointment/pages/manage-appointments/index?roomId=${roomId}&amp;appointmentId=${appointmentId}&amp;scriptId=${scriptId}`
})
</code></pre>
<p>å‚æ•°è§£æ</p>
<pre><code class="language-typescript">const { params } = useRouter()
const { roomId, appointmentId, scriptId } = params
const oRoomId = Number.parseInt(roomId)
const oAppointmentId = Number.parseInt(appointmentId)
const oScriptId = Number.parseInt(scriptId)
</code></pre>
<h2 id="ä¼˜åŒ–æ–¹æ¡ˆ">ä¼˜åŒ–æ–¹æ¡ˆ</h2>
<h3 id="part-1-è·¯ç”±è¡¨æ–‡ä»¶">PART 1 è·¯ç”±è¡¨æ–‡ä»¶</h3>
<p>æ–°å»ºä¸€ä¸ªè·¯ç”±è¡¨æ–‡ä»¶ routeTable.tsï¼Œä¸ºè·¯å¾„å‘½åã€‚</p>
<pre><code class="language-typescript">export enum URLs {
  INDEX = '/pages/index/index',
  MANAGE_APPOINTMENTS = '/package-appointment/pages/manage-appointments/index',
  INTENT_DETAIL = '/package-intent/pages/intent-detail/index'
}
</code></pre>
<p>è°ƒç”¨æ—¶ï¼Œåªéœ€è¦å¼•å…¥è·¯ç”±è¡¨æ–‡ä»¶</p>
<pre><code class="language-typescript">import { URLs } from '@/common/routeTable'
...
navigateTo({
  url: `${URLs.MANAGE_APPOINTMENTS}?roomId=${roomId}&amp;appointmentId=${appointmentId}&amp;scriptId=${scriptId}`
})
...
</code></pre>
<p>å¼•å…¥äº†è·¯ç”±è¡¨æ–‡ä»¶çš„åŒæ—¶ï¼Œå¼•å…¥äº†æ–°çš„é—®é¢˜ï¼Œæ–°å»ºä¸€ä¸ªé¡µé¢è¦ç»´æŠ¤ä¸¤ä¸ªè·¯ç”±åœ°å€æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ app.config ï¼Œå¦ä¸€ä¸ªå°±æ˜¯è·¯ç”±è¡¨æ–‡ä»¶ routeTableã€‚å¢åŠ äº†ç»´æŠ¤æˆæœ¬ï¼ŒåŒæ—¶ä¸¤ä¸ªæ–‡ä»¶ï¼Œåªè¦æœ‰ä¸€ç‚¹é”™è¯¯ï¼Œé¡µé¢å°±ä¸èƒ½æ­£ç¡®çš„è¢«è®¿é—®ã€‚æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<h3 id="part-2-è„šæœ¬æ›´æ–°è·¯ç”±è¡¨ä¸ç›¸å…³é…ç½®">PART 2 è„šæœ¬æ›´æ–°è·¯ç”±è¡¨ä¸ç›¸å…³é…ç½®</h3>
<p>æ— è®º app.config è·¯å¾„é…ç½®è¿˜æ˜¯è·¯ç”±è¡¨é…ç½®ï¼Œé¡µé¢ä¸è·¯å¾„æ˜¯å¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬å»å¤„ç†é—®é¢˜ã€‚é¦–å…ˆæ‰«ææºç æ–‡ä»¶å¤¹ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ‰¾åˆ° pages å’Œ package- ä¸‹çš„æ‰€æœ‰é¡µé¢ã€‚æ‰¾åˆ°æ–‡ä»¶åï¼Œè·å–æ–‡ä»¶å¤¹åç§°ä½œä¸ºè·¯ç”±è¡¨çš„ shortName, æ„é€ æ•°æ®åå³å¯æ›¿æ¢å’Œæ–°å»ºåˆ° app.config å’Œ routeTable ä¸­ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é¡ºå¸¦æŠŠ project.config.json ä¸­ miniprogram å­—æ®µæ›´æ–°ï¼Œç”¨äºå¼€å‘é¡µé¢è¿›è¡Œå¿«æ·è°ƒè¯•ã€‚</p>
<p>è„šæœ¬å®Œæˆä¹‹åï¼Œæ¯æ¬¡å¼€å‘é¡µé¢æ—¶ï¼Œåªéœ€è¦åœ¨ pages ç›®å½•ä¸‹æˆ–è€…åˆ†åŒ… pages ç›®å½•ä¸‹æ–°å»ºç›®å½•ï¼Œè¿è¡Œè„šæœ¬å‘½ä»¤å³å¯è‡ªåŠ¨æ›´æ–° app.config ã€ project.config å’Œ routeTableã€‚</p>
<p>æ³¨æ„:</p>
<blockquote>
<ul>
<li>æŸ¥æ‰¾é¡µé¢æ–‡ä»¶ï¼Œé»˜è®¤ pages ä¸‹çš„ä¸€çº§ç›®å½•ä¸ºæ‰€æœ‰é¡µé¢æ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦å¼€å‘è€…æ‹¥æœ‰è‰¯å¥½çš„å¼€å‘ä¹ æƒ¯ï¼Œå†™çš„é¡µé¢æ²¡æœ‰è¿›è¡ŒåµŒå¥—ã€‚</li>
<li>è„šæœ¬ä»£ç å¾ˆç®€å•ï¼Œå°±ä¸æ–°å»ºä»“åº“äº†ï¼Œå®Œæ•´ä»£ç å·²ç»è´´åˆ°äº†æœ€ä¸‹é¢</li>
</ul>
</blockquote>
<h3 id="part-3-åœ°å€å‚æ•°æ”¹é€ ">PART 3 åœ°å€å‚æ•°æ”¹é€ </h3>
<p>è§‚å¯Ÿ PART 1 éƒ¨åˆ†çš„ä»£ç ï¼Œå…¶å®å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶é€šè¿‡è·¯ç”±è¡¨å½¢å¼ç¼©çŸ­äº†ä¸€éƒ¨åˆ†åœ°å€çš„é•¿åº¦ï¼Œä½†æ˜¯å‚æ•°éƒ¨åˆ†è¿˜å¯ä»¥åšäº›æ–‡ç« ã€‚</p>
<pre><code class="language-typescript">// queryParams å°è£…
const covertObjToSearchParams = (searchObj: commonObjectProps = {}) =&gt; {
  let searchParams = ''
  for (let i in searchObj) {
    searchParams = searchParams + `${i}=${searchObj[i]}&amp;`
  }
  return searchParams.slice(0, -1)
}

const queryParams = covertObjToSearchParams({ roomId, appointmentId, scriptId })

navigateTo({
  url: `${URLs.MANAGE_APPOINTMENTS}?${queryParams}`
})

</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ä¼ é€’å‚æ•°ï¼Œç®€æ´ç›´è§‚ï¼Œæ–¹ä¾¿ä¸å°‘ã€‚</p>
<h3 id="part-4-è·¯ç”±è·³è½¬æ–¹æ³•æ”¹é€ ">PART 4 è·¯ç”±è·³è½¬æ–¹æ³•æ”¹é€ </h3>
<p>å°ç¨‹åºä¸­çš„æ–¹æ³•å¤§éƒ½éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå¯¹è±¡ä¼ é€’çš„å‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºå¤§å¤šæ•°æ–¹æ³•éƒ½æœ‰å¾ˆå¤šå‚æ•°ï¼Œé€šè¿‡å¯¹è±¡ä¼ å‚åˆ™æ˜¾å¾—ä»£ç æ•´æ´å‹å¥½ã€‚è§‚å¯Ÿæˆ‘ä»¬çš„ä»£ç ï¼Œç”¨åˆ°çš„æœ€å¤šçš„å°±æ˜¯ä¸€ä¸ª url å‚æ•°, é‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥å°†åœ°å€æ”¾åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä½ä¸Šã€‚</p>
<p>navigateTo æ–¹æ³•æ”¹é€ </p>
<pre><code class="language-typescript">import { navigateTo as originNavigateTo } from '@tarojs/taro'

export function navigateTo(url: string, params?: commonObjectProps, opt?: commonObjectProps) {
  if (!params) return originNavigateTo({ url, ...opt })

  const _url = `${url}?${covertObjToSearchParams(params)}`
  originNavigateTo({ url: _url, ...opt })
}
</code></pre>
<p>navigateTo è°ƒç”¨</p>
<pre><code class="language-typescript">navigateTo(URLs.MANAGE_APPOINTMENTS, { roomId, appointmentId, scriptId })`
</code></pre>
<p>ç›¸æ¯”å‰æ–‡ä¸­çš„æœ€å¼€å§‹æ—¶çš„è·¯ç”±è°ƒç”¨ï¼Œè¿™é‡Œæ›´åŠ ç®€æ´æ˜äº†</p>
<h3 id="part-5-è·¯ç”±å‚æ•°è§£ææ–¹æ³•æ”¹é€ ">PART 5 è·¯ç”±å‚æ•°è§£ææ–¹æ³•æ”¹é€ </h3>
<p>Taro ä¸­æä¾›äº† <strong>useRouter</strong> hookså»è§£æè·¯ç”±å‚æ•°ï¼Œä½†è¯¥ Hooks è§£æå‡ºçš„å‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚</p>
<p>å½“ä½¿ç”¨å‚æ•°æ—¶ï¼Œéœ€è¦å…ˆå¯¼å‡º <strong>params</strong> å¯¹è±¡ï¼Œç„¶åå†æ‹¿åˆ°å‚æ•°å€¼ï¼Œå¯¹äºä¸€äº›æ•°å­—ã€å¸ƒå°”ç±»å‹å€¼è¿˜åªèƒ½å†é€šè¿‡è½¬æ¢è·å¾—åŸå§‹å€¼ã€‚æµç¨‹ç¹çä¸”å¤æ‚ã€‚æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜?</p>
<p>é¦–å…ˆå¯¹ useRouter è¿›è¡Œåˆæ­¥å°è£…</p>
<pre><code class="language-typescript">import { useRouter as useOriginRouter } from '@tarojs/taro'

export function useRouter&lt;T&gt;(): T {
  const { params } = useOriginRouter()
  return params
}
</code></pre>
<p>å°è£…å®Œçš„ useRouter åªç®€åŒ–äº†å¯¼å‡º params çš„è¿‡ç¨‹ï¼Œè€Œå‚æ•°ç±»å‹è½¬æ¢è¿˜æ˜¯åªèƒ½æ ¹æ®å…·ä½“çš„å‚æ•°è¿›è¡Œå…·ä½“è½¬æ¢ã€‚é‚£è¿™æ ·çš„å°è£…å…¶å®è¿˜æ˜¯æœ‰ç‚¹é¸¡è‚‹ã€‚</p>
<p>é€šè¿‡ queryParams ä¼ é€’çš„å‚æ•°åªèƒ½æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„ï¼Œæ‰€ä»¥è§£æå‚æ•°ä¹Ÿåªèƒ½è§£æå‡ºå­—ç¬¦ä¸²ã€‚å› è€Œå¯ä»¥é€šè¿‡ <strong>JSON.stringify</strong> å°†å‚æ•°å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè§£ææ—¶å†åˆ©ç”¨ <strong>JSON.parse</strong> è§£æå‡ºä¿æœ‰åŸå§‹æ•°æ®ç±»å‹çš„å‚æ•°ã€‚</p>
<pre><code class="language-typescript">import { useRouter as useOriginRouter, navigateTo as originNavigateTo } from '@tarojs/taro'

// è·¯ç”±è·³è½¬
export function navigateTo(url: string, params?: object) {
  if (!params) return originNavigateTo({ url })

  const _url = `${url}?navParams=${JSON.stringify(params)}`
  originNavigateTo({ url: _url })
}

// è·¯ç”±è§£æ
export function useRouter&lt;T&gt;(): T {
  const { params } = useOriginRouter()

  try {
    const targetParams = params['navParams']
    if (targetParams) return JSON.parse(targetParams)
  } catch (e) {
    console.warn('å‚æ•°è§£æå¤±è´¥', e)
  }

  return {} as T
}
</code></pre>
<p>ä½¿ç”¨è¿™ç§å°è£…æ–¹å¼ï¼Œè™½ç„¶ URL ä¸ç›´è§‚ä¸”ä¸åˆ©äº SEOï¼Œä½†åœ¨å°ç¨‹åºç¯å¢ƒä¸­ï¼Œç”¨æˆ·æ ¹æœ¬ä¸ä¼šçœ‹åˆ° URLï¼Œä¸”åœ¨å½“å‰å°ç¨‹åºç¯å¢ƒä¸­ï¼ŒSEOä¼¼ä¹æ ¹æœ¬æ²¡ä»€ä¹ˆç”¨ã€‚</p>
<p>ä½¿ç”¨æˆ‘ä»¬å°è£…å¥½çš„ä»£ç ï¼Œæ–‡ç« å¼€å¤´ç»™å‡ºçš„ç¤ºä¾‹å¯ç®€åŒ–ä¸ºå¦‚ä¸‹ä»£ç :</p>
<pre><code class="language-typescript">import { navigateTo, useRouter } from '@/app'

navigateTo(URLs.MANAGE_APPOINTMENTS, { roomId, appointmentId, scriptId })
...

const { roomId, appointmentId, scriptId } = useRouter()
...

</code></pre>
<h2 id="å®Œæ•´è·¯ç”±è„šæœ¬ç”Ÿæˆå’Œä»£ç ">å®Œæ•´è·¯ç”±è„šæœ¬ç”Ÿæˆå’Œä»£ç </h2>
<p>è„šæœ¬ä»£ç å¾ˆç®€å•ï¼Œå°±ä¸æ–°å»ºä»“åº“å­˜äº†ã€‚</p>
<h3 id="ä¸»è„šæœ¬æ–‡ä»¶">ä¸»è„šæœ¬æ–‡ä»¶</h3>
<pre><code class="language-javascript">const path = require('path')
const fs = require('fs')
const { isDir, readDir, readFile, writeFile } = require('./util')
const PROJECT_CONFIG = require('../project.config.json')

const BASE_PATH = path.resolve(__dirname, '..')
const APP_CONFIG_PATH = path.resolve(BASE_PATH, 'src/app.config.ts')
const URL_TABLE_PATH = path.resolve(BASE_PATH, 'src/common/url.constant.ts')
const PACKAGE_CONFIG_PATH = path.resolve(BASE_PATH, 'project.config.json')

function handleMainPageConfig(dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'pages/${dir}/index'\n`)
  fileStr = fileStr.replace(/pages[\S\s]*subPackages/, `pages: [${paths}], subPackages`)
  return fileStr
}

function handleSubPageConfig(rootPath, dirsName, subPackage) {
  const [, name] = rootPath.split('-')
  subPackage.push({
    root: rootPath,
    name,
    pages: dirsName.map((name) =&gt; `pages/${name}/index`),
  })
  return subPackage
}

function handleMainRouteTable(dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'/pages/${dir}/index'\n`)
  for (let i = 0; i &lt; dirsName.length; i++) {
    const current = dirsName[i]
    const name = current
      .split('-')
      .map((v) =&gt; v.toUpperCase())
      .join('_')
    fileStr = fileStr + `${name}=${paths[i]},`
  }
  return fileStr
}

function handleSubRouteTable(rootPath, dirsName, fileStr) {
  const paths = dirsName.map((dir) =&gt; `'/${rootPath}/pages/${dir}/index'\n`)
  for (let i = 0; i &lt; dirsName.length; i++) {
    const current = dirsName[i]
    const name = current
      .split('-')
      .map((v) =&gt; v.toUpperCase())
      .join('_')
    fileStr = fileStr + `${name}=${paths[i]},`
  }
  return fileStr
}

function handleMainProjectConfig(dirsName, routes) {
  const paths = dirsName.map((dir) =&gt; `pages/${dir}/index`)
  return routes.concat(paths.map((_path, idx) =&gt; {
    return {
      id: idx + 1,
      name: dirsName[idx],
      pathName: _path,
      query: '',
    }
  }))
}

function handleSubProjectConfig(rootPath, dirsName, routes) {
  const paths = dirsName.map((dir) =&gt; `${rootPath}/pages/${dir}/index`)
  return routes.concat(
    paths.map((_path, idx) =&gt; {
      return {
        id: idx + 1,
        name: dirsName[idx],
        pathName: _path,
        query: '',
      }
    }),
  )
}

async function updateAppConfig(fileStr, subPackage) {
  fileStr = fileStr.replace(/(subPackages[\S\s]*)window/g, `subPackages: ${JSON.stringify(subPackage)}, window`)
  await writeFile(APP_CONFIG_PATH, fileStr)
}

async function updateRouteTable(fileStr) {
  let routeTable = `
    // è‡ªåŠ¨ç”Ÿæˆ, pages æ–‡ä»¶å¤¹æ–°å»ºç›®å½•ï¼Œè¿è¡Œ npm run g
    export enum URLs {
      ${fileStr}
    }
  `
  await writeFile(URL_TABLE_PATH, routeTable)
}

async function updateProjectConfig(entrance) {
  PROJECT_CONFIG.condition.miniprogram.list = entrance
  await writeFile(PACKAGE_CONFIG_PATH, JSON.stringify(PROJECT_CONFIG, null, 2))
}

function sortDirs(dirsName) {
  const indexIdx = dirsName.findIndex((dirname) =&gt; dirname === 'index')
  if (indexIdx === -1) return dirsName.sort((a, b) =&gt; a.localeCompare(b))
  dirsName.splice(indexIdx, 1)
  dirsName = dirsName.sort((a, b) =&gt; a.localeCompare(b))
  dirsName.unshift('index')
  return dirsName
}

async function main(dirPath) {
  const baseDirsName = await readDir(dirPath)
  const target = baseDirsName.filter((dirName) =&gt; /^pages$|^package-\w+$/.test(dirName))

  // è¯»å–APPé…ç½®æ–‡ä»¶
  let appConfigFileStr = await readFile(APP_CONFIG_PATH)
  // app.config åˆ†åŒ…é…ç½®
  let subPackage = []

  // ç”Ÿæˆè·¯ç”±è¡¨æ–‡ä»¶
  let routeTableFileStr = ''
  
  // project.config é¡¹ç›®å¿«æ·å…¥å£é…ç½®
  let entrance = []
  let mainEntrance = []

  for await (let i of target) {
    if (i === 'pages') {
      const dirsName = sortDirs(await readDir(path.resolve(dirPath, i)))
      appConfigFileStr = handleMainPageConfig(dirsName, appConfigFileStr)
      routeTableFileStr = handleMainRouteTable(dirsName, routeTableFileStr)
      mainEntrance = handleMainProjectConfig(dirsName, [])
    } else {
      const dirsName = sortDirs(await readDir(path.resolve(dirPath, i, 'pages')))
      subPackage = handleSubPageConfig(i, dirsName, subPackage)
      routeTableFileStr = handleSubRouteTable(i, dirsName, routeTableFileStr)
      entrance = handleSubProjectConfig(i, dirsName, entrance)
    }
  }
  updateAppConfig(appConfigFileStr, subPackage)
  updateRouteTable(routeTableFileStr)
  updateProjectConfig(mainEntrance.concat(entrance))
}

// ä¸»å‡½æ•°
main(path.resolve(BASE_PATH, 'src'))

</code></pre>
<h3 id="å·¥å…·è„šæœ¬æ–‡ä»¶">å·¥å…·è„šæœ¬æ–‡ä»¶</h3>
<pre><code class="language-javascript">const path = require('path')
const fs = require('fs')

// å½“å‰è·¯å¾„æ˜¯æ–‡ä»¶å¤¹
function isDir(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.stat(filePath, (err, stats) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(stats.isDirectory())
      }
    })
  })
}

// è¯»å–å½“å‰æ–‡ä»¶å¤¹ç›®å½•
function readDir(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.readdir(filePath, 'utf8', (err, dir) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(dir)
      }
    })
  })
}

// è¯»å–æ–‡ä»¶
function readFile(filePath) {
  return new Promise((resolve, reject) =&gt; {
    fs.readFile(filePath, (err, dir) =&gt; {
      if (err) {
        reject(err)
      } else {
        resolve(dir.toString())
      }
    })
  })
}

// å†™æ–‡ä»¶
async function writeFile(filePath, fileStr) {
  return new Promise((resolve, reject) =&gt; {
    fs.writeFile(filePath, fileStr, (err, res) =&gt; {
      if (err) return reject(err)
      resolve(res)
    })
  })
}

// æ–‡ä»¶å¤¹æ‰«æ
async function fileScanner(filePath, fn) {
  const dir = await isDir(filePath)
  if (dir) {
    const dirs = await readDir(filePath)
    for await (const name of dirs) {
      fileScanner(path.resolve(filePath, name), fn)
    }
  } else {
    await fn(filePath)
  }
}

module.exports = {
  isDir,
  readDir,
  readFile,
  writeFile,
  fileScanner,
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ReactNativeæ¸è¿›å¼å›¾ç‰‡åŠ è½½]]></title>
        <id>https://aiyou.life/post/FEu-GtOkz/</id>
        <link href="https://aiyou.life/post/FEu-GtOkz/">
        </link>
        <updated>2020-09-05T16:22:37.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšReactNativeé¡¹ç›®ï¼Œæˆ‘ä»¬çš„é¡µé¢æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œå‘ç°å›¾ç‰‡åŠ è½½æ•ˆæœå¾ˆå¡é¡¿ã€‚äºæ˜¯ç ”ç©¶äº†ä¸€ä¸‹RNä¸‹å›¾ç‰‡æ¸è¿›åŠ è½½ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšReactNativeé¡¹ç›®ï¼Œæˆ‘ä»¬çš„é¡µé¢æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œå‘ç°å›¾ç‰‡åŠ è½½æ•ˆæœå¾ˆå¡é¡¿ã€‚äºæ˜¯ç ”ç©¶äº†ä¸€ä¸‹RNä¸‹å›¾ç‰‡æ¸è¿›åŠ è½½ã€‚</p>
<!-- more -->
<h2 id="åŸç†">åŸç†</h2>
<p>é¦–å…ˆç»™å›¾ç‰‡ä¸€ä¸ªå›ºå®šå®½é«˜çš„å®¹å™¨ï¼Œå®¹å™¨ä¸­æœ‰ä¸¤ä¸ªé€æ˜åº¦ä¸º0çš„ Image å…ƒç´ ï¼Œ å…¶ä¸­ä¸€ä¸ªåŠ è½½ç¼©ç•¥å›¾ï¼Œä¸€ä¸ªä¸ºåŸå›¾ï¼Œç›‘å¬å›¾ç‰‡åŠ è½½ï¼Œè°ƒæ•´é€æ˜åº¦ï¼Œç»™è¿‡æ¸¡åŠ¨ç”»ã€‚</p>
<h2 id="ä¾èµ–">ä¾èµ–</h2>
<pre><code class="language-bash">react-native-fast-image   ç”¨äºç¼“å­˜å›¾ç‰‡
react-spring/native   ç”¨äºå®ç°åŠ¨ç”»æ•ˆæœ
</code></pre>
<h2 id="å¯¹æ¯”å›¾">å¯¹æ¯”å›¾</h2>
<figure data-type="image" tabindex="1"><img src="https://aiyou.life/post-images/1599328089874.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ä¼˜åŒ–å‰</div>
<figure data-type="image" tabindex="2"><img src="https://aiyou.life/post-images/1599328239398.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ä¼˜åŒ–å</div>
<h2 id="æ ¸å¿ƒä»£ç ">æ ¸å¿ƒä»£ç </h2>
<pre><code class="language-typescript">import React, { FC } from 'react'
import { View, StyleSheet, ImageStyle, ViewStyle, animated } from 'react-native'
import FastImage, { FastImageProps } from 'react-native-fast-image'
import { animated } from 'react-spring/native'
import { useSpring } from 'react-spring'

const AnimatedFastImage = animated(FastImage)

interface ImgStyle extends ImageStyle {
  width: number | string
  height: number | string
}

interface Props extends FastImageProps {
  thumbnailSource?: FastImageProps['source']
  style: ImgStyle
  containerStyle?: ViewStyle
}

export const ProgressiveImage: FC&lt;Props&gt; = ({
  thumbnailSource,
  source,
  style,
  containerStyle,
  ...props
}) =&gt; {
  const [thumbOpStyle, setThumbOpStyle] = useSpring(() =&gt; ({ opacity: 0, config: { duration: 500 } }))
  const [imgOpStyle, setImgOpStyle] = useSpring(() =&gt; ({ opacity: 0, config: { duration: 500 } }))

  function handleThumbnailLoad() {
    setThumbOpStyle({ opacity: 1, config: { duration: 500 } })
  }

  function onImageLoad() {
    setImgOpStyle({ opacity: 1, config: { duration: 500 } })
  }

  return (
    &lt;View style={[styles.container, { width: style.width, height: style.height }, containerStyle]}&gt;
      {thumbnailSource &amp;&amp; (
        &lt;AnimatedFastImage
          {...props}
          source={thumbnailSource}
          style={[style, thumbOpStyle]}
          onLoad={handleThumbnailLoad}
          blurRadius={1}
        /&gt;
      )}
      &lt;AnimatedFastImage
        {...props}
        source={source}
        style={[styles.imageOverlay, imgOpStyle, style]}
        onLoad={onImageLoad}
      /&gt;
    &lt;/View&gt;
  )
}

const styles = StyleSheet.create({
  imageOverlay: {
    position: 'absolute',
    left: 0,
    right: 0,
    bottom: 0,
    top: 0,
  },
  container: {
    backgroundColor: '#e1e4e8',
  },
})

</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¤šè¡Œæ–‡æœ¬æº¢å‡ºçœç•¥]]></title>
        <id>https://aiyou.life/post/qo35dDzbQ/</id>
        <link href="https://aiyou.life/post/qo35dDzbQ/">
        </link>
        <updated>2020-09-05T05:04:44.000Z</updated>
        <summary type="html"><![CDATA[<p>å¤šè¡Œæ–‡æœ¬æº¢å‡ºçœç•¥æŠ€æœ¯æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œæ— è®ºæ˜¯åœ¨å‰ç«¯è¿˜æ˜¯APPç«¯ã€‚æ–‡å­—ä½•æ—¶æ¢è¡Œï¼Œæ¢è¡Œçš„æ˜¯å“ªä¸€ä¸ªå­—ï¼Œæ–‡å­—ä¼šå ç”¨å‡ è¡Œéƒ½éš¾ä»¥ç²¾ç¡®è®¡ç®—å’Œä¼°é‡ã€‚æœ¬æ–‡å°†æ¢è®¨å’Œå®ç°ä¸€ç§ç›¸å¯¹å®Œç¾çš„æ–¹æ³•ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¤šè¡Œæ–‡æœ¬æº¢å‡ºçœç•¥æŠ€æœ¯æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œæ— è®ºæ˜¯åœ¨å‰ç«¯è¿˜æ˜¯APPç«¯ã€‚æ–‡å­—ä½•æ—¶æ¢è¡Œï¼Œæ¢è¡Œçš„æ˜¯å“ªä¸€ä¸ªå­—ï¼Œæ–‡å­—ä¼šå ç”¨å‡ è¡Œéƒ½éš¾ä»¥ç²¾ç¡®è®¡ç®—å’Œä¼°é‡ã€‚æœ¬æ–‡å°†æ¢è®¨å’Œå®ç°ä¸€ç§ç›¸å¯¹å®Œç¾çš„æ–¹æ³•ã€‚</p>
<!-- more -->
<h1 id="å•è¡Œæ–‡æœ¬çœç•¥">å•è¡Œæ–‡æœ¬çœç•¥</h1>
<p>å•è¡Œæ–‡æœ¬çœç•¥è¾ƒä¸ºç®€å•ï¼Œä¸”å…¼å®¹æ€§è¾ƒå¥½ã€‚</p>
<p>è¦å®ç°å•è¡Œæ–‡æœ¬çœç•¥ï¼Œä¸‹é¢CSSå±æ€§ç¼ºä¸€ä¸å¯</p>
<pre><code class="language-css">width: 100px;  // å›ºå®šå®½åº¦
overflow: hidden;   // æº¢å‡ºéšè—
white-space: nowrap;    // æ–‡å­—ä¸æ¢è¡Œ
text-overflow: ellipsis;    // æ–‡å­—æº¢å‡ºæˆªæ–­
</code></pre>
<h1 id="å¤šè¡Œæ–‡æœ¬çœç•¥">å¤šè¡Œæ–‡æœ¬çœç•¥</h1>
<p>å½“æ¥åˆ°è¿™ä¸ªéœ€æ±‚çš„æ—¶å€™ï¼Œè€ƒè™‘åˆ°æˆ‘ä»¬äº§å“è¿è¡Œåœ¨å¾®ä¿¡å°ç¨‹åºï¼Œè€Œå°ç¨‹åºåœ¨IOSå’Œå®‰å“å¹³å°éƒ½æ˜¯ç”¨äº†webkitå†…æ ¸, å› è€Œä¸‹é¢çš„ä»£ç åº”å½“åœ¨ä¸¤ä¸ªå¹³å°éƒ½å¯ä»¥å¾ˆå¥½è¿è¡Œã€‚</p>
<p>webkit å†…æ ¸çš„æµè§ˆå™¨å¯ä»¥åŸç”Ÿå®ç°å¤šè¡Œæ–‡æœ¬æº¢å‡ºçœç•¥ã€‚</p>
<pre><code class="language-css">display: -webkit-boxï¼›
-webkit-box-orient: vertical;
-webkit-line-clamp: 2;
overflow: hiddenï¼›
text-overflow: ellipsisï¼›
</code></pre>
<p>ç„¶è€Œäº‹å®å¹¶éå¦‚æ­¤ã€‚å®é™…ä¸Šé¢ä»£ç åœ¨å®‰å“å¯ä»¥è¿è¡Œï¼Œä½†åœ¨IOSä¸‹åˆ™ç©ºç™½ã€‚<br>
<img src="https://aiyou.life/post-images/1599296417880.png" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">line-clampå…¼å®¹æ€§</div>
<figure data-type="image" tabindex="1"><img src="https://aiyou.life/post-images/1599295340251.png" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">å¾®ä¿¡å°ç¨‹åºè¿è¡Œç¯å¢ƒ</div>
<figure data-type="image" tabindex="2"><img src="https://aiyou.life/post-images/1599296818625.png" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">IOS WkWebView åŸºäº Webkit</div>
<p>æ‰¾äº†åŠå¤©èµ„æ–™ï¼Œä¹Ÿæ²¡æœ‰æ‰¾åˆ°åŸå› ã€‚çŒœæƒ³å¯èƒ½ WkWebView ä¸­çš„ webkit ç‰ˆæœ¬å¤ªä½çš„ç¼˜æ•…ã€‚</p>
<p>æ—¢ç„¶ä¸Šé¢çš„ä»£ç ä¸èƒ½ä½¿ç”¨ï¼Œåªèƒ½å°è¯•å…¶ä»–åŠæ³•ã€‚</p>
<h2 id="js-æ–¹å¼">JS æ–¹å¼</h2>
<p>JSè®¡ç®—è£å‰ªçš„æ–¹å¼è¢«æ’é™¤äº†</p>
<ul>
<li>ç¬¬ä¸€ï¼Œè¿™æœ‰æ‚–äºè¡Œä¸ºä¸å±•ç¤ºç›¸åˆ†ç¦»çš„ç†å¿µ</li>
<li>ç¬¬äºŒï¼Œè¦è€ƒè™‘æ±‰å­—ï¼Œè‹±æ–‡å­—æ¯ï¼Œå›¾æ ‡ï¼Œå…¨è§’åŠè§’ç¬¦å·ç­‰æ‰èƒ½ç›¸å¯¹å‡†ç¡®ç®—å‡ºæ–‡å­—å ç”¨å‡ è¡Œï¼Œè¦ä¸è¦è£åˆ‡</li>
<li>ç¬¬ä¸‰ï¼Œæˆ‘ä»¬çš„ä½¿ç”¨åœºæ™¯ä¸­è¦è§£æå¯Œæ–‡æœ¬ï¼Œå¯¹äºHTMLæ ‡ç­¾ï¼Œé“¾æ¥åœ°å€ç­‰è¦è€ƒè™‘çš„è¾ƒå¤šï¼Œå®ç°æ–¹æ¡ˆè¾ƒä¸ºå¤æ‚</li>
</ul>
<h2 id="css-æ–¹å¼">CSS æ–¹å¼</h2>
<h3 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h3>
<p>å¾ˆå®¹æ˜“å†™ä¸‹ä¸‹é¢è¿™äº›ä»£ç ï¼Œç¼ºç‚¹æ˜¯å›ºå®šé«˜åº¦ï¼Œæ–‡å­—æ•°é‡å¿…é¡»è¶…è¿‡ä¸¤è¡Œï¼Œå½“æ–‡å­—åªæœ‰ä¸€è¡Œæˆ–ä¸¤è¡Œæ—¶ï¼Œéƒ½ä¼šæ˜¾ç¤ºæœ«å°¾çš„çœç•¥å·ã€‚ä¸”æ–‡å­—è¶…è¿‡ä¸¤è¡Œï¼Œæœ«å°¾çš„çœç•¥å·æœ‰å¯èƒ½é®æŒ¡ä½ä¸€åŠçš„å­—ç¬¦ã€‚è¿™æ ·çš„æ•ˆæœä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<pre><code class="language-css">.container {
    position: 'relative';
    width: 200px;
    height: 40px;
    line-height: 20px;
    overflow: hidden;
}
.container::after {
    content: '...';
    display: 'block';
    position: 'absolute';
    right: 0;
    bottom: 0;
}
</code></pre>
<h3 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h3>
<p>CSS å¤„ç†çš„éš¾ç‚¹åœ¨äºçŸ¥é“æœ‰æ²¡æœ‰æ¢è¡Œï¼Œæ€è€ƒè‰¯ä¹…åæ— æœï¼Œä»ç½‘ä¸Šæ‰¾äº†æ‰¾èµ„æ–™ï¼Œå‘ç°ä¸€ç§å¾ˆå·§å¦™çš„åŠæ³•ã€‚è§£å†³äº†ä¸€éƒ¨åˆ†é—®é¢˜ã€‚</p>
<p>è¯¥æ–¹æ³•åˆ©ç”¨æµ®åŠ¨å…ƒç´ ç‰¹æ€§å®ç°ã€‚åŸç†å¾ˆç®€å•ï¼Œä½†æƒ³æ³•å¾ˆç‹¬ç‰¹ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªé™å®šä¸¤è¡Œçš„ä¾‹å­ã€‚</p>
<h4 id="ç¬¬ä¸€æ­¥åˆ›å»ºå¦‚å›¾å¸ƒå±€">ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå¦‚å›¾å¸ƒå±€</h4>
<figure data-type="image" tabindex="3"><img src="https://aiyou.life/post-images/1599306945438.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ç¬¬ä¸€æ­¥</div>
<pre><code class="language-html">&lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;baseline&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;text&quot;&gt;è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡æœ¬&lt;/div&gt;
    &lt;div class=&quot;omit&quot;&gt;...&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="language-less">.container {
    background: #099;
    max-height: 40px;
    line-height: 20px;
    .baseline {
        float: left;
        width: 20px;
        height: 40px;
        background: yellow;
    }
    .text {
        float: right;
        width: calc(100% - 20px);
        background: blueviolet;
        word-break: break-all;
    }
    .omit {
        float: right;
        content: &quot;...&quot;;
        width: 20px;
        height: 20px;
        background: red;
    }
}
</code></pre>
<h4 id="ç¬¬äºŒæ­¥çœç•¥å·å½’ä½">ç¬¬äºŒæ­¥ï¼šçœç•¥å·å½’ä½</h4>
<figure data-type="image" tabindex="4"><img src="https://aiyou.life/post-images/1599314322562.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ç¬¬äºŒæ­¥</div>
<pre><code class="language-less">...
    .omit {
        float: right;
        content: &quot;...&quot;;
        width: 20px;
        height: 20px;
        background: red;
        + position: relative;
        + left: 100%;
        + transform: translate(-100%, -100%);
    }
...
</code></pre>
<p>è¿™é‡Œåˆ©ç”¨ position: relative ç›¸å¯¹çˆ¶å…ƒç´ å°†è‡ªå·±å®šä½åˆ°äº†çˆ¶å…ƒç´ çš„å®½åº¦å¤–ï¼Œä¹‹ååˆ©ç”¨ transform å‘ä¸Šå‘å·¦ç§»åŠ¨äº†ä¸€ä¸ªè‡ªå·±çš„å®½é«˜ã€‚å½“åªæœ‰ä¸€è¡Œæ—¶ï¼Œçœç•¥å·ç§»å‡ºäº†è§†çº¿ä¹‹å¤–ï¼Œå½“ä¸¤è¡Œæ—¶ï¼Œçœç•¥å·å›å½’äº†æ­£ç¡®çš„ä½ç½®ã€‚</p>
<h4 id="ç¬¬ä¸‰æ­¥éšè—å¤šä½™å…ƒç´ ">ç¬¬ä¸‰æ­¥ï¼šéšè—å¤šä½™å…ƒç´ </h4>
<figure data-type="image" tabindex="5"><img src="https://aiyou.life/post-images/1599315200026.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">ç¬¬ä¸‰æ­¥</div>
<pre><code class="language-less">...
.container {
    background: #099;
    max-height: 40px;
    line-height: 20px;
    ++ overflow: hidden;
    ...
    .text {
        float: right;
        -- width: calc(100% - 20px);
        ++ width: 100%;
        ++ margin-left: -20px;
        background: blueviolet;
        word-break: break-all;
    }
...
</code></pre>
<p>è¿™é‡Œä½¿ç”¨ margin-left ä¸ºè´Ÿï¼Œç›–ä½äº† baseline å…ƒç´ ã€‚è¿™æ ·ä¿è¯äº†åŸºæœ¬å¸ƒå±€ä¸å˜ï¼Œä¸”è¾¾åˆ°äº†å½±è—æ— å…³å…ƒç´ çš„ä½œç”¨ã€‚ç”±äºåœ¨çˆ¶å…ƒç´ ä¸­è®¾å®šäº† overflow: hidden, æ¸…é™¤æµ®åŠ¨ï¼Œæ‰€ä»¥çˆ¶å…ƒç´ çš„èƒŒæ™¯é¢œè‰²æ˜¾ç¤ºå‡ºæ¥äº†ã€‚</p>
<h4 id="å±€é™æ€§">å±€é™æ€§</h4>
<figure data-type="image" tabindex="6"><img src="https://aiyou.life/post-images/1599316233622.gif" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">å±€é™</div>
ä½¿ç”¨è¯¥ç§æ–¹å¼ï¼Œå±€é™åœ¨äºå›ºå®šé«˜åº¦ã€‚baseline å…ƒç´ å¿…é¡»è®¾å®šä¸ºå›ºå®šé«˜åº¦ï¼Œå› è€Œæ’‘èµ·äº†çˆ¶å…ƒç´ çš„é«˜åº¦ã€‚
<h4 id="æ³¨æ„">æ³¨æ„</h4>
<ul>
<li>container å…ƒç´ ä¸­ maxHeight/Height å¿…é¡»æ˜¯ LineHeight çš„æ•´æ•°å€ã€‚å€æ•°è¡¨ç¤ºé™åˆ¶å‡ è¡Œ</li>
<li>container å…ƒç´ ä¸­ maxHeight/Height è¦ä¸ baseline å…ƒç´ çš„ height ä¿æŒä¸€è‡´</li>
<li>baseline å…ƒç´ å®½åº¦è¦ä¸ emit å…ƒç´ å®½åº¦ä¿æŒä¸€è‡´</li>
<li>emit å…ƒç´ é«˜åº¦è¦ä¸º container å…ƒç´ çš„è¡Œé«˜</li>
</ul>
<h4 id="åº”ç”¨æ¡ˆä¾‹">åº”ç”¨æ¡ˆä¾‹</h4>
<figure data-type="image" tabindex="7"><img src="https://aiyou.life/post-images/1599318337342.png" alt="" loading="lazy"></figure>
<div style="text-align:center;font-size:80%">æŒ‡å°–æ¢æ¡ˆå°ç¨‹åºè¯„è®º</div>
<p>å¯¹æ¯”App Storeä¸­çš„è¯„è®ºï¼Œå¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„å®ç°è¿˜æ˜¯ç›¸å¯¹å®Œç¾<br>
<img src="https://aiyou.life/post-images/1599318937357.jpg" alt="" loading="lazy"></p>
<div style="text-align:center;font-size:80%">AppStoreè¯„è®º</div>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p><a href="https://juejin.im/post/5dc15b35f265da4d432a3d10#heading-9">å¯èƒ½æ˜¯æœ€å…¨çš„ â€œæ–‡æœ¬æº¢å‡ºæˆªæ–­çœç•¥â€ æ–¹æ¡ˆåˆé›†</a></p>
]]></content>
    </entry>
</feed>